<?php
require_once("grn/MySQLConfiguration.csp");
require_once("cydec/UDFNotifier.csp");
require_once('grn/cli.csp');

$options = cb_cli_start(
// Mandatory command-line options
    [
        new CB_CLI_DB_ADMIN_PASSWORD_OPTION(),
    ]
);

$notifier = \grn\cydec\UDFNotifier::create();
$mysqlConfiguration = \grn\grn\MySQLConfiguration::create();

if ( ! $mysqlConfiguration->isAvailableEventScheduler()) {
    cb_cli_log("[Warning] property event_scheduler is OFF");
}

if ( ! $mysqlConfiguration->isAvailablePluginDirectory()) {
    cb_cli_log("[Error] configuration plugin_dir isn't defined");
    cb_safe_exit(1);
}

if ( ! $notifier->validateUDFNotifierExists($mysqlConfiguration)) {
    cb_cli_log(sprintf("[Error] library file %s not found.",
        $notifier->getUDFNotifierPath($mysqlConfiguration)));
    cb_safe_exit(1);
}

if ( ! $notifier->validateUDFNotifierReadable($mysqlConfiguration)) {
    cb_cli_log(sprintf("[Error] library file(%s) isn't readable.",
        $notifier->getUDFNotifierPath($mysqlConfiguration)));
    cb_safe_exit(1);
}

$notifier->enable($options["db_admin_password"]);
cb_cli_log("[Success] UDF notifier is available.");
