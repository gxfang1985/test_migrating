<?php
cb_require_role('CommandLine');
require_once('grn/cli.csp');

define('DZLK_MODULE_NAME', 'Dezie');

$dz_url_option = new CB_CLI_URL_OPTION();
$dz_url_option->setModuleName(DZLK_MODULE_NAME);

$options = cb_cli_start([$dz_url_option]);

$url = $options['url'];

require_once('dezielink/sync_user_manager.csp');
$sync_logic = GRN_DezieLink_SyncUserLogic::getInstance($url);

$sync_man = GRN_Connector_SyncUserManager::getInstance();
$sync_man->setSyncLogic($sync_logic);

$sync_man->runSync();

//Logging
require_once('dezielink/inspection.csp');
$logger = GRN_Dezielink_Inspection::getInstance();
if ($logger->isEnabled()) {
    $log_params = [
        'url' => $url,
        'cmd' => 1
    ];
    $logger->writeInspectionLogNotice('sync', 'dezielink_sync_user',
        $log_params);
}

