<?php

use grn\grn\Validate;

cb_require_role('CommandLine');
$article_id = cb_at($argv, '1', null);
if (Validate::isNumber($article_id)) {
    require_once('bulletin/article.csp');
    $article_factory = GRN_Bulletin_ArticleFactory::getInstance();
    $article = $article_factory->get($article_id);

    if ($article instanceof GRN_Bulletin_Article && $article->isPublished()
        && ($article->get('start_timestamp') instanceof CB_TimeStamp)
    ) {
        require_once('bulletin/notification.csp');
        $bulletin_notification_listener
            = new GRN_Bulletin_NotificationListener();
        $bulletin_notification_listener->registerBackgroundNotification('create',
            $article,
            $article->getSenderForNotification($article->get('creator'),
                $article->get('creator_name')),
            $article->get('subject'),
            $article->get('data'),
            $article->get('start_timestamp'));
    }
}
