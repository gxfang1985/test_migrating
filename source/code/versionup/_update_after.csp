<?php

class CB_ModuleUpdaterAfterInstall
{
    var $_config = null;

    function __construct($file)
    {
        if ( ! file_exists($file)) {
            $h_file = fopen($file, 'w');
            fclose($h_file);
        }
        $this->_config = new CB_ConfigManager($file);
    }

    function requireUpdate($module, $version)
    {
        $this->_config->set($module, $version, '1');
        $this->_config->save();
    }

    function doUpdate($module_base_dir)
    {
        $modules = $this->_config->getSections();
        foreach ($modules as $module) {
            $version_list = $this->_config->getSection($module);
            foreach (array_keys($version_list) as $version) {
                $script = $module_base_dir
                          . "/$module/$version/scripts/update_after.csp";
                if (is_file($script)) {
                    @include($script);
                }
            }
        }
    }
}

