<?php
require_once('grn/application.csp');
require_once('grn/file.csp');

use grn\versionup\v7_2_910\Updater as v7_2_910_Updater;
use grn\versionup\v7_5_1000\Updater as v7_5_1000_Updater;
use grn\versionup\v7_7_1010\Updater as v7_7_1010_Updater;

function grn450_local_main()
{
    cb_export_log('Started grn450_local_main. ', false);

    /****************************************
     *  update the version number of profile data
     ****************************************/
    $version = '4.5.0';
    require_once('fw/profile.csp');
    $profile = cb_get_system_profile('grn.common.system');
    $profile->createAttribute('version', $version);

    cb_export_log('Updated the version number of system attribute: ' . $version,
        false);

    /****************************************
     *  update other data and schema
     ****************************************/
    $updater = new v7_2_910_Updater();
    $updater->runMiddle();

    $updater = new v7_5_1000_Updater();
    $updater->runBefore();
    $updater->runMiddle();
    $updater->runAfter();

    $updater = new v7_7_1010_Updater();
    $updater->runMiddle();

    global $G_module_updater_after;
    $G_module_updater_after->requireUpdate('grn', $version);

    cb_export_log('Finished grn450_local_main. ', false);
}

grn450_local_main();
