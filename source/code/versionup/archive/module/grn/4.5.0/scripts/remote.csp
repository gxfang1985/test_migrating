<?php

function grn450_remote_main()
{
    //////////////////////////////
    // resource update
    //////////////////////////////
    cb_export_log('Started grn450_remote_main. ', false);

    // GTM-3029 Delete cbdnet ini files
    cb_export_log('Start delete 42cbdnet.ini.', false);
    $full_ini_path = cb_basedir() . '/grn/42cbdnet.ini';
    if (is_file($full_ini_path)) {
        unlink($full_ini_path);
    }
    cb_export_log('End delete 42cbdnet.ini.', false);

    cb_export_log('Start delete old version binary files', false);
    $deleted_files = [
        '/libphp5_httpd22.so',
        '/libphp5_httpd24.so',
        '/php5.dll',
        '/extensions/ixed.5.6.lin',
        '/extensions/ixed.5.6.win'
    ];

    foreach ($deleted_files as $file) {
        $full_deleted_file_path = cb_basedir() . $file;
        if (is_file($full_deleted_file_path)) {
            unlink($full_deleted_file_path);
            cb_export_log('Delete ' . $full_deleted_file_path, false);
        }
    }
    cb_export_log('End delete old version binary files', false);

    // Start common.ini file
    global $G_config_common;
    cb_export_log("Start update common.ini.", false);

    cb_export_log("Start set API section.", false);
    $G_config_common->set('API', 'version', '1.9.0');
    cb_export_log("End set API section.", false);

    $G_config_common->save();
    cb_export_log("End update common.ini.", false);
    // End common.ini file

    // Start garoon.ini file
    global $G_config_grn;
    cb_export_log("Start update garoon.ini.", false);

    $version = '4.5.0';
    cb_export_log("Start set Locale section.", false);
    $G_config_grn->set('System', 'version', $version);
    $G_config_grn->set('Locale', 'ja_version', $version);
    $G_config_grn->set('Locale', 'en_version', $version);
    $G_config_grn->set('Locale', 'zh_version', $version);
    cb_export_log("End set Locale section.", false);

    $G_config_grn->save();
    cb_export_log("End update garoon.ini.", false);
    // End garoon.ini file

    // Start applications ini file
    $grn_ini_dir = cb_basedir() . '/grn/';
    cb_export_log("Start update 11space.ini.", false);
    $space_ini = $grn_ini_dir . '11space.ini';
    write_ini_item($space_ini, 'version', '4.5.0');
    cb_export_log("End update 11space.ini.", false);

    cb_export_log('Finished grn450_remote_main. ', false);
    // End applications ini file
}

grn450_remote_main();
