<?php
declare(strict_types=1);

require_once('grn/application.csp');
require_once('grn/file.csp');

use grn\versionup\v18_5_0\Updater as v18_5_0_Updater;
use grn\versionup\v18_5_1\Updater as v18_5_1_Updater;

function grn490_local_main()
{
    cb_export_log('Started ' . __FUNCTION__ . '. ', false);

    /****************************************
     *  update the version number of profile data
     ****************************************/
    $version = '4.9.0';
    require_once('fw/profile.csp');
    $profile = cb_get_system_profile('grn.common.system');
    $profile->createAttribute('version', $version);

    cb_export_log('Updated the version number of system attribute: ' . $version,
        false);

    /****************************************
     *  update other data and schema
     ****************************************/

    $updater = new v18_5_0_Updater();
    $updater->runBefore();
    $updater->runMiddle();
    $updater->runAfter();

    $updater = new v18_5_1_Updater();
    $updater->runBefore();
    $updater->runMiddle();
    $updater->runAfter();

    global $G_module_updater_after;
    $G_module_updater_after->requireUpdate('grn', $version);

    cb_export_log('Finished ' . __FUNCTION__ . '. ', false);
}


grn490_local_main();
