<?php

function grn430_remote_main()
{
    //////////////////////////////
    // resource update
    //////////////////////////////
    cb_export_log('Started grn430_remote_main. ', false);

    global $G_config_common;

    // Start common.ini file
    cb_export_log("Start update common.ini.", false);

    cb_export_log("Start set API section.", false);
    $G_config_common->set('API', 'version', '1.7.0');
    cb_export_log("End set API section.", false);

    $G_config_common->save();
    cb_export_log("End update common.ini.", false);
    // End common.ini file

    // Start garoon.ini file
    global $G_config_grn;
    cb_export_log("Start update garoon.ini.", false);

    $version = '4.3.0';
    cb_export_log("Start set Locale section.", false);
    $G_config_grn->set('System', 'version', $version);
    $G_config_grn->set('Locale', 'ja_version', $version);
    $G_config_grn->set('Locale', 'en_version', $version);
    $G_config_grn->set('Locale', 'zh_version', $version);
    cb_export_log("End set Locale section.", false);

    $G_config_grn->save();
    cb_export_log("End update garoon.ini.", false);
    // End garoon.ini file

    // Start lwc.ini file
    $lwc = new CB_ConfigManager(cb_basedir() . '/lwc.ini');

    cb_export_log("Start delete profile_config section.", false);
    $lwc->unsetSection('profile_config');
    cb_export_log("End delete profile_config section.", false);

    cb_export_log("Start delete cacher_config section.", false);
    $lwc->unsetSection('cacher_config');
    cb_export_log("End delete cacher_config section.", false);

    $lwc->save();
    // End lwc.ini file

    // Start profile.ini file
    cb_export_log("Start delete profile.ini.", false);
    $profile_ini = cb_basedir() . '/profile.ini';
    if (is_file($profile_ini)) {
        unlink($profile_ini);
    }
    cb_export_log("End delete profile.ini.", false);
    // End profile.ini file

    // Start cacher.ini file
    cb_export_log("Start delete cacher.ini.", false);
    $cacher_ini = cb_basedir() . '/cacher.ini';
    if (is_file($cacher_ini)) {
        unlink($cacher_ini);
    }
    cb_export_log("End delete cacher.ini.", false);
    // End cacher.ini file

    // Start sync.ini file
    cb_export_log("Start delete 52sync.ini.", false);
    $sync_ini = cb_basedir() . '/grn/52sync.ini';
    if (is_file($sync_ini)) {
        unlink($sync_ini);
    }
    cb_export_log("End delete 52sync.ini.", false);
    // End sync.ini file

    // Start applications ini file
    $grn_ini_dir = cb_basedir() . '/grn/';
    cb_export_log("Start update 11space.ini.", false);
    $space_ini = $grn_ini_dir . '11space.ini';
    write_ini_item($space_ini, 'version', '4.3.0');
    cb_export_log("End update 11space.ini.", false);

    foreach (
        [
            '13schedule.ini',
            '18memo.ini',
            '21todo.ini',
            '22address.ini',
            '24mail.ini'
        ] as $app_ini_filename
    ) {
        cb_export_log("Start update ${app_ini_filename}.", false);
        remove_ini_item($grn_ini_dir . $app_ini_filename, 'sync_prefix');
        cb_export_log("End update ${app_ini_filename}.", false);
    }

    cb_export_log('Finished grn430_remote_main. ', false);
    // End applications ini file
}

grn430_remote_main();
