<?php

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

// page title
$page_title
    = grn_get_current_page_display_name(['app_name' => $G_report_app_name]);
$t->assign('page_title', $page_title);

$form_name = cb_get_pagename();
$t->assign('form_name', $form_name);

// Check Modify Right
$user_id = $G_report_login_user->getOID();
require_once('report/controller_util.csp');
$report_util = GRN_Report_Report_Controller_Utility::getInstance();
$report = $report_util->getSimpleView(@$G_INPUT['rid']);
$creator_id = isset($report['creator']) ? $report['creator'] : null;
if ( ! $report_util->isModifiable($user_id, $creator_id, @$G_INPUT['rid'])) {
    require_once('report/error_code.csp');
    cb_throw_error(E_GRN_RPRT_REPORT_DENY_MODIFY);
}

include('_notification_modify.csp');

$t->assign('site_position', [
        [
            'page' => 'report/index',
            'name' => grn_get_page_display_name('report/index'),
            'sf'   => 1
        ],
        [
            'page' => 'report/view',
            'name' => grn_get_page_display_name('report/view'),
            'rid'  => @$G_INPUT['rid']
        ],
        ['page' => '', 'name' => $page_title]
    ]
);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


