<?php

// report/cellular function
require_once('report/cellular.csp');

global $G_INPUT;

// LoginUser
global $G_login_user;
global $G_cellular_login;
global $G_uum;
global $G_container_app;
if ( ! isset($G_uum)) {
    $G_uum = $G_container_app->getInstance('uum');
}
if ( ! isset($G_cellular_login)) {
    $G_cellular_login = $G_uum->getLoginUser();
}
$G_login_user = $G_cellular_login;

global $G_report_login_user;
$G_report_login_user = $G_login_user;

// 報告書ケータイの利用権限をチェック
if (is_object($G_login_user)) {
    require_once('grn/application.csp');
    $locator = GRN_ApplicationLocator::instance();
    if ( ! ($report = $locator->getInstance('report'))) {
        require_once('grn/error_code.csp');
        cb_throw_error(E_GRN_APPLICATION_NOT_ACTIVE);
    }

    // ライセンスの状態に関わらず利用停止設定を参照する

    require_once('report/config.csp');
    $configs = GRN_Report_Configs::getInstance();
    $config = $configs->getPersonalConfig($G_login_user->getOID());

    if ($config->getSuspension()) {
        require_once('report/error_code.csp');
        cb_throw_error(E_GRN_RPRT_CELLULAR_UNDER_SUSPENSION);
    }
    unset($locator, $report, $license, $configs, $config);
}

// ケータイアプリをチェック
global $G_cellular;
unset($G_cellular);

require_once('report/cellular.csp');
if (__grn_report_is_cellular_application()) {
    require_once('grn/application.csp');
    $locator = GRN_ApplicationLocator::instance();
    $G_cellular = $locator->getInstance('cellular');
    unset($locator);
}

// Page Path
global $G_pagepath;
$G_pagepath = dirname(cb_get_pagename());

if ( ! __grn_report_is_cellular_application()) {
    // 基本はコピーライトを表示しない
    global $G_state_set;
    $G_state_set->set('copyright_should_be_written', false);
}


