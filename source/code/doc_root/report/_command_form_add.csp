<?php

$category_id = array_key_exists('cid', $G_INPUT) ? $G_INPUT['cid'] : null;
$name = array_key_exists('name', $G_INPUT) ? $G_INPUT['name'] : null;
$foreign_key = array_key_exists('foreign_key', $G_INPUT)
    ? $G_INPUT['foreign_key'] : null;
$enable_follow = array_key_exists('enable_follow', $G_INPUT)
    ? $G_INPUT['enable_follow'] : null;
$enable_member = array_key_exists('enable_member', $G_INPUT)
    ? $G_INPUT['enable_member'] : null;
$enable_partner = array_key_exists('enable_partner', $G_INPUT)
    ? $G_INPUT['enable_partner'] : null;
$memo = array_key_exists('memo', $G_INPUT) ? $G_INPUT['memo'] : null;

//null check
require_once('report/resources.csp');
if (is_null($enable_follow)) {
    $enable_follow = GRN_REPORT_DISABLE;
}
if (is_null($enable_member)) {
    $enable_member = GRN_REPORT_DISABLE;
}
if (is_null($enable_partner)) {
    $enable_partner = GRN_REPORT_DISABLE;
}

//Check Category Exists
if (GRN_REPORT_CATEGORY_NONPARTY_ID != $category_id) {
    require_once('report/category_logic_base.csp');
    $category_logic_base = GRN_Report_Category_Logic_Base::getInstance();
    $category = &$category_logic_base->get($category_id);
}

//Add Form
require_once('report/form_logic.csp');
$form_logic = GRN_Report_Form_Logic::getInstance();
$form_id = $form_logic->add($name, $foreign_key, $enable_follow,
    $enable_member, $enable_partner, $memo, $category_id);

//Add Stardard Item
require_once('report/item_logic.csp');
$item_logic = GRN_Report_Item_Logic::getInstance();
$item_logic->addStandard($form_id);
