<?php
global $G_INPUT;

//Get Category and Form ID
$form_id = @ $G_INPUT['fid'];

//Get login User ID
global $G_report_login_user;
$uid = $G_report_login_user->getOID();

//Get Form and Item Controller Utility
require_once('report/controller_util.csp');
$form_util = GRN_Report_Form_Controller_Utility::getInstance();
$item_util = GRN_Report_Item_Controller_Utility::getInstance();

//Create Parameter Translation Map
$translation_map_form = [
    //Form Information
    'fid'            => '_id',              //Form ID
    'name'           => 'name',             //Form Name
    'foreign_key'    => 'foreign_key',      //Form Foreign key
    'memo'           => 'memo',             //Form Memo
    'admin_memo'     => 'admin_memo',       //Form Admin Memo
    'type'           => 'type',             //Form Type
    'deleted'        => 'deleted',          //Form Deleted
    'category'       => 'category',         //Form Category
    'active'         => 'active',           //Form Active
    'enable_member'  => 'enable_member',    //Form Enable Member
    'enable_partner' => 'enable_partner',   //Form Enable Partner
];

//Create Parameter Translation Map
$translation_map_item = [
    'iid'                => '_id',                  //Item ID
    'display_name'       => 'display_name',         //Item Display Name
    'type'               => 'type',                 //Item Type
    'option_string'      => 'option_string',        //Item Option String
    'option_string_type' => 'option_string_type',   //Item Option String Type
    'description'        => 'description',          //Item Description
    'description_type'   => 'description_type',     //Item Description Type
    'description_editor' => 'description_editor',   //Item Description Editor
    'data_type'          => 'data_type',            //Item data_type
    'form'               => 'form',                 //Item Form
    'settings'           => 'settings',             //Item Settings
    'required'           => 'required',             //Item Reuired Flag
    'list_index'         => 'list_index',           //Item List Index
    'display_type'       => 'display_type',         //Display_type
];

//Get Form for view
if ( ! isset($form_for_view)) {
    $form_for_view = $form_util->getView($form_id, $translation_map_form);
}

//Get Category ID
$category_id = $form_for_view['category'];
$category_id = $category_id ? $category_id : GRN_REPORT_CATEGORY_NONPARTY_ID;

//Get Item List for view
$item_list_for_view = $item_util->getListView($translation_map_item, $form_id);

//Set disable flag
foreach (array_keys($item_list_for_view) as $item_id) {
    $item_list_for_view[$item_id]['disabled'] = true;
}


//Create Item Layout
$current = null;
foreach (array_keys($item_list_for_view) as $item_id) {
    //Check Current or Sub Item
    $current =& $item_list_for_view[$item_id];
}

$t->assign('plugin', [
    'name'   => 'common',
    'params' => [
        'action'       => null,
        'session_name' => cb_get_pagename(),
        'app_id'       => 'report'
    ]
]);

//Assign Category ID
$t->assign('category_id', $category_id);
//Assign Form ID
$t->assign('form_id', $form_id);

//Assign Form
$t->assign('form', $form_for_view);
//Assign Item List
$t->assign('item_list', $item_list_for_view);

