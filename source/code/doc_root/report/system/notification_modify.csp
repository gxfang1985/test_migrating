<?php

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

// page title
$page_title
    = grn_get_current_page_display_name(['app_name' => $G_report_app_name]);
$t->assign('page_title', $page_title);

$form_name = cb_get_pagename();
$t->assign('form_name', $form_name);

require_once('report/controller_util.csp');
$report_util = GRN_Report_Report_Controller_Utility::getInstance();

$report_id = @ $G_INPUT['rid'];

$report = $report_util->getSimpleView($report_id);
if ( ! $report || $report['draft']) {
    require_once('report/error_code.csp');
    cb_throw_error(E_GRN_RPRT_REPORT_NOT_FOUND);
}

//Get Category ID
$category_id = $report['category'];
if ( ! $category_id) {
    $category_id = GRN_REPORT_CATEGORY_NONPARTY_ID;
}
$t->assign('category_id', $category_id);
$t->assign('form_id', $report['form']);

include('../_notification_modify.csp');

$t->assign('site_position', [
        [
            'page' => 'report/system/report_list',
            'name' => grn_get_page_display_name('report/system/report_list'),
            'cid'  => @$G_INPUT['cid'],
            'fid'  => @$G_INPUT['fid']
        ],
        [
            'page' => 'report/system/report_view',
            'name' => grn_get_page_display_name('report/system/report_view'),
            'cid'  => @$G_INPUT['cid'],
            'fid'  => @$G_INPUT['fid'],
            'rid'  => @$G_INPUT['rid']
        ],
        ['page' => '', 'name' => $page_title]
    ]
);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


