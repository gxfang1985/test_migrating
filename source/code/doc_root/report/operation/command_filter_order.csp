<?php
require_once('report/resources.csp');

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    global $G_INPUT;

    //Create Parameter Translation Map
    $category_id = array_key_exists('cid', $G_INPUT) ? $G_INPUT['cid'] : null;
    $order = array_key_exists('order', $G_INPUT) ? $G_INPUT['order']
        : null;

    //Check Parent Filter ID
    $category_id = $category_id ? $category_id : GRN_REPORT_CATEGORY_ROOT_ID;

    //Change Order Filter
    require_once('report/filter_logic.csp');
    $filter_logic = GRN_Report_Filter_Logic::getInstance();
    $filter_logic->changeOrder($order);

    //監査する
    require_once('report/inspection.csp');
    $inspection = GRN_Report_Filter_Inspection::getInstance();
    if ($inspection->isEnabled()) {
        $message_type = 'filter_order';

        $message_args = [];
        $message_args['cid'] = $category_id;
        $message_args['fids'] = $order;

        //Record Inspection
        $inspection->record($message_type, $message_args);
    }

    //Redirect Next Page
    cb_redirect('report/operation/filter_index', ['cid' => $category_id]);
}


