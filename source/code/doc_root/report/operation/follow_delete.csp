<?php

global $G_INPUT;

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once('report/controller_util.csp');
$utility = new GRN_Report_ControllerUtil();

$category_id = @$G_INPUT['cid'];

// 未分類カテゴリか確認
if (GRN_REPORT_CATEGORY_NONPARTY_ID == $category_id) {
    require_once('report/error_code.csp');
    cb_throw_error(E_GRN_RPRT_MANAGE_DENY_NONPARTY_CATEGORY);
}

// 未分類カテゴリ以外は運用管理権限とアクセス権を確認
$category_util->checkManage($category_id, true, CB_DATABASE_NO_LOCK);
$category_util->checkAccess($category_id, true, CB_DATABASE_NO_LOCK);

//Get Category and Form Controller Utility
require_once('report/controller_util.csp');
$form_util = GRN_Report_Form_Controller_Utility::getInstance();
$category_util = GRN_Report_Category_Controller_Utility::getInstance();

// site position
$page_path = [
    "report/index"                 => ['sf' => 1],
    "report/operation/report_list" => [
        'cid' => @$G_INPUT['cid'],
        'fid' => @$G_INPUT['fid']
    ],
    "report/operation/report_view" => [
        'cid' => @$G_INPUT['cid'],
        'fid' => @$G_INPUT['fid'],
        'rid' => @$G_INPUT['rid']
    ],
];


$utility->setSitePosition($t, $page_path);


require_once('../_follow_delete.csp');

$t->display(cb_get_pagename() . ".tpl");

