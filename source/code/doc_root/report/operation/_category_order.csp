<?php

//Get Parameter
$parent_category_id = @ $G_INPUT['pcid'];   //Parent Category ID

//Get Report and Category Controller Utility
require_once('report/controller_util.csp');
$category_util = GRN_Report_Category_Controller_Utility::getInstance();

//Check Parent Category ID
require_once('report/resources.csp');
$parent_category_id = $parent_category_id ? $parent_category_id
    : GRN_REPORT_CATEGORY_ROOT_ID;

//Create Parameter Translation Map
$translation_map = [
    'cid'  => '_id',
    'name' => 'name',
];

//Get Parent Category for View
$parent_category_for_view = $category_util->getView($parent_category_id,
    $translation_map, GRN_REPORT_ACCESS_TYPE_MANAGE);

//Get Child Category List for View
$child_category_list_for_view
    = $category_util->getChildListView($parent_category_id, $translation_map,
    GRN_REPORT_ACCESS_TYPE_MANAGE);
if (count($child_category_list_for_view) == 0) {
    cb_throw_error(E_GRN_RPRT_EMPTY_SUBCATEGORY);
}

//Create Category Information
$category_information_for_view = $parent_category_for_view;
foreach ($child_category_list_for_view as $child_category_for_view) {
    $category_information_for_view['child_categories'][$child_category_for_view['cid']]
        = $child_category_for_view['name'];
}

//Assign Parent Category Name
$t->assign('category', $category_information_for_view);


