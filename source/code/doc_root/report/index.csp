<?php
global $G_INPUT;
global $G_report_login_user;

require_once('report/controller_util.csp');
//Instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Get Session
require_once('fw/session_manager.csp');
$session_manager = CB_SessionManager::getInstance();
$session = $session_manager->getSession(cb_get_pagename());

if (@ $G_INPUT['sf']) {
    $param = "";
    $type = $session->get('type');
    $fid = $session->get('fid');
    $sp = $session->get('sp');

    $t->assign('type', $type);
    $t->assign('fid', $fid);
    $t->assign('sp', $sp);
    $t->assign('sf', true);
}

include('_menu.csp');
$t->assign('app_name', $G_report_app_name);

//Get User Config
require_once('grn/ui.csp');
$manager = GRN_UIConfigManager::getInstance();
$config = $manager->getUserConfig($G_report_login_user);

//Get paging size
$pagingSize = $config->getListMax();
$t->assign('pagingSize', $pagingSize);

//Check Manage
$category_util = GRN_Report_Category_Controller_Utility::getInstance();
$is_manage = $category_util->evaluateManage();
$t->assign('is_manage', $is_manage);

if ($is_manage) {
    //ルートカテゴリのアクセス権を確認する
    if ( ! $category_util->checkAccess(GRN_REPORT_CATEGORY_ROOT_ID, false)) {
        $t->assign('root_disable', true);
    }
}

//page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

//site position
$site_position = [['page' => 'report/index.csp', 'name' => $page_title]];
$t->assign('site_position', $site_position);

//Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


