<?php

global $G_INPUT;

global $G_state_set;
$G_state_set->set('copyright_should_be_written', false);
$G_state_set->set('html_should_be_closed', false);

//Instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Create Parameter Translation Map
$translation_map_item = [
    'iid'                => '_id',                  //Item ID
    'type'               => 'type',                 //Item ID
    'display_name'       => 'display_name',         //Item Display Name
    'description'        => 'description',          //Item Description
    'description_type'   => 'description_type',     //Item Description Type
    'description_editor' => 'description_editor',   //Item Description Editor
];

//Get Parameter
$mode = @ $G_INPUT['mode'];   //Mode (none/reuse/draft/return)
if ( ! $mode) {
    //Send

    $category_id = @ $G_INPUT['category_id'];    //Category ID
    $form_id = @ $G_INPUT['form_id'];        //Form ID
    $item_id = @ $G_INPUT['item_id'];      //Item ID

    //Get Item Controller Utility
    require_once('report/controller_util.csp');
    $item_util = GRN_Report_Item_Controller_Utility::getInstance();

    //Get Item for view
    $item_for_view = $item_util->getView($item_id, $translation_map_item,
        $form_id);
} elseif ($mode == 'remand') {
    //Remand

    $category_id = @ $G_INPUT['category_id'];    //Category ID
    $report_id = @ $G_INPUT['report_id'];    //Folder ID
    $item_data_id = @ $G_INPUT['item_data_id'];   //Item Data ID

    //Get Item Data Controller Utility
    require_once('report/controller_util.csp');
    $item_util = GRN_Report_ItemData_Controller_Utility::getInstance();

    //Get Item for view
    $item_for_view = $item_util->getView($item_data_id, $translation_map_item,
        $report_id);
} else {
    //Draft or Reuse

    $category_id = @ $G_INPUT['category_id'];  //Category ID
    $report_id = @ $G_INPUT['report_id'];  //Folder ID
    $item_id = @ $G_INPUT['item_id'];      //Item ID

    //Get Item Controller Utility
    require_once('report/controller_util.csp');
    $item_util = GRN_Report_Item_Controller_Utility::getInstance();

    //Get Item for view
    $item_for_view = $item_util->getView($item_id, $translation_map_item);
}

if ($mode != 'remand' && ! is_null($category_id)) {
    if (GRN_REPORT_CATEGORY_NONPARTY_ID != $category_id) {
        require_once('report/controller_util.csp');
        $category_util = GRN_Report_Category_Controller_Utility::getInstance();
        $category_util->checkAccess($category_id, true, CB_DATABASE_NO_LOCK);
    }
}

$sf = @ $G_INPUT['sf'];     //Session Hold Flag


//Assign Display Infomation
$t->assign('item', $item_for_view);

//-- set page title and site position

//page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

//Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


