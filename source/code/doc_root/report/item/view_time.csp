<?php

/**
 * Description for Settings Parameters for Time
 *
 * unit                   ->      Time Minute Unit
 * initial_type           ->      Initial Time Type(0:Blank/1:Now/2:Initlal Value)
 * initial_hour           ->      Initial Hour
 * initial_minute         ->      Initial Minute
 **/

global $G_INPUT;

// instantiate an Smarty object
require_once("grn/smarty.csp");
//$t = $smarty;

//Get Item from Template Variable
$item_for_view = $t->get_template_vars('item');
$show_blank = true;
if ($item_for_view['required'] == 1) {
    $show_blank = false;
}

//Check Table Name
if ($item_for_view['table'] == GRN_REPORT_TABLE_ITEM
    || $item_for_view['table'] == GRN_REPORT_TABLE_ITEMDATA
) {
    if ( ! array_key_exists('number', $item_for_view)) {
        $item_for_view['time'] = null;

        //Get Initial Value From Sttings
        if ($item_for_view['settings']['initial_type']
            == GRN_REPORT_ITEM_TIME_INITIAL_VALUE_NOW_TIME
        ) {
            $tsex = new CB_TimeStampEx();
            $time = $tsex->getTime();
            $item_for_view['time'] = $time;
        } elseif ($item_for_view['settings']['initial_type']
                  == GRN_REPORT_ITEM_TIME_INITIAL_VALUE_SPECIFIC_TIME
        ) {
            $time = new CB_Time();
            $time->hour = $item_for_view['settings']['initial_hour'];
            $time->minute
                = $item_for_view['settings']['initial_minute'];
            $item_for_view['time'] = $time;
        } else {
            $time = new CB_Time();
            $time->hour = null;
            $time->minute = null;
            $item_for_view['time'] = $time;
        }
    } else {
        if (is_null($item_for_view['number'])) {
            $time = new CB_Time();
            $time->hour = null;
            $time->minute = null;
            $item_for_view['time'] = $time;
        } else {
            require_once('report/item_resources.csp');
            $item_util = grn_report_get_item_util($item_for_view['data_type']);
            $item = ['col_number' => $item_for_view['number']];
            $time = $item_util->getItemData($item);
            $item_for_view['time'] = $time;
            unset($item, $time);
        }
    }
} else {
    if (is_null($item_for_view['number'])) {
        $time = new CB_Time();
        $time->hour = null;
        $time->minute = null;
        $item_for_view['time'] = $time;
    } else {
        require_once('report/item_resources.csp');
        $item_util = grn_report_get_item_util($item_for_view['data_type']);
        $item = ['col_number' => $item_for_view['number']];
        $time = $item_util->getItemData($item);
        $item_for_view['time'] = $time;
        unset($item, $time);
    }
}

//Assign Display Infomation
$t->assign('item_id', $item_for_view['iid']);
$t->assign('display', $display);
$t->assign('item', $item_for_view);
$t->assign('settings', $item_for_view['settings']);
$t->assign('show_blank', $show_blank);

//-- set page title and site position

// Ignore Licence Warnning
$t->skipWarning();

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("report/item/view_time.tpl");
