<?php

/**
 * Description for Settings Parameters for Numeric Item
 *
 * input_numbers          ->      input number check flag(0:no check/1:check by max and min value)
 * max_input_number       ->      max input number for input_numbers check
 * min_input_number       ->      min input number for input_numbers check
 * initial_value          ->      initial value
 * effective_figures      ->      efective figures for input number
 * minus_type             ->      display type for minus(0:-/1:▼/2:▽)
 * right_align            ->      display input number right align
 * split_rank             ->      display input number split rank(10000 -> 10,000)
 **/

global $G_INPUT;

// instantiate an Smarty object
require_once("grn/smarty.csp");
//$t = $smarty;

//Get Item from Template Variable
$item_for_view = $t->get_template_vars('item');

//Check Table Name
if ($item_for_view['table'] == GRN_REPORT_TABLE_ITEM) {
    if ( ! array_key_exists('number', $item_for_view)) {
        //Get Initial Value From Settings
        $item_for_view['number'] = $item_for_view['settings']['initial_value'];
    }
}

//Format Process for View
if (($display == 'view' || $display == 'view-system'
     || $display == 'view-operation'
     || $display == 'view-confirm')
    && array_key_exists('number', $item_for_view)
    && strlen(trim($item_for_view['number']))
) {
    //Preparation for format parameter.
    $thousandsSep = $item_for_view['settings']['split_rank'] ? ',' : '';
    $decimals
        = (int)$item_for_view['settings']["effective_figures"];
    $decPoint = '.';
    $minusChar = cb_msg(GRN_REPORT_MODULE_ID,
        'minus_type_' . $item_for_view['settings']['minus_type']);
    $isDecimalZeroPadding = true;

    require_once('fw/string_util.csp');
    $item_for_view['number'] = cb_number_format($item_for_view['number'],
        $decimals, $decPoint, $thousandsSep, $minusChar, $isDecimalZeroPadding);
}

//Assign Display Infomation
// Assign Item ID
$t->assign('item_id', $item_for_view['iid']);

// Display 
$t->assign('display', $display);

// Assign Item
$t->assign('item', $item_for_view);
// Assign Settings
$t->assign('settings', $item_for_view['settings']);

//-- set page title and site position

// Ignore Licence Warnning
$t->skipWarning();

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("report/item/view_numeric.tpl");


