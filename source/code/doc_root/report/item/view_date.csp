<?php

/**
 * Description for Settings Parameters for Date
 *
 * initial_type           ->      Initial Date Type(0:Now/1:Initlal Value)
 * initial_year           ->      Initial Year
 * initial_month          ->      Initial Month
 * initial_day            ->      Initial Day
 **/

global $G_INPUT;

// instantiate an Smarty object
require_once("grn/smarty.csp");
//$t = $smarty;

//Get Item from Template Variable
$item_for_view = $t->get_template_vars('item');
$show_blank = true;
//Check Table Name
if ($item_for_view['table'] == GRN_REPORT_TABLE_ITEM
    || $item_for_view['table'] == GRN_REPORT_TABLE_ITEMDATA
) {
    if ( ! array_key_exists('number', $item_for_view)) {
        $item_for_view['text'] = [];

        //Get Initial Value From Sttings
        if ($item_for_view['settings']['initial_type'] == 0) {
            $tsex = new CB_TimeStampEx();
            $date = $tsex->getDate();
            unset($tsex);
            $item_for_view['text']['year'] = $date->year;
            $item_for_view['text']['month'] = $date->month;
            $item_for_view['text']['day'] = $date->day;
        } elseif ($item_for_view['settings']['initial_type'] == 1) {
            $item_for_view['text']['year']
                = $item_for_view['settings']['initial_year'];
            $item_for_view['text']['month']
                = $item_for_view['settings']['initial_month'];
            $item_for_view['text']['day']
                = $item_for_view['settings']['initial_day'];
        } else {
            $item_for_view['text'] = [];
        }
    } else {
        if (is_null($item_for_view['number'])) {
            $item_for_view['text']['year'] = null;
            $item_for_view['text']['month'] = null;
            $item_for_view['text']['day'] = null;
        } else {
            $ts = new CB_TimeStamp();
            $ts->unix_ts = $item_for_view['number'];
            $tsex = new CB_TimeStampEx($ts);
            $date = $tsex->getDate();
            unset($tsex);
            $item_for_view['text']['year'] = $date->year;
            $item_for_view['text']['month'] = $date->month;
            $item_for_view['text']['day'] = $date->day;
        }
    }
} else {
    if (is_null($item_for_view['number'])) {
        $item_for_view['text']['year'] = null;
        $item_for_view['text']['month'] = null;
        $item_for_view['text']['day'] = null;
    } else {
        $ts = new CB_TimeStamp();
        $ts->unix_ts = $item_for_view['number'];
        $tsex = new CB_TimeStampEx($ts);
        $date =& $tsex->getDate();
        unset($tsex);
        $item_for_view['text']['year'] = $date->year;
        $item_for_view['text']['month'] = $date->month;
        $item_for_view['text']['day'] = $date->day;
    }
}

if (array_key_exists('number', $item_for_view)) {
    $datets = new CB_TimeStamp();
    $datets->unix_ts = $item_for_view['number'];
    $item_for_view['datets'] = $datets;
}

//Get Initial Value From Sttings
$tsex = new CB_TimeStampEx();
$initial_date = $tsex->getDate();
if (array_key_exists('text', $item_for_view)) {
    $initial_date->year = @$item_for_view['text']['year'];
    $initial_date->month = @$item_for_view['text']['month'];
    $initial_date->day = @$item_for_view['text']['day'];
}

//Assign Display Infomation

// Assign Item ID
$t->assign('item_id', $item_for_view['iid']);

// Display
$t->assign('display', $display);

// Assign Item
$t->assign('item', $item_for_view);
// Assign Settings
$t->assign('settings', $item_for_view['settings']);

// Assign Initial Date
$t->assign('initial_date', $initial_date);

// Assign Show Blank
$t->assign('show_blank', $show_blank);

// Assign Current Language
require_once('fw/i18n.csp');
$i18n = CB_I18N::getInstance();
$current_language = strtolower($i18n->getCurrentLanguage());
$t->assign('current_language', $current_language);

//-- set page title and site position

// Ignore Licence Warnning
$t->skipWarning();

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("report/item/view_date.tpl");


