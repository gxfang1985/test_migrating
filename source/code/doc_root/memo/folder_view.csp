<?php

global $G_INPUT;

global $G_container_app;
$uum =& $G_container_app->getInstance('uum');
$login =& $uum->getLoginUser();

// Smarty をインスタンス化
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

$folder_id = null;
if ( ! array_key_exists('did', $G_INPUT) || strlen($G_INPUT['did']) < 1
     || $G_INPUT['did'] < 1
) {
    require_once('memo/error_code.csp');
    cb_throw_error(E_GRN_MEMO_FOLDER_NOT_FOUND);
}
$folder_id = $G_INPUT['did'];
$t->assign('folder_id', $folder_id);

require_once('memo/logic.csp');
$logic = GRN_Memo_Logic::getInstance();

if (is_null(($folder =& $logic->getFolder($login, $folder_id)))) {
    require_once('memo/error_code.csp');
    cb_throw_error(E_GRN_MEMO_FOLDER_NOT_FOUND);
}

$folder_name = $folder->get('name');

require_once('memo/controller.csp');
$utility = new GRN_Memo_ControllerUtil();

$folder_for_view = grn_memo_folder_view($folder);
$folder_for_view['child_count'] = $folder->getNumFolders();
$folder_for_view['path'] = grn_memo_folder_path($folder);
$t->assign('folder', $folder_for_view);


$position = ['memo/index' => ['did' => $folder_id]];
$position_args = ['folder_name' => $folder_name];

$utility->setSitePosition($t, $position, $position_args);

// Smarty実行
$t->display(cb_get_pagename() . ".tpl");

