<?php

require_once('portal/error_code.csp');
if ( ! isset($portlet)) {
    cb_throw_error(E_GRN_PRTL_PORTLET_INVALID_ACCESS);
}

//Get Smarty Instance
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

global $G_INPUT;

//Create Font Options Array
$font_options = [
    ['value' => 'small', 'label' => cb_msg('grn.memo', 'font_size_small')],
    ['value' => 'normal', 'label' => cb_msg('grn.memo', 'font_size_normal')],
    ['value' => 'large', 'label' => cb_msg('grn.memo', 'font_size_large')],
];

$font_size = @$portlet['settings']['font_size'];
switch ($font_size) {
    case 'small':
        $font_options[0]['selected'] = true;
        break;
    case 'normal':
        $font_options[1]['selected'] = true;
        break;
    case 'large':
        $font_options[2]['selected'] = true;
        break;
    default:
        $font_options[1]['selected'] = true;
        break;
}
$t->assign('font_options', $font_options);

if ( ! array_key_exists('settings', $portlet)) {
    $portlet['settings'] = ['rows' => 10];

    if ('set-personal' == @ $display) {
        $portlet['settings']['did'] = null;
    }
}

// 表示フォルダを取得

global $G_container_base;
$uum =& $G_container_base->getInstance('uum');
$login =& $uum->getLoginUser();

require_once('memo/logic.csp');
require_once('memo/controller.csp');

$logic = GRN_Memo_Logic::getInstance();

if ('set-personal' == @ $display) {
    $folder_id = @ $portlet['settings']['did'];

    if ($folder_id) {
        if (($folder =& $logic->getFolder($login, $folder_id))) {
            $t->assign('folder', [
                'id'   => $folder->getOID(),
                'name' => $folder->get('name'),
            ]);
        }
    }
    $t->assign('folder_id', $folder_id);

    // 保存フォルダ選択メニュー
    $folders = $logic->getRootFolders($login);
    $t->assign('folder_menu', grn_memo_folder_select_menu($folders));

}


//Assign include_php Parameter
$t->assign('portlet', $portlet);
$t->assign('display', $display);

// Ignore Licence Warnning
$t->skipWarning();

//Display Smarty Template
$t->display("memo/portlet/settings.tpl");

