<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    require_once('portal/error_code.csp');
    if ( ! isset($portlet)) {
        cb_throw_error(E_GRN_PRTL_PORTLET_INVALID_ACCESS);
    }

    if (@ $G_INPUT['cancel']) {
        if ('set-personal' == @ $G_INPUT['display']) {
            cb_redirect('portal/personal/view', ['pid' => $G_INPUT['pid']]);
        } elseif ('set-operation' == @ $G_INPUT['display']) {
            cb_redirect('portal/operation/view', ['pid' => $G_INPUT['pid']]);
        } else {
            cb_redirect('portal/system/view', ['pid' => $G_INPUT['pid']]);
        }
    }

    $settings = [
        'rows'      => $G_INPUT['rows'],
        'iid'       => null,
        'font_size' => $G_INPUT['font_size']
    ];

    if ('set-personal' == @ $G_INPUT['display']) {
        $settings['did'] = $G_INPUT['did'];
    }


    //Get Portal Application
    require_once("grn/application.csp");
    $locator = GRN_ApplicationLocator::instance();
    if ($locator->isActive('portal')) {
        $portal =& $locator->getInstance('portal');
        $portal->setPortletSettings($G_INPUT['plid'], $settings);
    }

    if ('set-personal' == @ $G_INPUT['display']) {
        cb_redirect('portal/personal/view', ['pid' => $G_INPUT['pid']]);
    } elseif ('set-operation' == @ $G_INPUT['display']) {
        cb_redirect('portal/operation/view', ['pid' => $G_INPUT['pid']]);
    } else {
        cb_redirect('portal/system/view', ['pid' => $G_INPUT['pid']]);
    }
}
