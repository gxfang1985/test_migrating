<?php

global $G_INPUT;

global $G_container_app;
$uum = $G_container_app->getInstance('uum');
$login = $uum->getLoginUser();

// Smarty をインスタンス化
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

require_once('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form(cb_get_pagename(), true);

//------------------

$folder_id = null;
if (array_key_exists('did', $G_INPUT)) {
    $folder_id = $G_INPUT['did'];
}
$t->assign('folder_id', $folder_id);

require_once('memo/controller.csp');
$utility = new GRN_Memo_ControllerUtil();

require_once('memo/logic.csp');
$logic = GRN_Memo_Logic::getInstance();

if ($folder_id) {
    if ( ! ($folder =& $logic->getFolder($login, $folder_id))) {
        require_once('memo/error_code.csp');
        cb_throw_error(E_GRN_MEMO_FOLDER_NOT_FOUND);
    }

    $folder_for_view = grn_memo_folder_view($folder);
    $t->assign('folder', $folder_for_view);
}

$folders = $logic->getRootFolders($login);
$t->assign('folder_menu', grn_memo_folder_select_menu($folders));
$t->assign('pdid', $folder_id);

$page_path = ['memo/index' => ['did' => $folder_id]];
$utility->setSitePosition($t, $page_path);

$t->display(cb_get_pagename() . ".tpl");

