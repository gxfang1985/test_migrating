<?php

// 使用するパラメータの定義
$article_id = @ $G_INPUT['aid'];
$follow_str = @ $G_INPUT['follow'];

// Smarty をインスタンス化
require_once('cellular/smarty.csp');
$smarty = new GRN_Cellular_Smarty;

require_once('SmartyValidate.class.php');
SmartyValidate::connect($smarty);
$form_name = 'bulletin/cellular/follow';
SmartyValidate::register_form($form_name, true);
$smarty->assign('form_name', $form_name);

// ページタイトル
$smarty->assign('pagetitle', grn_get_current_page_display_name());
// パス情報
$smarty->assign('pagepath', $G_pagepath);

// 記事の取得
require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();
$bulletin_app =& $locator->getInstance('bulletin');

if ( ! ($article =& $bulletin_app->getArticle($G_login_user, $article_id))) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}

if ( ! $article->isPublished()) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}
if ($article->isExpired()) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_EXPIRED);
}

// カテゴリ
$category =& $article->get('category');
$smarty->assign('cid', $category->getOID());

// assign
$smarty->assign('aid', $article_id);
if (mb_strlen($follow_str) > 1024) {
    $follow_str = mb_substr($follow_str, 0, 1024);
}
$smarty->assign('follow', $follow_str);

// display
$smarty->display(cb_get_pagename() . '.tpl');

