<?php

global $G_INPUT;

/**
 * このスクリプトをインクルードするファイルで宣言される変数
 * $file : GRN_Fileオブジェクト
 */


if ( ! @ $file) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}

$body = null;

if (@ $G_INPUT['ver']) {
    $body =& $file->getBody($G_INPUT['ver']);
} else {
    $body =& $file->getCurrentBody();
}

if ( ! $body) {
    cb_throw_error(E_GRN_BULLETIN_FILE_LOG_NOT_FOUND);
}

// logging
require_once('bulletin/table.csp');
grn_bulletin_write_log("download", "file", [
    'uid'     => $G_bulletin_login->getOID(),
    'fid'     => $file->getOID(),
    'version' => $file->get('version'),
    'name'    => $body->get('name')
], 'info');

//$body->download( array_key_exists( 'inline', $G_INPUT ) );
require_once('grn/_file_download_for_thumbnail.csp');
$body->download(true);

cb_safe_exit();
