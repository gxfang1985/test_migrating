<?php

global $G_INPUT;

if ( ! isset($t) || ! is_a($t, 'GRN_Smarty')) {
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty();
}

if ( ! isset($utility) || ! is_a($utility, 'GRN_Bulletin_ControllerUtil')) {
    require_once('bulletin/controller.csp');
    $utility = new GRN_Bulletin_ControllerUtil();
}

if ( ! array_key_exists('cid', $G_INPUT)) {
    cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
}
$category_id = $G_INPUT['cid'];

if ( ! ($category =& $G_bulletin->getCategory($G_bulletin_login,
    $category_id))
) {
    cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
}

$t->assign('category_id', $category_id);


$category_for_view = [];
$category_for_view['cid'] = $category->getOID();
$category_for_view['name'] = $category->get('name');

$children = $category->getCategories($G_bulletin_login);

if (count($children) > 0) {
    $children_for_view = [];
    foreach (array_keys($children) as $cid) {
        $child =& $children[$cid];
        $children_for_view[$cid] = $child->get('name');
    }

    $category_for_view['children'] = $children_for_view;
}

$category_for_view['child_count'] = count($children);

if (0 == $category_for_view['child_count']) {
    cb_throw_error(E_GRN_BULLETIN_EMPRY_SUBCATEGORY);
}

$t->assign('category', $category_for_view);


