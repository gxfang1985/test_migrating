<?php

global $G_INPUT;

if ( ! isset($G_INPUT['aid'])) {
    require_once('bulletin/error_code.csp');
    cb_throw_error(E_GRN_BULLETIN_DRAFT_NOT_FOUND);
}
if ( ! isset($G_INPUT['fid'])) {
    require_once('bulletin/error_code.csp');
    cb_throw_error(E_GRN_BULLETIN_FILE_NOT_FOUND);
}

$article_id = $G_INPUT['aid'];
$file_id = $G_INPUT['fid'];

/** @var GRN_Bulletin $G_bulletin */
/** @var CB_User $G_bulletin_login */
if ( ! ($article =& $G_bulletin->getDraft($G_bulletin_login, $article_id))) {
    require_once('bulletin/error_code.csp');
    cb_throw_error(E_GRN_BULLETIN_DRAFT_NOT_FOUND);
}

$file_manager = GRN_Bulletin_FileManager::getInstance();
if ( ! $file = $file_manager->getFile($article, $file_id)) {
    require_once('bulletin/error_code.csp');
    cb_throw_error(E_GRN_BULLETIN_FILE_NOT_FOUND);
}

$file_name = $file->getCurrentBody()->get('name');

$download_page = 'bulletin/draft_file_download';
require_once('grn/_file_image_view.csp');
