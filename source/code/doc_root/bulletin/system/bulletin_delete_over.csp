<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

$category_id = null;
if (array_key_exists('cid', $G_INPUT)) {
    $category_id = $G_INPUT['cid'];
}
$t->assign('category_id', $category_id);


$page_path = [
    'bulletin/system/bulletin_list' => ['cid' => $category_id]
];

require_once('bulletin/controller.csp');
$utility = new GRN_Bulletin_ControllerUtil();

$utility->setSitePosition($t, $page_path);


if (@ $G_INPUT['cont']) {
    $t->assign('delete_continue', true);
}


$category = null;

if ($category_id) {
    if ( ! ($category =& $G_bulletin->getCategory($G_bulletin_login,
        $category_id))
    ) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    require_once('bulletin/functions.csp');

    $category_for_view = [
        'name' => $category->get('name'),
        'path' => grn_bulletin_get_category_path_string($category),
    ];

    $t->assign('category', $category_for_view);
}

require_once('bulletin/article_util.csp');
require_once('bulletin/bean/GrnBulletinArticleCondition.csp');

$conditionObj = new GrnBulletinArticleCondition();
$conditionObj->setUser($G_bulletin_login);
$conditionObj->setCategory($category);
$conditionObj->setArticleTerm('expired');

$coll = new GRN_Bulletin_ArticleExpiredList($conditionObj);
$coll->searchExecute();
$articles_for_view = ['delete_numbers' => $coll->count()];

$t->assign('articles', $articles_for_view);

$t->display(cb_get_pagename() . ".tpl");

