<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    $system_config = $G_bulletin->getSystemConfig($G_bulletin_login);
    $follow = cb_at($G_INPUT,
        'enable_follow') ? true : false;
    $htmleditor = cb_at($G_INPUT,
        'enable_htmleditor') ? true : false;
    $enable_follow_autolink = cb_at($G_INPUT,
        'enable_follow_autolink') ? true : false;
    $enable_acknowledgement = cb_at($G_INPUT,
        'enable_acknowledgement') ? true : false;
    $enable_manually_enter_sender = cb_at($G_INPUT,
        'enable_manually_enter_sender') ? true : false;
    $enable_confirm_authority_read_and_notification_users = cb_at($G_INPUT,
        'enable_confirm_authority_read_and_notification_users') ? true : false;

    $system_config->setEnableFollow($follow);
    $system_config->setEnableHtmlEditor($htmleditor);
    $system_config->setEnableFollowAutoLink($enable_follow_autolink);
    $system_config->setEnableAcknowledgement($enable_acknowledgement);
    $system_config->setEnableManuallyEnterSender($enable_manually_enter_sender);
    $system_config->setEnableConfirmAuthorityReadAndNotificationUsers($enable_confirm_authority_read_and_notification_users);
    if ($enable_manually_enter_sender) {
        require_once('bulletin/resources.csp');
        $default_value_from = cb_at($G_INPUT, 'default_value_from') === '1'
            ? GRN_BULLETIN_DEFAULT_VALUE_FROM_MANUALLY_ENTER
            : GRN_BULLETIN_DEFAULT_VALUE_FROM_USER;
        $system_config->setDefaultValueFrom($default_value_from);
    }

    if ($follow) {
        $follow = "TRUE";
    } else {
        $follow = "FALSE";
    }

    if ($htmleditor) {
        $htmleditor = "TRUE";
    } else {
        $htmleditor = "FALSE";
    }

    if ($enable_follow_autolink) {
        $enable_follow_autolink = "TRUE";
    } else {
        $enable_follow_autolink = "FALSE";
    }

    if ($enable_acknowledgement) {
        $enable_acknowledgement = "TRUE";
    } else {
        $enable_acknowledgement = "FALSE";
    }

    if ($enable_confirm_authority_read_and_notification_users) {
        $enable_confirm_authority_read_and_notification_users = "TRUE";
    } else {
        $enable_confirm_authority_read_and_notification_users = "FALSE";
    }

    $common = [
        'enable_follow'                                        => $follow,
        'enable_htmleditor'                                    => $htmleditor,
        'enable_follow_link'                                   => $enable_follow_autolink,
        'enable_acknowledgement'                               => $enable_acknowledgement,
        'enable_manually_enter_sender'                         => $enable_manually_enter_sender
            ? 'TRUE' : 'FALSE',
        'enable_confirm_authority_read_and_notification_users' => $enable_confirm_authority_read_and_notification_users
    ];
    if ($enable_manually_enter_sender) {
        $common['default_value_from'] = $default_value_from;
    }

    grn_bulletin_write_log('config', 'common', $common);

    cb_redirect('system/application_list', ['app_id' => 'bulletin']);
}
