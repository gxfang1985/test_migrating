<?php
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    if ( ! array_key_exists('cid', $G_INPUT) || strlen($G_INPUT['cid']) < 1) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }
    $cid = $G_INPUT['cid'];

    if ( ! array_key_exists('ids', $G_INPUT)) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }
    $target_ids = $G_INPUT['ids'];

    $page_parts = explode('/', cb_get_pagename());
    $is_system = (@$page_parts[1] === 'system');
    foreach ($target_ids as $id) {
        global $G_bulletin, $G_bulletin_login;
        if ( ! ($category = $G_bulletin->getCategory($G_bulletin_login, $id))) {
            cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
        }
        if ( ! $is_system) {
            $category->privileged($G_bulletin_login, ['operation'], true);
        }
    }

    if ($classification == "access") {
        require_once('bulletin/access.csp');
        $manager = GRN_Bulletin_AccessManager::getInstance();
        $manager->copyAccess($cid, $target_ids);
    } elseif ($classification == "notify") {
        require_once('bulletin/notification.csp');
        $manager = GRN_Bulletin_NotificationManager::getInstance();
        $manager->copyNotification($cid, $target_ids);
    }
}
