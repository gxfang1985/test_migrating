<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    // ../_command_access_add.csp 内で参照される。
    $bulletin_access_list_page = 'bulletin/operation/access_list';

    //set aid value
    $aid = null;
    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();

    $session_name = 'bulletin.operation.access_add';
    $session =& $session_manager->getSession($session_name);
    $aid = $session->get('target_ids');
    require_once('../_command_access_add.csp');

    // 自分の閲覧権限を奪うことはできない

    require_once('bulletin/access.csp');
    $acc = GRN_Bulletin_AccessManager::getInstance();

    if ( ! $acc->access($G_bulletin_login, $G_INPUT['nid'],
        GRN_BULLETIN_ACCESS_R)
    ) {
        cb_throw_error(E_GRN_BULLETIN_CANNOT_CHANGE_ACCESS);
    }

    cb_redirect($bulletin_access_list_page, [
        'nid'  => $G_INPUT['nid'],
        'poid' => @$G_INPUT['poid'],
        'text' => @$G_INPUT['text']
    ]);
}


