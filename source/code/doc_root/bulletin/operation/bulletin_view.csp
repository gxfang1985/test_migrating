<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

if ( ! array_key_exists('aid', $G_INPUT) || strlen($G_INPUT['aid']) < 1
     || $G_INPUT['aid'] < 1
) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}

require_once('bulletin/controller.csp');
$utility = new GRN_Bulletin_ControllerUtil();

require_once('../_article_view.csp');

assert('isset($article)');

// GRN35-209
if (@$G_INPUT['cid']) {
    $utility->prepareMakeSitePosition($t, @$G_INPUT['cid'], null, null,
        @$G_INPUT['cid']);
} else {
    $page_path = [
        "bulletin/index"                   => ['cid' => $G_INPUT['cid']],
        "bulletin/operation/bulletin_list" => ['cid' => $G_INPUT['cid']],
    ];
    $utility->setSitePosition($t, $page_path);
}
// GRN35-209

// 記事を既読にする
if ($article->isPublished() && ! $article->isExpired()) {
    $article->read($G_bulletin_login);
}

$t->display(cb_get_pagename() . ".tpl");

