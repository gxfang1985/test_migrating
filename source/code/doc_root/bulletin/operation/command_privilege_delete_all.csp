<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    $node_id = cb_at($G_INPUT, 'nid');
    $node_row = $G_bulletin->getCategory($G_bulletin_login, $node_id);
    if ( ! $node_row) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    // privilege information
    require_once('bulletin/privilege.csp');
    $privilege_manager = GRN_Bulletin_PrivilegeManager::getInstance();

    $privilege_manager->deleteTargets($node_row, null);

    if ( ! $privilege_manager->privileged($G_bulletin_login, $node_row,
        'operation')
    ) {
        cb_throw_error(E_GRN_BULLETIN_CANNOT_CHANGE_PRIVILEGE);
    }

    $params = ['nid' => $node_id];
    cb_redirect('bulletin/operation/privilege_list', $params);
}

