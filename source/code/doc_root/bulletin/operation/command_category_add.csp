<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    $target_name = 'bulletin/operation/category_add';

    require_once('../_command_category_add.csp');

    if (@ $success) {
        // 運用管理者により作成されたカテゴリのアクセス権は
        // 初期状態で作成者のみにアクセスが許可される
        // カテゴリに公開・非公開などの機能がないための対処

        require_once('bulletin/access.csp');
        $acc = GRN_Bulletin_AccessManager::getInstance();

        $acc->setSecurityModel($G_bulletin_login, $category,
            GRN_BULLETIN_SECURITY_MODEL_GRANT);
        $acc->addTarget($category, $G_bulletin_login,
            ['read' => 1, 'write' => 1, 'follow' => 1]);

        cb_redirect('bulletin/index', ['cid' => $G_INPUT['cid']]);
    } else {
        require_once('bulletin/controller.csp');
        $utility = new GRN_Bulletin_ControllerUtil();

        $page_path = [
            'bulletin/index' => ['cid' => $G_INPUT['cid']],
        ];

        $utility->setSitePosition($t, $page_path);

        $t->display($target_name . '.tpl');
    }
}
