<?php

global $G_INPUT;

if ( ! isset($G_INPUT['aid'])) {
    require_once('bulletin/error_code.csp');
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}

$category_id = @ $G_INPUT['cid'];
$article_id = $G_INPUT['aid'];
$follow_id = @ $G_INPUT['follow_id'];
$file_id = @ $G_INPUT['fid'];

if ( ! ($article =& $G_bulletin->getArticle($G_bulletin_login, $article_id))) {
    require_once('bulletin/error_code.csp');
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}

if ($article->isPublished()) {
    $upload_pathinfo = [
        "bulletin/index"     => ['cid' => $category_id],
        "bulletin/view"      => [
            'cid' => $category_id,
            'aid' => $article_id
        ],
        "bulletin/file_view" => [
            'cid'       => $category_id,
            'aid'       => $article_id,
            'follow_id' => $follow_id,
            'fid'       => $file_id
        ],
    ];
} else {
    $upload_pathinfo = [
        "bulletin/index"     => null,
        "bulletin/wait_list" => null,
        "bulletin/wait_view" => ['aid' => $article_id],
        "bulletin/file_view" => [
            'aid' => $article_id,
            'fid' => $file_id
        ],
    ];
}

$target_name = 'bulletin/file_upload';

require_once('_command_file_upload.csp');


