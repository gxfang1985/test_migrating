<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    assert('isset($target_name)');

    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();
    $session =& $session_manager->getSession($target_name);

    if ( ! ($eid = $session->get('eid')) || count($eid) < 0) {
        cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
    }

    $session->set('eid', null);

    require_once('../_command_category_select.csp');

    $set_category_id = $G_INPUT['s_cid'];

    if ( ! ($category =& $G_bulletin->getCategory($G_bulletin_login,
        $set_category_id))
    ) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    foreach ($eid as $aid) {
        if (($article =& $G_bulletin->getArticle($G_bulletin_login, $aid))) {
            $article->setCategory($G_bulletin_login, $category);
        }
    }
}
