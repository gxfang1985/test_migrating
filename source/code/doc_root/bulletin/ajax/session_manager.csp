<?php

use grn\grn\JSONResponse;
use grn\bulletin\screen\Subscribe;

global $G_INPUT;
global $G_state_set;

$G_state_set->set("html_should_be_closed", false);
$G_state_set->set("copyright_should_be_written", false);
$G_state_set->set("error_page_type", "json");

if (strcasecmp(@ $_SERVER["REQUEST_METHOD"], "POST") === 0) {
    $response = [];
    if (array_key_exists(Subscribe::SESSION_KEY_SUBSCRIBE_CHECKBOX, $G_INPUT)) {
        $session_key = cb_at($G_INPUT,
            Subscribe::SESSION_KEY_SUBSCRIBE_CHECKBOX);
        $id = cb_at($G_INPUT, Subscribe::ARG_CATEGORY_CHECKBOX_ID);
        $checked = cb_at($G_INPUT,
            Subscribe::ARG_CATEGORY_CHECKBOX_CHECKED);

        $subscribe = new Subscribe($G_INPUT);
        $subscribe->setSessionWithCategoryCheckBox($session_key, $id, $checked);
    }

    $json = JSONResponse::create();
    $json->response($response);
}
