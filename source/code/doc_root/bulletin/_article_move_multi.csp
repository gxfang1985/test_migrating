<?php

global $G_INPUT;

if ( ! isset($t) || ! is_a($t, 'GRN_Smarty')) {
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
}

if ( ! array_key_exists('cid', $G_INPUT) || strlen($G_INPUT['cid']) < 1
     || $G_INPUT['cid'] < 1
) {
    $category_id = GRN_BULLETIN_ROOT_CATEGORY_ID;
} else {
    $category_id = $G_INPUT['cid'];
}

$category_id = $G_INPUT['cid'];


require_once('fw/session_manager.csp');
$session_manager = CB_SessionManager::getInstance();
$session =& $session_manager->getSession(cb_get_pagename());

if (array_key_exists('eid', $G_INPUT)) {
    $eid = $G_INPUT['eid'];
    $session->set('eid', $eid);
} else {
    $eid = $session->get('eid');
}

$t->assign('eid', $eid);
$t->assign('eid_count', count($eid));


// 現在の位置を取得

if ( ! ($category =& $G_bulletin->getCategory($G_bulletin_login,
    $category_id))
) {
    cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
}

require_once('bulletin/functions.csp');

$current_for_view = [
    'cid'  => $category->getOID(),
    'path' => grn_bulletin_get_category_path_string($category),
    'name' => $category->get('name')
];

$t->assign('current', $current_for_view);

require_once('../_category_select.csp');


