<?php

require_once('portal/error_code.csp');
if ( ! isset($portlet)) {
    cb_throw_error(E_GRN_PRTL_PORTLET_INVALID_ACCESS);
}

//Get Smarty Instance
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

global $G_INPUT;

//Create Font Options Array
$font_options = [
    ['value' => 'small', 'label' => cb_msg('grn.bulletin', 'font_size_small')],
    [
        'value' => 'normal',
        'label' => cb_msg('grn.bulletin', 'font_size_normal')
    ],
    ['value' => 'large', 'label' => cb_msg('grn.bulletin', 'font_size_large')],
];
$font_size = @$portlet['settings']['font_size'];
switch ($font_size) {
    case 'small':
        $font_options[0]['selected'] = true;
        break;
    case 'normal':
        $font_options[1]['selected'] = true;
        break;
    case 'large':
        $font_options[2]['selected'] = true;
        break;
    default:
        $font_options[1]['selected'] = true;
        break;
}
$t->assign('font_options', $font_options);

//Crerate Select Number Array
$select_numbers = [];
for ($i = 1; $i < 21; ++$i) {
    $select_numbers[] = $i;
}
$t->assign('select_numbers', $select_numbers);

if ( ! array_key_exists('settings', $portlet)) {
    $portlet['settings'] = [
        'cid'          => null,
        'rows'         => 5,
        'hide_columns' => [
            'abstract' => 0,
            'creator'  => 0,
            'mtime'    => 0
        ]
    ];
} else {
    if ( ! array_key_exists('rows', $portlet['settings'])) {
        $portlet['settings']['rows'] = 5;
    }
    if ( ! array_key_exists('hide_columns', $portlet['settings'])) {
        $portlet['settings']['hide_columns'] = [
            'abstract' => 0,
            'creator'  => 0,
            'mtime'    => 0
        ];
    }
}

// 表示カテゴリを取得

require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();
$bulletin = $locator->getInstance('bulletin');

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

$params = [
    'pid'     => $portlet['pid'],
    'plid'    => $portlet['plid'],
    'ppid'    => $portlet['ppid'],
    'display' => $portlet['display'],
];

// ツリー表示リンクのパラメータ
$t->assign('params', $params);

//Assign include_php Parameter
$t->assign('portlet', $portlet);
$t->assign('display', $display);

// Ignore Licence Warnning
$t->skipWarning();

//Display Smarty Template
$t->display("bulletin/portlet/settings_acknowledgement.tpl");
