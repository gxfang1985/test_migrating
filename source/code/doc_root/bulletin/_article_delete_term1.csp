<?php

global $G_INPUT;

if ( ! isset($t) || ! is_a($t, 'GRN_Smarty')) {
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
}

$category_id = null;
if (array_key_exists('cid', $G_INPUT)) {
    $category_id = $G_INPUT['cid'];
}
$t->assign('category_id', $category_id);


require_once('fw/date.csp');

$ts = new CB_TimeStampEx(new CB_TimeStamp());
$ts->unix_ts = time();
$dt = $ts->getDate();
$dt->moveYears(-1);

$t->assign('term_date', $dt);


if ($category_id) {
    if ( ! ($category =& $G_bulletin->getCategory($G_bulletin_login,
        $category_id))
    ) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    require_once('bulletin/functions.csp');

    $category_for_view = [
        'name' => $category->get('name'),
        'path' => grn_bulletin_get_category_path_string($category),
    ];

    $t->assign('category', $category_for_view);
}


