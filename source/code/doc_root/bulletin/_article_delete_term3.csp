<?php

global $G_INPUT;

if ( ! isset($t) || ! is_a($t, 'GRN_Smarty')) {
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
}

$category_id = null;
if (array_key_exists('cid', $G_INPUT)) {
    $category_id = $G_INPUT['cid'];
}
$t->assign('category_id', $category_id);


$term = new CB_Date();
if ( ! $term->parse(@ $G_INPUT['term_date'])) {
    cb_throw_error(E_GRN_BULLETIN_INVALID_DELETE_DATE);
}
$t->assign('term_date', $term);
$t->assign('term_format_date', $G_INPUT['term_date']);


if ($category_id) {
    if ( ! ($category =& $G_bulletin->getCategory($G_bulletin_login,
        $category_id))
    ) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    require_once('bulletin/functions.csp');

    $category_for_view = [
        'name' => $category->get('name'),
        'path' => grn_bulletin_get_category_path_string($category),
    ];

    $t->assign('category', $category_for_view);
}


