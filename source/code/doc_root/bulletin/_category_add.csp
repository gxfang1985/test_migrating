<?php

global $G_INPUT;

if ( ! isset($t) || ! is_a($t, 'GRN_Smarty')) {
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty();
}

// SmartyValidate should be initialized when an input form is there.
require('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form(cb_get_pagename(), true);


if ( ! array_key_exists('cid', $G_INPUT)) {
    cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
}
$category_id = $G_INPUT['cid'];

$t->assign('category_id', $category_id);

if ( ! ($category = $G_bulletin->getCategory($G_bulletin_login,
    $category_id))
) {
    cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
}
$t->assign('parent_name', $category->get('name'));

$page_parts = explode('/', cb_get_pagename());
$is_system = (@$page_parts[1] === 'system');
require_once('bulletin/folder_tree.csp');
$params = [
    'system'                  => $is_system,
    'force_hide_notification' => true
];
$tree = new GRN_Bulletin_FolderTree($params);
$tree_for_access = $tree->getTreeForView($category, $is_system,
    'tree_for_access', 'grn.page.category_form.access_dropdown.selectCategory');
$tree_for_notification = $tree->getTreeForView($category, $is_system,
    'tree_for_notification',
    'grn.page.category_form.notification_dropdown.selectCategory');

$t->assign('tree_for_access', $tree_for_access);
$t->assign('tree_for_notification', $tree_for_notification);
$t->assign('tree_params', $params);

// multilanguage Infomation
require_once('bulletin/resources.csp');
$multiLanguageInfoArray = [];
$multiLanguageInfoArray['element_name'] = GRN_BULLETIN_ELEMENT_NAME_CATEGORY;
$multiLanguageInfoArray['values'] = null;
$t->assign('multiLanguageInfoArray', $multiLanguageInfoArray);
//GRN35-36
$foreign_key = uniqid('', true);
$t->assign('foreign_key', $foreign_key);
//GRN35-36
