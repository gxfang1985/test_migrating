<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    if ( ! array_key_exists('nid', $G_INPUT)) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }
    $node_id = $G_INPUT['nid'];

    if ( ! ($node_row =& $G_bulletin->getCategory($G_bulletin_login,
        $node_id))
    ) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    $poid = @ $G_INPUT['poid'];

    // access information
    require_once('bulletin/access.csp');
    $am = GRN_Bulletin_AccessManager::getInstance();
    $current_model = $am->getSecurityModelString($node_row);
    $security_model = @ $G_INPUT['security_model'];

    $params = $G_INPUT;

    $page_parts = explode('/', cb_get_pagename());

    if ($security_model == $current_model) {
        $page_parts[count($page_parts) - 1] = 'access_list';

        cb_redirect(implode('/', $page_parts),
            ['nid' => $node_id, 'poid' => $poid]);
    } else {
        $page_parts[count($page_parts) - 1] = 'access_model_modify2';

        cb_redirect(implode('/', $page_parts), $G_INPUT);
    }
}

