<?php

global $G_INPUT;

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

$category_id = @ $G_INPUT['cid'];
$article_id = @ $G_INPUT['aid'];

if ( ! $article_id) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}


// site position
require_once('bulletin/controller.csp');
$utility = new GRN_Bulletin_ControllerUtil();

// GRN35-209
if (@$G_INPUT['cid']) {
    if ( ! ($category = $G_bulletin->getCategory($G_bulletin_login,
        $category_id))
    ) {
        cb_throw_error(E_GRN_BULLETIN_CATEGORY_NOT_FOUND);
    }

    $utility->prepareMakeSitePosition($t, @$G_INPUT['cid'], @$G_INPUT['aid']);
} else {
    $page_path = [
        "bulletin/index" => ['cid' => $category_id],
        "bulletin/view"  => ['cid' => $category_id, 'aid' => $article_id],
    ];

    $utility->setSitePosition($t, $page_path);
}
// GRN35-209

require('_accessory.csp');

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");

