<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

if ( ! array_key_exists('aid', $G_INPUT) || $G_INPUT['aid'] < 1) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}
$article_id = $G_INPUT['aid'];

if ( ! ($original =& $G_bulletin->getArticle($G_bulletin_login, $article_id))) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_NOT_FOUND);
}

// 既に公開されたらエラー
if ($original->isPublished()) {
    cb_throw_error(E_GRN_BULLETIN_ARTICLE_IS_PUBLISHED);
}

require_once('_send.csp');

require_once('bulletin/controller.csp');
$utility = new GRN_Bulletin_ControllerUtil();

$page_path = [
    'bulletin/index'     => null,
    'bulletin/wait_list' => null,
    'bulletin/wait_view' => ['aid' => $article_id],
];

$utility->setSitePosition($t, $page_path);
//GRREQ-136: Allow use checkbox when edit
$t->assign('enable_acknowledgement', '1');

$t->display(cb_get_pagename() . ".tpl");

