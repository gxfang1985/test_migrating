<?php

use grn\grn\dialog\screen\AjaxGroupMemberDialogScreen;
use grn\grn\dialog\screen\AjaxRoleMemberDialogScreen;
use grn\grn\JSONResponse;

if (0 == strcasecmp(cb_at($_SERVER, 'REQUEST_METHOD'), 'POST')) {
    global $G_INPUT;

    $anchor_id = cb_at($G_INPUT, 'anchor_id', '');
    $is_ajax_mobile = cb_at($G_INPUT, 'is_ajax_mobile', false);

    if (preg_match('/^.*_dialog_link_group_/', $anchor_id)) {

        $screen = new AjaxGroupMemberDialogScreen($G_INPUT);

    } elseif (preg_match('/^.*_dialog_link_role_/', $anchor_id)) {

        $screen = new AjaxRoleMemberDialogScreen($G_INPUT);

    }

    $template = 'grn/ajax/member_list_dialog.tpl';
    if ($is_ajax_mobile) {
        $template = 'grn/ajax/mobile_member_list_dialog.tpl';
    }

    $json = JSONResponse::create();
    $json->response([
        'content' => $screen->fetch($template),
        'title'   => $screen->getDialogTitle()
    ]);
}
