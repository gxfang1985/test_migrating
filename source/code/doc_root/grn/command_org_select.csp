<?php

cb_require_role('LoginUser');

// GET/POSTされたパラメータを取得する
if (array_key_exists('page', $G_INPUT)) {
    $return_url = $G_INPUT['page'];
} else {
    assert('FALSE');
}
if (array_key_exists('gid', $G_INPUT)) {
    $gid = $G_INPUT['gid'];
} else {
    assert('FALSE');
}

// ログインユーザーを取得する
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();
if ( ! is_object($login) || ! is_a($login, 'CB_User')) {
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}

// 組織の選択頻度を計測する
if (is_numeric($gid) && 0 < $gid) {
    require_once('grn/uum_util.csp');
    $uum_util = GRN_UumUtil::getInstance();
    $uum_util->selectGroups($login, [$gid]);
}

$params = $G_INPUT;
unset($params['page']);
cb_redirect($return_url, $params);


