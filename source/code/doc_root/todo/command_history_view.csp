<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    if ( ! @ $G_INPUT['tid']) {
        cb_throw_error(E_GRN_TODO_NOT_FOUND);
    }

    $tid = $G_INPUT['tid'];

    require_once('grn/application.csp');
    $locator = GRN_ApplicationLocator::instance();
    $app =& $locator->getInstance('todo');

    global $G_container_app;
    $uum =& $G_container_app->getInstance('uum');
    $login =& $uum->getLoginUser();

    if ( ! ($todo =& $app->get($login, $tid))) {
        cb_throw_error(E_GRN_TODO_NOT_FOUND);
    }

    $todo->setFinish(false);
    $todo->onUpdate();

    cb_redirect('todo/history', ['cid' => @$G_INPUT['cid']]);

}
