<?php

require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();
$app = $locator->getInstance('todo');

global $G_container_app;
$uum = $G_container_app->getInstance('uum');
$login = $uum->getLoginUser();

// カテゴリ
$categories = $app->listCategories($login);

$categories_for_view = [];

foreach (array_keys($categories) as $id) {
    $categories_for_view[] = [
        'cid'   => $id,
        'title' => $categories[$id]->get('title')
    ];
}

$t->assign('categories', ['category' => $categories_for_view]);

$t->assign('category_id', @$G_INPUT['cid']);

// サイトポジション
require_once('todo/controller.csp');
$utility = new GRN_ToDo_ControllerUtil();

if (@ $modify) {
    $page_path = [
        'todo/index'  => ['cid' => @$G_INPUT['cid']],
        'todo/view'   => ['tid' => @$G_INPUT['tid'], 'cid' => @$G_INPUT['cid']],
        'todo/modify' => ['tid' => @$G_INPUT['tid'], 'cid' => @$G_INPUT['cid']]
    ];

    $t->assign('tid', @ $G_INPUT['tid']);
} elseif (@ $personal) {
    $page_path = null;
} else {
    $page_path = ['todo/index' => ['cid' => @$G_INPUT['cid']]];
}

$utility->setSitePosition($t, $page_path);


