<?php

global $G_INPUT;

require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();
$app = $locator->getInstance('todo');

global $G_container_app;
$uum = $G_container_app->getInstance('uum');
$login = $uum->getLoginUser();


// カテゴリ
$categories = $app->listCategories($login);

$categories_for_view = [];

foreach (array_keys($categories) as $id) {
    $categories_for_view[] = [
        'cid'   => $id,
        'title' => $categories[$id]->get('title')
    ];
}

$t->assign('categories', ['category' => $categories_for_view]);

// 選択カテゴリ
if (($category_id = @ $G_INPUT['cid'])) {
    if (($category =& $app->getCategory($login, $category_id))) {
        $category_for_view = [
            'cid'   => $category_id,
            'title' => $category->get('title')
        ];
        $t->assign('category', $category_for_view);
    } else {
        $category_id = null;
    }
}
$t->assign('category_id', $category_id);


require_once('todo/controller.csp');
$utility = new GRN_ToDo_ControllerUtil('todo/add');

$page_path = ['todo/index' => ['cid' => @$G_INPUT['cid']]];

$utility->setSitePosition($t, $page_path);

$t->assign('config', $utility->getInputConfigValues($login));
