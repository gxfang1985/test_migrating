<?php

global $G_INPUT;

//Instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Login User
global $G_container_base;
$uum =& $G_container_base->getInstance('uum');
$user =& $uum->getLoginUser();
if ( ! $user) {
    require_once('grn/error_code.csp');
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}
$petition_id = @ $G_INPUT['pid'];    //Form ID

//Get Session Key
require_once('grn/controller.csp');
$tmp_key = grn_get_temporary_key();
$t->assign('tmp_key', $tmp_key);

/*
require_once('workflow/controller_util.csp');
$util = GRN_Workflow_Petition_Controller_Utility::getInstance();
if ( !$util->isAvailableReuseProxy( $user->getOID(), $petition_id) )
{
    require_once( 'workflow/error_code.csp' );
    cb_throw_error( E_GRN_WRKF_CANNOT_PROXY_PETITION );
}
unset($util);
*/
//SmartyValidate should be initialized when an input form is there.
require_once('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form('workflow/send_path_draft_proxy' . $tmp_key,
    true);

//Include Sharing Code
include('_send_path_draft_proxy.csp');

//Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


