<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Set Application Name
global $G_workflow_app_name;
$t->assign('app_name', $G_workflow_app_name);

//Get Folder ID from Session
require_once('fw/session_manager.csp');
$session_manager = CB_SessionManager::getInstance();
$session_form_list
    =& $session_manager->getSession('workflow/operation/public_index');
$folder_id = $session_form_list->get('folder_id');

require_once('_public_util.csp');

//--public information
$node_id = @ $G_INPUT['nid'];

//Get Security Model
$public = [];
require_once('workflow/public_logic.csp');
$category_public_logic = GRN_Workflow_Category_Public_Logic::getInstance();
$public['security_model'] = $category_public_logic->getSecurityModel($node_id);

//Assign Smarty Variabale
$t->assign('public', $public);
$t->assign('is_grant', $public['security_model'] == 'grant');
$t->assign('is_revoke', $public['security_model'] == 'revoke');

//page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

//site position 
$t->assign('site_position', [
        [
            'page' => 'workflow/index',
            'name' => grn_get_page_display_name('workflow/index'),
            'fid'  => $folder_id,
            'sf'   => 1
        ],
        [
            'page' => 'workflow/operation/public_index',
            'name' => grn_get_page_display_name('workflow/operation/public_index'),
            'nid'  => $node_id
        ],
        [
            'page' => 'workflow/operation/public_list',
            'name' => grn_get_page_display_name('workflow/operation/public_list'),
            'nid'  => $node_id,
            'poid' => $poid
        ],
        ['page' => '', 'name' => $page_title],
    ]
);

//Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


