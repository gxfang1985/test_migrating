<?php

/**
 * Description for Settings Parameters for Calc Numeric Item
 *
 * effective_figures      ->      efective figures for input number
 * minus_type             ->      display type for minus(0:-/1:▲/2:△)
 * right_align            ->      display input number right align
 * split_rank             ->      display input number split rank(10000 -> 10,000)
 * not_display            ->      not display
 * calc_type              ->      calculation type(0:operator/1:total)
 * calc_operator(if calc_type == 0)
 * operator              ->      operator(0:＋/1:－/2:×/3:÷)
 * operand1_type         ->      operand 1 type(0:input value/other:item ID)
 * operand1_value        ->      operand 1 Input Value
 * operand2_type         ->      operand 1 type(0:input value/other:item ID)
 * operand2_value        ->      operand 1 Input Value
 * calc_total(if calc_type == 1)
 * total_values          ->      target item ID for calculate total
 **/

global $G_INPUT;

// instantiate an Smarty object
require_once("grn/smarty.csp");
//$t = $smarty;

//Get Item from Template Variable
$item_for_view = $t->get_template_vars('item');

// GRN2-2957
//Check Table Name
if ($item_for_view['table'] == GRN_WORKFLOW_TABLE_ITEM) {
    if ( ! array_key_exists('number', $item_for_view)) {
        //Get Initial Value From Settings
        $item_for_view['number'] = $item_for_view['settings']['initial_value'];
        $item_for_view['number_for_js']
            = $item_for_view['settings']['initial_value'];
    }
}

//Format Process for View
if (($display == 'view' || $display == 'view-system'
     || $display == 'view-operation'
     || $display == 'view-confirm')
    && array_key_exists('number', $item_for_view)
) {
    //Format Effective Figures and Split Rank
    $thousandsSep = $item_for_view['settings']['split_rank'] ? ',' : '';
    $decimals
        = (int)$item_for_view['settings']["effective_figures"];
    $decPoint = '.';
    $minusChar = cb_msg(GRN_WORKFLOW_MODULE_ID,
        'minus_type_' . $item_for_view['settings']['minus_type']);
    $isDecimalZeroPadding = true;
    $originalNumber = $item_for_view['number'];

    $item_for_view['number_for_js']
        = GRN_Workflow_Item_Util_Calc_Numeric::formatValueForJS($originalNumber,
        $item_for_view['settings']);

    require_once('fw/string_util.csp');
    $item_for_view['number'] = cb_number_format($item_for_view['number'],
        $decimals, $decPoint, $thousandsSep, $minusChar, $isDecimalZeroPadding);


}

//Assign Display Infomation
// Assign Item ID
$t->assign('item_id', $item_for_view['iid']);

// Display 
$t->assign('display', $display);

// Assign Item
$t->assign('item', $item_for_view);
// Assign Settings
$t->assign('settings', $item_for_view['settings']);

//-- set page title and site position

// Ignore Licence Warnning
$t->skipWarning();

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("workflow/item/view_calc_numeric.tpl");


