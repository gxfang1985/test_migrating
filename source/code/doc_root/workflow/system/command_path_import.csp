<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    global $G_INPUT;

    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;

    require_once('SmartyValidate.class.php');
    SmartyValidate::connect($t);
    $page_name = 'workflow/system/path_import';
    SmartyValidate::register_form($page_name);

    if (SmartyValidate::is_valid($G_INPUT, $page_name)) {
        $file = $_FILES['file'];

        $page_name = 'workflow/system/path_import';

        require_once('workflow/controller_util.csp');
        $controller_util = new GRN_Workflow_ControllerUtil($page_name);
        $controller_util->import($file['tmp_name']);

        SmartyValidate::unregister_form($page_name);
        cb_redirect('workflow/system/path_list');
    } else {
        $t->setPageInfo($page_name);
        $page_title = grn_get_page_display_name($page_name);
        $t->assign('page_title', $page_title);

        $pages_info = [
            'path_list'   => [],
            'path_import' => null
        ];
        require_once('workflow/controller_util.csp');
        $controller_util = new GRN_Workflow_ControllerUtil($page_name);
        $site_position
            = $controller_util->makeSitePosition('workflow/system/',
            $pages_info);
        $t->assign('site_position', $site_position);

        $t->display("{$page_name}.tpl");
    }
}


