<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

//--------------------------------------------------------------
// ログインユーザーを取得する
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

// ユーザ個別の設定ロジックを取得する
require_once('grn/ui.csp');
$manager = GRN_UIConfigManager::getInstance();
assert('is_object( $manager ) && is_a( $manager, \'GRN_UIConfigManager\' )');
$system_config = $manager->getSystemConfig();
if ( ! $system_config->getCanUserChangeHeaders()) {
    cb_throw_error(E_GRN_NO_SYSTEM_PRIVILEGE);
}

$config = $manager->getUserConfig($login);
assert('is_object( $config ) && is_a( $config, \'GRN_UIConfig\' )');

// アプリケーションメニューの表示
$display_application_menu = [
    'name'    => 'display_application_menu',
    'checked' => $config->getDisplayApplicationMenu()
];

// アプリケーションメニューの表示形式
$application_menu_style = $config->getApplicationMenuStyle();
if ( ! $application_menu_style) {
    $application_menu_style = 'Small';
}

// Smartyに設定を割り当てる
$t->assign('config', [
    'display_application_menu' => $display_application_menu,
    'application_menu_style'   => $application_menu_style
]);

//--------------------------------------------------------------

// Smartyにページタイトルを割り当てる
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// Smartyにサイトポジションを割り当てる
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

// Smartyを実行する
$t->display(cb_get_pagename() . '.tpl');


