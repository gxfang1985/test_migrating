<?php

require_once('fw/i18n.csp');
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

require_once('grn/calendar.csp');
$cm = GRN_CalendarManager::getInstance();
$c = $cm->getPreferenceUserCalendar($login);
$event = @$G_INPUT['event'];

$e = $c->getDayInfoById($event);
if ( ! $e) {
    cb_throw_error(E_GRN_CALENDAR_DAY_NOT_FOUND);
}

$date = $e->get('date');
$cs = GRN_CalendarService::getInstance();
$type = $cs->getEventName($e->get('type'));

$event = [
    'id'     => $e->getOID(),
    'detail' => $e->get('info'),
    'type'   => $type,
    'date'   => $date
];

$calendar = [
    'id'    => $c->getOID(),
    'event' => $event
];

$t->assign('calendar', $calendar);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
//for delete confirm
$delete_info = [
    'title'      => grn_get_page_display_name('personal/calendar/event_delete'),
    'page'       => 'personal/calendar/event_delete.tpl',
    'no_confirm' => false,
    'data'       => [
        'calendar'      => $calendar,
        'multi_target'  => '',
        'form_target'   => '',
        'before_delete' => '',
    ],
    'handler'    => 'lnk_delete'
];
$t->assign('delete_info', $delete_info);

// site position
$page_view = 'personal/calendar/calendar_view';
$t->assign(
    'site_position',
    [
        [
            'page'  => $page_view,
            'name'  => grn_get_page_display_name($page_view),
            'bdate' => $date->year
        ],
        ['page' => "", 'name' => $page_title],
    ]
);

$t->display(cb_get_pagename() . ".tpl");


