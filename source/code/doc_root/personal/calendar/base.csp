<?php
require_once('grn/smarty.csp');
$t = new GRN_Smarty();

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login_user = $uum->getLoginUser();

require_once("fw/i18n.csp");
require_once("fw/i18n/base.csp");
require_once("fw/i18n/system_config.csp");

if ( ! CB_I18N_SystemConfig::isUserChangeableBase()) {
    cb_redirect('personal/common_list', ['id' => 'i18n']);
}

$t->assign("bases", CB_BaseManager::getBasesView());

$user_base_setting = CB_UserBaseSetting::select($login_user->getOID());
if (is_null($user_base_setting)) {
    $user_base_setting = CB_BaseManager::getDefaultUserBaseSetting();
} else {
    $t->assign('user_modified', $user_base_setting->isCustomized());
}
$t->assign("user_base_setting", $user_base_setting->toViewArray());

require_once('grn/calendar.csp');
$t->assign('calendars',
    GRN_CalendarManager::getInstance()->listSystemCalendarNames());

require_once('schedule/system_logic.csp');
$systemlogic = GRN_Schedule_SystemLogic::getInstance();
$t->assign('minute_interval', $systemlogic->getScheduleUnit());

$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

$t->assign(
    'site_position', [
        [
            'page' => '',
            'name' => $page_title,
        ],
    ]
);

$t->display(cb_get_pagename() . '.tpl');
