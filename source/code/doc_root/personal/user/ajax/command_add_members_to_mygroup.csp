<?php

use grn\grn\JSONResponse;
use grn\grn\GrnException;

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    /** @var \GRN_Uum $uum */
    $uum = $G_container_base->getInstance('uum');

    //Get mygroup info
    require_once('grn/multi_select_utility.csp');
    $properties = [];
    $G_INPUT = grn_deploy_selected_users('members',
        'selected_users', $G_INPUT);
    $G_INPUT = grn_deploy_selected_users('facilities',
        'selected_facilities', $G_INPUT);
    $properties['selected_users'] = cb_at($G_INPUT, 'selected_users',
        null);
    $properties['selected_facilities'] = cb_at($G_INPUT, 'selected_facilities',
        null);
    $mygroup_id = cb_at($G_INPUT, 'mygroup_id', null);

    $mygroup_row = $uum->getMyGroup($mygroup_id);
    if ( ! $mygroup_row) {
        cb_throw_error(E_GRN_PERSONAL_MYGROUP_NOT_FOUND);
    }
    $uum->setMyGroupProperties($mygroup_id, $properties);

    $json = JSONResponse::create();
    $json->response([
        'success'       => true,
        'redirect_link' => cb_get_full_url('personal/user/mygroup_list',
            ['mgid' => $mygroup_id])
    ]);
}


