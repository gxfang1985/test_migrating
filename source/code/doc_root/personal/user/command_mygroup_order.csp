<?php

// POSTされたフォームデータを取得する
$selected_id = @ $G_INPUT['mgid'];

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // POSTされたフォームデータを取得する
    $mygroup_ids = @ $G_INPUT['mgids'];
    $minimum_mygroup = 2;

    if (is_array($mygroup_ids) && $minimum_mygroup <= count($mygroup_ids)) {
        $uum = $G_container_base->getInstance('uum');
        $login = $uum->getLoginUser();
        assert('is_object( $login ) && is_a( $login, \'CB_User\' )');
        $mygroups = $uum->listMyGroups($login);

        $list_index = 0;
        foreach ($mygroup_ids as $mygroup_id) {
            $mygroup =& $mygroups[$mygroup_id];
            if ( ! is_object($mygroup) || ! is_a($mygroup, 'GRN_MyGroup')) {
                cb_throw_error(E_GRN_PERSONAL_MYGROUP_NOT_FOUND);
            }

            $mygroup->set('list_index', $list_index);
            $uum->setMyGroupProperties($mygroup_id, []);
            $list_index++;
        }

        $uum->execInspection('mygroup', 'order',
            ['mgids' => implode(',', $mygroup_ids)]);
    }
}

cb_redirect('personal/user/mygroup_list', ['mgid' => $selected_id]);


