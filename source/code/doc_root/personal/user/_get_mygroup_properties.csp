<?php

use grn\grn\MemberLogic;
use grn\schedule\ScheduleMemberLogic;

require_once('grn/multi_select_utility.csp');
$login = cb_get_login_user();
$login_id = $login->getOID();

$G_INPUT = grn_deploy_selected_users('selected_users_sUID', 'sUIDs', $G_INPUT);
$G_INPUT = grn_deploy_selected_users('selected_users_sITEM', 'sITEMs',
    $G_INPUT);
$sUIDs = cb_at($G_INPUT, 'sUIDs', []);
$sITEMs = cb_at($G_INPUT, 'sITEMs', []);

//Selected users
$selected_users = MemberLogic::getInstance()->getDisplayUsersByUserIds($sUIDs);
foreach ($selected_users as &$member) {
    $member[MemberLogic::IS_NOT_USING_APP] = false;
}
$t->assign('selected_users', $selected_users);

//Selected facilities
$facilities_info = $facility_logic->getFacilitiesInfo($sITEMs);
$selected_facilities = ScheduleMemberLogic::getInstance()
                                          ->getFacilitiesRender($facilities_info);
$t->assign('initialize_item', $selected_facilities);

$t->assign('name', cb_at($G_INPUT, 'name'));
$t->assign('description', cb_at($G_INPUT, 'description'));
