<?php

use grn\space\common\data\bean\SpaceFile;
use grn\space\screen\common\ApplicationScreenCommon;
use grn\space\screen\GenericScreenBase;
use grn\space\screen\FileDelete;

if (strcmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    $screen = new ApplicationScreenCommon(new FileDelete($G_INPUT));
    $screen->post($G_INPUT);

    $spaceId = $G_INPUT['spid'];
    $todoId = @$G_INPUT['tdid'];
    $fileId = $G_INPUT['fid'];
    $fileType = $G_INPUT['type'];
    if (SpaceFile::PARENT_APPLICATION_TYPE_THREAD == $fileType
        || SpaceFile::PARENT_APPLICATION_TYPE_THREAD_COMMENT == $fileType
    ) {
        cb_redirect("space/application/discussion/index",
            ["spid" => $spaceId, 'sf' => 1]);
    } elseif (SpaceFile::PARENT_APPLICATION_TYPE_TODO == $fileType
              || SpaceFile::PARENT_APPLICATION_TYPE_TODO_COMMENT == $fileType
    ) {
        if (GenericScreenBase::FROM_DISCUSSION_INDEX
            == @ $G_INPUT[GenericScreenBase::ARG_FROM]
        ) {
            cb_redirect("space/application/discussion/index",
                ["spid" => $spaceId, 'sf' => 1]);
        } else {
            cb_redirect("space/application/todo/view", [
                "spid" => $spaceId,
                "tdid" => $todoId,
                "from" => @ $G_INPUT[GenericScreenBase::ARG_FROM]
            ]);
        }
    }
}
