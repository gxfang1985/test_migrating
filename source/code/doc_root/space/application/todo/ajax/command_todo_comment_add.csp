<?php

use grn\space\screen\application\todo\TodoCommentAdd;
use grn\space\screen\application\todo\TodoComment;

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    global $G_state_set;

    $G_state_set->set('html_should_be_closed', false);
    $G_state_set->set('copyright_should_be_written', false);
    $G_state_set->set('error_page_type', 'json');

    $todo_comment_add = new TodoCommentAdd($G_INPUT);
    $todo_comment_add->post($G_INPUT);

    $todo_comment_component = new TodoComment($G_INPUT);
    $todo_comments = $todo_comment_component->fetch();
    $last_comment_no = $todo_comment_component->getLastCommentNo();

    //for test
    echo json_encode([
        'todo_comments'   => $todo_comments,
        'last_comment_no' => $last_comment_no
    ]);
}
