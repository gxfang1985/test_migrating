<?php

use grn\space\screen\FileRestore;
use grn\space\screen\common\ApplicationScreenCommon;
use grn\space\screen\GenericScreenBase;
use grn\space\common\data\bean\SpaceFile;
use grn\space\common\exception\ErrorCode;
use grn\space\common\exception\GrnIllegalOperationException;

global $G_INPUT;

if (strcmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    $screen = new ApplicationScreenCommon(new FileRestore($G_INPUT));
    $screen->post($G_INPUT);
    if (SpaceFile::PARENT_APPLICATION_TYPE_THREAD == $G_INPUT['type']) {
        cb_redirect('space/application/discussion/file_view', [
            'spid' => @$G_INPUT['spid'],
            'tid'  => @$G_INPUT['tid'],
            'fid'  => @$G_INPUT['fid']
        ]);
    } elseif (SpaceFile::PARENT_APPLICATION_TYPE_TODO == $G_INPUT['type']) {
        cb_redirect('space/application/todo/file_view', [
            'spid' => @$G_INPUT['spid'],
            'tid'  => @$G_INPUT['tid'],
            'fid'  => @$G_INPUT['fid'],
            'from' => @ $G_INPUT[GenericScreenBase::ARG_FROM]
        ]);
    } else {
        throw new GrnIllegalOperationException(ErrorCode::GRN_INVALID_FILE_TYPE);
    }
}
