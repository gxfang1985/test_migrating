<?php

use grn\space\screen\FileUpload;
use grn\space\screen\common\ApplicationScreenCommon;
use grn\space\screen\GenericScreenBase;

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    $screen = new ApplicationScreenCommon(new FileUpload($G_INPUT));
    $appType = $screen->post($G_INPUT);

    $redirect_page = '';
    $parameter = [];

    if ($appType == 1) {
        $redirect_page = 'space/application/discussion/index';
        $parameter = ['spid' => @$G_INPUT['spid'], 'sf' => 1];
        if ($G_INPUT['index_return'] != true) {
            $redirect_page = 'space/application/discussion/file_view';
            $parameter = [
                'spid' => @$G_INPUT['spid'],
                'fid'  => @$G_INPUT['fid'],
                'tid'  => @$G_INPUT['tid']
            ];
        }
    } else {
        $redirect_page = 'space/application/todo/view';
        $parameter = [
            'spid' => @$G_INPUT['spid'],
            'tdid' => @$G_INPUT['tdid'],
            'from' => @ $G_INPUT[GenericScreenBase::ARG_FROM]
        ];
        if ($G_INPUT['index_return'] != true) {
            $redirect_page = 'space/application/todo/file_view';
            $parameter = [
                'spid' => @$G_INPUT['spid'],
                'fid'  => @$G_INPUT['fid'],
                'tid'  => @$G_INPUT['tid'],
                'from' => @ $G_INPUT[GenericScreenBase::ARG_FROM]
            ];
        }
    }

    cb_redirect($redirect_page, $parameter);
}
