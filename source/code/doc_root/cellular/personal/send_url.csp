<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//-- SmartyValidate should be initialized when an input form is there.
require('SmartyValidate.class.php');
SmartyValidate::connect($t);

$pagename = cb_get_pagename();
// register the form you want to validate
SmartyValidate::register_form($pagename, true);

// アカウント情報を取得

$login = cb_get_login_user();

require_once('cellular/config.csp');
$config = new GRN_Cellular_UserConfig($login);

$t->assign('account', [
        'uid'         => $login->getOID(),
        'name'        => $login->get('display_name'),
        'foreign_key' => $login->get('foreign_key'),
        'address'     => $config->getCellularMailAddress(),
        'available'   => $config->getAvailability(),
    ]

);


// システム設定の状態をチェック

$system_config = GRN_Cellular_SystemConfig::getInstance();

require_once('grn/system_mail.csp');
$system_mail = GRN_SystemMailConfigManager::getInstance();

$t->assign('system_config', [
    'system_mail' => $system_mail->isAvailable(),
    'login_url'   => ! is_null($system_config->getLoginUrl()),
]);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
// site position
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

//-- show page
$t->display($pagename . '.tpl');

