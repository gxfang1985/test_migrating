<?php

if (strcasecmp(cb_at($_SERVER, 'REQUEST_METHOD'), 'POST') == 0) {
    global $G_INPUT;

    //-- prepare
    $target_page = 'cellular/system/login_url';

    //-- instantiate an Smarty object
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;

    //-- Validation check
    require_once('SmartyValidate.class.php');
    SmartyValidate::connect($t);
    // register the target_form, or you get an error if you go back to the previous page by using 
    // your browser 'back' button
    SmartyValidate::register_form($target_page);

    $login_url = cb_at($G_INPUT, 'login_url');

    //-- validate after a POST
    if (SmartyValidate::is_valid($G_INPUT, $target_page)) {

        require_once('cellular/config.csp');
        $config = GRN_Cellular_SystemConfig::getInstance();

        $config->setLoginUrl(trim($login_url));

        SmartyValidate::unregister_form($target_page);

        cb_redirect('system/application_list', ['app_id' => 'cellular']);
    } else {
        $t->setPageInfo($target_page);

        // page title
        $page_title = grn_get_page_display_name($target_page);
        $t->assign('page_title', $page_title);

        // site position 
        $site_position = [
            ['page' => '', 'name' => $page_title],
        ];
        $t->assign('site_position', $site_position);

        $t->assign('login_url', $login_url);
        $t->assign('sample_url', cb_get_full_url("cellular/index"));

        $t->display("${target_page}.tpl");
    }
}


