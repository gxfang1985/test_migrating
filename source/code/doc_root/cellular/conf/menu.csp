<?php

require_once('cellular/smarty.csp');
$smarty = new GRN_Cellular_Smarty;

$config =& $G_cellular->getUserConfig($G_cellular_login);

$components = $G_cellular->getComponents();

$app_conf = ['list' => [], 'count' => 0];

foreach (array_keys($components) as $app_id) {
    $comp =& $components[$app_id];

    if ( ! $comp->isSupported('config')) {
        continue;
    }

    if (($c = $comp->getContent('config', $config)) !== false) {
        if ( ! array_key_exists('icon', $c)) {
            $c['icon'] = $comp->getContent('icon', $config);
        }

        $app_conf['list'][$app_id] = $c;
    }
}
$app_conf['count'] = count($app_conf['list']);

require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$system_config =& $utility->getSystemConfig();
$personal_config =& $utility->getPersonalConfig($G_cellular_login);

// アカウント設定数を取得する
$account_data_count = $personal_config->getAccountDataCount();
// サーバー設定数を取得する
$server_data_count = $system_config->getServerDataCount();

//default アカウント情報の取得
$default_acc_info = $personal_config->getDefaultAccountData();

require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();
$ids = $locator->getActiveApplicationIds();

if ( ! in_array('mail', $ids) || $account_data_count == 0
     || $server_data_count == 0
     || ! $default_acc_info
) {
    //サーバーの設定が行ってない場合、
    //またはアカウントの設定がされてない場合の画面の為の処理
    $smarty->assign('unusable_mail_flag', true);

}

$smarty->assign('conf', [
    'app_conf'   => $app_conf,
    'item_num'   => $config->getListMax(),
    'width_char' => $config->getSubjectWidth(),
    'webmail'    => $config->getUseWebMail(),
]);

$smarty->display(cb_get_pagename() . '.tpl');

