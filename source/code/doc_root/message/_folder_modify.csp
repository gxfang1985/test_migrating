<?php

//------------------

$category_id = @ $G_INPUT['cid'];

if ($category_id == '') {
    require_once('message/error_code.csp');
    cb_throw_error(E_GRN_MESSAGE_FOLDER_NOT_FOUND);
}

$t->assign('cid', $category_id);

// page title
$page_title = grn_get_current_page_display_name();


$t->assign('page_title', $page_title);

// site position
$page_index = 'message/index';
$page_inbox = 'message/inbox';
$page_outbox = 'message/outbox';
$page_draftbox = 'message/draftbox';
$page_category_list = 'message/category_list';
$page_folder_view = 'message/folder_view';

require_once('message/folder_logic.csp');
$folder_logic = new GRN_Message_FolderLogic();
$folder_info = $folder_logic->getFolderInfo($user, $category_id);

if ( ! $folder_info) {
    require_once('message/error_code.csp');
    cb_throw_error(E_GRN_MESSAGE_FOLDER_NOT_FOUND);
}

$sf = 0;
switch ($folder_info['folder_type']) {
    case GRN_MESSAGE_RECEIVINGFOLDER:
        $page_folder = $page_inbox;
        $sf = 1;
        break;
    case GRN_MESSAGE_SENDINGFOLDER:
        $page_folder = $page_outbox;
        break;
    case GRN_MESSAGE_DRAFTFOLDER:
        $page_folder = $page_draftbox;
        break;
    default:
        $page_folder = $page_category_list;
}

$t->assign(
    'site_position',
    [
        [
            'page' => $page_index,
            'name' => grn_get_page_display_name($page_index),
            'sf'   => $sf
        ],
        [
            'page' => $page_index,
            'name' => grn_get_page_display_name($page_folder),
            'cid'  => $category_id,
            'sf'   => 1
        ],
        [
            'page' => $page_folder_view,
            'name' => grn_get_page_display_name($page_folder_view),
            'cid'  => $category_id
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);


// フォルダ情報
$assign_category_map = [
    'cid'       => 'folder_id',
    'title'     => 'folder_name',
    'memo'      => 'memo',
    'type'      => 'folder_type',
    'subscribe' => 'subscription_flag',
    'parent_id' => 'parent_id',
];

$category_for_view = [];
foreach ($assign_category_map as $view_name => $data_name) {
    $category_for_view[$view_name] = $folder_info[$data_name];
}

$t->assign('category', $category_for_view);



