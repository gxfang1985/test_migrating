<?php

// application object
require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();

global $G_message, $G_message_name;
$G_message = null;
if ( ! ($G_message = $locator->getInstance('message'))) {
    require_once('message/error_code.csp');
    $name = $locator->getName('message');
    $name = htmlspecialchars($name);
    cb_throw_error(E_GRN_MESSAGE_DEACTIVATED,
        ['app_name' => $name],
        ['app_name' => $name]);
}
$G_message_name = $G_message->getName();
unset($locator);

// user object
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
global $G_message_login;
$G_message_login = $uum->getLoginUser();

if ( ! is_object($G_message_login) || ! is_a($G_message_login, 'cb_user')) {
    require_once('fw/error_code.csp');
    cb_throw_error(E_COMMON_ACCOUNT_INVALIDATED);
}
unset($uum);

require_once('grn/ui.csp');
$cm = GRN_UIConfigManager::getInstance();
global $G_message_ui_config;
$G_message_ui_config = $cm->getUserConfig($G_message_login);
unset($cm);

///////////////////////////////////////

function _message_rebuild_folder_tree($expand_oid = null)
{
    require_once('message/folder_tree.csp');
    $list_page = 'message/index';
    grn_message_rebuild_folder_tree($list_page, $expand_oid);
}


