<?php

use grn\grn\MemberLogic;

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login =& $uum->getLoginUser();
// addressees
if ($is_draft === false) {
    $users = $sUIDs;
} else {
    $users = null;
}

$addressee_users_for_view = [];
$addressee_users_for_filter_view = [];
if (is_array($users)) {
    $addressee_users_for_view = MemberLogic::getInstance()
                                           ->getDisplayUsersByUserIds($users);
    $t->assign('addressee_users', $addressee_users_for_view);

    $addressee_users_for_filter_view = $addressee_users_for_view;
    $t->assign('addressee_users_filter', $addressee_users_for_filter_view);
}

$operation_users_for_filter_view = [];
if (is_array($operators)) {
    $operation_users_for_filter_view = MemberLogic::getInstance()
                                                  ->getDisplayUsersByUserIds($operators);
    $t->assign('operation_users', $operation_users_for_filter_view);
}

$t->assign('operator_open', $operator_set);

// message data
$message_for_view['subject'] = @ $G_INPUT['title'];
$message_for_view['confirm'] = @ $G_INPUT['confirm'];

// for rich editor
if (array_key_exists('editor', $G_INPUT) && $G_INPUT['editor']) {
    $t->assign('editor', 1);
    $message_for_view['html'] = $G_INPUT['data'];
}
$message_for_view['data'] = $G_INPUT['data'];

// attached files
require_once('grn/controller.csp');
$tmp_key = grn_get_temporary_key();
$attach_files = grn_get_attached_file_info(@ $target_name
                                           . $tmp_key,
    'message');
$message_for_view['attached_files'] = $attach_files;

$t->assign('tmp_key', $tmp_key);

$t->assign('message', $message_for_view);

$t->assign('category_id', @ $G_INPUT['cid']);
$t->assign('relation_id', @ $G_INPUT['rid']);
$t->assign('message_id', @ $G_INPUT['mid']);

//generate upload ticket
include('grn/_upload_prepend.csp');


