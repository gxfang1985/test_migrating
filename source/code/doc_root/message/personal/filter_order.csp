<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

// SmartyValidate should be initialized when an input form is there.
//require('SmartyValidate.class.php');
//SmartyValidate::connect($t);

//-- get parameters from URL parameters
//$filter_id = @ $G_INPUT['fmid'];
//$t->assign('filter_id', $filter_id);

//------------------

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();

if ( ! $user) {
    require_once('grn/error_code.csp');
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}

require_once('message/personal_logic.csp');
$personal_logic = GRN_Message_PersonalLogic::getInstance();
$filters = $personal_logic->getAllFilters($user);

$filters_for_view = [];
foreach ($filters as $filter) {
    $filters_for_view[$filter['filter_id']] = $filter['filter_name'];
}

$t->assign('filters', $filters_for_view);

/*
// filter
$t->assign(
    'filters',array(
        1 => 'フィルター１', //mfid（メッセージフィルターID）フィルタータイトル
        2 => 'フィルター２', //mfid（メッセージフィルターID）フィルタータイトル
        3 => 'フィルター３', //mfid（メッセージフィルターID）フィルタータイトル
    )
);
 */

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => "message/personal/filter",
            'name' => grn_get_page_display_name("message/personal/filter")
        ],
        [
            'page' => "",
            'name' => $page_title
        ]
    ]
);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


