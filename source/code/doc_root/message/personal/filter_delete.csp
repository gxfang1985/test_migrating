<?php

$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();

if ( ! $user) {
    require_once('grn/error_code.csp');
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}

//-- instantiate smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//-- get parameters from URL parameters
$filter_id = @ $G_INPUT['mfid'];
//$t->assign( 'filter_id' , $filter_id );
if ($filter_id == '') {
    require_once('message/error_code.csp');
    cb_throw_error(E_GRN_MESSAGE_FILTER_NOT_FOUND);
}

//------------------

require_once('message/personal_logic.csp');
$personal_logic = GRN_Message_PersonalLogic::getInstance();
$filter_name = $personal_logic->getFilterName2($user, $filter_id);

if ($filter_name === false) {
    require_once('message/error_code.csp');
    cb_throw_error(E_GRN_MESSAGE_FILTER_NOT_FOUND);
}

$t->assign('selected', [
    'mfid'  => $filter_id,
    'title' => $filter_name
]);

/*
// selected Mygroup data
$t->assign(
    'selected', array(
        'mfid' => 1,
        'title' => 'フィルター1',
    )
);
 */

//------------------

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

/*
require_once( 'grn/controller.csp' );

// site position
$page_infos = array( 'filter' => 'message/personal/filter',
                     'filter_view' => array( 'mfid' => $filter_id ),
                     'filter_delete'  => null );
$util = new GRN_ControllerUtil();
$site_position = $util->makeSitePosition( 'message/personal/', $page_infos );
$t->assign( 'site_position', $site_position );
 */

$t->assign('site_position',
    [
        [
            'page' => "message/personal/filter",
            'name' => grn_get_page_display_name("message/personal/filter")
        ],
        [
            'page' => 'message/personal/filter_view',
            'name' => grn_get_page_display_name('message/personal/filter_view'),
            'mfid' => $filter_id,
        ],
        [
            'page' => "",
            'name' => $page_title
        ]
    ]
);

//-- show page
$t->display(cb_get_pagename() . '.tpl');

