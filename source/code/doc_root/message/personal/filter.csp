<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//-- get parameters from URL parameters
//$filter_id = @ $G_INPUT['id'];
//$t->assign('filter_id', $filter_id);

//------------------

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();

if ( ! $user) {
    require_once('grn/error_code.csp');
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}

require_once('message/personal_logic.csp');
$personal_logic = GRN_Message_PersonalLogic::getInstance();
$filters = $personal_logic->getAllFilters($user);

$filters_for_view = [];
foreach ($filters as $filter) {
    $_filter = [];
    $_filter['title'] = $filter['filter_name'];
    $_filter['available'] = $filter['available'];
    $_filter['folder_id'] = $filter['folder_id'];
    $filters_for_view[$filter['filter_id']] = $_filter;
}

$t->assign('filters', $filters_for_view);

//#526
$t->assign('disabled_change_order',
    count($filters_for_view) < 2 ? true : false);

/*
// filter_set
$t->assign(
    'filters',array(
        1 => array(
            'fmid' => 1, //filter_ID
            'title' => 'フィルター１', //filter_title
            'cid' => 1,
            'type' => 'all', //condition type
            'condition' =>  array( //condition setup
                1 => array(
                    'object' => 1, //subject,sender,address
                    'value' => 'なんちゃらかんちゃら',
                    'type' => 1 //含む、含まない、同じ、異なる、始まる
                ),
            ),
        ),
        2 => array(
            'fmid' => 2, //filter_ID
            'title' => 'フィルター２', //filter_title
            'cid' => 2,
            'type' => 'all', //condition type
            'condition' =>  array( //condition setup
                1 => array(
                    'object' => 1, //subject,sender,address
                    'value' => 'なんちゃらかんちゃら',
                    'type' => 1 //含む、含まない、同じ、異なる、始まる
                ),
            ),
        ),
        3 => array(
            'fmid' => 3, //filter_ID
            'title' => 'フィルター３', //filter_title
            'cid' => '',
            'type' => 'all', //condition type
            'condition' =>  array( //condition setup
                1 => array(
                    'object' => 1, //subject,sender,address
                    'value' => 'なんちゃらかんちゃら',
                    'type' => 1 //含む、含まない、同じ、異なる、始まる
                ),
            ),
        )
    )
);
 */

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

//-- show page
$t->display(cb_get_pagename() . ".tpl");


