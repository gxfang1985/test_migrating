<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();

    if ( ! $user) {
        require_once('grn/error_code.csp');
        cb_throw_error(E_GRN_USER_NOT_FOUND);
    }

    require_once('message/personal_logic.csp');
    $personal_logic = GRN_Message_PersonalLogic::getInstance();

    if (array_key_exists("use", $G_INPUT)) {
        $ret1 = $personal_logic->setUseGarbageBoxAttribute($user, '1');
    } else {
        $ret1 = $personal_logic->setUseGarbageBoxAttribute($user, '0');
    }

    $ret2 = $personal_logic->setStoredTermAttribute($user,
        @ $G_INPUT['set_day']);

    if ($ret1 === false || $ret2 === false) {
        require_once('message/error_code.csp');
        cb_throw_error(E_GRN_MESSAGE_PROFILE_DATA_NOT_UPDATED);
    }

    _message_rebuild_folder_tree();

    cb_redirect('personal/application_list', ['app_id' => 'message']);
}

