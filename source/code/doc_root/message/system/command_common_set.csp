<?php

if (array_key_exists('REQUEST_METHOD', $_SERVER)
    && strcasecmp($_SERVER['REQUEST_METHOD'], 'POST') == 0
) {
    require_once('message/system_logic.csp');
    $system_logic = GRN_Message_SystemLogic::getInstance();

    $confirm = '0';
    if (array_key_exists('confirm', $G_INPUT)) {
        $confirm = $G_INPUT['confirm'];
    }

    $use_re = '0';
    if (array_key_exists('use_re', $G_INPUT)) {
        $use_re = $G_INPUT['use_re'];
    }

    $confirm_mode = '0';
    if (array_key_exists('confirm_mode', $G_INPUT)) {
        $confirm_mode = $G_INPUT['confirm_mode'];
    }

    $enable_follow_autolink = '0';
    if (array_key_exists('enable_follow_autolink', $G_INPUT)) {
        $enable_follow_autolink = $G_INPUT['enable_follow_autolink'];
    }

    $ret1 = $system_logic->setConfirmConfigAttribute($confirm);
    $ret2 = $system_logic->setUseREConfigAttribute($use_re);
    $ret3 = $system_logic->setConfirmModeConfigAttribute($confirm_mode);
    $ret4 = $system_logic->setEnableFollowAutoLink($enable_follow_autolink);

    if ( ! $ret1 || ! $ret2 || ! $ret3 || ! $ret4) {
        require_once('message/error_code.csp');
        cb_throw_error(E_GRN_MESSAGE_FAIL_TO_UPDATE_SYSTEM_PROFILE);
    }

    cb_redirect('system/application_list', ['app_id' => 'message']);
}

