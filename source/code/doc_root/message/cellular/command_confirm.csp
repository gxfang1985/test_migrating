<?php
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    // 使用するパラメータの定義
    $relation_id = @ $G_INPUT['rid'];
    $message_id = @ $G_INPUT['mid'];

    require_once('grn/application.csp');
    $locator = GRN_ApplicationLocator::instance();
    $app_name = $locator->getName('message');

    if ($relation_id == '' || $message_id == '') {
        require_once('message/error_code.csp');
        cb_throw_error(E_GRN_MESSAGE_MESSAGE_NOT_FOUND,
            ['app_name' => $app_name],
            ['app_name' => $app_name],
            ['app_name' => $app_name]);
    }

    // メッセージinstance
    require_once('message/message_logic.csp');
    $message_logic = new GRN_Message_Logic();

    // 確認（confirm）
    $ret = $message_logic->confirmMessage($G_login_user, $message_id);
    if ( ! $ret) {
        require_once('message/error_code.csp');
        cb_throw_error(E_GRN_MESSAGE_MESSAGE_NOT_FOUND,
            ['app_name' => $app_name],
            ['app_name' => $app_name],
            ['app_name' => $app_name]);
    }

    require_once('cellular/prepend.csp');
    grn_cellular_redirect($G_pagepath . "/look1",
        ['rid' => $relation_id, 'mid' => $message_id]);
}

