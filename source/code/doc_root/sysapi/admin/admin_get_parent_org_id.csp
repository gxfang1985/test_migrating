<?php
/** @var GRN_Util_Api_Service $sysapi_service */
/** @var GRN_Uum $uum */
if (isset($sysapi_service)) {
    // Get a paramater
    $request_params = $sysapi_service->getRequestParameters();
    $values = $sysapi_service->selectNodesValue($request_params,
        'child_orgId', true);
    $childOrgId = $values[0];

    // Query the database
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');

    require_once('sysapi/logic.csp');
    if ($childOrgId == GRN_SYSAPI_ROOT_ORGID) {
        // Root org does not has a parent
        $parentOrgId = GRN_SYSAPI_INVALID_ORGID;
    } else {
        // Check if childOrgId exists
        $child = $uum->getGroupInfo($childOrgId);

        if ( ! $child) {
            $childOrgId = GRN_SYSAPI_INVALID_ORGID;
            $parentOrgId = GRN_SYSAPI_INVALID_ORGID;
        } else {
            $parentOrgId = $uum->getParentOfGroup($childOrgId);
            if (is_null($parentOrgId)) {
                $parentOrgId = GRN_SYSAPI_ROOT_ORGID;
            }
        }
    }

    // Put result to the container
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;
    $t->assign('parentOrgId', $parentOrgId);
    $t->assign('childOrgId', $childOrgId);

    $t->assign('xml_namespaces',
        "xmlns:admin=\"http://wsdl.cybozu.co.jp/admin/2008\"");
    grn_util_api_response($t, __FILE__);
}

