<?php
/** @var GRN_Util_Api_Service $sysapi_service */
/** @var GRN_Uum $uum */
if (isset($sysapi_service)) {
    // Get a paramater
    $request_params = $sysapi_service->getRequestParameters();
    $values = $sysapi_service->selectNodesValue($request_params,
        'userId', true);
    $userId = $values[0];

    // Query the database
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');

    // Check if userId exists
    $user_info = $uum->getUserInfo($userId, ['col_foreign_key']);
    if ($user_info) {
        $groups = $uum->getUserGroupsInfo($userId);
    } else {
        $groups = null;
    }

    // Create the result and put into an xml container
    $orgIds = [];
    if (is_array($groups)) {
        foreach ($groups as $group) {
            $orgIds[] = $group['_id'];
        }
    } else {
        require_once('sysapi/logic.csp');
        $userId = GRN_SYSAPI_INVALID_USERID;
    }

    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;
    $t->assign('orgIds', $orgIds);
    $t->assign('userId', $userId);

    $t->assign('xml_namespaces',
        "xmlns:admin=\"http://wsdl.cybozu.co.jp/admin/2008\"");
    grn_util_api_response($t, __FILE__);
}

