<?php
/** @var GRN_Util_Api_Service $sysapi_service */
/** @var GRN_Uum $uum */
if (isset($sysapi_service)) {
    // Get a paramater
    $request_params = $sysapi_service->getRequestParameters();
    $values = $sysapi_service->selectNodesValue($request_params,
        'orgId', true);
    $orgId = $values[0];

    require_once('sysapi/logic.csp');
    $orgId_grn = $orgId;
    if ($orgId === GRN_SYSAPI_ROOT_ORGID) {
        $orgId_grn = null;
    }

    //validate
    if ( ! is_numeric($orgId) || strval($orgId) != strval(intval($orgId))) {
        require_once('sysapi/error_code.csp');
        cb_throw_error(E_GRN_SYSAPI_INVALID_ORG, null, ['orgId' => $orgId],
            ['orgId' => $orgId]);
    }

    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $org = $uum->getGroup($orgId_grn);
    if ( ! is_null($org) && is_a($org, 'CB_Group')) {
        $num_users = $uum->getGroupUserCount($orgId_grn);
    } else {
        $orgId = GRN_SYSAPI_INVALID_ORGID;
        $num_users = 0;
    }

    // Put results in to a xml container
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;
    $t->assign('num_users', $num_users);
    $t->assign('orgId', $orgId);

    $t->assign('xml_namespaces',
        "xmlns:admin=\"http://wsdl.cybozu.co.jp/admin/2008\"");
    grn_util_api_response($t, __FILE__);
}
