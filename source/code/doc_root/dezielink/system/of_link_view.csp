<?php
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

require_once('dezielink/system_logic.csp');
$sys_logic = GRN_OfficeLink_SystemLogic::getInstance();

$auth_available = $sys_logic->getAuthAvailable();
$connector_available = $sys_logic->getConnectorAvailable();

if ($auth_available && $connector_available) {
    $sync_user_available = $sys_logic->getSyncUserAvailable();
    if ($sync_user_available) {
        $sync_period = $sys_logic->getSyncUserPeriod();
        $sync_time = $sys_logic->getSyncUserTime();

        $condition = $sys_logic->getPeriodDataCondition($sync_period,
            $sync_time);
        $period_data = cb_msg('grn.dezielink', 'period_data', $condition);
        $t->assign('period_data', $period_data);
    }
    $t->assign('sync_user', $sync_user_available);
    $t->assign('url', $sys_logic->getURL());
}
$t->assign('auth_available', $auth_available);
$t->assign('connector_available', $connector_available);
$t->assign('creator_info', $sys_logic->getCreator());
$t->assign('modifier_info', $modification_info = $sys_logic->getModifier());
$t->assign('edit_page', 'dezielink/system/of_link_modify');
$t->assign('sync_user_page', 'dezielink/system/of_link_sync_user');

//Set page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
//Set site position
$position[] = [
    'page' => "",
    'name' => $page_title
];
$t->assign('site_position', $position);
//Set page for displaying
$t->display(cb_get_pagename() . '.tpl');

