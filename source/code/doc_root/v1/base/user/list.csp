<?php
require_once dirname(dirname(__DIR__)) . '/_api.csp';

$in = JSON::getInput();

function setStringAttribute($row, $name, $value)
{
    $row->$name = $value ? $value : '';
}

global $G_container_base;
/** @var GRN_Uum $uum */
$uum = $G_container_base->getInstance('uum');
$users = $uum->getUsersInfo();

$rows = [];
foreach ($users as $key => $item) {
    $user = $uum->getUser($key, true);
    $row = new stdClass();
    $row->id = $user->getOID();
    $row->code = $user->get('foreign_key');
    $row->name = $user->get('display_name');
    setStringAttribute($row, 'nameReading', $user->get('sort_key'));
    setStringAttribute($row, 'email', $user->get('email_address'));
    setStringAttribute($row, 'url', $user->get('url'));
    setStringAttribute($row, 'phone', $user->get('telephone_number'));
    $rows[] = $row;
}

$result = new stdClass();
$result->success = true;
$result->rows = $rows;
echo json_encode($result);
