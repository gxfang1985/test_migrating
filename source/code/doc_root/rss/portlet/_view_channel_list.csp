<?php

function _grn_rss_channel_list(& $user, & $logic, $site_list, $prefix)
{
    $channel_oids = [];
    $sites = [];
    foreach ($site_list as $rid => $data) {
        $site = [];

        require_once('rss/resources.csp');
        switch ($data['type']) {
            case GRN_RSS_RELATION_TYPE_FOLDER:
                break;
            case GRN_RSS_RELATION_TYPE_CHANNEL:
                $site['display_name'] = $data['title'];
                if ($data['has_error']) {
                    $site['notify'] = -1;
                    $site['error'] = $logic->getErrorMessage($data['error']);
                }
                $channel_oids[] = $data['channel_oid'];
                $site['channel_oid'] = $data['channel_oid'];
                break;
            case GRN_RSS_RELATION_TYPE_DELIMITER:
                $site['separator'] = true;
                break;
        }

        $sites[$prefix . $rid] = $site;
    }

    $counts = $logic->getNewItemNumber($user, $channel_oids);

    foreach ($sites as $key => $site) {
        if (array_key_exists($site['channel_oid'], $counts)) {
            $sites[$key]['notify'] = $counts[$site['channel_oid']];
        }
    }

    return $sites;
}


