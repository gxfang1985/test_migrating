<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once('rss/system.csp');
$system = GRN_RSS_SystemLogic::getInstance();
if (strcmp($system->getUsePersonalAttribute(), '0') === 0) {
    require_once('rss/error_code.csp');
    cb_throw_error(E_GRN_RSS_NO_PERSONAL_PERMISSION);
}

// check parameter
if ( ! array_key_exists('key', $G_INPUT) || ! is_numeric($G_INPUT['key'])) {
    require_once('rss/error_code.csp');
    cb_throw_error(E_GRN_RSS_NO_SITE_INFO);
}

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once('rss/personal.csp');
$personal = GRN_RSS_PersonalLogic::getInstance();
$channel_info =& $personal->getPersonalChannelInfo($G_rss_login,
    $G_INPUT['key']);
if ($channel_info === false) {
    require_once('rss/error_code.csp');
    cb_throw_error(E_GRN_RSS_NO_SITE_INFO);
}
//delete info
$target = [
    'class'    => ['display_name' => cb_msg(GRN_RSS_APP_MODULEID, 'site')],
    'instance' => [
        'id'           => $G_INPUT['key'],
        'display_name' => $channel_info['title']
    ]
];
$delete_info = [
    'title'      => grn_get_page_display_name('rss/personal/delete'),
    'page'       => 'rss/personal/delete.tpl',
    'no_confirm' => false,
    'data'       => ['target' => $target],
    'handler'    => 'lnk_delete_rss',
];
$t->assign('delete_info', $delete_info);
// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

$page_list = 'rss/personal/list';
$t->assign('site_position',
    [
        [
            'page' => $page_list,
            'name' => grn_get_page_display_name($page_list)
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]);

$t->assign('menu_params', ['id' => $G_INPUT['key']]);

include('_items.csp');

$form_for_view = [
    'items' => $items_for_view,
];

$t->assign('form', $form_for_view);

//-- show page
$t->display(cb_get_pagename() . ".tpl");

