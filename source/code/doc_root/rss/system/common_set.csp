<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//-- assign smarty parameters

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

require_once('fw/i18n.csp');
require_once('rss/resources.csp');
require_once('rss/system.csp');
$system = GRN_RSS_SystemLogic::getInstance();

// cache interval option
$cache_interval_options = [5, 10, 15, 30, 60, 120, 360, 720, 1440];
$selected_option = intval($system->getCacheIntervalAttribute());
$cache_interval_options_for_view = [];

foreach ($cache_interval_options as $time) {
    $option = [];
    $option['value'] = strval($time);
    $option['label'] = cb_msg(GRN_RSS_APP_MODULEID,
        "cache_interval.options.${time}");
    if ($selected_option === $time) {
        $option['selected'] = true;
    }
    $cache_interval_options_for_view[] = $option;
}

// cache preservation option
$cache_preservation_options = [1, 2, 3, 7, 14];
$selected_option
    = intval($system->getCachePreservationAttribute());
$cache_preservation_options_for_view = [];
foreach ($cache_preservation_options as $time) {
    $option = [];
    $option['value'] = strval($time);
    $option['label'] = cb_msg(GRN_RSS_APP_MODULEID,
        "cache_preservation.options.${time}");
    if ($selected_option === $time) {
        $option['selected'] = true;
    }
    $cache_preservation_options_for_view[] = $option;
}

// timeout option
$timeout_options = [1, 2, 5, 10, 20, 30];
$selected_option = intval($system->getTimeoutAttribute());
$timeout_options_unit = cb_msg(GRN_RSS_APP_MODULEID, 'timeout.unit');
$timeout_options_for_view = [];
foreach ($timeout_options as $time) {
    $option = [];
    $option['value'] = strval($time);
    $option['label'] = "${time}${timeout_options_unit}";
    if ($selected_option === $time) {
        $option['selected'] = true;
    }
    $timeout_options_for_view[] = $option;
}

$form_for_view = [
    'items'   => [
        'use_shared'         => [
            'display_name' => cb_msg(GRN_RSS_APP_MODULEID, 'shared_site'),
            'type'         => 'checkbox',
            'caption'      => cb_msg(GRN_RSS_APP_MODULEID, 'shared_caption'),
            'value'        => '1',
            'checked'      => $system->getUseSharedAttribute(),
        ],
        'use_personal'       => [
            'display_name' => cb_msg(GRN_RSS_APP_MODULEID, 'personal_config'),
            'type'         => 'checkbox',
            'caption'      => cb_msg(GRN_RSS_APP_MODULEID, 'personal_caption'),
            'value'        => '1',
            'checked'      => $system->getUsePersonalAttribute(),
        ],
        'cache_interval'     => [
            'display_name' => cb_msg(GRN_RSS_APP_MODULEID, 'cache_interval'),
            'type'         => 'select',
            'options'      => $cache_interval_options_for_view,
        ],
        'cache_preservation' => [
            'display_name' => cb_msg(GRN_RSS_APP_MODULEID,
                'cache_preservation'),
            'type'         => 'select',
            'options'      => $cache_preservation_options_for_view,
        ],
        'timeout'            => [
            'display_name' => cb_msg(GRN_RSS_APP_MODULEID, 'timeout'),
            'type'         => 'select',
            'options'      => $timeout_options_for_view,
        ],
    ],
    'buttons' => [
        'submit' => [
            'display_name' => cb_msg('fw/common', 'save'),
            'type'         => 'submit',
        ],
        'cancel' => [
            'type' => 'cancel',
        ],
    ],
];

$t->assign('form', $form_for_view);
//-- show page
$t->display(cb_get_pagename() . '.tpl');

