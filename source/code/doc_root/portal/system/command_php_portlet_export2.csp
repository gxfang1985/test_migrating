<?php

// Check HTTP-POST Method
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    // instantiate an Smarty object
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;

    // Get Parameters
    $portlet_id_list = @  $G_INPUT['eid'];

    // Prepare Download
    cb_prepare_download('php_portlet.xml', 'text/xml', false);

    // Export All System PHP Portlet
    require_once('portal/system_portlet_logic.csp');
    $system_php_portletlogic = GRN_Portal_SystemPHPPortletLogic::getInstance();
    $portlet_list
        = $system_php_portletlogic->exportMulti($portlet_id_list);

    //Check Inspection Message Enabled
    require_once('portal/inspection.csp');
    $inspection = GRN_Portal_System_PHP_Portlet_Inspection::getInstance();
    if ($inspection->isEnabled()) {
        //Write Inspection Message
        foreach (array_keys($portlet_list) as $portlet_id) {
            $portlet =& $portlet_list[$portlet_id];
            $message_type = 'php_portlet_export';
            $message_args = [
                'ppid'         => $portlet->getOID(),
                'portlet_name' => $portlet->get('name')
            ];
            $inspection->record($message_type, $message_args);
        }
    }

    // Exit Download
    cb_safe_exit();
}


