<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // 入力フォームデータを取得する
    $security_model = @ $G_INPUT['security_model']; // セキュリティ・モデル
    $poid = @ $G_INPUT['poid'];           // 選択されている組織

    require_once('portal/access_logic.csp');
    $logic = GRN_Portal_MyPortalAccessLogic::getInstance();
    $object =& $logic->getObject();
    $object_id = $object->getOID();

    if ($security_model == $logic->getSecurityModel($object_id)) {
        // アクセス権ページにリダイレクトする
        cb_redirect('portal/system/availability_list');
    }

    require_once('fw/session_manager.csp');

    $session_manager = CB_SessionManager::getInstance();
    $session =& $session_manager->getSession(GRN_PRTL_MODULE_ID);

    // セキュリティ・モデルをセッションに書き込む
    $session->set('security_model', $security_model);

    // セキュリティ・モデルの変更1/2ページにリダイレクトする
    cb_redirect('portal/system/availability_model_modify2',
        ['poid' => $poid, 'security_model' => $security_model]);
}


