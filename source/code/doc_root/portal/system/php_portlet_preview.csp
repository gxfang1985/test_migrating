<?php

// instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Get Portlet ID
$portlet_id = @ $G_INPUT['plid'];

//Get System HTML Portlet
require_once('portal/system_portlet_logic.csp');
$system_php_portletlogic = GRN_Portal_SystemPHPPortletLogic::getInstance();
$portlet =& $system_php_portletlogic->get($portlet_id);

// Create Parameter Translation Map
$translation_map_portlet = [
    'ppid'          => '_id',                  //Portlet ID
    'type'          => 'type',                 //Portlet Type
    'version'       => 'version',              //Portlet Version
    'set_template'  => 'set_template',         //Portlet Setting Tamplate
    'view_template' => 'view_template',        //Portlet View template
    'source'        => 'source',               //Portlet Source
    'myportal'      => 'available_myportal',   //Portlet Available MyPortal
    'editor'        => 'editor',               //Portlet Editor
];

// Do Parameter Translation
$portlet_for_view = [];
foreach ($translation_map_portlet as $view_name => $model_name) {
    if ($view_name === 'ppid') {
        $portlet_for_view[$view_name] = $portlet_id;
    } else {
        $portlet_for_view[$view_name] = $portlet->get($model_name);
    }
}

// Assign Portlet Display Infomation
$t->assign('portlet', $portlet_for_view);

//-- set page title and site position

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => "portal/system/php_portlet_list",
            'name' => grn_get_page_display_name('portal/system/php_portlet_list'),
            'sf'   => 1
        ],
        [
            'page' => "portal/system/php_portlet_view",
            'name' => grn_get_page_display_name('portal/system/php_portlet_view'),
            'plid' => $portlet_id
        ],
        ['page' => "", 'name' => $page_title]
    ]
);
// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


