<?php

// Check HTTP-POST Method
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    // instantiate an Smarty object
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;

    $portlet_id_list = @ $G_INPUT['sITEM'];
    $G_INPUT['sITEM'] = '';
    if (is_array($portlet_id_list)) {
        //Exclude Null Portlet ID List
        foreach (array_keys($portlet_id_list) as $index) {
            if ($portlet_id_list[$index] == "") {
                unset($portlet_id_list[$index]);
            }
        }

        //Check Array Count
        if (count($portlet_id_list) > 0) {
            $G_INPUT['sITEM'] = 'dummy';
        }
    }

    // Validation check
    require_once('SmartyValidate.class.php');
    SmartyValidate::connect($t);
    $target_name = 'portal/system/html_portlet_export1';
    SmartyValidate::register_form($target_name);

    // validate after a POST
    if (SmartyValidate::is_valid($G_INPUT, $target_name)) {
        //Save Portlet ID List
        $session_manager = CB_SessionManager::getInstance();
        $session =& $session_manager->getSession(GRN_PRTL_MODULE_ID);
        $session->set('selected_portlet_id_list', $portlet_id_list);

        //Redirect Next Page
        cb_redirect('portal/system/html_portlet_export2');
    } else {
        //include sharing codes with command_*
        include('_html_portlet_export1.csp');

        //Assign Template Name
        $t->setPageInfo($target_name);

        //Display Previous Page
        $t->display($target_name . '.tpl');
    }
}


