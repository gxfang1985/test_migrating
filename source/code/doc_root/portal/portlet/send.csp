<?php

use grn\grn\access\service\AppAccess;

// instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

global $G_container_base;
$uum =& $G_container_base->getInstance('uum');
$user =& $uum->getLoginUser();

//Get Active Application ID List
require_once('grn/application.csp');
$application_locator = GRN_ApplicationLocator::instance();
$application_id_list = AppAccess::getAvailableAppIdsByUserId($user->getOID());


// Do Parameter Translation for Application
$application_list = [];
foreach ($application_id_list as $application_id) {
    $config = $application_locator->getConfig($application_id);
    if (array_key_exists('send_index', $config)) {
        $app_info = [
            'id'   => $application_id,
            'name' => $application_locator->getName($application_id),
            'page' => $config['send_index'],
            'icon' => $config['icon20'] . '.gif'
        ];
        $app =& $application_locator->getInstance($application_id);
        if ( ! is_null($app)) {
            if (method_exists($app, 'hideSendLink')) {
                $app_info['hide'] = $app->hideSendLink($user);
            }

            if (method_exists($app, 'disabledSendLink')) {
                $app_info['disabled'] = $app->disabledSendLink($user);
            }
        }

        $application_list[] = $app_info;
    }
}

// Smarty
$t->assign('applications', $application_list);

// Ignore Licence Warnning
$t->skipWarning();

// Display Smarty Template
$t->display('portal/portlet/send.tpl');


