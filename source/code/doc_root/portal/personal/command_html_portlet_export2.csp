<?php

//Evaluate access of My portal function.
require_once('portal/access_logic.csp');
$myportal_logic = GRN_Portal_MyPortalAccessLogic::getInstance();
$myportal_logic->evaluateAccess();

// Check HTTP-POST Method
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    // instantiate an Smarty object
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;

    // Get Parameters
    $portlet_id_list = @  $G_INPUT['eid'];

    // Prepare Download
    cb_prepare_download('html_portlet.xml', 'text/xml', false);

    // Export All My HTML Portlet
    require_once('portal/my_portlet_logic.csp');
    $my_html_portletlogic = GRN_Portal_MyHTMLPortletLogic::getInstance();
    $portlet_list
        = $my_html_portletlogic->exportMulti($portlet_id_list);

    //Check Inspection Message Enabled
    require_once('portal/inspection.csp');
    $inspection = GRN_Portal_My_HTML_Portlet_Inspection::getInstance();
    if ($inspection->isEnabled()) {
        //Write Inspection Message
        foreach (array_keys($portlet_list) as $portlet_id) {
            $portlet =& $portlet_list[$portlet_id];
            $message_type = 'my_html_portlet_export';
            $message_args = [
                'ppid'         => $portlet->getOID(),
                'portlet_name' => $portlet->get('name')
            ];
            $inspection->record($message_type, $message_args);
        }
    }

    // Exit Download
    cb_safe_exit();
}

