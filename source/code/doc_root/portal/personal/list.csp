<?php

// instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Set Application Name
global $G_portal_app_name;
$t->assign('app_name', $G_portal_app_name);

// for site position
$t->assign('app_id', 'portal');

// Evaluate access of My portal function.
require_once('portal/access_logic.csp');
$myportal_logic = GRN_Portal_MyPortalAccessLogic::getInstance();
$myportal_logic->evaluateAccess();

//Get My Portal List
require_once('portal/portal_logic.csp');
$my_portallogic = GRN_Portal_MyPortalLogic::getInstance();
$portal_rows = $my_portallogic->getList();

// Get My Portlet Template ID
require_once("portal/system_logic.csp");
$system_logic = GRN_Portal_SystemLogic::getInstance();
$my_portal_template_id = $system_logic->getMyPortaltemplate();

$portal_list = [];
foreach (array_keys($portal_rows) as $id) {
    //Exclde My Portal Template from Portal List
    if (intval($id) === intval($my_portal_template_id)) {
        continue;
    }

    $portal_row =& $portal_rows[$id];
    $portal_list[$id] = [
        'pid'  => $id,
        'name' => $portal_row->get('name'),
    ];
}

$t->assign('portal_list', $portal_list);
$t->assign('portal_count', count($portal_list));

//-- set page title and site position

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

$delete_multi = [
    'title'        => grn_get_page_display_name('portal/personal/delete_multi'),
    'page'         => 'portal/personal/delete_multi.tpl',
    'handler'      => 'btn_delete_multi',
    'data'         => null,
    'multi_target' => 'eid[]',
    'form_target'  => cb_get_pagename()
];
$t->assign('delete_multi', $delete_multi);

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


