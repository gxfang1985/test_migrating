<?php

// instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

// for site position
$t->assign('app_id', 'portal');

//Get List Flag
$list = @ $G_INPUT['list'];

// Evaluate access of My portal function.
require_once('portal/access_logic.csp');
$myportal_logic = GRN_Portal_MyPortalAccessLogic::getInstance();
$myportal_logic->evaluateAccess();

//Get My Portal List
require_once("portal/portal_logic.csp");
$my_portalLogic = GRN_Portal_MyPortalLogic::getInstance();
$portal_list = $my_portalLogic->getList();

// Create Parameter Translation Map
$translation_map = [
    'pid'   => '_id',
    'title' => 'name',
];

// Do Parameter Translation
$portal_list_for_view = [];
foreach (array_keys($portal_list) as $portal_id) {
    $portlet = [];
    foreach ($translation_map as $view_name => $model_name) {
        if ($view_name === 'pid') {
            $portal_for_view[$view_name] = $portal_id;
        } else {
            $portal_for_view[$view_name]
                = $portal_list[$portal_id]->get($model_name);
        }
    }
    $portal_list_for_view[$portal_id] = $portal_for_view['title'];
}


// Assign Portal Display Infomation
$t->assign('portal', $portal_list_for_view);
$t->assign('list', $list);

//-- set page title and site position

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
if ($list == 1) {
    //Portal List Page
    $t->assign(
        'site_position', [
            [
                'page' => "portal/personal/list",
                'name' => grn_get_page_display_name('portal/personal/list')
            ],
            ['page' => '', 'name' => $page_title]
        ]
    );
} else {
    //Portal Top Page
    $t->assign(
        'site_position', [
            ['page' => '', 'name' => $page_title]
        ]
    );
}

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


