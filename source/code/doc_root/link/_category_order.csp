<?php

//Get Parameter
$parent_category_id = @ $G_INPUT['pcid'];   //Parent Category ID

//Get Link and Category Controller Utility
require_once('link/controller_util.csp');
$category_util = GRN_Link_Category_Controller_Utility::getInstance();
$category_util->setType('personal');

//Check Parent Category ID
require_once('link/resources.csp');
$parent_category_id = $parent_category_id ? $parent_category_id
    : GRN_LINK_CATEGORY_ROOT_ID;

//Create Parameter Translation Map
$translation_map_category = [
    'cid'   => '_id',
    'title' => 'name',
];

//Get Parent Category for View
$parent_category_for_view = $category_util->getView($parent_category_id,
    $translation_map_category, null, true, CB_DATABASE_NO_LOCK);

//Get Child Category List for View
$child_category_list_for_view
    = $category_util->getChildListView($parent_category_id,
    $translation_map_category, CB_DATABASE_NO_LOCK);
if (count($child_category_list_for_view) == 0) {
    //Child Category List Not Found
    require_once('link/error_code.csp');
    cb_throw_error(E_GRN_LINK_CATEGORY_LIST_NOT_FOUND);
}

//Create Category Information
$category_information_for_view = $parent_category_for_view;
foreach ($child_category_list_for_view as $child_category_for_view) {
    $category_information_for_view['child_categories'][$child_category_for_view['cid']]
        = $child_category_for_view['title'];
}

//Assign Parent Category Title
$t->assign('category', $category_information_for_view);
