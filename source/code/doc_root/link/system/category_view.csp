<?php

global $G_INPUT;

//Instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Get Category Controller Utility
require_once('link/controller_util.csp');
$category_util = GRN_Link_Category_Controller_Utility::getInstance();

//Check Category ID
require_once('link/resources.csp');
$category_id = @ $G_INPUT['cid'];    //Category ID
$category_id = $category_id ? $category_id : GRN_LINK_CATEGORY_ROOT_ID;
$t->assign('category_id', $category_id);

//Set Shared
$category_util->setType('system');
$t->assign('type', 'system');

//Create Parameter Translation for Category
$translation_map_category = [
    'cid'          => '_id',              //Category ID
    'title'        => 'name',             //Category Name
    'foreign_key'  => 'foreign_key',      //Category Name
    'memo'         => 'memo',             //Category Memo
    'memo'         => 'memo',             //Category Memo
    'creator_uid'  => 'creator_uid',      //Category Creator UID
    'creator_name' => 'creator_name',     //Category Creator Name
    'modify_uid'   => 'modifier_uid',     //Category Modifier UID
    'modify_name'  => 'modifier_name',    //Category Modifier Name
    'ctime'        => 'ctime',            //Category Create Time
    'mtime'        => 'mtime',            //Category Modify Time
    'num_children' => 'num_children',     //Children Category Count
    'num_link'     => 'num_link',         //Children Link Count
];

$category = $category_util->getView($category_id,
    $translation_map_category);
$category_id = $category['cid'];
$category['parent_category'] = $category_util->getParentView($category_id,
    $translation_map_category);
$category['child_categories']
    = $category_util->getListView($translation_map_category,
    $category_id);

$t->assign('category', $category);
$t->assign('is_root', $category_id == GRN_LINK_CATEGORY_ROOT_ID);
$t->assign('management', 1);

//-- set page title and site position

//page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

//site position
$t->assign('site_position', [
        [
            'page' => 'link/system/list',
            'name' => grn_get_page_display_name('link/system/list'),
            'cid'  => $category_id
        ],
        ['page' => '', 'name' => $page_title]
    ]
);

//Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


