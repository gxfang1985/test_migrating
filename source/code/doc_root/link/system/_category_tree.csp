<?php

require_once('grn/org_tree.csp');
require_once('link/category_tree.csp');

if ( ! isset($tree_name)) {
    $tree_name = cb_get_pagename();
}

$util = GRN_OrgTreeUtil::getInstance();
$tree =& $util->getTree($tree_name, 'GRN_Link_SystemCategoryTree');

$tree_for_view = [];

if (is_null($tree_selected_oid)) {
    $tree_selected_oid = $tree->getSelectedNode();
}
if (array_key_exists('top', $G_INPUT) || is_null($tree->getRoot())) {
    $tree->initialize();
    $tree_selected_oid = null;
}

$tree->setSelectedNode($tree_selected_oid);
$util->setTree($tree_name, $tree);

$tree_for_view = [
    'page_name'    => $tree_name,
    'root'         => $tree->getRoot(),
    'async_url'    => 'link/system/category_json',
    'link_url'     => null,
    'selected_oid' => $tree_selected_oid,
];

if (isset($tree_info) && is_array($tree_info)) {
    $tree_for_view = $tree_info + $tree_for_view;
}

$t->assign('folder_tree', $tree_for_view);

