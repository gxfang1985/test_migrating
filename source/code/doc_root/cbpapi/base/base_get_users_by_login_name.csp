<?php
if (isset($cbpapi_service)) {
    // get SOAP action
    $action = $cbpapi_service->getAction();

    // get parameters of SOAP request
    $request_params = $cbpapi_service->getRequestParameters();
    $list_login_name = $cbpapi_service->selectNodesValue($request_params,
        'login_name');

    if ( ! isset($list_login_name)) {
        require_once('grn/error_code.csp');
        cb_throw_error(E_GRN_CBPAPI_MISSING_PARAMETER, null,
            ['param' => 'login_name']);
    }

    $users = [];
    foreach ($list_login_name as $login_name) {
        $user_info = grn_cbpapi_get_user_by_login_name($login_name);
        if ($user_info) {
            $users[$login_name] = $user_info;
        }
    }

    //response SOAP message
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('common')]);
    $t->assign('action', $action);
    $t->assign('users', $users);

    grn_cbpapi_response($t, __FILE__);
}


