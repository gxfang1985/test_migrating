<?php
if (isset($cbpapi_service)) {
    // get SOAP action
    $action = $cbpapi_service->getAction();

    // Create region options
    $region_options = [];
    $region_list = CB_I18N::getTimezoneRegions();

    foreach ($region_list as $region) {
        if ($region != '(All)') {
            $region_options[] = [
                'label' => cb_msg('fw.timezone', $region),
                'value' => $region
            ];
        }
    }

    // Create timezone options
    $timezone_options = [];
    $timezone_list = CB_I18N::getAvailableTimezones();
    foreach ($region_options as $key => $region) {
        foreach ($timezone_list as $timezone) {

            $option = [
                'label' => cb_msg('fw.timezone', $timezone),
                'value' => $timezone
            ];
            $region_timezone = explode('/', $timezone);
            if (strcmp($region_timezone[0], $region['value']) == 0) {
                if (isset($region_timezone[1])) {
                    $region_options[$key]['timezone'][]
                        = [
                        'time' => $option['label'],
                        'city' => $region_timezone[1]
                    ];
                } else {
                    $region_options[$key]['timezone'][]
                        = [
                        'time' => $option['label'],
                        'city' => $region_timezone[0]
                    ];
                }
            }
        }
    }


    //response SOAP message
    require_once("grn/smarty.csp");

    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('base')]);
    $t->assign('action', $action);
    $t->assign('region_options', $region_options);

    grn_cbpapi_response($t, __FILE__);
}

