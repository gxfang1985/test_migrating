<?php

if (isset($cbpapi_service)) {
    global $G_container_base;

    // get SOAP action
    $action = $cbpapi_service->getAction();

    // get parameters of SOAP request
    $request_params = $cbpapi_service->getRequestParameters();
    $groups_info_request = grn_cbpapi_parse_item_versions($request_params,
        'organization_item');

    // get group list
    $uum = $G_container_base->getInstance('uum');
    $groups_info = $uum->getGroupInfoList();
    foreach (array_keys($groups_info) as $key) {
        $groups_info[$key] = [
            'id'      => $key,
            'version' => $groups_info[$key]['col_mtime']
        ];
    }

    $groups = grn_cbpapi_compare_item_versions($groups_info_request,
        $groups_info);

    //SOAP reponse
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('common')]);
    $t->assign('action', $action);
    $t->assign('groups', $groups);

    grn_cbpapi_response($t, __FILE__);
}


