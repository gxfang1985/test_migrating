<?php
if (isset($cbpapi_service)) {
    // get SOAP action
    $action = $cbpapi_service->getAction();

    // get parameters of SOAP request
    $request_params = $cbpapi_service->getRequestParameters();
    $uids_request = $cbpapi_service->selectNodesValue($request_params,
        'user_id');

    if ( ! $uids_request) {
        require_once('grn/error_code.csp');
        cb_throw_error(E_GRN_CBPAPI_MISSING_PARAMETER, null,
            ['param' => 'user_id']);
    }

    $user_id_list = [];
    foreach (array_keys($uids_request) as $key) {
        if ( ! in_array($uids_request[$key], $user_id_list)) {
            $user_id_list[] = $uids_request[$key];
        }
    }

    $users = grn_cbpapi_get_users_by_id_list($user_id_list);

    foreach ($users as $userRow) {
        if ($userRow['attributes']['status'] == 2) {
            cb_throw_error(E_GRN_USER_NOT_FOUND);
        }
    }

    //response SOAP message
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('common')]);
    $t->assign('action', $action);
    $t->assign('users', $users);

    grn_cbpapi_response($t, __FILE__);
}


