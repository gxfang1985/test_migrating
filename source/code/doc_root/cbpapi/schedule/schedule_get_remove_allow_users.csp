<?php

if (isset($cbpapi_service)) {
    // check for valid request.
    $node_parameters = $cbpapi_service->getRequestParameters();

    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    $dynamic_roles = $uum->listGrantedRoles();
    $users_info = $uum->getUsersInfo();

    require_once('schedule/access_logic.csp');
    $acc_logic = GRN_Schedule_Access_Logic::getInstance();
    $remove_allow_users = $acc_logic->evaluateAccessesById($login, $users_info,
        ['read', 'delete'], $dynamic_roles, 'user');

    //response SOAP message
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('schedule')]);
    $t->assign('remove_allow_users', $remove_allow_users);
    grn_cbpapi_response($t, __FILE__);
}

