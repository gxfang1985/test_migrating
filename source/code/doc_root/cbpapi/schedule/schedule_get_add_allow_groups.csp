<?php

/**
 * API schedule add allow user
 *
 * @author : Tien Nguyen
 **/

if (isset($cbpapi_service)) {
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();
    $orgs = $uum->getGroupInfoList();
    $user_group_list = [];
    if ($orgs) {
        require_once('schedule/access_logic.csp');
        $acc_logic = GRN_Schedule_Access_Logic::getInstance();
        $dynamic_role = $uum->listGrantedRoles();
        $group_access_list = $acc_logic->getEvaluateAccessesListById($user,
            $orgs, 'group', ['add'], $dynamic_role);
        foreach ($group_access_list as $key_grp => $access) {
            if ($access['add'] != GRN_SCHD_ACCESS_DENY) {
                $user_group_list[] = $key_grp;
            }
        }
    }
    require_once "grn/smarty.csp";
    $t = new GRN_Smarty;

    $t->assign('user_group_list', $user_group_list);
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('schedule')]);
    grn_cbpapi_response($t, __FILE__);
}
