<?php

if (isset($cbpapi_service)) {
    // check for valid request.
    $node_parameters = $cbpapi_service->getRequestParameters();

    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    $dynamic_roles = $uum->listGrantedRoles();
    $groups_info = $uum->getGroupInfoList();

    require_once('schedule/access_logic.csp');
    $acc_logic = GRN_Schedule_Access_Logic::getInstance();
    $read_allow_groups = $acc_logic->evaluateAccessesById($login, $groups_info,
        ['read'], $dynamic_roles, 'group');

    //response SOAP message
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('schedule')]);
    $t->assign('read_allow_groups', $read_allow_groups);
    grn_cbpapi_response($t, __FILE__);
}

