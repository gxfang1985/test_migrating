<?php

if (isset($cbpapi_service)) {
    $action = $cbpapi_service->getAction();
    $node_parameter =& $cbpapi_service->getRequestParameters();
    $mygroup_ids = $cbpapi_service->selectNodesValue($node_parameter,
        'my_address_group_id');
    if ( ! isset($mygroup_ids)) {
        require_once('cbpapi/error_code.csp');
        cb_throw_error(E_GRN_CBPAPI_MISSING_PARAMETER, null,
            ['param' => 'my_address_group_id']);
    }

    global $G_container_base;
    $uum =& $G_container_base->getInstance('uum');
    $user =& $uum->getLoginUser();

    require_once('address/mygroup_logic.csp');
    $mygroup = GRN_Address_MyGroup_Logic::getInstance();

    foreach ($mygroup_ids as $mygroup_id) {
        if (is_null($mygroup_id) || 0 == strlen($mygroup_id)) {
            cb_throw_error(E_GRN_ADDRESS_MYGROUP_NOT_FOUND);
        }

        if ($mygroup->removeMyGroup($user, $mygroup_id) === false) {
            cb_throw_error(E_GRN_ADDRESS_MYGROUP_NOT_FOUND);
        }
    }
    // SOAP Response
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty();

    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('address')]);
    $t->assign('action', $action);

    grn_cbpapi_response($t, __FILE__);
}

