<?php
if (isset($cbpapi_service)) {
    $action = $cbpapi_service->getAction();
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    // get parameters of SOAP message
    $node_parameters = $cbpapi_service->getRequestParameters();

    require_once('cbpapi/message_logic.csp');
    $message_logic = GRN_CBPApi_Message_Logic::getInstance();
    $candidate_items_version = [];
    $folder_logic = new GRN_Message_FolderLogic();
    $category_id = $folder_logic->getSpecificFolderID($login,
        GRN_MESSAGE_RECEIVINGFOLDER);
    if ( ! $category_id) {
        require_once('message/error_code.csp');
        cb_throw_error(E_GRN_MESSAGE_FOLDER_NOT_FOUND);
    }
    $candidate_items_version = $message_logic->getFolderList($login);
    require_once('cbpapi/util.csp');
    $item_name = 'folder_item';
    $items_version = grn_cbpapi_parse_item_versions($node_parameters,
        $item_name);

    $folder_for_view = grn_cbpapi_compare_item_versions($items_version,
        $candidate_items_version);
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;
    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('message')]);
    $t->assign('folders', $folder_for_view);
    $t->assign('action', $action);
    grn_cbpapi_response($t, __FILE__);
}
