<?php
if (isset($cbpapi_service)) {
    $request = $cbpapi_service->getRequestParameters();

    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    $login_id = $login->getOID();

    require_once('workflow/config.csp');
    $config = GRN_Workflow_Configs::getInstance();
    $personal_config = $config->getPersonalConfig($login_id);

    $delegators = $personal_config->getUsersFromAgent($login_id,
        GRN_WORKFLOW_AGENT_TYPE_APPROVAL);
    if (is_array($delegators) && count($delegators) > 0) {
        foreach (array_keys($delegators) as $delegator_key) {
            $delegator = $delegators[$delegator_key];
            $delegator_id = $delegator['user'];
            if ( ! ($uum->isActiveUser($delegator_id))) {
                unset($delegators[$delegator_key]);
            }
        }
    }
    // SOAP response
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty();

    $t->assign('xml_namespaces', [grn_cbpapi_get_namespace('workflow')]);
    $t->assign('action', $cbpapi_service->getAction());
    $t->assign('delegators', $delegators);

    grn_cbpapi_response($t, __FILE__);
}
