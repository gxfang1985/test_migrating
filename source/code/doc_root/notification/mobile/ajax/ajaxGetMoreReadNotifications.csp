<?php

use grn\notification\screen\mobile\HistoryList;
use grn\grn\JSONResponse;

global $G_INPUT, $G_state_set;
$screen = new HistoryList($G_INPUT);
$G_state_set->set('error_page_type', 'json');

$more_list = $screen->ajaxFetch();
$data_list = $screen->getDataList();
if (count($data_list) > 0) {
    if ($screen->getModuleId()) {
        $module_id = $screen->getModuleId();
    } else {
        $module_id = 0;
    }
    $has_more = $data_list[$module_id]['more'];
    $sp = $data_list[$module_id]['sp'];
    $last_data_id = $data_list[$module_id]['lastDataId'];
    $count_number = count($data_list[$module_id]['list']);
} else {
    $has_more = false;
    $sp = 0;
    $count_number = 0;
    $last_data_id = 0;
}

$json = JSONResponse::create();
$json->response(
    [
        'moreList'    => $more_list,
        'hasMore'     => $has_more,
        'sp'          => $sp,
        'lastDataId'  => $last_data_id,
        'countNumber' => $count_number
    ]
);
