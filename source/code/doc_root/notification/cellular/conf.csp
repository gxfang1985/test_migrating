<?php

global $G_INPUT;

require_once('cellular/smarty.csp');
$smarty = new GRN_Cellular_Smarty();

require_once('fw/profile.csp');
$profile =& cb_get_user_profile($G_cellular_login, 'grn.notification.cellular');

require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();

$ids = $G_cellular->getAvailableApplicationIds();

$config = $G_cellular->getUserConfig($G_cellular_login);

$conf = [];

foreach ($ids as $app_id) {
    if ($app_id == 'notification') {
        continue;
    }

    $instance =& $locator->getInstance($app_id);

    if ( ! method_exists($instance, 'getNotificationIndexPageInfo_cellular')) {
        continue;
    }

    $comp = $G_cellular->getComponent($app_id);

    if ( ! $comp) {
        continue;
    }

    $hide = false;

    $profile->getAttribute('hide_' . $app_id, $hide);

    $conf[$app_id] = [
        'enable' => ($hide ? 0 : 1),
        'icon'   => $comp->getContent('icon', $config)
    ];
}

$smarty->assign('conf', $conf);

$smarty->display(cb_get_pagename() . '.tpl');


