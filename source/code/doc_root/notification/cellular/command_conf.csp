<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    require_once('fw/profile.csp');
    $profile =& cb_get_user_profile($G_cellular_login,
        'grn.notification.cellular');

    require_once('grn/application.csp');
    $locator = GRN_ApplicationLocator::instance();

    $ids = $G_cellular->getAvailableApplicationIds();

    foreach ($ids as $app_id) {
        if ($app_id == 'notification') {
            continue;
        }

        $instance =& $locator->getInstance($app_id);

        if ( ! method_exists($instance,
            'getNotificationIndexPageInfo_cellular')
        ) {
            continue;
        }

        $hide = 0;

        if (@ $G_INPUT['aid']) {
            $res = array_search($app_id, $G_INPUT['aid']);

            if (is_null($res) || $res === false) {
                $hide = 1;
            }
        } else {
            $hide = 1;
        }

        if ( ! $profile->updateAttribute('hide_' . $app_id, $hide)) {
            $profile->createAttribute('hide_' . $app_id, $hide);
        }
    }
    grn_cellular_redirect('cellular/conf/menu');
}


