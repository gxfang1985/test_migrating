<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // GET/POSTされたパラメータを取得する
    $eid = null;
    if (array_key_exists('eid', $G_INPUT)) {
        $eid = $G_INPUT['eid'];
    }

    // 通知一覧を取得する
    require_once('notification/application.csp');
    $app_locator = GRN_ApplicationLocator::instance();
    /** @var GRN_Notification_App $app */
    $app =& $app_locator->getInstance(GRN_NOTIFICATION_APP_ID);
    if ( ! is_object($app) || ! is_a($app, 'GRN_Notification_App')) {
        cb_throw_error(E_GRN_NTFC_NOT_AVAILABLE);
    }

    // 外部通知を一括削除する
    $app_manager =& $app->getOutsideApplicationManager();
    $app_manager->deleteList($eid);

    // 監査する
    require_once('notification/inspection.csp');
    $inspection = GRN_Notification_Inspection::getInstance();
    if ($inspection->isEnabled()) {
        $action = GRN_NOTIFICATION_INSPECTION_SYSTEM_CONFIG;
        $target = GRN_NOTIFICATION_INSPECTION_NOTIFYINFO_DELETE;
        foreach ($eid as $selected_id) {
            $params = ['aid' => $selected_id];
            $inspection->record($action, $target, $params);
        }
    }

    cb_redirect('notification/system/notifyinfo_list');
}


