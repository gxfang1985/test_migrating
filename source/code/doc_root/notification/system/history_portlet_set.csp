<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

require('SmartyValidate.class.php');
SmartyValidate::connect($t);

//--------------------------------------------------------------

require_once('notification/application.csp');
$app_locator = GRN_ApplicationLocator::instance();
$available_only = false;
/** @var GRN_Notification_App $notification_app */
$notification_app =& $app_locator->getInstance(GRN_NOTIFICATION_APP_ID);
if (is_null($notification_app)) {
    cb_throw_error(E_GRN_NTFC_NOT_AVAILABLE);
}

$system_config =& $notification_app->getSystemConfig();

//--------------------------------------------------------------

// 表示しない項目の一覧を取得する
$not_display_items = [];
$system_config->getHistoryPortletNotDisplayItems($not_display_items);

require_once('notification/view_util.csp');
$utility = GRN_Notification_ViewUtil::getInstance();
$captions = $utility->getHistoryItemCaptions();
$display_items = [];

foreach ($captions as $key => $caption) {
    $checked = 0;
    if (false === array_search($key, $not_display_items)) {
        $checked = 1;
    }

    $display_items[$key] = [
        'caption' => $caption,
        'checked' => $checked
    ];
}

//--------------------------------------------------------------

// 表示の初期設定値を取得する

$setting = null;
$system_config->getHistoryPortletDisplaySetting($setting);

//--------------------------------------------------------------

// SmartyにアプリIDを割り当てる
$t->assign('app_id', 'notification');

// Smartyにページタイトルを割り当てる
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// Smartyにサイトポジションを割り当てる
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

$t->assign('display_items', $display_items);
$t->assign('setting', $setting);

// Smartyに表示件数の初期選択値メニューを割り当てる
$t->assign('select1', [
    'name'     => 'keep_day_notice',
    'options'  => [0, 5, 10, 15, 20,],
    'padding'  => '&nbsp;',
    'selected' => 5,
]);

// Smartyを実行する
$t->display(cb_get_pagename() . '.tpl');


