<?php

$app_locator = GRN_ApplicationLocator::instance();
if ( ! $app_locator->isActive('portal')) {
    assert('FALSE');
}
/** @var GRN_Portal_Application $app */
$app =& $app_locator->getInstance('portal');

$portal_page = $app->getConfig('index');
if (0 == strlen($portal_page)) {
    $portal_page = 'index';
}

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // ログインユーザーを取得する
    global $G_container_base;
    $uum =& $G_container_base->getInstance('uum');
    $login =& $uum->getLoginUser();

    // write info
    $status = array_key_exists('status', $G_INPUT) ? $G_INPUT['status'] : '';
    $memo = array_key_exists('memo', $G_INPUT) ? $G_INPUT['memo'] : '';
    require_once('presence/logic.csp');
    $presence_logic = GRN_Presence_Logic::getInstance();
    $presence_logic->setPresenceWithCheck($login->getOID(), $status, $memo);
}

cb_redirect($portal_page);


