<?php

// Smarty をインスタンス化
require_once('cellular/smarty.csp');
$smarty = new GRN_Cellular_Smarty;

require_once('SmartyValidate.class.php');
SmartyValidate::connect($smarty);
$form_name = 'presence/cellular/attendee';
SmartyValidate::register_form($form_name);

$smarty->assign('form_name', $form_name);
// ページタイトル
$smarty->assign('pagetitle', grn_get_current_page_display_name());
// パス情報
$smarty->assign('pagepath', $G_pagepath);

//--------------------------------------------------------------

if (SmartyValidate::is_valid($G_INPUT, $form_name)) {
    global $G_container_base;
    $uum =& $G_container_base->getInstance('uum');

    // ログインユーザーを取得する
    $login =& $uum->getLoginUser();

    // 在席情報を設定する
    if (array_key_exists('sel', $G_INPUT)) {
        $select_set =& $G_INPUT['sel'];
        $memo = '';
        if (array_key_exists('str', $G_INPUT)) {
            $memo = $G_INPUT['str'];
        }
        require_once('presence/logic.csp');
        $presence_logic = GRN_Presence_Logic::getInstance();
        $presence_logic->setPresenceWithCheck($login->getOID(), $select_set,
            $memo);
    }

    SmartyValidate::unregister_form($form_name);
    grn_cellular_redirect($G_pagepath . '/attendee');
} else {
    // error. switch form page
    grn_cellular_switch_page($G_pagepath . '/attendee');
}


