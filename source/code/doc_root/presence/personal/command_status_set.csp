<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // GET/POSTされたフォームデータを取得する
    $items = null;
    if (array_key_exists('items', $G_INPUT)) {
        $items = $G_INPUT['items'];
    }

    // ログインユーザーを取得する
    global $G_container_base;
    $uum =& $G_container_base->getInstance('uum');
    $login =& $uum->getLoginUser();

    // アドレス帳の設定を取得する
    require_once('presence/config.csp');
    $config_manager = GRN_Presence_ConfigManager::getInstance();
    $config =& $config_manager->getPersonalConfig($login);

    // 在席情報の項目を設定する
    $items = $config->setStatuses($items);

    // write log
    require_once('presence/logic.csp');
    $presence_logic = GRN_Presence_logic::getInstance();
    $params = ['value' => mb_ereg_replace("\r\n", ' ', $items)];
    $presence_logic->writeLog('config', 'personal_presence', $params);

}

cb_redirect('personal/application_list', ['app_id' => 'presence']);


