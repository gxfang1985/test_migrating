<?php
if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // check exist of user
    $uid = array_key_exists('uid', $G_INPUT) ? $G_INPUT['uid'] : '';

    // check access modify authority
    require_once('presence/logic.csp');
    $presence_logic = GRN_Presence_Logic::getInstance();
    $presence_logic->checkAccessModify($uid);

    // write info
    $status = array_key_exists('status', $G_INPUT) ? $G_INPUT['status'] : '';
    $memo = array_key_exists('memo', $G_INPUT) ? $G_INPUT['memo'] : '';
    $presence_logic->setPresenceWithCheck($uid, $status, $memo);

    $previous_page_info = $presence_logic->getPreviousPage();
    $previous_page = $previous_page_info['page'];
    unset($previous_page_info['page']);
    unset($previous_page_info['name']);
    cb_redirect($previous_page, $previous_page_info);
}
