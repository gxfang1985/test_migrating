<?php
if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    require_once('_access_util.csp');

    // GET/POSTされたパラメータを取得する
    if (0 == strlen($node_id)) {
        cb_throw_error(E_GRN_ADDRESS_INVALID_BOOK_ID);
    }

    // セキュリティモデルを取得する
    $row =& $node_row->getRow();
    require_once('address/access.csp');
    $access_manager = GRN_Address_AccessManager::getInstance();
    $security_model = $access_manager->getSecurityModel($row);

    // セキュリティモデルを反転させる
    if (GRN_ADDRESS_SECURITYMODEL_REVOKE == $security_model) {
        $security_model = GRN_ADDRESS_SECURITYMODEL_GRANT;
    } else {
        $security_model = GRN_ADDRESS_SECURITYMODEL_REVOKE;
    }
    $authorities = ['browse' => 0, 'editing' => 0, 'operation' => 1];
    $access_manager->setSecurityModel($row, $security_model, $authorities);

    cb_redirect('address/system/access_list',
        ['poid' => $poid, 'nid' => $node_id, 'reset' => 1]);
}

