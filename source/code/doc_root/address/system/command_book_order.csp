<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // GET/POSTされたパラメータを取得する
    $bid = null;
    if (array_key_exists('bid', $G_INPUT)) {
        $bid = $G_INPUT['bid'];
    }
    if (is_array($bid) && 0 < count($bid)) {
        // アドレス帳を取得する
        require_once('address/application.csp');
        $app_locator = GRN_ApplicationLocator::instance();
        /** @var GRN_Address_Application $app */
        $app =& $app_locator->getInstance(GRN_ADDRESS_APPLICATION_ID);
        if ( ! is_object($app) || ! is_a($app, 'GRN_Address_Application')) {
            cb_throw_error(E_GRN_APPLICATION_NOT_AVAILABLE);
        }
        $book_manager =& $app->getBookManager();

        // 共有アドレスブック一覧を取得する
        $books =& $book_manager->listSharedAddressBooks();

        // 共有アドレスブックの表示順番を変更する
        foreach ($bid as $list_index => $book_id) {
            $books[$book_id]->setProperty('list_index', $list_index);
        }
    }
    cb_redirect('address/system/book_list');
}


