<?php

require_once('cellular/utils.csp');
require_once('grn/application.csp');
// Smarty をインスタンス化
require_once('cellular/smarty.csp');
$smarty = new GRN_Cellular_Smarty;
// 
$smarty->assign('pagetitle', grn_get_current_page_display_name());
$smarty->assign('pagepath', $G_pagepath);
$smarty->assign('pagename', cb_get_pagename());

require_once('grn/uum_util.csp');
$uum_util = GRN_UumUtil::getInstance();

if (array_key_exists('uid', $G_INPUT) && 0 != @intval($G_INPUT['uid'])
    && ($user_obj
        = &$G_uum->getUser($G_INPUT['uid'])) !== false
) {
    // ユーザが見付かった
} else {
    cb_throw_error(); // uid がない。or 不正
}

// 「戻る」リンクで使うパラメータ
$back_link = $G_cellular_session->get('back-from-address-view');
$smarty->assign('back_link', $back_link);


// 表示する組み込み項目を設定する
$default_information = [];
$default_item_names = [];
foreach (getDisplayDefaultItemIdsList() as $item_id) {
    $default_information[$item_id] = formatDefaultItem($item_id, $user_obj);
    $default_item_names[$item_id]
        = mb_convert_kana($G_uum->getRealDefaultItemName($item_id),
        'k');
}
$smarty->assign('default_information', $default_information);
$smarty->assign('default_item_names', $default_item_names);

// 表示するカスタマイズ項目を設定する
$extension_information = [];
$extension_item_names = [];
foreach (getDisplayExtensionItemList($user_obj) as $item_id => $item_value) {
    $extension_information[$item_id] = $item_value;
    $extension_information[$item_id]['value']
        = mb_convert_kana($extension_information[$item_id]['value'],
        'k');
    $extension_item_names[$item_id]
        = mb_convert_kana($item_value['display_name'],
        'k');
}
$smarty->assign('extension_information', $extension_information);
$smarty->assign('extension_item_names', $extension_item_names);

$smarty->assign('sf', @$G_INPUT['sf']);
$smarty->assign('submit_user', @$G_INPUT['submit_user']);

$smarty->display(cb_get_pagename() . '.tpl');
