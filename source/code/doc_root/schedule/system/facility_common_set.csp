<?php

// instantiate an Smarty object
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

require_once('schedule/facility_system_logic.csp');
$system_logic = GRN_Facility_SystemLogic::getInstance();

$advance = $system_logic->getFacilityAdvance();
$max_time = $system_logic->getFacilityMaxTime();
$modify_user = $system_logic->getFacilityModifyUser();
$show_memo = $system_logic->getFacilityShowMemo();
$regularly = $system_logic->getFacilityRepeat();
$approval = $system_logic->getFacilityApproval();

$hour = intval($max_time / 60);
$minute = $max_time % 60;
$t->assign('hour', $hour);
$t->assign('minute', $minute);

$t->assign('advance_select', $advance > 0 ? true : false);
$t->assign('advance', $advance);
$t->assign('max_time', $max_time);
$t->assign('modify_user', $modify_user);
$t->assign('show_memo', $show_memo);
$t->assign('regularly', $regularly);
$t->assign('approval', $approval);

// force to register
require_once('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form('schedule/system/facility_common_set', true);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
require_once('grn/controller.csp');
$controller_util = new GRN_ControllerUtil();
$page_info = [
    'facility_select_set' => [],
    'facility_common_set' => null
];
$site_position = $controller_util->makeSitePosition('schedule/system/',
    $page_info);
$t->assign('site_position', $site_position);

// Smarty実行
$t->display(cb_get_pagename() . '.tpl');
