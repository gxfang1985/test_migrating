<?php

use grn\kintone\AppRelationSettingLogic;

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    $items = $G_INPUT['order'];

    $relationSettingLogic = new AppRelationSettingLogic();
    $settings
        = $relationSettingLogic->getAllRelationSettings('schedule/add');

    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    if ( ! is_object($login) || ! is_a($login, 'CB_User')) {
        cb_throw_error(E_GRN_USER_NOT_FOUND);
    }

    if (is_array($settings) && is_array($items)) {
        foreach ($items as $key => $value) {
            if (array_key_exists($value, $settings)) {
                $relationSettingLogic->updateRelationSettingOrder($value, $key);
            }
        }
    }

    cb_redirect('schedule/system/kintone_relation');
}
