<?php

$fid = cb_at($G_INPUT, 'fid');
$fagid = cb_at($G_INPUT, 'oid');

if (strlen($fid) == 0) {
    cb_throw_error(E_GRN_FCLT_NOTFOUND_FACILITY);
}

if (strlen($fagid) == 0) {
    $fagid = null;
}

require_once('schedule/facility_system_logic.csp');
$fsl = GRN_Facility_SystemLogic::getInstance();

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

/**
 * @var GRN_Facility_Facility      $facility
 * @var GRN_Facility_FacilityGroup $fgroup
 */
$facility = $fsl->getFacility($fid);
if ($facility === false) {
    cb_throw_error(E_GRN_FCLT_NOTFOUND_FACILITY);
}

if ( ! is_null($fagid)) {
    $fgroup = $fsl->getFacilityGroup($fagid);
    if ($fgroup === false) {
        cb_throw_error(E_GRN_FCLT_NOTFOUND_FACILITYGROUP);
    }
} else {
    $fgroup = null;
}

$fsl->moveFacility($login, $facility->getOID(), $fagid);

cb_redirect('schedule/system/facility_view', ['faid' => $fid]);
