<?php
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    /*
        // instantiate an Smarty object
        require_once( "grn/smarty.csp" );
        $t = new GRN_Smarty;

        // Validation check
        require_once('SmartyValidate.class.php');
        SmartyValidate::connect($t);

        // validate after a POST
        if(SmartyValidate::is_valid($G_INPUT)) {
            // the validation session is finished
            SmartyValidate::disconnect();
    */
    // --------
    // brabrabra after success
    // --------

    require_once('schedule/system_logic.csp');
    $logic = GRN_Schedule_SystemLogic::getInstance();

    $str_date = @ $G_INPUT['date'];

    $date = new CB_Date();
    if ( ! $date->parse($str_date)) {
        cb_throw_error(E_GRN_SCHD_INVALID_SETDATE);
    }

    require_once('schedule/utility.csp');
    if (grn_schedule_date_isvalid($date) == false) {
        cb_throw_error(E_GRN_SCHD_INVALID_SETDATE);
    }

    // より前なので1日前にする
    $dateex = new CB_DateEx($date);
    $dateex->moveDays(-1);

    $logic->deleteEvents($dateex);

    // 監査ログ
    require_once('grn/logger.csp');
    $lm = CB_LoggerManager::getInstance();
    $l = $lm->getLogger(GRN_SCHEDULE_MODULE_ID);
    $log_params
        = [
        'delete_date' => html_entity_decode(cb_date_format('DateFull_YMDW',
            $dateex))
    ];
    $l->noticeEx('delete_all', 'system_event', $log_params);

    cb_redirect('schedule/system/delete_all3');
    /*
        } else {
            // if error, show the source form

            //Assign Template Name
            $t->setPageInfo($target_name);

            cb_redirect( 'schedule/system/delete_all' );
        }

    */
}
