<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    // GET/POSTされたパラメータを取得する
    $eiid = null;
    if (array_key_exists('eiid', $G_INPUT)) {
        $eiid = $G_INPUT['eiid'];
    }
    if (0 == strlen($eiid)) {
        cb_throw_error(E_GRN_FCLT_INVALID_EXTENDED_ITEM_ID);
    }

    // ログインユーザーを取得する
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    if ( ! is_object($login) || ! is_a($login, 'CB_User')) {
        cb_throw_error(E_GRN_USER_NOT_FOUND);
    }
    $login_id = $login->getOID();

    require_once('schedule/facility_system_logic.csp');
    $system_logic = GRN_Facility_SystemLogic::getInstance();

    // 拡張項目を削除する
    if ( ! $system_logic->removeItem($eiid)) {
        cb_throw_error(E_GRN_FCLT_EXTENDED_ITEM_NOT_FOUND);
    }

    cb_redirect('schedule/system/item_list');
}


