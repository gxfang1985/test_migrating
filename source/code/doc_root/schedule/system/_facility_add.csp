<?php

require_once('schedule/facility_system_logic.csp');
$fsl = GRN_Facility_SystemLogic::getInstance();

$facility_group = [];

$fagid = @$G_INPUT['fagid'];

if ( ! $fagid || $fagid === '0' || $fagid === '-1'
     || $fagid === '-2'
) // 0: （トップ）から -1: （施設グループに未所属の施設）から -2: （全施設）から
{
    $facility_group = null;
} else {
    $is_facility_group = $fsl->getFacilityGroup($fagid);
    if ($is_facility_group === false) {
        cb_throw_error(E_GRN_FCLT_NOTFOUND_FACILITYGROUP);
    } else {
        $fagid = $is_facility_group->getOID();
    }
    $tmp_ancestors = $fsl->getAncestors([$fagid => $fagid]);
    $ancestors = [];
    foreach ($tmp_ancestors[$fagid] as $id) {
        $ancestors[$id] = $id;
    }
    $tmp_facility_group = $fsl->getFacilityGroupsInfo($ancestors);
    foreach (array_reverse($tmp_ancestors[$fagid]) as $id) {
        $facility_group[] = $tmp_facility_group[$id];
    }
}

$t->assign('facility_group', $facility_group);

//--- add VCBSCH0010 ---s
$netmeeting_data = [];

// システムのV-CUBEを使用可否を取得
require_once('schedule/netmeeting_system_logic.csp');
$netmeeting_system_logic = GRN_Netmeeting_SystemLogic::getInstance();
$netmeeting_system_available
    = $netmeeting_system_logic->getNetmeetingAvailable();
if ( ! $netmeeting_system_available) {
    $available = '0';
}
$netmeeting_data['system_available'] = $netmeeting_system_available;

// V-CUBEの使用情報セット
$t->assign('netmeeting', $netmeeting_data);
//--- add VCBSCH0010 ---e

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('fagid', $fagid);
$t->assign('facility_group', $facility_group);

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'schedule/system/facility_group',
            'name' => grn_get_page_display_name('schedule/system/facility_group'),
            'sf'   => '1'
        ],
        ['page' => '', 'name' => $page_title]
    ]
);

// multilanguage Infomation
require_once('schedule/resources.csp');
$multiLanguageInfoArray = [];
$multiLanguageInfoArray['element_name'] = GRN_SCHEDULE_ELEMENT_NAME_FACILITY;
$multiLanguageInfoArray['values'] = null;
$t->assign('multiLanguageInfoArray', $multiLanguageInfoArray);


