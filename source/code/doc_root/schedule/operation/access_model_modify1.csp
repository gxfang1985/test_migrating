<?php

// Smarty をインスタンス化
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

require_once('_access_util.csp');

// access object
$object = grn_get_schedule_access_object($target, $org_id, $user_id, $role_id,
    $facility_id, $fgroup_id);

// access information
require_once('schedule/access_logic.csp');
$sal = GRN_Schedule_Access_Logic::getInstance();
$access = [];
$access['security_model'] = $sal->getSecurityModel($object);

$t->assign('access', $access);
$t->assign('is_grant', $access['security_model'] == 'grant');
$t->assign('is_revoke', $access['security_model'] == 'revoke');

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);


$view_position = [
    'page'  => 'schedule/operation/facility_view',
    'name'  => grn_get_page_display_name('schedule/operation/facility_view'),
    'fagid' => $fgroup_id,
    'faid'  => $facility_id
];

if ($target === 'facilitygroup') {
    $view_position = [
        'page'  => 'schedule/operation/facility_group_view',
        'name'  => grn_get_page_display_name('schedule/operation/facility_group_view'),
        'fagid' => $fgroup_id,
        'faid'  => $facility_id
    ];
}

// site position 
$site_position = [
    [
        'page' => 'schedule/index',
        'name' => grn_get_page_display_name('schedule/schedule_index')
    ],
    [
        'page' => 'schedule/operation/facility_list',
        'name' => grn_get_page_display_name('schedule/operation/facility_list'),
        'oid'  => $fgroup_id,
        'sf'   => 1
    ],
    $view_position,
    [
        'page'  => 'schedule/operation/access_list',
        'name'  => grn_get_page_display_name('schedule/operation/access_list'),
        'tid'   => $target,
        'oid'   => $org_id,
        'fagid' => $fgroup_id,
        'uid'   => $user_id,
        'rid'   => $role_id,
        'faid'  => $facility_id,
        'poid'  => $poid
    ],
    ['page' => '', 'name' => $page_title],
];
$t->assign('site_position', $site_position);

// Smarty実行
$t->display(cb_get_pagename() . '.tpl');

