<?php

$app_locator = GRN_ApplicationLocator::instance();
if ( ! $app_locator->isActive('portal')) {
    assert('FALSE');
}
/** @var GRN_Portal_Application $app */
$app = $app_locator->getInstance('portal');

$portal_page = $app->getConfig('index');
if (0 == strlen($portal_page)) {
    $portal_page = 'index';
}

$str_date = array_key_exists('bdate', $G_INPUT) ? $G_INPUT['bdate'] : null;

$date = new CB_Date();
if ( ! $date->parse($str_date)) {
    $str_date = null;
}

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

require_once('schedule/personal_logic.csp');
$personallogic = GRN_Schedule_PersonalLogic::getInstance();

$ne = array_key_exists('ne', $G_INPUT) ? $G_INPUT['ne'] : 'on';

$personallogic->setNextEvents($login, $ne);

cb_redirect($portal_page, ['pid' => $G_INPUT['pid'], 'bdate' => $str_date]);


