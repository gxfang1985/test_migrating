<?php

require_once('portal/error_code.csp');
if ( ! isset($portlet)) {
    cb_throw_error(E_GRN_PRTL_PORTLET_INVALID_ACCESS);
}

//Get Smarty Instance
require_once('grn/smarty.csp');
$t = new GRN_Smarty;
/*
//Initialize SmartyValidate and Register Form
require_once('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form( 'set_history' );
*/
//Get Portlet Settings
$portlet_setting = null;
if ( ! is_null($portlet['settings'])) {
    $portlet_settings =& $portlet['settings'];
}

include('_member_select.csp');

if ($display == 'set-personal') {
    $page_name = "schedule/portlet/set_personal_week/personal";
    $t->assign('page_name', 'schedule/portlet/set_personal_week/personal');
    $t->assign('form_name', 'schedule/portlet/set_personal_week/personal');
} elseif ($display == 'set-operation') {
    $page_name = "schedule/portlet/set_personal_week/operation";
    $t->assign('page_name', 'schedule/portlet/set_personal_week/operation');
    $t->assign('form_name', 'schedule/portlet/set_personal_week/operation');
} else {
    $page_name = "schedule/portlet/set_personal_week/system";
    $t->assign('page_name', 'schedule/portlet/set_personal_week/system');
    $t->assign('form_name', 'schedule/portlet/set_personal_week/system');
}


// Assign Portlet Settings Infomation
$t->assign('settings', $portlet_settings);

//Assign include_php Parameter
$t->assign('portlet', $portlet);
$t->assign('display', $display);

// Assign Font Options
$t->assign('font_options', $font_options);

//-- set page title and site position

// Ignore Licence Warnning
$t->skipWarning();

$doc_name = 'schedule/portlet/set_personal_week';

/////////////////////////////////////////////////
// For tree
require_once('schedule/portlet_view_util.csp');
$tree_data
    = GRN_Schedule_Portlet_Dropdown_Util::makeFacilityGroupsTreeMenu($page_name,
    'f', true);

$t->assign('fgroup_list', $tree_data['org']);
$t->assign('fgroup_selected_id', $tree_data['selected_id']);
$t->assign('ftree_name', $page_name);
$t->assign('ftree_async_page', "schedule/json/accessible_facility_tree");

//Display Smarty Template
$t->display("{$doc_name}.tpl");


