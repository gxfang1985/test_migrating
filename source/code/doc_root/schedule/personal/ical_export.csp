<?php

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;
// for site position
$t->assign('app_id', 'schedule');

//------------------
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

require_once("schedule/personal_logic.csp");
$logic = GRN_Schedule_PersonalLogic::getInstance();

$sethour = 8;
$endhour = 19;
$logic->getViewHour($login, $sethour, $endhour);

require_once('fw/date.csp');
$ts = new CB_TimeStamp();
$ts->unix_ts = time();
$tsex = new CB_TimeStampEx($ts);
$startdate = $tsex->getDate();
$startdate->day = 1;

$enddate = new CB_DateEx($startdate);
$enddate->day = $enddate->getEndOfMonthDay();

$t->assign('stime', $startdate);
$t->assign('etime', $enddate);
// page title
$page_title = grn_get_page_display_name('schedule/personal/ical_export');
$t->assign('page_title', $page_title);
// site position 
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");

