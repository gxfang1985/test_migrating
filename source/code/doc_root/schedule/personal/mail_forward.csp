<?php

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;
// for site position
$t->assign('app_id', 'schedule');

//------------------
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();

require_once("schedule/personal_logic.csp");
$logic = GRN_Schedule_PersonalLogic::getInstance();

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
// site position 
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

// システムメールアカウントが利用できるか
require_once('grn/system_mail.csp');
$system_mail = GRN_SystemMailConfigManager::getInstance();

$mail_set = ['system' => $system_mail->isAvailable()];

require_once('schedule/personal_logic.csp');
$personal_logic = GRN_Schedule_PersonalLogic::getInstance();

$mail_set['used'] = $personal_logic->getForwardMail($login);

require_once('schedule/facility_privilege.csp');
$privilege_logic = GRN_Facility_Privilege_Logic::getInstance();
$mail_set['manage'] = $privilege_logic->hasPrivilege($login);
if ($mail_set['manage']) {
    $mail_set['facility_rely_mail']
        = $personal_logic->getForwardFacilityRelyMail($login);
}

$mail_set['mail'] = [
    'address' => $login->get('email_address'),
    'other'   => $personal_logic->getForwardMailAddress($login),
    'value'   => $personal_logic->getForwardMailType($login),
];

$t->assign('set', $mail_set);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");

