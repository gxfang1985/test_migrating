<?php
/**
 * 個人設定 V-CUBEシステム用メールアドレス設定
 *
 * @create:
 *    2011/06/08 VCBSCH0010 Sync for V-CUBE
 */

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    // -------- 
    // brabrabra after success
    // --------
    require_once('fw/string_util.csp');
    require_once('schedule/netmeeting_personal_logic.csp');
    $logic = GRN_Netmeeting_PersonalLogic::getInstance();

    // ログインユーザーの取得
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();

    $forward_type = @ $G_INPUT['mail'];
    if ( ! $forward_type) {
        $forward_type = GRN_NETMEETING_FORWARD_TYPE_MAIL;
    } else {
        $forward_type = GRN_NETMEETING_FORWARD_TYPE_OTHER;
    }
    $logic->setForwardMailType($login, $forward_type);

    $forward_address = @ $G_INPUT['other_mail'];
    if ( ! $forward_address) {
        $forward_address = '';
    }
    $forward_address = cb_trim($forward_address);


    $logic->setForwardMailAddress($login, $forward_address);

    $log_params = [];
    $notic_string = '';
    //$notic_string .= 'ON:';
    if ($forward_type) {
        $log_params['email'] = $forward_address;
    } else {
        $log_params['email'] = $login->get('email_address');
    }
    // 監査ログ
    require_once('grn/logger.csp');
    $lm = CB_LoggerManager::getInstance();
    $l = $lm->getLogger(GRN_SCHEDULE_MODULE_ID);
    $l->noticeEx('config', 'netmeeting_forward_mail', $log_params);

}

cb_redirect('personal/application_list', ['app_id' => 'schedule']);

