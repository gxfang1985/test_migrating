<?php

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

// SmartyValidate should be initialized when an input form is there.
require('SmartyValidate.class.php');
SmartyValidate::connect($t);

$session_name = 'grn.schedule.statistics';
$ous_params = [];
$can_select_facility = false;
$search_login_name = false;
$is_admin = false;
require_once('schedule/org_user_facility_select.csp');

if (count($selected_list) == 0) {
    require_once('schedule/error_code.csp');
    cb_throw_error(E_GRN_SCHD_NOT_SELECT_STATISTICS_USER);
}
require_once('fw/date.csp');

$ts = new CB_TimeStamp();
$ts->unix_ts = time();
$tsex = new CB_TimeStampEx($ts);
$startdate = $tsex->getDate();
$startdate->day = 1;

$enddate = new CB_DateEx($startdate);
$enddate->day = $enddate->getEndOfMonthDay();

$t->assign('stime', $startdate);
$t->assign('etime', $enddate);

global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$login = $uum->getLoginUser();
$_lid = $login->getOID();

require_once('schedule/personal_logic.csp');
$personallogic = GRN_Schedule_PersonalLogic::getInstance();
require_once('schedule/system_logic.csp');
$systemlogic = GRN_Schedule_SystemLogic::getInstance();
$unit = $systemlogic->getScheduleUnit();
$showholiday = $systemlogic->getShowHoliday();

$set_hour = 8;
$end_hour = 19;
$personallogic->getViewHour($login, $set_hour, $end_hour);

$stime = new CB_Time();
$stime->hour = intval($set_hour);

$etime = new CB_Time();
$etime->hour = intval($end_hour);

// set data
$t->assign(
    'set', [
        'shour'       => $stime, //start_time
        'ehour'       => $etime, //end_time
        'unit'        => $unit, //分単位
        'showholiday' => $showholiday,
    ]
);

//------------------

// page title
$page_title = grn_get_page_display_name('schedule/personal/statistics1');
$t->assign('page_title', $page_title);
// site position 
$t->assign(
    'site_position', [
        ['page' => "", 'name' => $page_title]
    ]
);

// Smarty実行
$t->display(cb_get_pagename() . ".tpl");

