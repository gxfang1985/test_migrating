<?php

use grn\grn\MemberLogic;
use grn\grn\MemberSelectAdd;
use grn\grn\MemberSelectCondition;
use grn\schedule\ScheduleMemberLogic;

include("_default_public_prepend.csp");

$session_name = cb_get_pagename();
$memberSelectCondition = new MemberSelectCondition();
$memberSelectCondition->setAppId("schedule");
$memberSelectCondition->setSessionName($session_name);
$is_allowed_role = MemberLogic::getInstance()->isAllowedRole();
$memberSelectCondition->setCanSelectRole($is_allowed_role);
$memberSelectCondition->setSystem(false);

require_once('schedule/system_logic.csp');
$memberSelectCondition->setShowGroupRole(ScheduleMemberLogic::getInstance()
                                                            ->isAllowSettingGroupRoleToWatchers());

$access_plugin = [
    "name"   => "schedule",
    "params" => [
        "action"       => ["read"],
        "session_name" => $session_name
    ]
];
$memberSelectCondition->setAccessPlugin($access_plugin);

$memberSelectAdd = new MemberSelectAdd($memberSelectCondition, $G_INPUT);
$memberSelectAdd->assignMemberSelectAdd($smarty);

// tree link page
$smarty->assign("link_page", cb_get_pagename());

// site position
$site_position = [];
$site_position[] = [
    "page" => "schedule/personal/default_public_list"
    ,
    "name" => grn_get_page_display_name("schedule/personal/default_public_list")
];
$site_position[] = [
    "page" => ""
    ,
    "name" => $page_title
];
$smarty->assign("site_position", $site_position);

// display smarty
$smarty->display(cb_get_pagename() . ".tpl");
