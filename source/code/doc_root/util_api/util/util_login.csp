<?php

cb_require_role('LoginUser');

if (isset($util_api_service)) {
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login = $uum->getLoginUser();
    $userId = $login->getOID();
    $user_info = $uum->getUserInfo($userId, ['col_foreign_key']);

    // Delete dynamic roles that have been saved
    global $G_container_base;
    $grn_uum = $G_container_base->getInstance('uum');
    $session = $grn_uum->_sp->getSession();
    $dynamic_roles = $session->get(CB_UUMSPI_DYNAMIC_ROLES);

    //response SOAP message
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;

    $sess_name = session_name();
    $sessID = session_id();
    $sess_params = session_get_cookie_params();
    $sess_path = $sess_params['path'];
    $t->assign('sess_name', $sess_name);
    $t->assign('sessID', $sessID);
    $t->assign('sess_path', $sess_path);
    $t->assign('status', 'Login');
    $t->assign('login_name', $user_info['col_foreign_key']);

    $t->assign('xml_namespaces',
        "xmlns:admin=\"http://wsdl.cybozu.co.jp/admin/2008\"");
    grn_util_api_response($t, __FILE__);
}

