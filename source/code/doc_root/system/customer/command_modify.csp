<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    require_once('grn/error_code.csp');
    require_once('grn/smarty.csp');

    $t = new GRN_Smarty();
    $file = @$_FILES['logo_file'];
    require_once('grn/customer.csp');
    $customer = GRN_Customer::getInstance();

    if (strlen(@$G_INPUT['logo_path']) <= 0) {
        $G_INPUT['logo_path'] = null;
    }

    $customer->setProperties($G_INPUT);

    if ($file['error'] === UPLOAD_ERR_OK) {
        if (@getimagesize($file['tmp_name']) !== false) {
            $logo =& $customer->getLogoFile();
            if ($logo) {
                $logo->delete();
            }
            $customer->setLogoFile($file);
        }
    } else {
        if (isset($G_INPUT['delete_logo']) && $G_INPUT['delete_logo']) {
            $customer->removeLogoFile();
        }
    }

    cb_redirect('system/customer/index');
}


