<?php

require_once('grn/application.csp');
$app_locator = GRN_ApplicationLocator::instance();
$apps = $app_locator->getActiveApplicationIds();

require_once('grn/ui.csp');
$manager = GRN_UIConfigManager::getInstance();

require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();

$menu = [];
foreach ($apps as $app_id) {
    if ( ! $locator->isLicensed($app_id) || ! $locator->isActive($app_id)) {
        continue;
    }

    $function_name = $app_locator->getDefaultName($app_id);
    $app_name = $app_locator->getName($app_id);

    $menu[$app_id] = [
        'app_id' => $app_id,
        'name'   => $function_name,
        'items'  => []
    ];
    $link_menu = $manager->getLinkMenu($app_id);

    foreach ($link_menu as $item) {
        $page = $app_id . '/' . $item['location'];
        $menu[$app_id]['items'][] = [
            'value' => $page,
            'label' =>
                grn_get_page_display_name($page,
                    [
                        'app_name'         => $app_name,
                        'application_name' => $app_name
                    ])
        ];
    }

    if (count($menu[$app_id]['items']) <= 0) {
        unset($menu[$app_id]);
    }
}

$t->assign('menu', $menu);

if (array_key_exists('menu_type', $G_INPUT)) {
    $t->assign('menu_type', $G_INPUT['menu_type']);
} else {
    $t->assign('menu_type', 'app');
}

// multilanguage Infomation
require_once('system/resources.csp');
$multiLanguageInfoArrayWithLink = [];
$multiLanguageInfoArrayWithLink['element_name']
    = GRN_SYSTEM_ELEMENT_NAME_APPLICATION_MENU_LINK;
$multiLanguageInfoArrayWithLink['values'] = null;

$multiLanguageInfoArrayWithUrl = [];
$multiLanguageInfoArrayWithUrl['element_name']
    = GRN_SYSTEM_ELEMENT_NAME_APPLICATION_MENU_URL;
$multiLanguageInfoArrayWithUrl['values'] = null;

$t->assign('multiLanguageInfoArrayWithLink', $multiLanguageInfoArrayWithLink);
$t->assign('multiLanguageInfoArrayWithUrl', $multiLanguageInfoArrayWithUrl);


$page_title = grn_get_current_page_display_name();
$parent_page = 'system/ui/application_menu_list';
$parent_name = grn_get_page_display_name($parent_page);
$t->assign('page_title', $page_title);

$t->assign(
    'site_position',
    [
        ['page' => $parent_page, 'name' => $parent_name],
        ['page' => "", 'name' => $page_title],
    ]
);


