<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

global $G_container_base;
$uum =& $G_container_base->getInstance('uum');
$login =& $uum->getLoginUser();

require_once('grn/ui.csp');
$ucm = GRN_UIConfigManager::getInstance();
$uc =& $ucm->getUserConfig($login);
$limit = $uc->getListMax();

require_once('grn/controller.csp');
$utility = new GRN_ControllerUtil();
$offset = $utility->getNaviStartPosition();
$utility->setNaviStartPosition($offset);

$sort = 'ed';
if (@$G_INPUT['sf']) {
    $offset = $utility->getNaviStartPosition();
    $utility->setNaviStartPosition($offset);
    $sort = $utility->getSortParameter();
    if ( ! $sort) {
        $sort = 'ed';
    }
    $utility->setSortParameter($sort);
}

require_once('grn/mime.csp');
$mm = GRN_MIMEConfigManager::getInstance();
$order_condition = $mm->createSortCondition($sort);
$table =& $mm->getMIMETable();
$rowset = new CB_RowSet($table);
$rowset->addOrderColumn($order_condition);
$rowset->setCalcAllMatched(true);
$rowset->limit($offset, $limit);
$total_count = $rowset->countAllMatched();

$list = [];
while ($row = $rowset->iterate()) {
    $list[$row->getOID()] = [
        'extension' => $row->get('extension'),
        'mime'      => $row->get('mime')
    ];
}

$view_set = $utility->makeNaviInformation($offset, $limit, $total_count);

$not_exists = false;
if ($total_count <= 0) {
    $not_exists = true;
}

$t->assign('list', $list);
$t->assign('not_exists', $not_exists);
$t->assign('sort', $sort);
$t->assign('view_set', $view_set);

$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);
$t->display(cb_get_pagename() . '.tpl');

function _sort_condition()
{

}


