<?php

global $G_INPUT;

//-- instantiate smarty object
require_once('grn/smarty.csp');
$t = new GRN_Smarty();

$login = cb_get_login_user();
require_once('grn/system_logic.csp');
$system = GRN_System::getInstance();
$is_administrator = $system->isSuperAdmin($login);

require_once('grn/information.csp');

$mgr = GRN_SystemInformation::getInstance();
$ids = $mgr->getLogicIds();

$menu = cb_at($G_INPUT, 'id', current($ids));
$logic = $mgr->getLogic($menu);

if ( ! $logic
     || ((defined('ON_SAAS') || ! $is_administrator)
         && 'environment' === $logic->getId())
) {
    $menu = current($ids);
    $logic = $mgr->getLogic($menu);
}
$contents = $logic->getContents();
$page_title = $logic->getName();

$list = [];
foreach ($ids as $key => $value) {
    $logic = $mgr->getLogic($value);

    if ((defined('ON_SAAS') || ! $is_administrator)
        && 'environment' === $logic->getId()
    ) {
        continue;
    }

    $list[] = [
        'id'   => $logic->getId(),
        'name' => $logic->getName()
    ];
}

$t->assign('menu', $menu);
$t->assign('list', $list);
$t->assign('contents', $contents);

//site position
$positions[] = [
    'page' => 'system/index',
    'name' => grn_get_current_page_display_name()
];
$positions[] = ['page' => '', 'name' => $page_title];
$t->assign('page_title', $page_title);
$t->assign('site_position', $positions);

//-- show page
$t->display(cb_get_pagename() . '.tpl');
