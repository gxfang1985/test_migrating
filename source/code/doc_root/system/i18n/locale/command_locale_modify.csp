<?php
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    require_once("grn/smarty.csp");
    require_once("SmartyValidate.class.php");
    require_once("fw/i18n.csp");
    require_once("fw/i18n/locale.csp");

    $i18n = CB_I18N::getInstance();
    $target_name = "system/i18n/locale/locale_modify";
    $t = new GRN_Smarty();
    SmartyValidate::connect($t);
    SmartyValidate::register_form($target_name);

    if (SmartyValidate::is_valid($G_INPUT, $target_name)) {
        if ( ! array_key_exists("lid", $G_INPUT)) {
            cb_throw_error(E_COMMON_LOCALE_WAS_NOT_FOUND);
        }

        CB_LocaleManager::modifyLocale($G_INPUT,
            getMultiLanguageText("locale-name", $G_INPUT));

        cb_redirect("system/i18n/locale/locale_detail",
            ["lid" => $G_INPUT["lid"]]);
    } else {
        require_once("_locale_modify.csp");

        $t->assign("locale_names",
            @getMultiLanguageText("locale-name", $G_INPUT));
        $t->assign("locale_code", @$G_INPUT["locale-code"]);
        $t->assign("language", @$G_INPUT["language"]);
        $t->assign("long_date_format",
            CB_DateTimeFormatManager::getDateFormat(@$G_INPUT["language"],
                @$G_INPUT["long-date-format"]));
        $t->assign("short_date_format",
            CB_DateTimeFormatManager::getDateFormat(@$G_INPUT["language"],
                @$G_INPUT["short-date-format"]));
        $t->assign("time_format",
            CB_DateTimeFormatManager::getTimeFormat(@$G_INPUT["language"],
                @$G_INPUT["time-format"]));

        $t->setPageInfo($target_name);

        $t->display($target_name . '.tpl');

    }
}
