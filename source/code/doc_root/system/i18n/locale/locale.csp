<?php
require_once('grn/smarty.csp');
$t = new GRN_Smarty;
require('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form(cb_get_pagename(), true);

require_once("grn/controller.csp");
$utility = new GRN_ControllerUtil();

global $G_container_base;
$uum =& $G_container_base->getInstance('uum');
$login =& $uum->getLoginUser();

require_once('grn/ui.csp');
$cm = GRN_UIConfigManager::getInstance();
$config = $cm->getUserConfig($login);

$limit = $config->getListMax();

// 一覧開始位置
$offset = $utility->getNaviStartPosition();
$utility->setNaviStartPosition($offset);

require_once("fw/i18n.csp");
require_once("fw/date.csp");
$i18n = CB_I18n::getInstance();
$current_language = $i18n->getCurrentLanguage();

$availableLanguages = CB_LanguageManager::getAvailableLanguages();
$availableLanguages[]
    = CB_LanguageManager::$LANGUAGE_CODE_PREFER_BROWSER_SETTING;

require_once("fw/i18n/locale.csp");
$locales = CB_LocaleManager::getLocales($offset, $limit);

$now = new CB_TimeStamp();
$now->unix_ts = time();
$view = [];
foreach ($locales as $locale) {
    $view[] = [
        "id"                => $locale->getId(),
        "name"              => $locale->getLocalName(),
        "language_code"     => $locale->getLanguageCode(),
        "long_date_format"  => $locale->getLongDateFormat(),
        "short_date_format" => $locale->getShortDateFormat(),
        "time_format"       => $locale->getTimeFormat(),
    ];
}

// 一覧ナビゲーション
$navi_info = $utility->makeNaviInformation($offset, $limit,
    count(CB_LocaleManager::getLocales()), ['sf' => 1]);
$t->assign('navi', $navi_info);

$t->assign("locales", $view);
$t->assign('page_title',
    grn_get_page_display_name("system/i18n/locale/locale"));

$t->assign("delete_multi_info", [
    'title'         => grn_get_page_display_name('system/i18n/locale/locale_delete_multi'),
    'page'          => 'system/i18n/locale/locale_delete_multi.tpl',
    'no_confirm'    => false,
    'data'          => [],
    'handler'       => ['btn_delete_multi1', 'btn_delete_multi2'],
    'multi_target'  => 'locale-id[]',
    'before_delete' => 'on_before_show_popup',
    'form_target'   => 'system/i18n/locale/locale'
]);

$t->assign(
    'site_position', [
        0 =>
            [
                'page' => '',
                'name' => grn_get_page_display_name("system/i18n/locale/locale"),
            ],
    ]
);

$t->display(cb_get_pagename() . '.tpl');
