<?php
require_once("fw/i18n/locale.csp");

$locale_id = $G_INPUT["lid"];
$locale = CB_Locale::select($locale_id);

if (is_null($locale)) {
    cb_throw_error(E_COMMON_LOCALE_WAS_NOT_FOUND);
}

require_once("fw/i18n.csp");
require_once("fw/date.csp");
$i18n = CB_I18n::getInstance();

$current_language = $i18n->getCurrentLanguage();
$availableLanguage = CB_LanguageManager::getAvailableLanguages();
$availableLanguage[]
    = CB_LanguageManager::$LANGUAGE_CODE_PREFER_BROWSER_SETTING;

$locales = CB_LocaleManager::getLocales();

$locale_names_objects = CB_LocaleManager::getLocaleNames($locale->getId());

$locale_names = [];
foreach ($locale_names_objects as $locale_name_object) {
    $locale_names[$locale_name_object->getLanguageCode()]
        = $locale_name_object->getName();
}
$locale_names[CB_I18N_DEFUALT_LANGUAGE_CODE] = $locale->getName();

$t->assign("lid", $locale->getId());
$t->assign("locale_names", $locale_names);
$t->assign("locale_code", $locale->getCode());
$t->assign("language", $locale->getLanguageCode());
$t->assign("long_date_format", $locale->getLongDateFormat());
$t->assign("short_date_format", $locale->getShortDateFormat());
$t->assign("time_format", $locale->getTimeFormat());

$long_date_format = [];
$short_date_format = [];
$time_format = [];
foreach ($availableLanguage as $language_code) {
    $long_date_format[$language_code]
        = CB_DateTimeFormatManager::getDateFormats($language_code);
    $short_date_format[$language_code]
        = CB_DateTimeFormatManager::getDateFormats($language_code);
    $time_format[$language_code]
        = CB_DateTimeFormatManager::getTimeFormats($language_code);
}

$t->assign("language_code_list", $availableLanguage);
$t->assign("long_date_format_list", $long_date_format);
$t->assign("short_date_format_list", $short_date_format);
$t->assign("time_format_list", $time_format);
$t->assign("current_language", $current_language);

$t->assign('page_title',
    grn_get_page_display_name("system/i18n/locale/locale_modify"));

$t->assign('site_position', [
    [
        'page' => '/system/i18n/locale/locale',
        'name' => grn_get_page_display_name("system/i18n/locale/locale"),
    ],
    [
        'page' => '/system/i18n/locale/locale_detail',
        'name' => grn_get_page_display_name("system/i18n/locale/locale_detail"),
        "lid"  => $locale->getId()
    ],
    [
        'page' => '',
        'name' => grn_get_page_display_name("system/i18n/locale/locale_modify"),
    ],
]);
