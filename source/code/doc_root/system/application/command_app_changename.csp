<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;

    //get language values
    require_once('fw/i18n.csp');
    require_once('system/resources.csp');
    $inputLocalNameArray
        = getMultiLanguageText(GRN_SYSTEM_ELEMENT_NAME_APPLICATION, $G_INPUT);

    require_once('SmartyValidate.class.php');
    SmartyValidate::connect($t);

    $target_name = 'system/application/app_changename';
    SmartyValidate::register_form($target_name);

    if (SmartyValidate::is_valid($G_INPUT, $target_name)) {
        require_once('grn/application.csp');
        $locator = GRN_ApplicationLocator::instance();
        $app_id = @ $G_INPUT['app_id'];

        // アプリケーション名を変更する
        require_once('system/SystemApplicationLogic.csp');
        $sysAppLogic = new SystemApplicationLogic();
        $sysAppLogic->modifyApplicationName($app_id, $inputLocalNameArray);

        SmartyValidate::unregister_form($target_name);

        cb_redirect('system/application/index');
    } else {
        include('_app_changename.csp');

        $multiLanguageInfoArray = [];
        $multiLanguageInfoArray['element_name']
            = GRN_SYSTEM_ELEMENT_NAME_APPLICATION;
        $multiLanguageInfoArray['values'] = $inputLocalNameArray;
        $t->assign('multiLanguageInfoArray', $multiLanguageInfoArray);

        $t->display($target_name . '.tpl');
    }
}


