<?php

//Get Smarty Instance
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Set Base ID for Site Position
$t->assign('id', 'sso');

//Get SSO Method List
require_once("grn/sso.csp");
$sso_service = GRN_SSO_Service::getInstance();
$sso_method_list = $sso_service->getSSOMethodList();
if ( ! $sso_method_list) {
    $sso_method_list = [];
}

// Create Parameter Translation Map
$translation_map = [
    'smid'         => '_id',
    'display_name' => 'display_name',
];

//Get Login User
require_once('grn/uum.csp');
global $G_container_base;
$grn_uum =& $G_container_base->getInstance('uum');
$login_user =& $grn_uum->getLoginUser();

//Get Login User Config
require_once('grn/ui.csp');
$manager = GRN_UIConfigManager::getInstance();
$config =& $manager->getUserConfig($login_user);

//N-Navigation
require_once('grn/controller.csp');
$utility = new GRN_ControllerUtil();
$start_position = $utility->getNaviStartPosition();
$utility->setNaviStartPosition($start_position);
$n_navigation_for_view = $utility->makeNaviInformation($start_position,
    $config->getListMax(), count($sso_method_list));

//ID List
$id_list = array_keys($sso_method_list);
$view_id_list = array_slice($id_list, $n_navigation_for_view['offset'],
    $n_navigation_for_view['limit']);

// Do Parameter Translation
$index = 0;
$sso_method_list_for_view = [];
foreach ($view_id_list as $sso_method_id) {
    $sso_method_for_view = [];
    foreach ($translation_map as $view_name => $model_name) {
        if ($view_name === 'smid') {
            $sso_method_for_view[$view_name] = $sso_method_id;
        } else {
            $sso_method_for_view[$view_name]
                = $sso_method_list[$sso_method_id]->get($model_name);
        }
    }
    $index++;
    $sso_method_list_for_view[$index] = $sso_method_for_view;
}

// Assign Get Parameter
$sso_method_id = @ $G_INPUT['smid'];
$t->assign('sso_method_id', $sso_method_id);

// Assign Portlet Display Infomation
// Assign SSO Method List
$t->assign('sso_method', $sso_method_list_for_view);

// Assign Display Settings
$t->assign('view_set', $n_navigation_for_view);

//-- set page title and site position

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


