<?php

//Get Smarty Instance
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Get SSO Driver
require_once('grn/sso.csp');
$sso_service = GRN_SSO_Service::getInstance();
$sso_driver =& $sso_service->getSSODriver($method['driver_type']);

//Create Parameter Translation Map for SSO Driver
$translation_map_sso_driver = [
    'name' => 'name',             //Driver name
    'type' => 'type',             //Driver Type
];

//Do Parameter Translation for SSO Driver
$sso_driver_for_view = [];
foreach ($translation_map_sso_driver as $view_name => $model_name) {
    switch ($model_name) {
        case 'name':
            $sso_driver_for_view[$view_name] = $sso_driver->getName();
            break;
        case 'type':
            $sso_driver_for_view[$view_name] = $sso_driver->getType();
            break;
        default:
            break;
    }
}

//Replace Personal Settings Identifier
$personal_settings = [];
foreach ($method['driver_settings']['personal_params'] as $name => $value) {
    foreach (array_keys($identifier) as $app_id) {
        $reverse_identifier = array_flip($identifier[$app_id]);
        if (array_key_exists($name, $reverse_identifier)) {
            $name = $reverse_identifier[$name];
        }
        if (array_key_exists($value, $reverse_identifier)) {
            $value = $reverse_identifier[$value];
        }
    }
    $personal_settings[$name] = $value;
}
$method['driver_settings']['personal_params'] = $personal_settings;

//Replace System Settings Identifier
$system_settings = [];
foreach ($method['driver_settings']['system_params'] as $name => $value) {
    foreach (array_keys($identifier) as $app_id) {
        $reverse_identifier = array_flip($identifier[$app_id]);
        if (array_key_exists($name, $reverse_identifier)) {
            $name = $reverse_identifier[$name];
        }
        if (array_key_exists($value, $reverse_identifier)) {
            $value = $reverse_identifier[$value];
        }
    }
    $system_settings[$name] = $value;
}
$method['driver_settings']['system_params'] = $system_settings;

//Assign Display Infomation
//Display Infomation
$t->assign('display', $display);
//SSO Method Display Infomation
$t->assign('sso_method', $method);
//SSO Driver Display Infomation
$t->assign('sso_driver', $sso_driver_for_view);

// Ignore Licence Warnning
$t->skipWarning();

// Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("system/sso/sso/view_get.tpl");


