<?php

//Get Driver Type from Session
$session_manager = CB_SessionManager::getInstance();
$session = $session_manager->getSession(GRN_AUTH_MODULE_ID);
$login_driver_type =& $session->get('login_driver_type');

//Get Login Driver
require_once('grn/authentication.csp');
$authentication_service = GRN_Authentication_Service::getInstance();
$login_driver
    = $authentication_service->getLoginDriver($login_driver_type);

//Create Parameter Translation Map
$translation_map = [
    //Login Method Infomation
    'lmid'            => '_lmid',                //Login Method ID
    'rmid'            => 'repository',           //Repository Method ID
    'display_name'    => 'display_name',         //Display Name
    'driver_type'     => 'driver_type',          //Driver Type
    'driver_settings' => 'driver_settings',      //Driver Name
    'ctime'           => 'ctime',                //Create Time
    'creator_uid'     => 'creator',              //Creator ID
    'creator_name'    => 'creator_name',         //Creator Name
    'mtime'           => 'mtime',                //Modify Time
    'modify_uid'      => 'modifier',             //Modifier ID
    'modify_name'     => 'modifier_name',        //Modifier Name
    'is_default'      => 'is_default',           //Default Driver Flag
];

//Do Parameter Translation for Login Method
$login_method_for_view = [];
foreach ($translation_map as $view_name => $model_name) {
    switch ($model_name) {
        case '_lmid':
        case '_rmid':
        case 'creator_uid':
        case 'modifier_uid':
            $login_method_for_view[$view_name] = '0';
            break;
        case 'display_name':
        case 'driver_settings':
        case 'ctime':
        case 'mtime':
        case 'creator_name':
        case 'modifier_name':
            $login_method_for_view[$view_name] = '';
            break;
        case 'driver_type':
            $login_method_for_view[$view_name] = $login_driver->getType();
            break;
        default:
            break;
    }
}

//Assign Login Method Display Infomation
$t->assign('login_method', $login_method_for_view);

//-- set page title and site position

// set page title
$page_title
    = grn_get_page_display_name('system/authentication/login_method_add2');
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => "system/authentication/login_method_list",
            'name' => grn_get_page_display_name('system/authentication/login_method_list')
        ],
        ['page' => "", 'name' => $page_title]
    ]
);


