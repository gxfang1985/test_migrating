<?php

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once("grn/authentication.csp");
$authentication_service = GRN_Authentication_Service::getInstance();
$repository_method_list = $authentication_service->getRepositoryMethodList();
if ( ! $repository_method_list) {
    $repository_method_list = [];
}

// Create and assign view values of repository method list
$repository_method_list_for_view = [];
foreach ($repository_method_list as $repository_method) {
    if ($repository_method->isDefaultRepository()) {
        continue;
    }

    $id = $repository_method->getOID();
    $display_name = $repository_method->get(GRN_AUTH_PROPERTY_DISPLAY_NAME);
    if ( ! $display_name) {
        $driver_type = $repository_method->get(GRN_AUTH_PROPERTY_DRIVER_TYPE);
        $driver_type_elements = explode('.', $driver_type);
        $display_name = cb_msg($driver_type, $driver_type_elements[4]);
    }
    $repository_method_list_for_view[$id] = $display_name;
}
$t->assign('repository_method_list', $repository_method_list_for_view);

// Page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// Site position
$site_position = [
    [
        'page' => "system/authentication/repository_method_list",
        'name' => grn_get_page_display_name('system/authentication/repository_method_list')
    ],
    [
        'page' => '',
        'name' => $page_title
    ]
];
$t->assign('site_position', $site_position);

$t->display(cb_get_pagename() . ".tpl");
