<?php

// instantiate an Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//Get Authenticate Method ID
$authenticate_method_id = @ $G_INPUT['amid'];

//Get Authenticate Method Object
require_once('grn/authentication.csp');
$authentication_service = GRN_Authentication_Service::getInstance();
$authenticate_method
    =& $authentication_service->getAuthenticateMethod($authenticate_method_id);

//Check Driver
\grn\system\authentication\AvailableDriverChecker::getInstanceOfAuthenticateMethod()
                                                 ->canDelete(
                                                     $authenticate_method->getDriverType()
                                                 );

//Create Parameter Translation Map
$translation_Map = [
    'amid'         => '_id',              //Authenticate Method ID
    'display_name' => 'display_name',     //Display Name
];

//Do Parameter Translation
$authenticate_method_for_view = [];
foreach ($translation_Map as $view_name => $model_name) {
    switch ($view_name) {
        case 'amid':
            $authenticate_method_for_view[$view_name]
                = $authenticate_method->getOID();
            break;
        case 'display_name':
            $display_name
                = $authenticate_method->get(GRN_AUTH_PROPERTY_DISPLAY_NAME);
            if ( ! $display_name) {
                $driver_type
                    = $authenticate_method->get(GRN_AUTH_PROPERTY_DRIVER_TYPE);
                $driver_type_elements = explode('.', $driver_type);
                $display_name = cb_msg($driver_type,
                    $driver_type_elements[4]);
            }
            $authenticate_method_for_view[$view_name] = $display_name;
            break;
        default:
            break;
    }
}

//Assign Display Infomation
$t->assign('authenticate_method', $authenticate_method_for_view);


//-- set page title and site position

//page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

//site position
$t->assign(
    'site_position', [
        [
            'page' => "system/authentication/authenticate_method_list",
            'name' => grn_get_page_display_name('system/authentication/authenticate_method_list')
        ],
        [
            'page' => "system/authentication/authenticate_method_view",
            'name' => grn_get_page_display_name('system/authentication/authenticate_method_view'),
            'amid' => $authenticate_method_id
        ],
        ['page' => "", 'name' => $page_title]
    ]
);

//Display Smarty Template
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


