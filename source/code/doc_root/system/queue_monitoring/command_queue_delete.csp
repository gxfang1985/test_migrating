<?php

use grn\cydec\mq\MessageQueue;

if (defined('ON_FOREST') || ! \grn\fts\Application::isAvailable()) {
    return;
}

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    $id = cb_at($G_INPUT, 'id');
    $ctime = cb_at($G_INPUT, 'ctime');
    if (empty($id) || empty($ctime)) {
        cb_redirect('system/queue_monitoring/cbfts_queue');
    }

    $mq = new MessageQueue();
    $queue = $mq->getParticularQueue($id, $ctime);
    if ($queue['id'] === '') {
        cb_redirect('system/queue_monitoring/cbfts_queue');
    }

    $affectedRows = $mq->deleteQueue($id, $ctime);

    if ($affectedRows > 0) {
        require_once('grn/logger.csp');
        $lm = CB_LoggerManager::getInstance();
        $logger = $lm->getLogger('grn.job');
        if ($logger->isInfoEnabled()) {
            $logger->infoEx("delete", "queue", $queue);
        }
    }
    cb_redirect('system/queue_monitoring/cbfts_queue');
}
