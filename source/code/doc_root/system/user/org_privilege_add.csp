<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

$logic = &_grn_get_privilege_logic();

//-- get parameters from URL parameters
$oid = @ $G_INPUT['oid'];

// アクセスを制御する対象を取得する
global $G_container_base;
/** @var GRN_Uum $uum */
$uum =& $G_container_base->getInstance('uum');
if (0 < strlen($oid)) {
    $group = &$uum->getGroup($oid);
    if ( ! $group) {
        cb_throw_error(E_GRN_GROUP_NOT_FOUND);
    }
}

$logged_in_user = $uum->getLoginUser();
if ( ! $logic->isTransferable($logged_in_user, $group)) {
    cb_throw_error(E_GRN_NO_SYSTEM_PRIVILEGE);
}

$session_name = 'system.user.org_privilege_add';
$ous_params = ['oid' => $oid];
$can_select_role = true;
$search_login_name = true;
require_once('grn/org_user_role_select.csp');
$t->assign('ous_params', $ous_params);

$t->assign('listbox_size', $navigation_info['navi']['number_on_page'] + 1);

// tree link page
$t->assign('link_page', cb_get_pagename());

//-- page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

//-- site position
$site_position = [
    [
        'page' => 'system/user/org_list',
        'name' => grn_get_page_display_name('system/user/org_list'),
        'oid'  => $oid
    ],
    [
        'page'  => 'system/user/org_privilege_list',
        'name'  => grn_get_page_display_name('system/user/org_privilege_list'),
        'oid'   => $oid,
        'reset' => 1
    ],
    ['page' => '', 'name' => $page_title],
];
$t->assign('site_position', $site_position);

//--authority types
$authorities = ['transferable' => 0];

$t->assign('authorities', $authorities);

// exec smarty
$t->display(cb_get_pagename() . '.tpl');

