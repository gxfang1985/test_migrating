<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    $rid = @ $G_INPUT['role_id'];
    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();
    $session
        =& $session_manager->getSession('grn.system.role_user_vest');
    $user_ids = $session->get('user_ids');
    if (is_array($user_ids)) {
        /** @var GRN_Uum $uum */
        $uum =& $G_container_base->getInstance('uum');
        $user_ids_tmp = array_keys($user_ids);
        $uum->setRoleUsers($rid, $user_ids_tmp);
        $uum->execInspection('role', 'assign', [
            'rid'  => $rid,
            'uids' => implode(',', $user_ids_tmp)
        ]);
    }

    cb_redirect('system/user/role_list', ['role_id' => $rid]);
}

