<?php

use grn\system\sandbox\GRN_Uum_Sandbox;
use grn\system\sandbox\GroupOperationService;

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    $uum = GRN_Uum_Sandbox::getInstance();
    $service = new GroupOperationService();

    $org_id = @ $G_INPUT['oid'];
    $eid = @ $G_INPUT['eid'];

    if (is_array($eid)) {
        $users = $uum->getGroupUsers($org_id);
        foreach ($eid as $uid) {
            unset($users[$uid]);
        }
        $eids = array_keys($users);
        $service->setGroupUsers($org_id, $eids);
    } else {
        $eid = [];
        $service->setGroupUsers($org_id, $eid);
    }

    $uum->execInspection('sandbox-group', 'delete_assign',
        ['gid' => $org_id, 'uids' => implode(',', $eid)]);
    cb_redirect('system/user/sandbox/org_list', ['oid' => $org_id]);
}
