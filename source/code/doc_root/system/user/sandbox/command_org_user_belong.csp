<?php

use grn\system\sandbox\GRN_Uum_Sandbox;
use grn\system\sandbox\UserOperationService;

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    global $G_INPUT;
    $org_id = @ $G_INPUT['oid'];
    $user_id = @ $G_INPUT['uid'];
    if (0 == strlen($user_id)) {
        assert('FALSE');
    }

    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();
    $session
        =& $session_manager->getSession('grn.system.sandbox.org_user_belong');
    $org_ids = $session->get('org_ids');

    $service = new UserOperationService();
    $service->setUserGroups($user_id, array_keys($org_ids));

    $uum = GRN_Uum_Sandbox::getInstance();
    $uum->execInspection('sandbox-user', 'belong',
        ['uid' => $user_id, 'gids' => implode(',', array_keys($org_ids))]);

    cb_redirect('system/user/sandbox/org_user_view',
        ['oid' => $org_id, 'uid' => $user_id]);
}


