<?php

use grn\system\sandbox\GRN_Uum_Sandbox;

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

//-- orgnaization id
global $G_INPUT;
$org_id = @ $G_INPUT['oid'];

//-- prepare uum
$uum = GRN_Uum_Sandbox::getInstance();

//-- organization informaiton
$org = [];
if ($org_id) {
    // (for general organization)
    $group =& $uum->getGroup($org_id);
    if ( ! $group) {
        cb_throw_error(E_GRN_GROUP_NOT_FOUND);
    }
    $org['name'] = $group->get('name');
    $children = $uum->getChildGroups($org_id);
} else {
    // (for root organization)
    $children = $uum->getRootGroups();
}

//-- child group list
$children_options = [];
foreach (array_keys($children) as $id) {
    /** @var CB_Group $child */
    $child =& $children[$id];
    $children_options[$id] = $child->get('name');
}

$t->assign('org_id', $org_id);
$t->assign('org', $org);
$t->assign('children_options', $children_options);

//-- page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('title_of_grn_title', cb_msg("grn.system.user", "org_order"));

//-- site position
require_once('grn/controller.csp');
$page_infos = [
    'index'     => [],
    'org_list'  => ['oid' => $org_id, 'sf' => 1],
    'org_order' => null,
];
$util = new GRN_ControllerUtil();
$site_position = $util->makeSitePosition('system/user/sandbox/', $page_infos);
$t->assign('site_position', $site_position);
$form_name = cb_get_pagename();
$t->assign('form_name', $form_name);
$t->assign('dir_name', 'system/user/sandbox');
$t->assign('is_sandbox_page', true);

// Smartyを実行する
$t->display('system/user/org_order.tpl');


