<?php

use grn\system\sandbox\GRN_Uum_Sandbox;
use grn\system\sandbox\GroupOperationService;

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;

    global $G_INPUT;
    $org_id = $G_INPUT['oid'];
    if (0 == strlen($org_id)) {
        cb_throw_error(E_GRN_GROUP_NOT_FOUND);
    }
    $parent_org_id = $G_INPUT['poid'];
    if (0 == $parent_org_id || 0 == strlen($parent_org_id)) {
        $parent_org_id = null;
    }

    $service = new GroupOperationService;
    $service->setParentGroup($org_id, $parent_org_id);

    $uum = GRN_Uum_Sandbox::getInstance();
    $uum->execInspection(
        'sandbox-group', 'move', [
            'gid'  => $org_id,
            'pgid' => $parent_org_id
        ]
    );
    grn\system\sandbox\_grn_rebuild_tree($parent_org_id);

    cb_redirect('system/user/sandbox/org_view', ['oid' => $org_id]);
}


