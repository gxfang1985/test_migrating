<?php

use grn\system\sandbox\GRN_Uum_Sandbox;

$user = cb_get_login_user();

require_once('grn/system_logic.csp');
$system = GRN_System::getInstance();
if ( ! $system->isSuperAdmin($user)
     && ! $system->adminSubSystem('user', $user)
) {
    cb_throw_error(E_GRN_NO_SYSTEM_PRIVILEGE);
}

require_once('grn/org_privilege.csp');
$logic = GRN_OrganizationPrivilegeLogic::getInstance();
$logic->setAdmin(true);

unset($system, $user);

// load misc functions
require_once('system/sandbox/misc.csp');

// check sandbox mode
if ( ! in_array(
    cb_get_pagename(),
    [
        'system/user/sandbox/index',//組織の事前設定
        'system/user/sandbox/command_index',//組織の事前設定
    ]
)
) {
    \grn\system\sandbox\validateSandboxStatusIsExist();
}

// stop cache
GRN_Uum_Sandbox::setupSandboxMode();
