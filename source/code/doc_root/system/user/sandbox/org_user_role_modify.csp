<?php

use grn\system\sandbox\GRN_Uum_Sandbox;

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//-- parameters
global $G_INPUT;
$org_id = @ $G_INPUT['oid'];
$user_id = @ $G_INPUT['uid'];

$uum = GRN_Uum_Sandbox::getInstance();

//-- candidate role list
$roles = $uum->listStaticRoles();
$role_list = [];
foreach ($roles as $id => $role) {
    $role_list[$id] = [
        'rid'         => $id,
        'foreign_key' => $role->get('foreign_key'),
    ];
}

$user = $uum->getUser($user_id);
if ( ! $user) {
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}
//-- current role list for selected user
$roles = $uum->getUserRoles($user_id);
foreach ($roles as $id => $role) {
    $role_list[$id]['selected'] = true;
}

$t->assign('org_id', $org_id);
$t->assign('user_id', $user_id);
$t->assign('role_list', $role_list);

//--page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('title_of_grn_title',
    cb_msg("grn.system.user", "org_user_role_modify"));

//site position
require_once('grn/controller.csp');
$page_infos = [
    'index'                => [],
    'org_list'             => ['oid' => $org_id],
    'org_user_view'        => ['oid' => $org_id, 'uid' => $user_id],
    'org_user_role_modify' => null,
];
$util = new GRN_ControllerUtil();
$site_position = $util->makeSitePosition('system/user/sandbox/', $page_infos);
$t->assign('site_position', $site_position);

$form_name = cb_get_pagename();
$t->assign('form_name', $form_name);
$t->assign('dir_name', 'system/user/sandbox');
$t->assign('is_sandbox_page', true);

// Smarty実行
$t->display('system/user/org_user_role_modify.tpl');


