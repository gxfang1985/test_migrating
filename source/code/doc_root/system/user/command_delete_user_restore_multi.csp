<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    global $G_container_base;
    /** @var GRN_Uum $uum */
    $uum =& $G_container_base->getInstance('uum');

    $eid = isset($G_INPUT['eid']) ? $G_INPUT['eid'] : null;

    if (is_array($eid)) {
        foreach ($eid as $id) {
            $result = $uum->restoreUser($id);

            if ($result === E_GRN_USER_NOT_FOUND
                || $result === E_GRN_USER_NOT_DELETED
            ) {
                cb_throw_error($result);
            }

            $user =& $uum->getUser($id);
            $uum->execInspection('user', 'restore', [
                'uid'     => $id,
                'name'    => $user->get('display_name'),
                'account' => $user->get('foreign_key')
            ]);
        }
    }

    cb_redirect('system/user/delete_user_list');
}
