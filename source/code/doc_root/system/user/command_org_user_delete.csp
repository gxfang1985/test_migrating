<?php

$logic = _grn_get_privilege_logic();

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;

    $user_id = @ $G_INPUT['uid'];
    if (0 == strlen($user_id)) {
        cb_throw_error();
    }
    $org_id = @ $G_INPUT['oid'];
    $logged_in_user = $uum->getLoginUser();
    $user = $uum->getUser($user_id);
    if ( ! $logic->isPrivilegedUser($logged_in_user, $user)) {
        cb_throw_error(E_GRN_NO_SYSTEM_PRIVILEGE);
    }

    /** @var GRN_Uum $uum */
    $uum = $G_container_base->getInstance('uum');

    $user_info = $uum->getUserInfo($user_id);
    $uum->removeUser($user_id);
    $uum->execInspection('user', 'delete', [
        'uid'     => $user_id,
        'name'    => $user_info['col_display_name'],
        'account' => $user_info['col_foreign_key']
    ]);

    cb_redirect('system/user/org_list', ['oid' => $org_id]);
}


