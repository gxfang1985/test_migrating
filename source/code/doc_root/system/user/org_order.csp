<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

//-- orgnaization id
$org_id = @ $G_INPUT['oid'];

$logic = &_grn_get_privilege_logic();
$is_admin = $logic->isAdmin();

//-- prepare uum
global $G_container_base;
/** @var GRN_Uum $uum */
$uum =& $G_container_base->getInstance('uum');

//-- organization informaiton
$org = [];
if ($org_id) {
    // (for general organization)
    $group =& $uum->getGroup($org_id);
    if ( ! $group) {
        cb_throw_error(E_GRN_GROUP_NOT_FOUND);
    }
    $org['name'] = $group->get('name');
    $children = $uum->getChildGroups($org_id);
} else {
    if ( ! $is_admin) {
        cb_throw_error(E_GRN_NO_SYSTEM_PRIVILEGE);
    }
    // (for root organization)
    $children = $uum->getRootGroups();
}

//-- child group list
$children_options = [];
foreach (array_keys($children) as $id) {
    $child =& $children[$id];
    $children_options[$id] = $child->get('name');
}

$t->assign('org_id', $org_id);
$t->assign('org', $org);
$t->assign('children_options', $children_options);

//-- page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('title_of_grn_title', $page_title);

//-- site position
require_once('grn/controller.csp');
$page_infos = [
    'org_list'  => ['oid' => $org_id, 'sf' => 1],
    'org_order' => null,
];
$util = new GRN_ControllerUtil();
$site_position = $util->makeSitePosition('system/user/', $page_infos);
$t->assign('site_position', $site_position);
$form_name = cb_get_pagename();
$t->assign('form_name', $form_name);
$t->assign('dir_name', 'system/user');

// Smartyを実行する
$t->display(cb_get_pagename() . '.tpl');


