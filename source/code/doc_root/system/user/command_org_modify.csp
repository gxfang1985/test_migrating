<?php

$logic = &_grn_get_privilege_logic();

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    require_once('grn/smarty.csp');
    $t = new GRN_Smarty;

    //get language values
    require_once('fw/i18n.csp');
    $inputLocalNameArray
        = getMultiLanguageText(GRN_UUM_ELEMENT_NAME_ORGANIZATION, $G_INPUT);

    require_once('SmartyValidate.class.php');
    SmartyValidate::connect($t);

    $target_page = 'system/user/org_modify';
    SmartyValidate::register_form($target_page);

    if (SmartyValidate::is_valid($G_INPUT, $target_page)) {
        if ( ! @ $G_INPUT['oid']) {
            cb_throw_error(E_GRN_GROUP_NOT_FOUND);
        }

        $org_id = $G_INPUT['oid'];
        $foreignKey = @ $G_INPUT['code'];
        $memo = @ $G_INPUT['memo'];


        //Modify Group
        global $G_container_base;
        /** @var GRN_Uum $uum */
        $uum = $G_container_base->getInstance('uum');
        $uum->modifyGroup($org_id, $inputLocalNameArray, $foreignKey, $memo);


        SmartyValidate::unregister_form($target_page);

        _grn_rebuild_tree();

        cb_redirect('system/user/org_view', ['oid' => $org_id]);
    } else {
        $t->setPageInfo($target_page);

        $t->assign('form_name', $target_page);
        $t->assign('dir_name', 'system/user');

        include('_org_modify.csp');

        $org_for_view = &$t->get_template_vars('org');
        $org_for_view['foreign_key'] = $G_INPUT['code'];
        $org_for_view['description'] = $G_INPUT['memo'];

        $multiLanguageInfoArray = [];
        $multiLanguageInfoArray['element_name']
            = GRN_UUM_ELEMENT_NAME_ORGANIZATION;
        $multiLanguageInfoArray['values'] = $inputLocalNameArray;
        $t->assign('multiLanguageInfoArray', $multiLanguageInfoArray);

        $t->display($target_page . '.tpl');
    }

}
