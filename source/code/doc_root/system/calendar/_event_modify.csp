<?php

require_once('fw/i18n.csp');

$scid = @$G_INPUT['scid'];
$bdate = (int)@$G_INPUT['bdate'];
$eid = @$G_INPUT['event'];

require_once('grn/calendar.csp');
$cm = GRN_CalendarManager::getInstance();
$c = $cm->getSystemCalendar($scid);
if ( ! $c) {
    cb_throw_error(E_GRN_CALENDAR_CALENDAR_NOT_FOUND);
}

$e = $c->getDayInfoById($eid);
if ( ! $e) {
    cb_throw_error(E_GRN_CALENDAR_DAY_NOT_FOUND);
}
$date = $e->get('date');
$type = $e->get('type');

$cs = GRN_CalendarService::getInstance();
$holiday = $cs->getEventName(GRN_CALENDAR_TYPE_PUBLICHOLIDAY);
$memo = $cs->getEventName(GRN_CALENDAR_TYPE_SYSTEM_MEMO);
$workday = $cs->getEventName(GRN_CALENDAR_TYPE_WORKDAY);

$types[GRN_CALENDAR_TYPE_PUBLICHOLIDAY] = [
    'value' => GRN_CALENDAR_TYPE_PUBLICHOLIDAY,
    'label' => $holiday
];
$types[GRN_CALENDAR_TYPE_WORKDAY] = [
    'value' => GRN_CALENDAR_TYPE_WORKDAY,
    'label' => $workday
];
$types[GRN_CALENDAR_TYPE_SYSTEM_MEMO] = [
    'value' => GRN_CALENDAR_TYPE_SYSTEM_MEMO,
    'label' => $memo
];

$types[$type]['selected'] = true;
$event = [
    'date'   => $date,
    'types'  => $types,
    'id'     => $eid,
    'detail' => $e->get('info')
];

$calendar = [
    'id'    => $scid,
    'event' => $event
];

$t->assign('scid', $scid);
$t->assign('date', $date);
$t->assign('calendar', $calendar);

// page title
$page_title = grn_get_page_display_name('system/calendar/event_modify');
$t->assign('page_title', $page_title);

$page_list = 'system/calendar/systemcalendar_list';
$page_event = 'system/calendar/event_view';

// site position 
$t->assign(
    'site_position', [
        [
            'page' => $page_list,
            'name' => grn_get_page_display_name($page_list),
            'scid' => $scid
        ],
        [
            'page'  => $page_event,
            'name'  => grn_get_page_display_name($page_event),
            'event' => $eid,
            'scid'  => $scid
        ],
        ['page' => "", 'name' => $page_title]
    ]
);


