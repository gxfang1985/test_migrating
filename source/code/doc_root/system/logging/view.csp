<?php

require_once('grn/logger.csp');
require_once('grn/smarty.csp');
$t = new GRN_Smarty;
$logic = GRN_LoggingLogic::getInstance();

$priority = @$G_INPUT['priority'];
$category = @$G_INPUT['category'];

$lid = @$G_INPUT['lid'];

$query = CB_LoggerQuery::getInstance();
$row = $query->getLogById($lid);

$log = [];
$log['id'] = $row['_id'];

$ts = new CB_TimeStamp();
$ts->unix_ts = $row['col_timestamp'];
$log['date'] = $logic->timestamp_to_datetime($ts);

$log['user'] = $row['col_user'];
$log['account'] = $row['col_account'];
$log['ip'] = $row['col_remote_addr'];
$log['host'] = $row['col_remote_host'];
$log['msg'] = $row['col_msg'];
$log['category_msg'] = $logic->getCategoryName($row['col_category']);
$log['priority_msg'] = $logic->getThresholdName($row['col_priority']);

$t->assign('log', $log);
$t->assign('category', $category);
$t->assign('priority', $priority);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

$admin_page = 'system/logging/admin';

// site position 
$t->assign(
    'site_position', [
        [
            'page'     => $admin_page,
            'name'     => grn_get_page_display_name($admin_page),
            'priority' => $priority,
            'category' => $category,
            'sf'       => 1
        ],
        ['page' => "", 'name' => $page_title]
    ]
);

// Smarty実行
$t->display(cb_get_pagename() . ".tpl");


