<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty();

$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('site_position', [
    [
        'page' => '',
        'name' => $page_title
    ]
]);

require_once('grn/license.csp');
$lm = GRN_LicenseManager::getInstance();
$license_info = $lm->getLicense(GRN_LICENSE_BASESYSTEM);

if ( ! is_array($license_info) || count($license_info) <= 0) {
    cb_throw_error();
}
global $G_container_base;
$uum = $G_container_base->getInstance('uum');

$active_count = $uum->getActiveUserCount();
$all_count = $uum->getUserCount();
$stop_count = $all_count - $active_count;
$regist_count = $active_count - 1;

$user_count = [
    'all'    => $all_count,
    'stop'   => $stop_count,
    'regist' => $regist_count
];

$t->assign('user_count', $user_count);

$is_demo_license = $lm->isDemoLicense($license_info['type']);
$t->assign('is_demo_license', $is_demo_license);
if ($is_demo_license) {
    $limit = $license_info['limit'];
    $license_info['remind_days'] = $lm->getRemindDays($limit);
} else {
    $limit = $license_info['service_limit'];
    $license_info['remind_days'] = $lm->getRemindDays($limit);
}

$t->assign('license', $license_info);

$t->display(cb_get_pagename() . '.tpl');


