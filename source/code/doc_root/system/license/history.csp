<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty();

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$page_admin = 'system/license/admin';
$t->assign(
    'site_position',
    [
        [
            'page' => $page_admin,
            'name' => grn_get_page_display_name($page_admin)
        ],
        ['page' => "", 'name' => $page_title],
    ]
);

require_once('grn/license.csp');

$lm = GRN_LicenseManager::getInstance();
$licenses = $lm->getLicensesFromHistory();

foreach (array_keys($licenses) as $key) {
    $dt = new CB_DateTime;
    $register = $licenses[$key]['register'];
    $date = getdate($register->unix_ts);

    $dt->year = $date['year'];
    $dt->month = $date['mon'];
    $dt->day = $date['mday'];
    $dt->hour = $date['hours'];
    $dt->minute = $date['minutes'];
    $dt->second = $date['seconds'];

    $licenses[$key]['register'] = $dt;
}

$t->assign('licenses', $licenses);
$t->display(cb_get_pagename() . '.tpl');


