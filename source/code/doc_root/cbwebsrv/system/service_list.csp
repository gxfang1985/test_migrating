<?php

//-- instantiate smarty object
require_once('grn/smarty.csp');
$t = new GRN_Smarty();

require_once('cbwebsrv/tool_define.csp');
$service_list = [
    GRN_CBWEBSRV_SERVICE_ROUTE,
    GRN_CBWEBSRV_SERVICE_MAP,
    GRN_CBWEBSRV_SERVICE_RESEARCH,
    GRN_CBWEBSRV_SERVICE_ADDRESS,
    GRN_CBWEBSRV_SERVICE_WEATHER,
    GRN_CBWEBSRV_SERVICE_SIXKINDSOFDAY
];

require_once('cbwebsrv/system_logic.csp');
$system_logic = GRN_CBWebSrv_SystemLogic::getInstance();

$service_list_for_view = [];
foreach ($service_list as $service_name) {
    $service_list_for_view[$service_name]
        = $system_logic->getServiceAvailabilityAttribute($service_name);
}
$t->assign('service_list', $service_list_for_view);

require_once('cbwebsrv/application.csp');
$locator = GRN_ApplicationLocator::instance();
$app = null;
if (is_null($app =& $locator->getInstance('cbwebsrv'))) {
    require_once('cbwebsrv/error_code.csp');
    cb_throw_error(E_GRN_CBWEBSRV_DEACTIVATED);
}

// login user
$uum =& $G_container_base->getInstance('uum');
$user =& $uum->getLoginUser();

// site position
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);
$t->assign('site_position', [['page' => '', 'name' => $page_title]]);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");

