<?php

use grn\favour\service\FavourService;

global $G_INPUT;
require_once('grn/smarty.csp');
$smarty = new GRN_Smarty;
require_once('grn/application.csp');
$favour_service = new FavourService();
$locator = GRN_ApplicationLocator::instance();
if ( ! $locator->isActive('favour')) {
    cb_throw_error(E_GRN_APPLICATION_NOT_ACTIVE);
}

$apps = FavourService::$appsCheckingRespond;
$apps_info = [];
$favour_apps_setting = $favour_service->getAllowApplicationsRespond();
$favour_apps_setting = $favour_apps_setting === false ? []
    : $favour_apps_setting;
foreach ($apps as $app) {
    $app_info = [];
    $app_instance = $locator->getInstance($app);
    if ($app_instance) {
        $app_info['app_id'] = $app;
        $app_info['name'] = $app_instance->getDefaultName();
        $app_info['checked'] = cb_at($favour_apps_setting, $app, 0);
        $apps_info[$app] = $app_info;
    }
}
$smarty->assign('apps_info', $apps_info);

$page_title = grn_get_current_page_display_name();
$site_position = [
    [
        'page' => '',
        'name' => $page_title,
    ],
];
$smarty->assign('site_position', $site_position);
$smarty->assign('page_title', $page_title);
$smarty->display(cb_get_pagename() . '.tpl');
