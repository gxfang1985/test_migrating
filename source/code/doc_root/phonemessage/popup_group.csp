<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

////////////////////////////////////////////////////////////////

// 電話メモを取得する
require_once('phonemessage/application.csp');
$app_locator = GRN_ApplicationLocator::instance();
/** @var GRN_PhoneMessage_Application $app */
$app =& $app_locator->getInstance(GRN_PHONEMESSAGE_APPLICATION_ID);
if ( ! is_object($app) || ! is_a($app, 'GRN_PhoneMessage_Application')) {
    cb_throw_error(E_GRN_APPLICATION_NOT_AVAILABLE);
}

// GET/POSTされたパラメータを取得する
$gid = null;
if (array_key_exists('gid', $G_INPUT)) {
    $gid = $G_INPUT['gid'];
}
if (0 == strlen($gid) || 0 >= $gid) {
    $gid = 0;
}

// 組織を選択するツリーを取得する
require_once('grn/uum_util.csp');
$uum_util = GRN_UumUtil::getInstance();
$group_tree = $uum_util->getGroupSelectionTree($gid);

$t->assign('organization', $group_tree);
$t->assign('organization_id', $gid);
$t->assign('parent_organization_id', $gid);

////////////////////////////////////////////////////////////////

// Smartyにページタイトルを割り当てる
$page_title = grn_get_page_display_name('phonemessage/popup_group');
$t->assign('page_title', $page_title);

// Smartyにサイトポジションを割り当てる
require_once('phonemessage/controller.csp');
$controller_util = new GRN_PhoneMessage_ControllerUtil();
$page_infos = ['popup_group' => null];
$site_position = $controller_util->makeSitePosition('phonemessage/',
    $page_infos);
$t->assign('site_position', $site_position);

// Smartyを実行する
$t->display(cb_get_pagename() . '.tpl');


