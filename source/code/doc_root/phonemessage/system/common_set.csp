<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

////////////////////////////////////////////////////////////////

// 電話メモを取得する
//tv, this is not good in f4, becasue usser setting application codding
/*require_once( 'phonemessage/application.csp' );
$app_locator = GRN_ApplicationLocator::instance();
$app =& $app_locator->getInstance( GRN_PHONEMESSAGE_APPLICATION_ID );
if( ! is_object( $app ) || ! is_a( $app, 'GRN_PhoneMessage_Application' ) )
{
    cb_throw_error( E_GRN_APPLICATION_NOT_AVAILABLE );
}*/

// 電話メモの設定を取得する
require_once('phonemessage/config.csp');
$config_manager = GRN_PhoneMessage_ConfigManager::getInstance();
$system_config =& $config_manager->getSystemConfig();

// ユーザー名に割り当てたシングルサインオンを取得する
$sso = $system_config->getSSO();

// シングルサインオン一覧を取得する
require_once('grn/sso.csp');
$sso_service = GRN_SSO_Service::getInstance();
$ssos = $sso_service->getSSOMethodList('phonemessage');

// シングルサインオンオプション一覧を取得する
require_once('phonemessage/controller.csp');
$controller_util = new GRN_PhoneMessage_ControllerUtil();
$sso_options = $controller_util->listSSOOptions($ssos, $sso);

$t->assign('sso_options', $sso_options);

////////////////////////////////////////////////////////////////

// Smartyにページタイトルを割り当てる
$page_title = grn_get_page_display_name('phonemessage/system/common_set');
$t->assign('page_title', $page_title);

// Smartyにサイトポジションを割り当てる
$page_info = ['common_set' => null];
$site_position = $controller_util->makeSitePosition('phonemessage/system/',
    $page_info);
$t->assign('site_position', $site_position);

// Smartyを実行する
$t->display(cb_get_pagename() . '.tpl');


