<?php

//-- get parameters from URL parameters
$target = @ $G_INPUT['tid'];        // user(+organization), role, or facility
$org_id = @ $G_INPUT['oid'];        // organization id
$user_id = @ $G_INPUT['uid'];       // user id
$role_id = @ $G_INPUT['rid'];
$poid = @ $G_INPUT['poid'];

if (@ $t) {
    $t->assign('target', $target);
    $t->assign('org_id', $org_id);
    $t->assign('user_id', $user_id);
    $t->assign('role_id', $role_id);
    $t->assign('poid', $poid);
}

/**
 * Get an CB_Row instance of a user,a group or a role.
 *
 * @param string|null $target
 * @param string|null $org_id
 * @param string|null $user_id
 * @param string|null $role_id
 *
 * @return CB_User|CB_Group|CB_Role
 */
function grn_get_phonemessage_access_object(
    $target,
    $org_id,
    $user_id,
    $role_id
) {
    global $G_container_base;
    /** @var GRN_Uum $uum */
    $uum = $G_container_base->getInstance('uum');

    if ($target == 'role') {
        //(for role)
        $object = $uum->getStaticRole($role_id);
        if ( ! $object) {
            cb_throw_error(E_GRN_ROLE_NOT_FOUND);
        }
    } elseif ($user_id) {
        //(for user)
        $object = $uum->getUser($user_id);
        if ( ! $object) {
            cb_throw_error(E_GRN_USER_NOT_FOUND);
        }
    } elseif ($org_id) {
        //(for organization)
        $object = $uum->getGroup($org_id);
        if ( ! $object) {
            cb_throw_error(E_GRN_GROUP_NOT_FOUND);
        }
    } else {
        cb_throw_error(E_GRN_PHONEMESSAGE_CSV_INVALID_AUTHORITIES);
    }

    return $object;
}

