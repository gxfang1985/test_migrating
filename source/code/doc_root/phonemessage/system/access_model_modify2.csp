<?php

require_once('grn/smarty.csp');
$t = new GRN_Smarty;

////////////////////////////////////////////////////////////////

// GET/POSTされたパラメータを取得する
$tid = null;
if (array_key_exists('tid', $G_INPUT)) {
    $tid = $G_INPUT['tid'];
}
$rid = null;
if (array_key_exists('rid', $G_INPUT)) {
    $rid = $G_INPUT['rid'];
}
$oid = null;
if (array_key_exists('oid', $G_INPUT)) {
    $oid = $G_INPUT['oid'];
}
$uid = null;
if (array_key_exists('uid', $G_INPUT)) {
    $uid = $G_INPUT['uid'];
}
$security_model = null;
if (array_key_exists('security_model', $G_INPUT)) {
    $security_model = $G_INPUT['security_model'];
}
if (0 == strlen($security_model)) {
    cb_throw_error(E_GRN_PHONEMESSAGE_INVALID_SECURITY_MODEL);
}

require_once('_access_util.csp');

// 電話メモを取得する
//tv
/*require_once( 'phonemessage/application.csp' );
$app_locator = GRN_ApplicationLocator::instance();
$app =& $app_locator->getInstance( GRN_PHONEMESSAGE_APPLICATION_ID );
if( ! is_object( $app ) || ! is_a( $app, 'GRN_PhoneMessage_Application' ) )
{
    cb_throw_error( E_GRN_APPLICATION_NOT_AVAILABLE );
}*/

$t->assign('security_model', $security_model);

////////////////////////////////////////////////////////////////

// Smartyにページタイトルを割り当てる
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// Smartyにサイトポジションを割り当てる
require_once('phonemessage/controller.csp');
$controller_util = new GRN_PhoneMessage_ControllerUtil();
$page_info = [
    'access_index'         => ['sf' => 1, 'tid' => $tid, 'oid' => $oid],
    'access_list'          => [
        'tid'  => $tid,
        'oid'  => $oid,
        'uid'  => $uid,
        'rid'  => $rid,
        'poid' => $poid
    ],
    'access_model_modify2' => null
];
$site_position = $controller_util->makeSitePosition('phonemessage/system/',
    $page_info);
$t->assign('site_position', $site_position);

// Smartyを実行する
$t->display(cb_get_pagename() . '.tpl');


