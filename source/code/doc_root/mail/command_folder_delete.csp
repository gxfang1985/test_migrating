<?php

global $G_INPUT;
$account_id = @ $G_INPUT['aid'];
$category_id = @ $G_INPUT['cid'];
$parent_id = null;

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();
    if ( ! is_object($user)) {
        cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
    }

    require_once('mail/utility.csp');
    $utility = GRN_Mail_Utility::getInstance();
    $folder_logic = $utility->getFolderLogic();

    $folder_data = $folder_logic->getFolderData($category_id);
    if (is_array($folder_data)) {
        $parent_id = $folder_data['parent_id'];
    }

    if (isset($folder_data['code']) && is_string($folder_data['code'])
        && (strlen($folder_data['code']) > 0)
    ) {
        cb_throw_error(E_GRN_MAIL_CANNOT_DELETE_FOLDER_DATA);
    }

    // フォルダの削除
    $folder_logic->deleteFolderData($category_id);

    _mail_rebuild_folder_tree($account_id, $parent_id);
}

cb_redirect('mail/index', ['aid' => $account_id, 'cid' => $parent_id]);


