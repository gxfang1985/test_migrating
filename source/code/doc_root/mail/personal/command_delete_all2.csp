<?php
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();
    if ( ! is_object($user)) {
        cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
    }

    $account_id = @ $G_INPUT['aid'];
    $year = @ $G_INPUT['term_year'];
    $month = @ $G_INPUT['term_month'];
    $day = @ $G_INPUT['term_day'];

    if ($year == '' || $month == '' || $day == '') {
        require_once('mail/error_code.csp');
        cb_throw_error(E_GRN_MAIL_WRONG_PARAMETER);
    }

    require_once('fw/basic_date.csp');
    $base_date = new CB_Date();
    $base_date->year = $year;
    $base_date->month = $month;
    $base_date->day = $day;

    require_once('mail/utility.csp');
    $utility = GRN_Mail_Utility::getInstance();
    $mail_logic = $utility->getMailLogic();
    $personal_config = $utility->getPersonalConfig($user);

    if ( ! $account_id || ($account_id == '0')) {
        $account_id = null;
    }

    // メールデータ削除
    $mail_logic->deleteAllMailData($user, $account_id, $base_date, false);
    // メールサイズ再計算
    $personal_config->resetMailSize();

    cb_redirect('personal/application_list', ['app_id' => 'mail']);
}

