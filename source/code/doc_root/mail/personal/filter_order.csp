<?php
global $G_INPUT;
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();
if ( ! is_object($user)) {
    cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
}

require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$personal_config = $utility->getPersonalConfig($user);

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//-- get parameters from URL parameters
$account_id = @ $G_INPUT['aid'];

//------------------

// 振り分け設定取得
$filter_list_for_view = [];
if ( ! is_null($account_id)) {
    $filter_list = $personal_config->getFilterDataList($account_id, false);
    if (is_array($filter_list)) {
        foreach (array_keys($filter_list) as $key) {
            $temp_data =& $filter_list[$key];
            $filter_list_for_view[$key] = $temp_data['name'];
        }
    }
}

//------------------

// set_data
$t->assign(
    'set', [
        'aid' => $account_id,
    ]
);

// filter
$t->assign('filters', $filter_list_for_view);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => "mail/personal/filter",
            'name' => grn_get_page_display_name("mail/personal/filter"),
            'aid'  => $account_id
        ],
        [
            'page' => "",
            'name' => $page_title
        ]
    ]
);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


