<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();
    if ( ! is_object($user)) {
        cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
    }

    require_once('mail/utility.csp');
    $utility = GRN_Mail_Utility::getInstance();
    $personal_config = $utility->getPersonalConfig($user);

    $settings = [];
    if (isset($G_INPUT['send_set'])) {
        $settings['use_for_sending'] = (intval($G_INPUT['send_set']) == 1);
    } else {
        $settings['use_for_sending'] = false;
    }

    if (isset($G_INPUT['receive_set'])) {
        $settings['response'] = $G_INPUT['receive_set'];
    }

    if (isset($G_INPUT['no_response_bcc'])) {
        $settings['no_response_bcc'] = (intval($G_INPUT['no_response_bcc'])
                                        == 1);
    } else {
        $settings['no_response_bcc'] = false;
    }

    $personal_config->setConfirmSetting($settings);
}

cb_redirect('personal/application_list', ['app_id' => 'mail']);

