<?php
global $t;
$set =& $t->get_template_vars('set');
if ( ! isset($set) || is_null($set)) {
    $set = [];
}

global $G_INPUT;

$mail_server = cb_at($G_INPUT, 'mail_server');
$server_id = is_null($mail_server) ? '' : $mail_server;
$disabled = cb_at($G_INPUT, 'stop');
$disabled = ! is_null($disabled) && ((int)$disabled == 1);

// set data
$set['name'] = cb_at($G_INPUT, 'name');
$set['email'] = cb_at($G_INPUT, 'email');
$set['account'] = cb_at($G_INPUT, 'account');
$set['password'] = cb_at($G_INPUT, 'password');
$set['send_account'] = cb_at($G_INPUT, 'send_account');
$set['send_password'] = cb_at($G_INPUT, 'send_password');
$set['leave_server_mail'] = cb_at($G_INPUT, 'leave_server_mail');
$set['stop'] = $disabled;
$send_vcard = null;
$default_bcc = null;
$sender = null;

foreach (array_keys($mail_servers) as $key) {
    $server_data =& $mail_servers[$key];
    if ($key == $server_id) {
        $server_data['selected'] = true;
        if ($server_data['set_send']) {
            // 送信メールアカウントの設定フラグ
            $set['set_send'] = true;
        }
    } else {
        $server_data['selected'] = false;
    }
}

// mail_server
$t->assign('mail_server', $mail_servers);

// アカウント設定
$t->assign('set', $set);
