<?php

use grn\mail\screen\NoSettings;
use grn\mail\screen\personal\automation\Automation;

global $G_INPUT;
cb_require_role('LoginUser');
require_once("grn/smarty.csp");
$noSettings = new NoSettings;
$smarty = new GRN_Smarty;
$noSettingsFlag = $noSettings->getNoSettingFlags();
$smarty->assign("no_setting", $noSettingsFlag);
if ($noSettings::SETTING_OK === $noSettingsFlag) {
    $accountId = cb_at($G_INPUT, "accountId", -1);
    $automationPage = new Automation($accountId);
    $smarty->assign("page_title", $automationPage->getPageTitle());
    $smarty->assign("accountList", $automationPage->getAccountList());
    $smarty->assign("account", $automationPage->getAccount());
    $smarty->assign("events", $automationPage->getAutomaticEventList());
    $smarty->assign("accountId", $automationPage->getAccountId());
    $smarty->assign('site_position', $automationPage->getSitePosition());
} else {
    $page_title = grn_get_current_page_display_name();
    $smarty->assign("page_title", $page_title);
    $smarty->assign('site_position', [['page' => '', 'name' => $page_title]]);
    $smarty->assign('app_name', $G_mail_name);
}
$smarty->display("mail/personal/automation/automation.tpl");
