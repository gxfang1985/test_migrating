<?php

if (0 == strcasecmp(cb_at($_SERVER, 'REQUEST_METHOD'), 'POST')) {
    $user = cb_get_login_user();
    if ( ! is_object($user)) {
        cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
    }

    global $G_INPUT;
    $account_id = cb_at($G_INPUT, 'aid');
    $account_ids = [$account_id];
    $mail_delete = (isset($G_INPUT['mail_delete']) && $G_INPUT['mail_delete']);

    // アカウントデータの削除
    require_once('mail/utility.csp');
    $utility = GRN_Mail_Utility::getInstance();
    $personal_config = $utility->getPersonalConfig($user);
    $personal_config->deleteAccountDatas($account_ids, $mail_delete);
}

cb_redirect('mail/personal/account_list');
