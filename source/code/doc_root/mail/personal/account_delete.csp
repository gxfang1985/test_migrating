<?php

require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$system_config = $utility->getSystemConfig();

// アカウント削除権限
$system_config->getUserPrivilegeSetting($settings);

if ( ! $settings['all_permission']) {
    cb_throw_error(E_GRN_MAIL_CANNOT_DELETE_ACCOUNT_DATA);
}

//-- instantiate Smarty object
require_once('grn/smarty.csp');
$t = new GRN_Smarty;

$user = cb_get_login_user();
if ( ! is_object($user)) {
    cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
}

// get parameters from URL parameters
global $G_INPUT;
$account_id = cb_at($G_INPUT, 'aid');

// アカウントデータ取得
$personal_config = $utility->getPersonalConfig($user);
$account_data = $personal_config->getAccountData($account_id, true, true);

$title = '';
if ( ! is_null($account_data)) {
    $title = $account_data['title'];
}

// account_data
$t->assign(
    'set', [
        'aid'   => $account_id,
        'title' => $title
    ]
);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'mail/personal/account_list',
            'name' => grn_get_page_display_name('mail/personal/account_list')
        ],
        [
            'page' => 'mail/personal/account_view',
            'name' => grn_get_page_display_name('mail/personal/account_view'),
            'aid'  => $account_id
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

//-- show page
$t->display(cb_get_pagename() . ".tpl");
