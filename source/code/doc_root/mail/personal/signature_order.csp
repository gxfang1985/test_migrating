<?php
global $G_INPUT;
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();
if ( ! is_object($user)) {
    cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
}

require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$personal_config = $utility->getPersonalConfig($user);

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

//------------------

// get parameters from URL parameters
$account_id = @ $G_INPUT['aid'];

// アカウントデータ取得
$account_data = $personal_config->getAccountData($account_id, false, true);

//------------------

// 署名情報取得
$signature_data_list_for_view = [];
$signature_default_data = null;

// アカウントの署名設定リストを取得
$signature_list = $personal_config->getSignatureDataList($account_id, false);
if (is_array($signature_list)) {
    // 署名ループ
    foreach (array_keys($signature_list) as $temp_sign_id) {
        $sign_data =& $signature_list[$temp_sign_id];
        $signature_data_list_for_view[$temp_sign_id] = $sign_data['name'];
    }
}

//------------------

// 署名設定
$t->assign('sign_list', $signature_data_list_for_view);

$t->assign(
    'set', [
        'aid' => $account_id
    ]
);

//------------------
// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'mail/personal/signature_list',
            'name' => grn_get_page_display_name('mail/personal/signature_list'),
            'aid'  => $account_id
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");


