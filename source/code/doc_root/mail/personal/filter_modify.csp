<?php
global $G_INPUT;
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();
if ( ! is_object($user)) {
    cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
}

require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$system_config = $utility->getSystemConfig();
$personal_config = $utility->getPersonalConfig($user);

//-- instantiate smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

$t->assign('app_name', $G_mail_name);

//-- SmartyValidate should be initialized when an input form is there.
require('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form('mail/personal/filter_modify', true);

//-- include sharing code
include('_filter_modify.csp');

// set_data
$t->assign(
    'set', [
        'aid'                  => $account_id,
        'account'              => $account_data['title'],
        'stop'                 => $account_data['disabled'],
        'use_garbage'          => $use_trash,
        'status_id'            => $filter_data['status_id'],
        'save_address_history' => $filter_data['save_address_history'] != 0 ? 1
            : 0
    ]
);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position',
    [
        [
            'page' => 'mail/personal/filter',
            'name' => grn_get_page_display_name('mail/personal/filter'),
            'aid'  => $account_id
        ],
        [
            'page' => 'mail/personal/filter_view',
            'name' => grn_get_page_display_name('mail/personal/filter_view'),
            'aid'  => $account_id,
            'mfid' => $filter_id
        ],
        [
            'page' => '',
            'name' => $page_title,
        ],
    ]
);

// filter
$t->assign('filter', $filter_data_for_view);

// filter set Number
$t->assign('filter_set_num', count($conditions));

//-- show page
$t->display(cb_get_pagename() . '.tpl');


