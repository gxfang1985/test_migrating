<?php

//------------------

// アカウントデータリスト
$account_list_for_view = [];
$folder_list_for_view = [];
$folder_list_for_view['data'] = [];

// アカウントデータリスト
$account_list = $personal_config->getAccountDataList(false, false, -1, -1,
    false, true);
if (is_array($account_list)) {
    foreach (array_keys($account_list) as $key) {
        $temp_data =& $account_list[$key];
        $temp_account_info = $temp_data['account_info'];

        $temp_title = $temp_data['title'];
        $account_list_for_view[$key] = [
            'value' => $key,
            'label' => $temp_title
        ];

        if (isset($account_id) && ! is_null($account_id)
            && ($key == $account_id)
        ) {
            $account_list_for_view[$key]['selected'] = true;
        }

        if ((isset($account_id) && ! is_null($account_id)
             && ($key == $account_id))
            && (isset($category_id) && ! is_null($category_id))
        ) {
            $temp_cid = $category_id;
        } else {
            // 受信箱データ取得
            $temp_data = $folder_logic->getSpecialFolderData($key,
                GRN_MAIL_FOLDER_CODE_INBOX, false);
            $temp_cid = $temp_data['id'];
        }

        $folder_list_for_view['data'][] = ['aid' => $key, 'cid' => $temp_cid];
    }

    $folder_list_for_view['selected'] = $account_id;
}

//------------------

$no_setting = '0';
$account_data_count = count($account_list_for_view);
if (count($account_list_for_view) == 0) {
    // サーバー設定数を取得する
    $system_config = $utility->getSystemConfig();
    $server_data_count = $system_config->getServerDataCount();
    if (($account_data_count == 0) && ($server_data_count == 0)) {
        $no_setting = '3';
    } elseif ($account_data_count == 0) {
        $no_setting = '2';
    } elseif ($server_data_count == 0) {
        $no_setting = '1';
    }
}

// 0はOK、1はメールサーバーがまだ 2はアカウントがまだ 3は両方まだ
$t->assign('no_setting', $no_setting);

//------------------
// account_data
$t->assign('user_account', $account_list_for_view);

// folder_select_data
$t->assign('folder_list', $folder_list_for_view);


