<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

// get parameters from URL parameters
global $G_INPUT;
global $G_container_base;
$org_id = @ $G_INPUT['oid'];
$t->assign('org_id', $org_id);
$user_id = @ $G_INPUT['uid'];
$uum = $G_container_base->getInstance('uum');
$user = $uum->getUser($user_id);


// ユーザー情報
$user_for_view = [];
if (is_object($user)) {
    $user_for_view['uid'] = $user->getOID();
    $user_for_view['name'] = $user->get('display_name');
}

$t->assign('app_name', $G_mail_name);

//------------------

// get parameters from URL parameters
$user_id = @ $G_INPUT['uid'];
$account_id = @ $G_INPUT['aid'];

//------------------

// アカウントデータ取得
require_once('mail/system_config.csp');
$system_config = GRN_Mail_SystemConfig::getInstance();

$email = '';
$title = '';
$account_data = $system_config->getAccountData($account_id, true, true);
if ( ! is_null($account_data)) {
    $title = $account_data['title'];
    $account_info = $account_data['account_info'];
    if ( ! is_null($account_info)) {
        $email = $account_info->email;
    }
}

//------------------

// user_data
$t->assign('user', $user_for_view);

// account_data
$t->assign(
    'set', [
        'aid'   => $account_id,
        'title' => $title,
        'email' => $email
    ]
);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'mail/system/user_account',
            'name' => grn_get_page_display_name('mail/system/user_account'),
            'oid'  => $org_id,
        ],
        [
            'page' => 'mail/system/user_account_list',
            'name' => grn_get_page_display_name('mail/system/user_account_list'),
            'oid'  => $org_id,
            'uid'  => $user_id
        ],
        [
            'page' => 'mail/system/user_account_view',
            'name' => grn_get_page_display_name('mail/system/user_account_view'),
            'oid'  => $org_id,
            'uid'  => $user_id,
            'aid'  => $account_id,
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

//-- show page
$t->display(cb_get_pagename() . ".tpl");

