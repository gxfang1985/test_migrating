<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;
$doc_name = cb_get_pagename();

// get parameters from URL parameters
global $G_INPUT;
global $G_container_base;
$user_id = @ $G_INPUT['uid'];
$org_id = @ $G_INPUT['oid'];
$t->assign('org_id', $org_id);
$uum = $G_container_base->getInstance('uum');
$user = $uum->getUser($user_id);
if ( ! is_object($user)) {
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}

//------------------
require_once('mail/system_config.csp');

// アカウントデータリスト
$system_config = GRN_Mail_SystemConfig::getInstance();
$account_list = $system_config->getAccountDataList($user, false);

$account_list_for_view = [];
if (is_array($account_list)) {
    foreach (array_keys($account_list) as $key) {
        $account_data =& $account_list[$key];
        $account_list_for_view[$key] = $account_data['title'];
    }
}

// ユーザー情報
$user_for_view = [
    'uid'  => $user->getOID(),
    'name' => $user->get('display_name')
];

//------------------

// mailservers
$t->assign('mailaccounts', $account_list_for_view);

$t->assign('user', $user_for_view);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'mail/system/user_account',
            'name' => grn_get_page_display_name('mail/system/user_account')
        ],
        [
            'page' => 'mail/system/user_account_list',
            'name' => grn_get_page_display_name('mail/system/user_account_list'),
            'uid'  => $user_id
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

// Smarty実行
$t->display("{$doc_name}.tpl");


