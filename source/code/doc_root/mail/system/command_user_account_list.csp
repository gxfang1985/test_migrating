<?php

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    $org_id = @ $G_INPUT['oid'];
    $user_id = @ $G_INPUT['uid'];
    $command = @ $G_INPUT['cmd'];

    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getUser($user_id);
    if ( ! $user) {
        cb_throw_error(E_GRN_USER_NOT_FOUND);
    }

    // チェックした項目
    $account_ids = $G_INPUT['ids'];

    if (is_array($account_ids) && (count($account_ids) > 0)) {
        if ($command == 'restart') {
            // アカウント再開
            require_once('mail/system_config.csp');
            $system_config = GRN_Mail_SystemConfig::getInstance();
            $system_config->enableAccountDatas($account_ids);

            cb_redirect('mail/system/user_account_list',
                ['oid' => $org_id, 'uid' => $user_id, 'sf' => 1]);
        } else {
            require_once('fw/session_manager.csp');
            $sm = CB_SessionManager::getInstance();
            $session = $sm->getSession('mail/system/user_account_list');

            // セッションに処理する対象のアカウントデータIDリストを保存
            $session->set('account_ids', $account_ids);

            if ($command == 'delete') {
                // アカウント削除
                cb_redirect('mail/system/user_account_delete_multi',
                    ['oid' => $org_id, 'uid' => $user_id]);
            } elseif ($command == 'stop') {
                // アカウント停止
                cb_redirect('mail/system/user_account_stop_multi',
                    ['oid' => $org_id, 'uid' => $user_id]);
            }
        }
    }
}

cb_redirect('mail/system/user_account_list',
    ['org' => $org_id, 'uid' => $user_id, 'sf' => 1]);


