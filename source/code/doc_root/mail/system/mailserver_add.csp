<?php

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;
$doc_name = cb_get_pagename();

//------------------

// SmartyValidate should be initialized when an input form is there.
require('SmartyValidate.class.php');
SmartyValidate::connect($t);
SmartyValidate::register_form($doc_name, true);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

include('_mailserver_add.csp');

//------------------

// サーバー設定
$t->assign('set', $set);

// select_data
$t->assign(
    'select1', [
        'name'     => 'pop_before_smtp_wait',
        'options'  => [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
        'selected' => $set['pop_before_smtp_wait']
    ]
);


$t->assign(
    'select2', [
        'name'     => 'smtp_timeout',
        'options'  => [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120],
        'selected' => 10
    ]
);

$t->assign(
    'select3', [
        'name'     => 'retrieve_timeout',
        'options'  => [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120],
        'selected' => 10
    ]
);

//received_protocol
$t->assign(
    'received_protocol', [
        [
            'value'    => 'POP3',
            'label'    => 'POP3',
            'selected' => $set['received_protocol'] == 'POP3'
        ],
        [
            'value'    => 'IMAP4',
            'label'    => 'IMAP4',
            'selected' => $set['received_protocol'] == 'IMAP4'
        ],
    ]
);

//smtp_auth
$t->assign(
    'smtp_auth', [
        [
            'value'    => 'NONE',
            'label'    => cb_msg('grn.mail.lang', 'unused'),
            'selected' => $set['smtp_auth'] == 'NONE'
        ],
        [
            'value'    => 'PLAIN',
            'label'    => 'PLAIN',
            'selected' => $set['smtp_auth'] == 'PLAIN'
        ],
        [
            'value'    => 'LOGIN',
            'label'    => 'LOGIN',
            'selected' => $set['smtp_auth'] == 'LOGIN'
        ],
        [
            'value'    => 'CRAM-MD5',
            'label'    => 'CRAM-MD5',
            'selected' => $set['smtp_auth'] == 'CRAM-MD5'
        ],
        [
            'value'    => 'DIGEST-MD5',
            'label'    => 'DIGEST-MD5',
            'selected' => $set['smtp_auth'] == 'DIGEST-MD5'
        ],
    ]
);

$t->assign(
    'encrypted_connection', [
        ['value' => 'NONE', 'label' => cb_msg('grn.mail.system', 'none')],
        [
            'value'    => 'SSL',
            'label'    => cb_msg('grn.mail.system', 'use_ssl'),
            'selected' => $use_SSL
        ],
        [
            'value'    => 'TLS',
            'label'    => cb_msg('grn.mail.system', 'use_tls'),
            'selected' => $use_TLS
        ],
    ]
);

//------------------

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'mail/system/mailserver',
            'name' => grn_get_page_display_name('mail/system/mailserver')
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

// Smarty実行
$t->display("{$doc_name}.tpl");

