<?php
// get parameters from URL parameters
$mailserver_id = @ $G_INPUT['msid'];

if ( ! is_null($mailserver_id)) {
    // メールサーバーの設定を取得
    require_once('mail/system_config.csp');
    $system_config = GRN_Mail_SystemConfig::getInstance();
    $server_data = $system_config->getServerData($mailserver_id);
    $server_info = $server_data['server_info'];

    $set = [
        'msid'                 => $mailserver_id,
        'foreign_key'          => $server_data['foreign_key'],
        'title'                => $server_data['name'],
        'smtp_server'          => $server_info->smtp,
        'smtp_auth'            => $server_info->smtp_auth,
        'smtp_port'            => $server_info->smtp_port,
        'smtp_ssl'             => $server_info->smtp_ssl,
        'smtp_tls'             => $server_info->smtp_tls,
        'smtp_account_set'     => $server_info->smtp_set_account,
        'is_pop_before_smtp'   => $server_info->pop_before_smtp,
        'pop_before_smtp_wait' => $server_info->pbsmtp_wait_sec,
        'received_server'      => $server_info->retrieve,
        'received_protocol'    => $server_info->retrieve_protocol,
        'received_port'        => $server_info->retrieve_port,
        'received_ssl'         => $server_info->retrieve_ssl,
        'apop'                 => ($server_info->retrieve_auth == 'APOP') ? 1
            : 0,
        'smtp_timeout'         => $server_info->getSmtpTimeoutTime(),
        'retrieve_timeout'     => $server_info->getRetrieveTimeoutTime()
    ];

} else {
    // デフォルト
    $set = [
        'smtp_server'          => '',
        'smtp_auth'            => 'NONE',
        'smtp_port'            => 25,
        'smtp_account_set'     => false,
        'is_pop_before_smtp'   => 0,
        'pop_before_smtp_wait' => 0,
        'received_protocol'    => 'POP3',
        'received_port'        => 110,
        'apop'                 => 0,
        'smtp_timeout'         => GRN_MAIL_SMTP_CONNECTION_TIMEOUT,
        'retrieve_timeout'     => GRN_MAIL_RETRIEVE_CONNECTION_TIMEOUT
    ];
}

//type of encrypted connection
$use_SSL = false;
$use_TLS = false;
if (array_key_exists('smtp_ssl', $set) && $set['smtp_ssl']) {
    $use_SSL = true;
}
if (array_key_exists('smtp_tls', $set) && $set['smtp_tls']) {
    $use_TLS = true;
}
