<?php

global $t;
global $G_INPUT;
$set =& $t->get_template_vars('set');
if ( ! isset($set) || is_null($set)) {
    $set = [];
}

$set['msid'] = @ $G_INPUT['msid'];
$set['foreign_key'] = @ $G_INPUT['foreign_key'];
$set['title'] = @ $G_INPUT['title'];
$set['smtp_server'] = @ $G_INPUT['smtp_server'];
$set['smtp_auth'] = @ $G_INPUT['smtp_auth'];
if (is_null($set['smtp_auth'])) {
    $set['smtp_auth'] = 'NONE';
}
$set['smtp_port'] = @ $G_INPUT['smtp_port'];
$set['smtp_account_set'] = @ $G_INPUT['smtp_account_set'];
$set['is_pop_before_smtp'] = @ $G_INPUT['is_pop_before_smtp'];
if (is_null($set['is_pop_before_smtp'])) {
    $set['is_pop_before_smtp'] = 0;
}
$set['pop_before_smtp_wait'] = @ $G_INPUT['pop_before_smtp_wait'];
if (is_null($set['pop_before_smtp_wait'])) {
    $set['pop_before_smtp_wait'] = 0;
}
$set['received_server'] = @ $G_INPUT['received_server'];
$set['received_protocol'] = @ $G_INPUT['received_protocol'];
if (is_null($set['received_protocol'])) {
    $set['received_protocol'] = 'POP3';
}
$set['received_port'] = @ $G_INPUT['received_port'];
$set['apop'] = @ $G_INPUT['apop'];
if (is_null($set['apop'])) {
    $set['apop'] = 0;
}

$set['smtp_timeout'] = intval(@ $G_INPUT['smtp_timeout']);
$set['retrieve_timeout'] = intval(@ $G_INPUT['retrieve_timeout']);

//------------------

$t->assign('set', $set);

if (cb_at($G_INPUT, 'encrypted_connection')) {
    switch ($G_INPUT['encrypted_connection']) {
        case 'SSL':
            $use_SSL = true;
            $use_TLS = false;
            break;
        case 'TLS':
            $use_TLS = true;
            $use_SSL = false;
            break;
        default:
            $use_TLS = false;
            $use_SSL = false;
    }
}

// select_data
$t->assign(
    'select1', [
        'name'     => 'pop_before_smtp_wait',
        'options'  => [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
        'selected' => $set['pop_before_smtp_wait']
    ]
);

$t->assign(
    'select2', [
        'name'     => 'smtp_timeout',
        'options'  => [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120],
        'selected' => $set['smtp_timeout']
    ]
);

$t->assign(
    'select3', [
        'name'     => 'retrieve_timeout',
        'options'  => [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120],
        'selected' => $set['retrieve_timeout']
    ]
);

//received_protocol
$t->assign(
    'received_protocol', [
        [
            'value'    => 'POP3',
            'label'    => 'POP3',
            'selected' => $set['received_protocol'] == 'POP3'
        ],
        [
            'value'    => 'IMAP4',
            'label'    => 'IMAP4',
            'selected' => $set['received_protocol'] == 'IMAP4'
        ],
    ]
);

//smtp_auth
$t->assign(
    'smtp_auth', [
        [
            'value'    => 'NONE',
            'label'    => cb_msg('grn.mail.lang', 'unused'),
            'selected' => $set['smtp_auth'] == 'NONE'
        ],
        [
            'value'    => 'PLAIN',
            'label'    => 'PLAIN',
            'selected' => $set['smtp_auth'] == 'PLAIN'
        ],
        [
            'value'    => 'LOGIN',
            'label'    => 'LOGIN',
            'selected' => $set['smtp_auth'] == 'LOGIN'
        ],
        [
            'value'    => 'CRAM-MD5',
            'label'    => 'CRAM-MD5',
            'selected' => $set['smtp_auth'] == 'CRAM-MD5'
        ],
        [
            'value'    => 'DIGEST-MD5',
            'label'    => 'DIGEST-MD5',
            'selected' => $set['smtp_auth'] == 'DIGEST-MD5'
        ],
    ]
);


