<?php

//-- instantiate Smarty object
require_once("grn/smarty.csp");
$t = new GRN_Smarty;
$doc_name = cb_get_pagename();

//-- get parameters from URL parameters
global $G_container_base;
$org_id = @ $G_INPUT['oid'];
$t->assign('org_id', $org_id);
$user_id = @ $G_INPUT['uid'];
$uum = $G_container_base->getInstance('uum');
$user = $uum->getUser($user_id);
if ( ! is_object($user)) {
    cb_throw_error(E_GRN_USER_NOT_FOUND);
}

//--------------------------------------------------------------

include('_user_account_add.csp');

//--------------------------------------------------------------

$t->assign('user', $user_for_view);

// アカウント設定
$t->assign('set', $set);

// mail_server
$t->assign('mail_server', $mail_servers);

//--------------------------------------------------------------
require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$system_config = $utility->getSystemConfig();

// ユーザー権限取得
$system_config->getUserPrivilegeSetting($settings);


//--------------------------------------------------------------

// ユーザー権限
$t->assign(
    'system', [
        'user_account_modify' => $settings['modify_account'],
        'user_mail_check'     => $settings['check_mails']
    ]
);


//--------------------------------------------------------------

// Smartyにページタイトルを割り当てる
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

require_once('grn/controller.csp');

// site position
$t->assign(
    'site_position', [
        [
            'page' => 'mail/system/user_account',
            'name' => grn_get_page_display_name('mail/system/user_account'),
            'oid'  => $org_id,
        ],
        [
            'page' => 'mail/system/user_account_list',
            'name' => grn_get_page_display_name('mail/system/user_account_list'),
            'oid'  => $org_id,
            'uid'  => $user_for_view['uid']
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

$t->display(cb_get_pagename() . '.tpl');

