<?php

if (array_key_exists('REQUEST_METHOD', $_SERVER)
    && 0 == strcasecmp($_SERVER['REQUEST_METHOD'], 'POST')
) {
    $account_id = array_key_exists('aid', $G_INPUT) ? $G_INPUT['aid'] : '';
    $category_id = array_key_exists('cid', $G_INPUT) ? $G_INPUT['cid'] : '';
    $mail_id = array_key_exists('mid', $G_INPUT) ? $G_INPUT['mid'] : '';
    $status_id = array_key_exists('status', $G_INPUT) ? $G_INPUT['status']
        : '';

    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();
    if ( ! is_object($user)) {
        cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
    }

    require_once('mail/status.csp');
    grn_mail_set_status($user, $mail_id, $status_id);

    cb_redirect('mail/view',
        ['aid' => $account_id, 'cid' => $category_id, 'mid' => $mail_id,]);
}


