<?php
$temp_mail_id = $send_logic->savePreviewMail($user, $account_id, $properties,
    $files, null, null, $action);
$temp_mail_data = $mail_logic->getTemporaryMailData($temp_mail_id, true);
$is_html = strlen($temp_mail_data['html_data']) > 0;
$data = "";
if ($is_html) {
    require_once('grn/word_util.csp');
    $fold_words = new GRN_FoldWords;
    $fold_words->setLineWidth(GRN_MAIL_LINE_WIDTH);
    $fold_words->setExtendNum(0);
    $fold_words->setShortenNum(0);
    $data = $temp_mail_data['html_data'];
    $sign_data = $temp_mail_data['sign_data'];
    $sign_position = $position;
    if (is_string($sign_data) && 0 < strlen($sign_data) && 0 < strlen($data)) {
        $ret = [];
        GRN_Mail_Utility::insertSignData($data, $sign_data, [
            'action'       => $temp_mail_data['action'],
            'position'     => $sign_position,
            'original_mid' => $origin_mid
        ], $ret, $utility);
        $data = $ret['data'];
    }
}
