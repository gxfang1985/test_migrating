<?php
global $G_INPUT;
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();
if ( ! is_object($user)) {
    cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
}

require_once('mail/table.csp');
require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$mail_logic = $utility->getMailLogic();

//------------------

$mail_id = @ $G_INPUT['mid'];
$source_data =& $mail_logic->getMailSourceData($mail_id);

if ( ! is_null($source_data)) {
    cb_prepare_download('source.txt', 'text/plain', true);
    echo $source_data;
}

cb_safe_exit();

