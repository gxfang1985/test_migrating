<?php

global $G_INPUT;
$account_id = @ $G_INPUT['aid'];
$category_id = @ $G_INPUT['cid'];

if (0 == strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST')) {
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $user = $uum->getLoginUser();
    if ( ! is_object($user)) {
        cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
    }

    $uids = @ $G_INPUT['uids'];
    if (is_array($uids) && (count($uids) > 0)) {
        require_once('mail/utility.csp');
        $utility = GRN_Mail_Utility::getInstance();
        $recv_logic = $utility->getRecvLogic();

        // メールサーバーからメールデータを削除
        $new_mails = $recv_logic->deletePop3ErrorMails($account_id, $uids);
        if (($new_mails !== false) && ($new_mails > 0)) {
            cb_redirect('mail/cannot_receive',
                ['aid' => $account_id, 'cid' => $category_id]);
        }
    }
}

cb_redirect('mail/index', ['aid' => $account_id, 'cid' => $category_id]);


