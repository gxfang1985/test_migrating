<?php

assert('is_object( $folder_logic )');

$folder_data = null;
// フォルダ情報
if (is_null($category_id) || (strlen($category_id) == 0)) {
    if (isset($account_id) && ! is_null($account_id)
        && (strlen($account_id) >= 0)
    ) {
        // 受信箱
        $folder_data = $folder_logic->getSpecialFolderData($account_id,
            GRN_MAIL_FOLDER_CODE_INBOX,
            isset($folder_detail) && $folder_detail);
        $category_id = $folder_data['id'];
    }
} else {
    // 指定されたフォルダ
    $folder_data = $folder_logic->getFolderData($category_id,
        isset($folder_detail) && $folder_detail, true);
}

if ( ! is_null($folder_data)
     && ( ! isset($account_id) || is_null($account_id)
          || (strlen($account_id) == 0))
) {
    $account_id = $folder_data['account_id'];
}

if ( ! is_array($folder_data) || ! array_key_exists('account_id', $folder_data)
     || is_null($folder_data['account_id'])
     || (isset($account_id) && ! is_null($account_id)
         && ($folder_data['account_id'] != $account_id))
) {
    // フォルダがない、またはアカウントが異なる
    cb_throw_error(E_GRN_MAIL_FOLDER_DATA_NOT_FOUND);
}

// 指定されたフォルダがルートだったら受信箱に変更する
if ($folder_data['code'] == GRN_MAIL_FOLDER_CODE_ROOT) {
    // 受信箱
    $folder_data = $folder_logic->getSpecialFolderData($account_id,
        GRN_MAIL_FOLDER_CODE_INBOX, isset($folder_detail) && $folder_detail);
    $category_id = $folder_data['id'];
}

// アカウントIDをフォルダから逆引き
if ( ! isset($account_id) || is_null($account_id)
     || (strlen($account_id) == 0)
) {
    $account_id = $folder_data['account_id'];
}

$page_index = 'mail/index';
$page_root = 'mail/root';
$page_inbox = 'mail/inbox';
$page_outbox = 'mail/outbox';
$page_draftbox = 'mail/draftbox';
$page_garbagebox = 'mail/garbagebox';
$page_category_list = 'mail/category_list';

$folder_code = is_array($folder_data) ? $folder_data['code'] : '';

switch ($folder_code) {
    case GRN_MAIL_FOLDER_CODE_ROOT:
        $folder_type = '0';
        $page_folder = grn_get_page_display_name($page_root);
        break;
    case GRN_MAIL_FOLDER_CODE_INBOX:
        $folder_type = '1';
        $page_folder = grn_get_page_display_name($page_inbox);
        break;
    case GRN_MAIL_FOLDER_CODE_SENTBOX:
        $folder_type = '2';
        $page_folder = grn_get_page_display_name($page_outbox);
        break;
    case GRN_MAIL_FOLDER_CODE_UNSENT:
        $folder_type = '3';
        $page_folder = grn_get_page_display_name($page_draftbox);
        break;
    case GRN_MAIL_FOLDER_CODE_TRASH:
        $folder_type = '4';
        $page_folder = grn_get_page_display_name($page_garbagebox);
        break;
    default:
        $folder_type = '5';
        $page_folder = grn_get_page_display_name($page_category_list);
        break;
}

$category_for_view = [];
$category_for_view['type'] = $folder_type;
$category_for_view['title'] = $page_folder;
$category_for_view['aid'] = $account_id;
$category_for_view['cid'] = $category_id;
$category_for_view['parent_id'] = $folder_data['parent_id'];
$category_for_view['subscribed'] = $folder_data['subscribed'];


if (isset($folder_detail) && $folder_detail) {
    $category_for_view['memo'] = $folder_data['memo'];
}


