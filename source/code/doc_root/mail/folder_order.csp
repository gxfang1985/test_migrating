<?php
global $G_INPUT;
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();
if ( ! is_object($user)) {
    cb_throw_error(E_COMMON_AUTHENTICATION_FAILED);
}

// Smarty をインスタンス化
require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once('mail/table.csp');
require_once('mail/utility.csp');
$utility = GRN_Mail_Utility::getInstance();
$personal_config = $utility->getPersonalConfig($user);
$folder_logic = $utility->getFolderLogic();

//------------------

// フォルダ情報
$folder_detail = true;

include('_folder_add.csp');

if (strlen($folder_code) > 0) {
    $mail_app = $utility->getMailApp();
    $category_for_view['title'] = cb_msg($mail_app->getModuleId(),
        $folder_code);
} else {
    $category_for_view['title'] = $folder_data['name'];
}
$category_for_view['is_subscribed'] = '1';


//------------------

// サブフォルダデータリスト
$category_list_for_view = [];
$category_list = $folder_logic->getFolderDataList($account_id,
    $folder_data['parent_id'], false);
if (is_array($category_list)) {
    foreach (array_keys($category_list) as $key) {
        $temp_data =& $category_list[$key];
        if ( ! isset($temp_data['code']) || (strlen($temp_data['code']) == 0)) {
            $category_list_for_view[$key] = $temp_data['name'];
        }
    }
}

//--------------------------------------------------------------

// categorys
$t->assign('categorys', $category_list_for_view);

// folder properties
$t->assign('category', $category_for_view);

// page title
$page_title = grn_get_current_page_display_name();
$t->assign('page_title', $page_title);

$t->assign(
    'site_position',
    [
        $utility->getIndexSitePosition($user, $account_id),
        [
            'page' => $page_index,
            'name' => $page_folder,
            'aid'  => $account_id,
            'cid'  => $category_id
        ],
        [
            'page' => '',
            'name' => $page_title
        ]
    ]
);

// Smarty実行
$doc_name = cb_get_pagename();
$t->display("{$doc_name}.tpl");

