<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once('cabinet/controller.csp');
$utility = new GRN_Cabinet_ControllerUtil();

//表示するものは、閲覧権限があるものを表示
$hierarchy_access = GRN_CABINET_ACCESS_R;
$folder_privileges = null;

// 管理権限を持っていれば管理権限もチェックして階層を表示
require_once('cabinet/privilege.csp');
$pm = GRN_Cabinet_PrivilegeManager::getInstance();
$hid = @$G_INPUT['hid'];
$s_hid = @$G_INPUT['s_hid'];
// 選択されたフォルダに運用権限があるかどうか
$b_privileges = $pm->privileged($G_cabinet_login, $s_hid, ['operation']);
unset($pm);

require_once('_move.csp');

// GRN35-209
if (@$G_INPUT['hid']) {
    if ( ! ($folder = $G_cabinet->getFolder($G_cabinet_login,
        $G_INPUT['hid']))
    ) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }
    $utility->prepareMakeSitePosition($t, @$G_INPUT['hid'], @$G_INPUT['fid']);
} else {
    $page_path = [
        'cabinet/index' => ['hid' => @$G_INPUT['hid']],
        'cabinet/view'  => [
            'hid' => @$G_INPUT['hid'],
            'fid' => @$G_INPUT['fid']
        ],
    ];

    $utility->setSitePosition($t, $page_path);
}
// GRN35-209

$t->display(cb_get_pagename() . ".tpl");

