<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    require_once('../_access_util.csp');

    $security_model = @ $G_INPUT['security_model'];

    //--check
    if ($security_model != 'revoke' && $security_model != 'grant') {
        cb_throw_error(E_GRN_CABINET_ACCESS_INVALID_SECURITY_MODEL);
    }

    // access information
    require_once('cabinet/access.csp');
    $am = GRN_Cabinet_AccessManager::getInstance();
    $am->setSecurityModel($node_row,
        $security_model == 'revoke' ? GRN_CABINET_SECURITY_MODEL_REVOKE
            : GRN_CABINET_SECURITY_MODEL_GRANT);

    $pages = explode('/', cb_get_pagename());
    if (count($pages) > 1) {
        $pages[count($pages) - 1] = 'access_list';

        require_once('fw/session_manager.csp');
        $session_manager = CB_SessionManager::getInstance();
        $session =& $session_manager->getSession(implode('.', $pages));
        $session->set('authorities', null);
    }
}

