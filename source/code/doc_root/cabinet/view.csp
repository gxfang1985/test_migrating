<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;

require_once('cabinet/controller.csp');
$utility = new GRN_Cabinet_ControllerUtil();

require_once('_view.csp');

//GRN2-4315
if (isset($file_for_view['navi']) && isset($file_for_view['navi']['navi'])
    && isset($file_for_view['navi']['navi']['params'])
    && isset($file_for_view['navi']['navi']['params']['hid'])
) {
    $utility->prepareMakeSitePosition($t,
        $file_for_view['navi']['navi']['params']['hid']);
} //GRN2-4315
elseif (@$G_INPUT['hid']) {
    $utility->prepareMakeSitePosition($t, @$G_INPUT['hid']);
} else {
    $page_path = [
        'cabinet/index' => ['hid' => @$G_INPUT['hid']]
    ];
    $utility->setSitePosition($t, $page_path);
}

if (isset($file_for_view['title']) && mb_strlen($file_for_view['title']) > 0) {
    $t->assign('page_title', $file_for_view['title']);
} else {
    if (isset($file_for_view['filename'])) {
        $t->assign('page_title', $file_for_view['filename']);
    }
}
$delete_info = [
    'title'      => grn_get_page_display_name('cabinet/delete'),
    'page'       => 'cabinet/delete.tpl',
    'no_confirm' => false,
    'data'       => [
        'file'      => $file_for_view,
        'folder_id' => $folder_id
    ],
    'handler'    => 'lnk_delete'
];
$t->assign('delete_info', $delete_info);

$lock_info = [
    'title'      => grn_get_page_display_name('cabinet/lock'),
    'page'       => 'cabinet/lock.tpl',
    'no_confirm' => true,
    'data'       => [
        'linkparams' => ['hid' => $folder_id],
        'folder_id'  => $folder_id,
        'file_id'    => $file_id,
        'file'       => $file_for_view,
    ],
    'handler'    => 'btn_lock'
];
$t->assign('lock_info', $lock_info);
require_once('star/logic.csp');
$star_logic = GRN_Star_StarLogic::getInstance();
$use_star = $star_logic->isActive();
$t->assign('use_star', $use_star);
global $G_container_base;
$uum =& $G_container_base->getInstance('uum');
$user =& $uum->getLoginUser();
$t->assign('star_infos',
    $star_logic->getStatusByIDs($user, 'grn.cabinet', [$file_id]));
$t->display(cb_get_pagename() . ".tpl");

