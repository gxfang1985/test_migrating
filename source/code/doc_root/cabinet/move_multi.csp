<?php

global $G_INPUT;

require_once("grn/smarty.csp");
$t = new GRN_Smarty;


if ( ! ($folder_id = @ $G_INPUT['hid'])) {
    cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
}

require_once('cabinet/controller.csp');
$utility = new GRN_Cabinet_ControllerUtil('cabinet/index');

$session = $utility->getSession();
$eid = $session->get('eid');

$utility = new GRN_Cabinet_ControllerUtil();
$session = $utility->getSession();

if ( ! $eid) {
    $eid = $session->get('eid');
} else {
    $session->set('eid', $eid);
}
$t->assign('move_numbers', count($eid));

// GRN35-209
if (@$G_INPUT['hid']) {
    $utility->prepareMakeSitePosition($t, @$G_INPUT['hid']);
} else {
    $page_path = [
        'cabinet/index' => ['hid' => @$G_INPUT['hid']]
    ];
    $utility->setSitePosition($t, $page_path);
}
// GRN35-209

$hierarchy_access = GRN_CABINET_ACCESS_R;
$folder_privileges = null;

// 管理権限を持っていれば管理権限もチェックして階層を表示
require_once('cabinet/privilege.csp');
$pm = GRN_Cabinet_PrivilegeManager::getInstance();
$hid = @$G_INPUT['hid'];
$s_hid = @$G_INPUT['s_hid'];
// 選択されたフォルダに運用権限があるかどうか
$b_privileges = $pm->privileged($G_cabinet_login, $s_hid, ['operation']);
unset($pm);

require_once('_move_multi.csp');

$t->display(cb_get_pagename() . ".tpl");

