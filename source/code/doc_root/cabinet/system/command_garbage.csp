<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    if ( ! array_key_exists('hid', $G_INPUT)) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }
    $folder_id = $G_INPUT['hid'];

    if ( ! array_key_exists('eid', $G_INPUT) || ! is_array($G_INPUT['eid'])) {
        cb_redirect('cabinet/system/folder_list', ['hid' => $folder_id]);
    }

    require_once('cabinet/controller.csp');
    $utility = new GRN_Cabinet_ControllerUtil('cabinet/system/folder_list');

    $session =& $utility->getSession();

    $session->set('eid', $G_INPUT['eid']);

    if (@$G_INPUT['cmd'] == 'force_delete') {
        cb_redirect('cabinet/system/delete_multi_completely',
            ['hid' => $folder_id]);
    } elseif (@$G_INPUT['cmd'] == 'restore') {
        if (($eid = @ $G_INPUT['eid'])) {
            foreach ($eid as $fid) {
                $G_cabinet->restoreFileFromTrash($G_cabinet_login, $fid);
            }
            cb_redirect('cabinet/system/garbage', ['hid' => $folder_id]);
        }
    }
}

