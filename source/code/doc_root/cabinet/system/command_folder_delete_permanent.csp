<?php

if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;

    if ( ! array_key_exists('hid', $G_INPUT)) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }
    $folder_id = $G_INPUT['hid'];

    if ( ! ($folder =& $G_cabinet->getFolder($G_cabinet_login, $folder_id))) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }

    $parent_id = $folder->getId('parent');

    if ( ! $folder->deleteFoldersPermanent($G_cabinet_login)) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_EMPTY);
    }

    _cabinet_rebuild_folder_tree($parent_id);

    cb_redirect('cabinet/system/folder_list', ['hid' => @$parent_id]);
}
