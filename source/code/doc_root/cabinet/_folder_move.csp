<?php

global $G_INPUT;

if ( ! isset($t) || ! is_a($t, 'GRN_Smarty')) {
    require_once("grn/smarty.csp");
    $t = new GRN_Smarty;
}

if ( ! isset($folder_id)) {
    if ( ! array_key_exists('hid', $G_INPUT)) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }
    $folder_id = $G_INPUT['hid'];
}

if ( ! ($folder =& $G_cabinet->getFolder($G_cabinet_login, $folder_id))) {
    cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
}

if ( ! isset($set_folder_id)) {
    $set_folder_id = $folder->getId('parent');

    if ( ! $set_folder_id) {
        cb_throw_error(E_GRN_CABINET_CANNOT_MOVE_ROOT);
    }

    if (array_key_exists('s_hid', $G_INPUT) && strlen($G_INPUT['s_hid']) > 0) {
        $set_folder_id = $G_INPUT['s_hid'];
    }
}

$t->assign('folder_id', $folder_id);
$t->assign('set_folder_id', $set_folder_id);


// 移動フォルダ

$target_for_view = [
    'name' => $folder->get('name'),
    'hid'  => $folder->getOID()
];

if (($parent =& $folder->get('parent'))) {
    require_once('cabinet/functions.csp');

    $target_for_view['parent'] = [
        'name' => $parent->get('name'),
        'path' => grn_cabinet_get_folder_path_string($parent),
    ];
}

$t->assign('target', $target_for_view);

if ( ! array_key_exists('ss', $G_INPUT) || ! $G_INPUT['ss']) {
    $ignore_root_folder = $folder->getOID();
    $ignore_folders = [$folder->getOID() => & $folder];
}

require_once('../_folder_select.csp');


