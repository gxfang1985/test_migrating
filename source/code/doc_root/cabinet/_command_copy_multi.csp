<?php
if (strcasecmp(@ $_SERVER['REQUEST_METHOD'], 'POST') == 0) {
    global $G_INPUT;
    if ( ! array_key_exists('hid', $G_INPUT) || strlen($G_INPUT['hid']) < 1) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }
    $hid = $G_INPUT['hid'];

    if ( ! array_key_exists('ids', $G_INPUT)) {
        cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
    }
    $target_ids = $G_INPUT['ids'];

    $page_parts = explode('/', cb_get_pagename());
    $is_system = (@$page_parts[1] === 'system');
    foreach ($target_ids as $id) {
        global $G_cabinet, $G_cabinet_login;
        if ( ! ($folder = $G_cabinet->getFolder($G_cabinet_login, $id))) {
            cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
        }
        if ( ! $is_system) {
            $folder->privileged($G_cabinet_login, ['operation'], true);
        }
    }

    if ($classification == "access") {
        require_once('cabinet/access.csp');
        $manager = GRN_Cabinet_AccessManager::getInstance();
        $manager->copyAccess($hid, $target_ids);
    } elseif ($classification == "notify") {
        require_once('cabinet/notification.csp');
        $manager = GRN_Cabinet_NotificationManager::getInstance();
        $manager->copyNotification($hid, $target_ids);
    }
}
