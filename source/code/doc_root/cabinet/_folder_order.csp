<?php

global $G_INPUT;

if ( ! array_key_exists('hid', $G_INPUT)) {
    cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
}
$folder_id = $G_INPUT['hid'];

if ( ! ($folder = $G_cabinet->getFolder($G_cabinet_login, $folder_id))) {
    cb_throw_error(E_GRN_CABINET_FOLDER_NOT_FOUND);
}
$t->assign('folder_id', $folder_id);


// フォルダオブジェクトの取得

$folder_for_view = [];

$folder_for_view['hid'] = $folder->getOID();
$folder_for_view['name'] = $folder->get('name');

$children = $folder->getFolders($G_cabinet_login);

if (count($children) > 0) {
    $children_for_view = [];
    foreach (array_keys($children) as $hid) {
        $child = $children[$hid];
        $children_for_view[$hid] = $child->get('name');
    }

    $folder_for_view['children'] = $children_for_view;
}

$folder_for_view['child_count'] = count($children);

$t->assign('folder', $folder_for_view);


