<?php

cb_require_role('CommandLine');

require_once('fw/date.csp');

$args = [];

//format check
for ($i = 1; $i < $argc; $i++) {
    if (preg_match("#^--period=[']?([0-9]*)[']?$#", $argv[$i], $regs)
        && is_numeric($regs[1])
    ) {
        $args['period'] = $regs[1];
    } elseif (preg_match("#^--message=[']?((\\\'|[^'])*)[']?$#", $argv[$i],
        $regs)
    ) {
        $args['message'] = $regs[1];
    } else {
        echo "Usage: ${argv[0]} [--period='minutes'] [--message='message']\n";
        exit(1);
    }
}

//validation and conversion
require_once('fw/date.csp');
$start = new CB_TimeStampEx();
$args['start'] = $start->getDateTime();
if (array_key_exists('period', $args)) {
    $args['end'] = new CB_DateTimeEx($args['start']);
    $timespan = new CB_DateTimeSpan($args['period'] * 60);
    $args['end']->add($timespan);
}

require_once('fw/backupmode.csp');
cb_set_backupmode($args);


