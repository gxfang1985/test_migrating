<?php

namespace grn\system\screen\user\sandbox;


use grn\system\sandbox\SandboxSchedulingEvent;

class IndexExist
{
    /**
     *
     * @param \GRN_Smarty $t
     */
    public function assign(\GRN_Smarty $t)
    {

        $this->assignPresetEvent($t);
        $t->assign('delete_sandbox_info', [
            'title'       => grn_get_page_display_name('system/user/sandbox/delete'),
            'page'        => 'system/user/sandbox/delete.tpl',
            'handler'     => ['delete_sand_box_grn'],
            'form_target' => 'system/user/sandbox/index'
        ]);
        $t->display('system/user/sandbox/index_exist.tpl');
    }

    /**
     * @param \GRN_Smarty $t
     */
    private function assignPresetEvent(\GRN_Smarty $t)
    {
        $presetEvent = (new SandboxSchedulingEvent())->getPresetEvent();
        $presetExists = $presetEvent instanceof \CB_ScheduleEvent;

        $t->assign('preset_exist', $presetExists);
        if ($presetExists) {
            /** @var \CB_Timestamp $timestamp */
            $timestamp = $presetEvent->get("execution");
            $t->assign('preset_datetime_UTC',
                cb_timestamp_to_datetime($timestamp->unix_ts, "UTC"));
            $t->assign('preset_datetime_current_timezone',
                cb_timestamp_to_datetime($timestamp->unix_ts));
        }
    }

}
