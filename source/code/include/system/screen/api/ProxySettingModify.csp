<?php

namespace grn\system\screen\api;

use grn\grn\customization\bean\Proxy;

class ProxySettingModify extends ProxySettingBase
{
    public function __construct($input)
    {
        parent::__construct($input);
        $this->viewMode = 'modify';
    }

    public function getTemplateName()
    {
        return 'system/api/proxy_form';
    }

    protected function onFetch(\GRN_Smarty $smarty)
    {
        $proxy = $this->getProxySetting();
        $smarty->assign('proxy', $proxy);

        // Method
        $methods = $this->getAvailableProxyMethods();
        foreach ($methods as &$method) {
            if ($method['value'] == $proxy->getMethod()) {
                $method['selected'] = true;
            }
        }

        $smarty->assign('methods', $methods);

        // Status
        $smarty->assign('apply', $proxy->getActive());
        $smarty->assign('not_apply', ! $proxy->getActive());

        // Data for javascript
        $smarty->assign('data_for_js', [
            'url_params' => $proxy->getParams(),
            'headers'    => $proxy->getHeaders(),
            'body'       => $proxy->getBody()
        ]);
    }
}
