<?php

namespace grn\system\screen\api;

use grn\grn\GrnGenericScreenBase;
use grn\grn\customization\logic\ProxySettingLogic;

class ProxyList extends GrnGenericScreenBase
{
    /**
     * @return string
     */
    public function fetch()
    {
        require_once('grn/smarty.csp');
        $t = new \GRN_Smarty();

        // page title
        $page_title = grn_get_current_page_display_name();
        $t->assign('page_title', $page_title);

        // site position
        $t->assign('site_position', [
                ['page' => '', 'name' => $page_title],
            ]
        );

        $proxy_setting_logic = new ProxySettingLogic();
        $proxy_list = $proxy_setting_logic->getAll();

        $t->assign('proxy_list', $proxy_list);
        $t->assign('deletion_info', $this->createDeletionInfo());

        return $t->fetch(cb_get_pagename() . '.tpl');
    }

    private function createDeletionInfo()
    {
        $title
            = grn_get_page_display_name('system/api/proxy_list_setting_multi_delete_confirmation_title');

        return [
            'title'        => $title,
            'page'         => 'system/api/proxy_list_multi_delete.tpl',
            'no_confirm'   => false,
            'data'         => [],
            'handler'      => [
                'btn_delete_multi_top',
                'btn_delete_multi_bottom'
            ],
            'multi_target' => 'proxy_ids[]',
            'form_target'  => 'system/api/proxy_list',
        ];
    }
}
