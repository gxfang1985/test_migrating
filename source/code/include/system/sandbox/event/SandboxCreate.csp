<?php

namespace grn\system\sandbox\event;

use grn\system\sandbox\dao\CbGroupLocalSandboxDAO;
use grn\system\sandbox\dao\CbGroupSandboxDAO;
use grn\system\sandbox\dao\CbUserGroupRelationSandboxDAO;
use grn\system\sandbox\dao\CbUserRoleRelationSandboxDAO;
use grn\system\sandbox\SandboxProfileData;

class SandboxCreate
{
    public function run()
    {
        // check sandbox status
        $profile = SandboxProfileData::getInstance();
        if ($profile->getSandboxCreated() === true) {
            require_once('grn/error_code.csp');
            cb_throw_error(E_GRN_SANDBOX_ALREADY_EXISTS);
        }

        // copy data
        (new CbGroupSandboxDAO())->copyAll();
        (new CbGroupLocalSandboxDAO())->copyAll();
        (new CbUserGroupRelationSandboxDAO())->copyAll();
        (new CbUserRoleRelationSandboxDAO())->copyAll();

        // update flag
        $profile->setSandboxCreated(true);

    }
}
