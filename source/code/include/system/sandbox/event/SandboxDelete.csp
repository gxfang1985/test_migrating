<?php

namespace grn\system\sandbox\event;

use grn\system\sandbox\dao\CbGroupLocalSandboxDAO;
use grn\system\sandbox\dao\CbGroupSandboxDAO;
use grn\system\sandbox\dao\CbUserDiffSandboxDAO;
use grn\system\sandbox\dao\CbUserGroupRelationSandboxDAO;
use grn\system\sandbox\dao\CbUserRoleRelationSandboxDAO;
use grn\system\sandbox\SandboxProfileData;

class SandboxDelete
{
    public function run()
    {

        // check sandbox status
        $profile = SandboxProfileData::getInstance();
        if ($profile->getSandboxCreated() !== true) {
            require_once('grn/error_code.csp');
            cb_throw_error(E_GRN_SANDBOX_DOES_NOT_EXISTS);
        }

        // delete data
        (new CbGroupSandboxDAO())->deleteAll();
        (new CbGroupLocalSandboxDAO())->deleteAll();
        (new CbUserGroupRelationSandboxDAO())->deleteAll();
        (new CbUserRoleRelationSandboxDAO())->deleteAll();
        (new CbUserDiffSandboxDAO())->deleteAll();

        // update flag
        $profile->setSandboxCreated(false);
    }
}
