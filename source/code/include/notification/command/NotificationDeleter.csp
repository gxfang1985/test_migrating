<?php

namespace grn\notification\command;

class NotificationDeleter
{
    static public function deleteOldNotification()
    {
        require_once('grn/notification.csp');
        $service = \GRN_Notification_Service::getInstance();

        // 30days ago
        $time = time() - 30 * 24 * 60 * 60;

        // exclude unread notification of workflow
        require_once('workflow/resources.csp');
        $condition = "(col_module_id <> '" . GRN_WORKFLOW_MODULE_ID
                     . "' OR col_status <> '"
                     . GRN_NOTIFICATION_DATA_STATUS_UNREAD . "')";

        // delete from tab_grn_notification_notify
        $service->deleteAllNotificationData('notify', $time, $condition);
        // delete from tab_grn_notification_history
        $service->deleteAllNotificationData('confirmed', $time);
        // delete from tab_grn_notification_to_me
        $service->deleteAllNotificationData('to_me', $time);
        // delete from tab_grn_notification_to_me_history
        $service->deleteAllNotificationData('to_me_history', $time);
    }
}
