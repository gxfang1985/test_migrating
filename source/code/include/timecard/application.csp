<?php
/**
 * @brief    Timecardアプリケーションクラス
 * @author   Yoshiaki Tanaka
 * @date     2005/03/23
 * @par      Copyright (c) 2004 Cybozu,Inc. All rights reserved .
 * @package  grn.timecard
 */

require_once('grn/application.csp');


/**
 * @package grn.timecard
 */
class GRN_Timecard extends GRN_ApplicationBase
{

    private static $_instance = null;

    /**
     * @return GRN_Timecard
     */
    public static function getInstance()
    {
        if ( ! isset(self::$_instance)) {
            $c = __CLASS__;
            self::$_instance = new $c;
        }

        return self::$_instance;
    }


    function __construct()
    {
        parent::__construct('timecard');
    }


    /**
     * システム設定オブジェクト
     */
    function getSystemConfig()
    {
        require_once('timecard/config.csp');
        $config = GRN_Timecard_SystemConfig::getInstance();

        return $config;
    }


    /**
     * システム設定
     */
    function getSystemConfigArray()
    {
        return [
            'timecard_config' =>
                [
                    [
                        'page' => 'timecard/system/common_set',
                        'icon' => 'general32'
                    ],
                    [
                        'page' => 'timecard/system/timecard_list',
                        'icon' => 'timecard32'
                    ],
                    [
                        'page'  => 'timecard/system/export_cards1',
                        'param' => ['reset' => 1],
                        'icon'  => 'export32'
                    ],
                ],
        ];
    }

    /**
     * 個人設定
     */
    function getPersonalConfigArray()
    {
        return [
            'timecard_config' =>
                [
                    [
                        'page' => 'timecard/personal/export',
                        'icon' => 'export32'
                    ],
                ],
        ];
    }

    /**
     * ポートレット
     *
     * @return array
     */
    function &getPortletList()
    {
        $portlet = [
            'name'             => $this->getName(),
            'type'             => 'grn.timecard.portlet',         //種別
            'version'          => '1.0',                         //バージョン
            'set_template'     => null,
            'command_template' => null,
            'view_template'    => 'timecard/portlet/view.csp'     //表示用テンプレート名
        ];

        $ret = [$portlet];

        return $ret;
    }

    /**
     * @static
     * @return string
     */
    static public function getIPAddress()
    {
        if (defined('ON_FOREST')) {
            require_once('fw/audit_util.csp');
            $auditUtil = CB_AuditUtil::getInstance();

            return $auditUtil->getRemoteAddr();
        } else {
            return $_SERVER['REMOTE_ADDR'];
        }
    }
}
