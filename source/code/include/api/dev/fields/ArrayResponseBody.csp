<?php
declare(strict_types=1);

namespace grn\api\dev\fields;

use grn\api\http\HttpStatus;
use grn\api\http\response\Records;
use grn\api\ResponseEntity;
use grn\api\RestApi;

class ArrayResponseBody extends RestApi
{
    /**
     * @param array $params
     *
     * @return ResponseEntity
     *
     * Usage: api/dev/fields/array_response_body/envelop/3?hoge=123&fuga=456&fields=hoge,fields
     * Expects: {
     *             "envelop": [
     *                            {
     *                                "fields": "hoge,fields",
     *                                "hoge": 123
     *                            },
     *                            {
     *                                "fields": "hoge,fields",
     *                                "hoge": 123
     *                            },
     *                            {
     *                                "fields": "hoge,fields",
     *                                "hoge": 123
     *                            },
     *             ]
     *          }
     */
    public function execute(array $params): ResponseEntity
    {
        $envelop = $params["envelop"];
        $times = $params["times"];
        $result = [$envelop => []];
        for ($i = 0; $i < $times; $i++) {
            $result[$envelop][] = $this->getInput();
        }
        $response_entity
            = new ResponseEntity(new Records($result, $envelop),
            new HttpStatus(HttpStatus::OK));

        return $response_entity;
    }
}
