<?php
declare(strict_types=1);

namespace grn\api\exception\validation;

use grn\api\exception\RestApiException;

class ValidationFailedException extends RestApiException
{
    /**
     * @param string            $error_code
     * @param string|array|NULL $param_name
     * @param array|NULL        $diagnosis
     * @param array|NULL        $additional_cause
     */
    public function __construct(
        $error_code,
        $param_name = null,
        array $diagnosis = null,
        array $additional_cause = null
    ) {
        parent::__construct($error_code);

        $this->setDiagnosis($diagnosis);
        $cause = $this->makeCause($param_name);
        if (is_array($additional_cause)) {
            $cause = array_merge($cause, $additional_cause);
        }
        $this->setCause($cause);
    }

    /**
     * @param string|array $param_name
     *
     * @return array
     */
    private function makeCause($param_name)
    {
        if (is_null($param_name)) {
            return [];
        }
        if (is_array($param_name)) {
            return ["param" => join(".", $param_name)];
        }

        return ["param" => $param_name];
    }
}
