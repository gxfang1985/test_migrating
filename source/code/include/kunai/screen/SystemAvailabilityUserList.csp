<?php

namespace grn\kunai\screen;

use grn\kunai\service\KunaiService;

class SystemAvailabilityUserList extends KunaiScreenBase
{
    public function fetch()
    {
        $page_name = $this->getPageName();
        $display_apps = KunaiService::getActiveControlledApps();
        $service = new KunaiService();
        $dynamic_roles
            = $service->getAllAvailability(KunaiService::DYNAMIC_ROLE);
        $d_count = $dynamic_roles->getCountNoLimit();
        $groups = $service->getAllAvailability(KunaiService::GROUP);
        $g_count = $groups->getCountNoLimit();
        $static_roles
            = $service->getAllAvailability(KunaiService::STATIC_ROLE);
        $s_count = $static_roles->getCountNoLimit();
        $users = $service->getAllAvailability(KunaiService::USER);
        $u_count = $users->getCountNoLimit();
        $total_count = $d_count + $g_count + $s_count + $u_count;
        require_once('grn/smarty.csp');
        $smarty = new \GRN_Smarty();
        $smarty->assign('display_apps', $display_apps);
        $smarty->assign('display_apps_count', count($display_apps));
        $smarty->assign('dynamic_roles', $dynamic_roles);
        $smarty->assign('groups', $groups);
        $smarty->assign('static_roles', $static_roles);
        $smarty->assign('users', $users);
        $smarty->assign('total_count', $total_count);

        return $smarty->fetch($page_name . '.tpl');
    }

    public function getSitePosition()
    {
        $page_infos = ['availability_user_list' => null];

        return $this->makeSitePosition(self::PATH_SYSTEM, $page_infos);
    }
}
