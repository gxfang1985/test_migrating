<?php

namespace grn\kunai;

require_once('grn/application.csp');

class Application extends \GRN_ApplicationBase
{
    const APPLICATION_ID = 'kunai';

    public function __construct()
    {
        parent::__construct(self::APPLICATION_ID);
    }

    public function getSystemConfigArray()
    {
        $config = [
            [
                'page' => 'kunai/system/common_set',
                'icon' => 'general32'
            ],
            [
                'page' => 'kunai/system/availability_user_list',
                'icon' => 'useradmin32'
            ],
            [
                'page' => 'kunai/system/availability_user_import1',
                'icon' => 'import32'
            ],
            [
                'page' => 'kunai/system/availability_user_export',
                'icon' => 'export32'
            ]
        ];

        return ['kunai_config' => $config];
    }

    /**
     * Get active application from KUNAI controlled apps
     */
    public function getActiveControlledApps()
    {
        $locator = \GRN_ApplicationLocator::instance();
        $active_apps = [];
        $apps = $this->_getKunaiControlledApps();
        foreach ($apps as $app_id) {
            if ($locator->isActive($app_id)) {
                $active_apps[] = $app_id;
            }
        }

        return $active_apps;
    }

    /**
     * Get KUNAI controlled apps
     */
    private function _getKunaiControlledApps()
    {
        return [
            'schedule',
            'message',
            'workflow',
            'mail',
            'address',
            'space',
            'bulletin',
            'report'
        ];
    }
}
