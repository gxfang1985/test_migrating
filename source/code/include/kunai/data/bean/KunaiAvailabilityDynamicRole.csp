<?php

namespace grn\kunai\data\bean;

use grn\space\common\data\bean\BeanAbstract;

class KunaiAvailabilityDynamicRole extends BeanAbstract
{
    const CREATE_TIME = 'col_ctime';
    const DYNAMIC_ROLE = 'col_dynamic_role';
    const APP_STATUS = 'col_app_status';

    /**
     * create time
     *
     * @var int
     */
    private $_create_time;

    /**
     * dynamic role name
     *
     * @var string
     */
    private $_dynamic_role;

    /**
     * application status
     *
     * @var array
     */
    private $_app_status;

    /**
     * @param array   $init_data initial data
     * @param boolean $is_input_check
     */
    public function __construct(
        array $init_data = null,
        $is_input_check = self::CHECK_INPUT
    ) {
        parent::__construct($init_data, $is_input_check);

        if (is_null($init_data)) {
            $this->setCreateTime(time());
            $this->setDynamicRole('');
            $this->setAppStatus('');
        } else {
            $this->setCreateTime((array_key_exists(self::CREATE_TIME,
                $init_data)) ? $init_data[self::CREATE_TIME] : time());
            $this->setDynamicRole((array_key_exists(self::DYNAMIC_ROLE,
                $init_data)) ? $init_data[self::DYNAMIC_ROLE] : '');
            $this->setAppStatus((array_key_exists(self::APP_STATUS, $init_data))
                ? $init_data[self::APP_STATUS] : '');
        }
    }

    public function convertArray()
    {
        $result = parent::convertArray();

        $result[self::CREATE_TIME] = $this->getCreateTime();
        $result[self::DYNAMIC_ROLE] = $this->getDynamicRole();
        $result[self::APP_STATUS] = $this->getAppStatus();

        return $result;
    }

    public function getCreateTime()
    {
        return $this->_create_time;
    }

    public function setCreateTime($value)
    {
        $this->isInputNumber($value);
        $this->_create_time = $value;
    }

    public function getDynamicRole()
    {
        return $this->_dynamic_role;
    }

    public function setDynamicRole($value)
    {
        $this->_dynamic_role = $value;
    }

    public function getAppStatus()
    {
        return $this->_app_status;
    }

    public function setAppStatus($value)
    {
        if (is_array($value)) {
            $this->_app_status = $value;
        }
    }

    /**
     * @param     int $valid_type VALID_TYPE_CREATE, VALID_TYPE_MODIFY, VALID_TYPE_SELECT
     *
     * @return    boolean       TRUE : valid   FALSE: invalid
     */
    protected function checkValidate($valid_type)
    {
        if (parent::checkValidate($valid_type) === false) {
            return false;
        }
        if ($valid_type == self::VALID_TYPE_CREATE) {
            require_once('grn/uum_util.csp');
            $uum_util = \GRN_UumUtil::getInstance();
            $dynamic_roles = $uum_util->listDynamicRoles();
            if ( ! array_key_exists($this->getDynamicRole(), $dynamic_roles)) {
                return false;
            }
        }
        if ( ! is_array($this->getAppStatus())) {
            return false;
        }

        return true;
    }
}
