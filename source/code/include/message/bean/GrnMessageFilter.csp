<?php

class GrnMessageFilter
{
    private $id = null;
    private $andOr = null;
    private $folder = null;
    private $name = null;
    private $user = null;
    private $viewOrder = null;
    /** @var GrnMessageFilterCondition[] */
    private $filterConditionList = [];

    public static $CONDITION_AND = 1;
    public static $CONDITION_OR = 2;

    public function __construct($rowData = [])
    {
        if (array_key_exists("_id", $rowData)) {
            $this->setId($rowData["_id"]);
        }
        if (array_key_exists("col_folder", $rowData)) {
            $this->setFolder($rowData["col_folder"]);
        }
        if (array_key_exists("col_and_or", $rowData)) {
            $this->setAndOr($rowData["col_and_or"]);
        }
        if (array_key_exists("col_folder", $rowData)) {
            $this->setFolder($rowData["col_folder"]);
        }
        if (array_key_exists("col_name", $rowData)) {
            $this->setName($rowData["col_name"]);
        }
        if (array_key_exists("col_user", $rowData)) {
            $this->setUser($rowData["col_user"]);
        }
        if (array_key_exists("col_view_order", $rowData)) {
            $this->setViewOrder($rowData["col_view_order"]);
        }
    }

    public function setId($id)
    {
        $this->id = $id;
    }

    public function getId()
    {
        return $this->id;
    }

    public function setAndOr($andOr)
    {
        $this->andOr = $andOr;
    }

    public function getAndOr()
    {
        return $this->andOr;
    }

    public function setFolder($folder)
    {
        $this->folder = $folder;
    }

    public function getFolder()
    {
        return $this->folder;
    }

    public function setName($name)
    {
        $this->name = $name;
    }

    public function getName()
    {
        return $this->name;
    }

    public function setUser($user)
    {
        $this->user = $user;
    }

    public function getUser()
    {
        return $this->user;
    }

    public function setViewOrder($viewOrder)
    {
        $this->viewOrder = $viewOrder;
    }

    public function getViewOrder()
    {
        return $this->viewOrder;
    }

    public function addFilterCondition($filterCondition)
    {
        $this->filterConditionList[] = $filterCondition;
    }

    public function getFilterConditionList()
    {
        return $this->filterConditionList;
    }

    public function setFilterConditionList($filterConditionList)
    {
        $this->filterConditionList = $filterConditionList;
    }

    public function isMatchWith($subject, $senderNames, $addresseesNames)
    {
        foreach ($this->getFilterConditionList() as $filterCondition) {
            if ($this->getAndOr() == self::$CONDITION_OR) {
                if ($filterCondition->isMatchWith($subject, $senderNames,
                    $addresseesNames)
                ) {
                    return true;
                }
            }
            if ($this->getAndOr() == self::$CONDITION_AND) {
                if ( ! $filterCondition->isMatchWith($subject, $senderNames,
                    $addresseesNames)
                ) {
                    return false;
                }
            }
        }
        if ($this->getAndOr() == self::$CONDITION_OR) {
            return false;
        } else {
            return true;
        }
    }
}
