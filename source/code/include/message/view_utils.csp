<?php

class GRN_Message_ViewUtils
{
    public static function is_operator_open($maintainers, $message_owner_id)
    {
        assert('is_array($maintainers)');

        $count = count($maintainers);

        if ($count == 0) {
            return 0;
        }

        if ($count == 1) {
            $maintainer_id = $maintainers[0];
            if ($maintainer_id == $message_owner_id) {
                return 0;
            }
        }

        return 1;
    }

    /*  this method returns member id of message, including user who send message.
     *  Returned member is not deleted and Anyone received message doesn't delete message.
     *  @param array information of message
     *  @return array message member ids
     */
    public static function getMessageMembers(array $message)
    {
        $guard = isset($message['addressees']);
        assert('$guard');

        $member = [];
        foreach ($message['addressees'] as $candidate) {
            // もし Message を削除したユーザーも入れないのなら、
            // この if 文に && $candidate['delete_flag'] == 0 を追記する。
            if ($candidate["dtime"]->unix_ts == 0
                && $candidate['delete_flag'] == 0
            ) {
                $member[] = $candidate["id"];
            }
        }

        if ( ! in_array($message['creator_id'], $member)
             && strlen($message['creator_id']) > 0
        ) {
            $member[] = $message['creator_id'];
        }

        return $member;
    }
}
