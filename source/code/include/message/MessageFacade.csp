<?php
require_once('grn/application.csp');
require_once('grn/CBException.csp');
require_once('grn/DAOFactory.csp');

class MessageFacade
{
    private $daoFactory = null;

    /**
     *
     * @return DAOFactory
     */
    public function getDAOFactory()
    {
        if (is_null($this->daoFactory)) {
            $this->setDAOFactory(DAOFactory::getDAOFactory(DAOFactory::$MYSQL));
        }

        return $this->daoFactory;
    }

    public function setDAOFactory($daoFactory)
    {
        $this->daoFactory = $daoFactory;
    }

    private $databaseConnection = null;

    public function getDatabaseConnection()
    {
        if (is_null($this->databaseConnection)) {
            $app_locator = GRN_ApplicationLocator::instance();
            $this->setDatabaseConnection($app_locator->getConnection('message'));
        }

        return $this->databaseConnection;
    }

    public function setDatabaseConnection($databaseConnection)
    {
        $this->databaseConnection = $databaseConnection;
    }

    /**
     *
     * @param array  $inDataObj
     * @param string $inMessageId
     *
     * @return array
     */
    public function selectAddresseeAndUserByMessageIdSenderIsZero(
        $inDataObj,
        $inMessageId
    ) {
        $inDataObj["db"] = $this->getDatabaseConnection();
        $daoFactory = $this->getDAOFactory();
        $dao = $daoFactory->getGrnMessageAddresseeDAO();

        return $dao->selectAddresseeAndUserByMessageIdSenderIsZero($inDataObj,
            $inMessageId);
    }

    /**
     *
     * @param array  $inDataObj
     * @param string $inUserId
     *
     * @return GrnMessageFilter[]
     */
    public function selectFilterAndFilterConditionListByUserId(
        $inDataObj,
        $inUserId
    ) {
        $inDataObj["db"] = $this->getDatabaseConnection();
        $daoFactory = $this->getDAOFactory();
        $dao = $daoFactory->getGrnMessageFilterDAO();

        return $dao->selectFilterAndFilterConditionListByUserId($inDataObj,
            $inUserId);
    }
}
