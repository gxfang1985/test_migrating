<?php

namespace grn\message;

use grn\fts\SQLSearchResultDocument as ftsSearchResultDocument;

class SQLSearchResultDocument extends ftsSearchResultDocument
{

    /**
     * @param $row_data Array of fetched database data
     *
     * @return array response
     */
    public function createDocument(array $row_data)
    {

        assert(isset($row_data["mid"]));
        assert(isset($row_data["displayName"]));
        assert(isset($row_data["title"]));
        assert(isset($row_data["modifiedTime"]));

        $doc = [];
        $doc[parent::TITLE]
            = $this->htmlEscape($row_data[parent::TITLE]);
        $doc[parent::SNIPPET] = "";
        $doc[parent::ICON] = $this->getIconUrl();
        $doc[parent::URL] = $this->getMessageUrl($row_data["mid"]);
        $doc[parent::MODIFIED_TIME]
            = $this->getFormatTimestamp($row_data[parent::MODIFIED_TIME]);
        $modifier = [];
        $modifier[parent::DISPLAY_NAME]
            = $this->getDisplayName($row_data["senderId"],
            $row_data["displayName"]);
        $modifier[parent::PROFILE]
            = $this->getProfileUrl($row_data["senderId"]);

        $doc[parent::MODIFIER] = $modifier;

        return $doc;
    }


    /**
     * @param $mid Integer
     *
     * @return string of url
     */
    public function getMessageUrl($mid)
    {
        assert(is_numeric($mid));

        return cb_format_url("message/view", ["mid" => $mid]);
    }

    /**
     * @return string of icon url
     */
    public function getIconUrl()
    {
        return cb_get_app_path() . '/grn/image/cybozu/msg16.png';
    }


}
