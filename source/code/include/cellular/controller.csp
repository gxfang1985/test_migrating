<?php
/**
 * @brief
 * @author   Yoshiaki Tanaka
 * @date     2005/02/16
 * @par      Copyright (c) 2005 Cybozu,Inc. All rights reserved .
 * @package  grn.todo
 */

/**
 * @package grn.cellular
 */
function grn_cellular_initialize_controller()
{
    global $G_state_set;

    // show copyright
    $G_state_set->set('copyright_should_be_written', true);
    // auto close html tag
    $G_state_set->set('html_should_be_closed', true);
    // custom error page
    $G_state_set->set('error_page_type', 'cellular');
}


require_once('grn/controller.csp');


/**
 * @class    GRN_Cellular_ControllerUtil
 * @package  grn.cellular
 */
class GRN_Cellular_ControllerUtil extends GRN_ControllerUtil
{
    function __construct($page = null)
    {
        parent::__construct($page);
    }

    /**
     * 一覧開始位置を取得する、自動でセッションへ保存する
     *
     * @return integer
     */
    function getListOffset()
    {
        if ($this->_page != cb_get_pagename()) {
            $session =& $this->getSession();
            $sp = $session->get('current_start_position');
            if ($sp == null) {
                $sp = 0;
            }

            return $sp;
        }

        $sp = $this->getNaviStartPosition();
        $this->setNaviStartPosition($sp);

        return $sp;
    }

    function getConfigValues(& $user)
    {
        require_once('cellular/application.csp');
        $app = GRN_Cellular::getInstance();

        $config = $app->getUserConfig($user);

        $values = [
            'subject_width' => $config->getSubjectWidth(),
            'list_max'      => $config->getListMax(),
            'use_mail'      => $config->getUseWebMail(),
        ];

        return $values;
    }
}


