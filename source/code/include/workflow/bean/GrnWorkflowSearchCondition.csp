<?php

/**
 *
 */
abstract class GrnWorkflowSearchCondition
{
    //Type choices
    const GRN_WORKFLOW_SEARCH_ITEM_NUMBER = 0; //検索項目：番号
    const GRN_WORKFLOW_SEARCH_ITEM_FORM_NAME = 1; //検索項目：申請フォーム名
    const GRN_WORKFLOW_SEARCH_ITEM_NAME = 2; //検索項目：標題
    const GRN_WORKFLOW_SEARCH_ITEM_STATUS = 3; //検索項目：状態
    const GRN_WORKFLOW_SEARCH_ITEM_DATE = 4; //検索項目：日付
    const GRN_WORKFLOW_SEARCH_ITEM_USER = 5; //検索項目：申請者
    const GRN_WORKFLOW_SEARCH_ITEM_STRING = 6; //検索項目：項目（文字列）
    const GRN_WORKFLOW_SEARCH_ITEM_PRIORITY = 7; //検索項目：優先度

    //Operator choice
    const GRN_WORKFLOW_SEARCH_OPERATOR_LIKE = 0; //含む
    const GRN_WORKFLOW_SEARCH_OPERATOR_NOT_LIKE = 1; //含まない
    const GRN_WORKFLOW_SEARCH_OPERATOR_EQUAL = 2; //同じ
    const GRN_WORKFLOW_SEARCH_OPERATOR_NOT_EQUAL = 3; //異なる
    const GRN_WORKFLOW_SEARCH_OPERATOR_AFTER = 4; //以降
    const GRN_WORKFLOW_SEARCH_OPERATOR_BEFORE = 5; //以前

    private $operator;
    private $value;

    /**
     * @see GrnWorkflowSearchCondition::getConditionSQL
     *
     * @param CB_DatabaseConnection $db
     *
     * @return string
     */
    protected function like(CB_DatabaseConnection $db)
    {
        return "";
    }

    /**
     * * @see GrnWorkflowSearchCondition::getConditionSQL
     * @param CB_DatabaseConnection $db
     *
     * @return string
     */
    protected function notLike(CB_DatabaseConnection $db)
    {
        return "";
    }

    /**
     * @see GrnWorkflowSearchCondition::getConditionSQL
     *
     * @param CB_DatabaseConnection $db
     *
     * @return string
     */
    protected function equals(CB_DatabaseConnection $db)
    {
        return "";
    }

    /**
     * @see GrnWorkflowSearchCondition::getConditionSQL
     *
     * @param CB_DatabaseConnection $db
     *
     * @return string
     */
    protected function notEquals(CB_DatabaseConnection $db)
    {
        return "";
    }

    /**
     * @see GrnWorkflowSearchCondition::getConditionSQL
     *
     * @param CB_DatabaseConnection $db
     *
     * @return string
     */
    protected function after(CB_DatabaseConnection $db)
    {
        return "";
    }

    /**
     * @see GrnWorkflowSearchCondition::getConditionSQL
     *
     * @param CB_DatabaseConnection $db
     *
     * @return string
     */
    protected function before(CB_DatabaseConnection $db)
    {
        return "";
    }


    /**
     * @return int type of SearchConditionType
     */
    abstract public function getType();

    abstract protected function getColumnName();


    /**
     * @see GrnWorkflowSearchCondition_Date::hasValidOperator
     * @return bool
     */
    protected function hasValidOperator()
    {
        switch ($this->getOperator()) {
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_LIKE: //含む
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_NOT_LIKE: //含まない
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_EQUAL: //同じ
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_NOT_EQUAL: //異なる
                return true;
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_AFTER: //以降
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_BEFORE: //以前
                return false;

        }

        return false;
    }

    /**
     * @return bool
     * @see http://issues.dev.cybozu.co.jp/browse/GRN2-7097
     */
    public function hasValidValue()
    {
        return isset($this->value)
               && $this->hasValidOperator();
    }


    /**
     * @param $operator
     */
    public function setOperator($operator)
    {
        $this->operator = $operator;
    }

    public function getOperator()
    {
        return $this->operator;
    }

    /**
     * @param $value
     */
    public function setValue($value)
    {
        $this->value = $value;
    }

    public function getValue()
    {
        return $this->value;
    }

    /**
     * @param CB_DatabaseConnection $db
     *
     * @return mixed
     */
    public function getConditionSQL(CB_DatabaseConnection $db)
    {
        if ($this->hasValidValue() === false) {
            return "";
        }

        switch ($this->getOperator()) {
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_LIKE: //含む
                return $this->like($db);
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_NOT_LIKE: //含まない
                return $this->notLike($db);
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_EQUAL: //同じ
                return $this->equals($db);
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_NOT_EQUAL: //異なる
                return $this->notEquals($db);
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_AFTER: //以降
                return $this->after($db);
            case self::GRN_WORKFLOW_SEARCH_OPERATOR_BEFORE: //以前
                return $this->before($db);
            default:
                return "";
        }
    }

}

