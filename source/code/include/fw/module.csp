<?php

/**
 * Module Support.
 *
 * @author      Yamamoto, Hirotaka      2004/07
 * @version     1.0
 * @package     fw.core
 */

/**
 * Module base class.
 *
 * This class provides a consistent way to access miscellaneous
 * module-based APIs.  Such APIs typically distinguish modules by
 * strings, which might confuse things.
 *
 * By inheriting and extending this class, modules will use the
 * sole ID string to access module-based APIs such as
 * {@link CB_SessionManager}, {@link CB_SystemProfileManager}, and so on.
 *
 * @abstract
 * @package fw.core
 */
class CB_ModuleBase
{
    /**
     * The sole id string of the module.
     *
     * @access protected
     */
    var $_my_id;

    /**
     * Constructor.
     *
     * @param string $module_id The sole id string of the module.
     */
    function __construct($module_id)
    {
        $this->_my_id = $module_id;
    }

    /**
     * @return string The sole id string of this module.
     */
    function getModuleId()
    {
        return $this->_my_id;
    }

    /**
     * Get I18N string for this module.
     *
     * @param string $key
     * @param        $args
     * @param        $locale
     *
     * @return string
     */
    function getMessage($key, $args = null, $locale = null)
    {
        require_once('fw/i18n.csp');

        return cb_msg($this->_my_id, $key, $args, $locale);
    }

    /**
     * Get {@link CB_Session} object for this module.
     *
     * @return CB_Session
     */
    function getSession()
    {
        require_once('fw/session_manager.csp');
        $sm = CB_SessionManager::getInstance();
        $session = $sm->getSession($this->_my_id);

        return $session;
    }

    /**
     * Get system profile object for this module.
     *
     * @return CB_Profile
     */
    function getSystemProfile()
    {
        require_once('fw/profile.csp');
        $profile = cb_get_system_profile($this->_my_id);

        return $profile;
    }

    /**
     * Get user profile object of the named user for this module.
     *
     * @param $user
     *
     * @return CB_Profile
     */
    function getUserProfile($user)
    {
        require_once('fw/profile.csp');
        $profile = cb_get_user_profile($user, $this->_my_id);

        return $profile;
    }

    /**
     * Get {@link CB_Logger} object for this module.
     *
     * @return CB_Logger
     */
    function getLogger()
    {
        require_once('fw/logger.csp');
        $lm = CB_LoggerManager::getInstance();
        $logger = $lm->getLogger($this->_my_id);

        return $logger;
    }

    /**
     * Get {@link CB_PluginLoader} object for this module.
     *
     * @return CB_PluginLoader
     */
    function getPluginLoader()
    {
        require_once('fw/plugin.csp');
        $loader = new CB_PluginLoader($this->_my_id);

        return $loader;
    }

    protected function isOnForest()
    {
        return defined('ON_FOREST');
    }
}


