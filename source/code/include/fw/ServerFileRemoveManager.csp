<?php

namespace grn\fw;

/**
 * Class ServerFileRemoveManager
 *
 * @package grn\fw
 */
class ServerFileRemoveManager implements \CB_Transactional
{
    /** @var array */
    private $_toRemove = [];

    /**
     * Commit changes.  Implementers must be aware that this may
     * be called many times during the process request.
     *
     * @return bool
     */
    public function commit()
    {
        foreach ($this->_toRemove as $rm) {
            @unlink($rm);
        }
        $this->_toRemove = [];

        return true;
    }

    /**
     * Abort and discard changes.  Implementers must be aware that
     * this may be called many times during the process request.
     */
    public function abort()
    {
        $this->_toRemove = [];
    }

    /**
     * @param string $path
     */
    public function addToRemove($path)
    {
        $this->_toRemove[$path] = $path;
    }

    /**
     * @param string $path
     */
    public function unsetToRemove($path)
    {
        unset($this->_toRemove[$path]);
    }
}
