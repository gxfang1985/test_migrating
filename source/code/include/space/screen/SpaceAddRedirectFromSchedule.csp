<?php
declare(strict_types=1);

namespace grn\space\screen;

use grn\space\common\exception\GrnInvalidArgumentException;
use grn\space\common\utility\ValidateUtility;

class SpaceAddRedirectFromSchedule extends SpaceAddRedirect
{

    /**
     * @param  array $input
     *
     * @return array
     */
    public function getUserIDs(array $input): array
    {
        $user = cb_get_login_user();

        require_once('schedule/application.csp');
        $app = \GRN_Schedule_Application::getInstance();

        $event_info
            = $app->getEvent($user, $input['eid'], null, CB_DATABASE_NO_LOCK,
            false, GRN_SCHEDULE_GET_MEMBER_ID);

        if ($event_info != false) {
            $event_users = is_array($event_info->users)
                ? array_keys($event_info->users) : [];

            return $event_users;
        }

        return [];

    }

    /**
     * Check argument of $G_INPUT
     *
     * @param  array $input
     *
     * @throws GrnInvalidArgumentException
     */
    protected function checkArgFromInput(array $input)
    {
        if ( ! isset($input['eid'])
             || ! ValidateUtility::isNumber($input['eid'],
                ValidateUtility::DISABLE_EMPTY,
                ValidateUtility::EXCEPTION_NOT_THROW)
        ) {
            require_once('schedule/error_code.csp');
            throw new GrnInvalidArgumentException(E_GRN_SCHD_NOTFOUND_EVENT);
        }

        return;
    }

}
