<?php

namespace grn\space\screen;

use grn\space\common\exception\ErrorCode;
use grn\space\common\exception\GrnKintoneException;
use grn\space\utility\KintoneUtility;
use grn\space\service\SpaceService;
use grn\space\service\KintoneService;

/**
 * Class CommandAppManageAddNewApps
 *
 */
class CommandAppManageAddNewApps extends AppManageBase
{
    const ARG_APPLICATION_ID = "kappid";

    /**
     * @param $notUsed
     *
     * @return array
     * @throws GrnKintoneException
     */
    public function post($notUsed)
    {
        $spaceID = $this->getArrayValue(parent::ARG_SPACE_ID,
            $this->getInput());
        $kAppID = $this->getArrayValue(self::ARG_APPLICATION_ID,
            $this->getInput());
        $loginID = $this->getLoginUserId();

        //copy
        $kintoneService = KintoneService::getInstance();
        $application
            = $kintoneService->reuseKintoneApplication($this->getSpace(),
            $kAppID, $loginID);

        return [
            'page'   => 'space/application/external/index',
            'params' => [
                'spid'  => $spaceID,
                'appid' => $application->getId()
            ]
        ];
    }
}
