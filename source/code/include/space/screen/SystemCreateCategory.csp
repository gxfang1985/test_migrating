<?php

namespace grn\space\screen;

use grn\space\service\SpaceService;

/**
 * Class SystemCreateCategory
 *
 */
class SystemCreateCategory extends GenericScreenBase
{
    const URL_LIST = "space/system/category_list";
    const PATH_TEMPLATE_FILE = "space/system/category_add.tpl";

    private $_smarty;

    /**
     * @return mixed
     */
    public function fetch()
    {
        $input = $this->getInput();
        $login = $this->getLoginUserId();

        require_once("fw/i18n.csp");
        $i18n = \CB_I18N::getInstance();
        $languageCode = $i18n->getCurrentLanguage();

        $spaceService = SpaceService::getInstance();
        $categoryObj = $spaceService->getSpaceCategory($input["cid"], $login,
            $languageCode);
        $_categoryName = $categoryObj->getCategoryName();

        $foreign_key = uniqid('', true);

        require_once("grn/smarty.csp");
        $smarty = $this->getSmarty();

        $smarty->assign('foreign_key', $foreign_key);
        $smarty->assign("parent_name", $_categoryName);
        $smarty->assign("this_getMultilingualSpaceCategoryNameArray",
            $this->getMultilingualSpaceCategoryNameArray());
        $smarty->assign("this", $this);
        $smarty->assign("site_position", $this->getSitePosition());
        $smarty->assign("page_title", $this->getTitle());
        $smarty->assign("cid", $categoryObj->getId());
        $smarty->assign("filter_id", cb_at($input, "filter_id"));

        return $smarty->fetch(self::PATH_TEMPLATE_FILE);
    }

    /**
     * Create Array to give to grn_text_multilanguage
     *
     * @return array
     */
    public function getMultilingualSpaceCategoryNameArray()
    {
        return [
            "element_name" => "name",
            "form_name"    => "space/system/category_add",
            "values"       => [],
        ];
    }

    /**
     * @return array
     */
    public function getSitePosition()
    {
        return [
            [
                "page"      => self::URL_LIST,
                "name"      => cb_msg('grn.space.system', 'category_list'),
                "filter_id" => cb_at($this->getInput(), 'filter_id'),
            ],

            [
                "name" => cb_msg('grn.space.system', 'category_add')
            ]
        ];
    }

    /**
     * @return string
     */
    public function getTitle()
    {
        return cb_msg('grn.space.system', 'category_add');
    }

    /**
     * @return mixed
     */
    public function getInput()
    {
        return $this->input;
    }

    /**
     * @param $input
     */
    public function setInput($input)
    {
        $this->input = $input;
    }

    /**
     * @param $smarty
     */
    public function setSmarty($smarty)
    {
        $this->_smarty = $smarty;
    }

    /**
     * @return mixed
     */
    public function getSmarty()
    {
        return $this->_smarty;
    }

}
