<?php
namespace grn\space\utility;

use grn\space\data\collection\SpaceCollection;

require_once('fw/uum_core.csp');


/**
 * Importance!! : Use ServiceClass or neither LogicClass nor DBClass from UtilityClass.
 * But, the DB access is exceptionally generated because this class is using legacy code.
 *
 * スレッドユーティリティクラス
 * スレッドを必要な形に加工するクラス
 *
 * This code uses the legacy of the past.
 */
class SpaceUtility
{

    /**
     * トリムを行った時のマーク
     */
    const TRIM_MAKER = '...';

    /**
     * コンストラクタ
     *
     */
    private function __construct()
    {

    }

    /**
     * SynthesisThreadCommentCollectionが持つBeanオブジェクトの値をユーザー設定に従って切り詰める
     *
     * @param SpaceCollection $collection
     * @param \CB_User        $operationUser
     */
    static public function truncateSpaceUsingUserConfig(
        SpaceCollection $collection,
        \CB_User $operationUser
    ) {
        require_once('grn/ui.csp');
        $um = \GRN_UIConfigManager::getInstance();
        $uc = $um->getUserConfig($operationUser);

        $subjectWidth = ($uc) ? $uc->getSubjectWidth()
            : self::DEFAULT_TRUNCATE_LENGTH;
        $startOffset = 0;

        /** @var \grn\space\data\bean\Space $eachSpace */
        foreach ($collection as $eachSpace) {
            $spaceName = $eachSpace->getSpaceName();
            $categoryName = $eachSpace->getCategoryName();

            $spaceName = mb_strimwidth($spaceName, $startOffset,
                $subjectWidth, self::TRIM_MAKER);
            $categoryName = mb_strimwidth($categoryName, $startOffset,
                $subjectWidth, self::TRIM_MAKER);

            $eachSpace->setSpaceName($spaceName);
            $eachSpace->setCategoryName($categoryName);
        }
    }
}

?>

