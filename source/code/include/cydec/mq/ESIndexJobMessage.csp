<?php

namespace grn\cydec\mq;


/**
 * The specification of the es job message.
 * http://wiki.dev.cybozu.co.jp/x/FZh3AQ
 */
class ESIndexJobMessage extends JobMessage
{
    const JSON_LENGTH_LIMIT = FTSIndexJobMessage::JSON_LENGTH_LIMIT;

    /**
     *
     * @param array $arguments
     *
     * @return mixed
     */
    public function constructMessage(array $arguments)
    {
        return $arguments;
    }


    /**
     * @param array $argument
     *
     * @return int
     */
    private function calculateMessageLength(array $argument)
    {
        return strlen(json_encode($this->constructMessage($argument),
            JSON_UNESCAPED_UNICODE));
    }

    /**
     * @param array       $argument
     * @param mixed       $nextArgument
     * @param string|null $nextArgumentType
     *
     * @return bool
     */
    public function exceedsSize(
        array $argument,
        $nextArgument,
        $nextArgumentType = null
    ) {
        $argument[$nextArgumentType][] = $nextArgument;
        $messageLength
            = $this->calculateMessageLength($argument);

        return $messageLength > self::JSON_LENGTH_LIMIT;

    }

    public function getJobName()
    {
        return JobNameConstants::ES_INDEXER;
    }
}
