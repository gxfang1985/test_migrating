<?php
declare(strict_types=1);

namespace grn\cydec\mq;

use grn\grn\push_notification\PushPayload;

class PushJobMessage
{

    /**
     * @param PushPayload $push_payload
     *
     * @return string
     */
    public function payloadToJson(PushPayload $push_payload): string
    {
        $json = json_encode($push_payload, JSON_UNESCAPED_UNICODE);
        if ($json === false) {
            $this->logFailedJsonEncode();
        }

        return $json;
    }

    /**
     * @return string
     */
    public function getJobName(): string
    {
        return JobNameConstants::NTF_PUSH;
    }

    private function logFailedJsonEncode()
    {
        $errorMsg = json_last_error_msg();
        $errorCode = json_last_error();

        $domain = \CB_CyDECUtil::getInstance()->getDomainID();
        $message
            = "NTF-PUSH: Failed to json_encode()!! [domain: {$domain}, message: {$errorMsg}, code: {$errorCode}]";

        syslog(LOG_ERR, $message);
    }
}
