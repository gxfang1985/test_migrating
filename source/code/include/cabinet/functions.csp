<?php


function grn_cabinet_get_user_groups($uid)
{
    static $__user_groups = [];

    if ( ! array_key_exists($uid, $__user_groups)) {
        global $G_container_base;
        $uum = $G_container_base->getInstance('uum');

        $__user_groups[$uid] = $uum->getUserGroups($uid);
    }

    return $__user_groups[$uid];
}

function grn_cabinet_get_user_roles($uid)
{
    static $__user_roles = [];

    if ( ! array_key_exists($uid, $__user_roles)) {
        global $G_container_base;
        $uum = $G_container_base->getInstance('uum');

        $__user_roles[$uid] = $uum->getUserRoles($uid);
    }

    return $__user_roles[$uid];
}

function grn_cabinet_get_user_dynamic_roles($uid)
{
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');

    $login = $uum->getLoginUser($uid);

    $roles = [];

    if ($login->getOID() == $uid) {
        $roles = $uum->listGrantedRoles();
    }

    $roles['Everyone'] = 1;

    return $roles;
}

/**
 * @access private
 */
function __grn_cabinet_get_folder_path_string(& $folder, & $path, $delimiter)
{
    if ($folder) {
        $path = $folder->get('name') . $delimiter . $path;
        if (($parent =& $folder->get('parent'))) {
            __grn_cabinet_get_folder_path_string($parent, $path, $delimiter);
        }
    }
}

/**
 * 指定フォルダのパス文字列を取得
 */
function grn_cabinet_get_folder_path_string(& $folder, $delimiter = null)
{
    if ( ! $folder) {
        return null;
    }

    if (is_null($delimiter)) {
        static $_default_delimiter = null;
        if (is_null($_default_delimiter)) {
            require_once('fw/i18n.csp');
            $_default_delimiter = cb_msg('grn.cabinet', 'path_delimiter');
        }
        $delimiter = $_default_delimiter;
    }

    $path = $folder->get('name');
    if (($parent =& $folder->get('parent'))) {
        __grn_cabinet_get_folder_path_string($parent, $path, $delimiter);
    }

    return $path;
}

/**
 * @access private
 */
function __grn_cabinet_get_folder_path_array(& $folder, & $path)
{
    if ($folder) {
        $node = [
            $folder->getOID() => [
                'title' => $folder->get('name'),
                'hid'   => $folder->getOID()
            ]
        ];
        $path = $node + $path;
        if (($parent =& $folder->get('parent'))) {
            __grn_cabinet_get_folder_path_array($parent, $path);
        }
    }
}

/**
 * 指定フォルダまでのフォルダ階層を取得する
 */
function grn_cabinet_get_folder_path_array(& $folder)
{
    if ( ! $folder) {
        return null;
    }

    $path = [
        $folder->getOID() => [
            'title' => $folder->get('name'),
            'hid'   => $folder->getOID()
        ]
    ];
    if (($parent =& $folder->get('parent'))) {
        __grn_cabinet_get_folder_path_array($parent, $path);
    }

    return $path;
}


