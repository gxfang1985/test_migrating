<?php

namespace grn\portal\ajax\system;


use grn\grn\JSONResponse;
use grn\portal\ajax\PortalAjaxCommandInterface;

require_once('fw/i18n.csp');
require_once('portal/portal_logic.csp');
require_once('portal/error_code.csp');

class AjaxPostPortalTitleModify implements PortalAjaxCommandInterface
{
    /** @var array */
    private $input;
    /** @var JSONResponse */
    private $jsonResponse;

    /**
     * @param array        $input
     * @param JSONResponse $jsonResponse
     */
    public function __construct(array $input, JSONResponse $jsonResponse)
    {
        $this->input = $input;
        $this->jsonResponse = $jsonResponse;
    }

    /**
     */
    public function execute()
    {
        $portalId = cb_at($this->input, "portal_id");
        if (is_null($portalId)) {
            cb_throw_error(E_COMMON_MISSING_MANDATORY);
        }

        //get request language values
        $inputLocalNameArray
            = getMultiLanguageText(GRN_PRTL_ELEMENT_NAME_PORTAL, $this->input);

        if ( ! isset($inputLocalNameArray[CB_I18N_DEFUALT_LANGUAGE_CODE])
             || strlen($inputLocalNameArray[CB_I18N_DEFUALT_LANGUAGE_CODE])
                === 0
        ) {
            cb_throw_error(E_GRN_PRTL_PORTAL_NOT_INPUT_NECESSARY);
        }

        //Modify Portal
        $logic = \GRN_Portal_SystemPortalLogic::getInstance();
        $logic->modifyPortalName($portalId, $inputLocalNameArray);

        $i18n = \CB_I18N::getInstance();
        $currentLanguage = $i18n->getCurrentLanguage();
        $title = (isset($inputLocalNameArray[$currentLanguage])
                  && strlen(cb_trim($inputLocalNameArray[$currentLanguage]))
                     > 0)
            ? cb_trim($inputLocalNameArray[$currentLanguage])
            : $inputLocalNameArray[CB_I18N_DEFUALT_LANGUAGE_CODE];

        $this->jsonResponse->response(['title' => $title]);
    }
}
