<?php

namespace grn\versionup;

class UpdaterLock
{
    public static function acquire()
    {
        $db = cb_get_master_db();
        $lockName = $db->getDatabaseName() . '-grn-versionup';
        $query = $db->format("SELECT GET_LOCK('@S',-1) AS getlock",
            [$lockName]);
        $ret = $db->query($query);
        $row = $db->fetch_assoc($ret);
        $lock = $row['getlock'];
        $db->free_result($ret);

        if ($lock != "1") {
            cb_throw_error('FW00001');
        }
    }
}
