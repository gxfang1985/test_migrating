<?php

namespace grn\forest;

class VersionApi
{
    private function prepare()
    {
        global $G_state_set;
        $G_state_set->set('copyright_should_be_written', false);
        $G_state_set->set('html_should_be_closed', false);
        $G_state_set->set('error_page_type', 'json');
        header('Content-Type: application/json;charset=UTF-8');

        if (cb_is_onpremises()) {
            cb_throw_error('FW00043', null, null, null,
                ['page' => cb_get_pagename()]);
        }
    }

    public function run()
    {
        $this->prepare();

        global $G_config_grn;

        $result = [
            'version'     => $G_config_grn->get('System', 'archive_version'),
            'revision'    => $G_config_grn->get('System', 'revision'),
            'buildNumber' => (int)$G_config_grn->get('System', 'build_number'),
        ];

        echo json_encode(['result' => $result, 'success' => true]);
    }
}
