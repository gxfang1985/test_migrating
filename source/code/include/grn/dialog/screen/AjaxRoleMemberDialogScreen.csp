<?php

namespace grn\grn\dialog\screen;

/**
 * Class AjaxRoleMemberDialogScreen
 *
 * @package grn\grn\dialog\screen
 */
class AjaxRoleMemberDialogScreen extends AbstractAjaxMemberDialogScreen
{
    /** Input parameter : Primary key for search */
    private $input_primary_key;
    /** Input parameter : Display page number */
    private $input_want_page;
    /** Input parameter : Search word */
    private $input_search_word;
    /** Input parameter : Access plugin */
    private $input_access_plugin;
    /** Input parameter : Application ID */
    private $input_app_id;

    /**
     * AjaxRoleMemberDialogScreen constructor.
     *
     * @param $input
     */
    function __construct($input)
    {
        parent::__construct($input);

        $this->setInput($input);
    }

    /**
     * Set Input.
     *
     * @param $input array
     */
    private function setInput($input)
    {
        $anchor_id = cb_at($input, 'anchor_id', '');
        $anchor_id = explode('_', $anchor_id);
        $this->input_primary_key = $anchor_id[count($anchor_id) - 1];

        $this->input_want_page = cb_at($input, 'want_page', 1);

        $this->input_search_word = cb_at($input, 'search_word', '');

        $this->input_app_id = cb_at($input, 'app_id', '');

        $access_plugin_encoded = cb_at($input, 'access_plugin_encoded', false);
        if ( ! $access_plugin_encoded) {
            $this->input_access_plugin = false;
        } else {
            $this->input_access_plugin
                = cb_unserialize(base64_decode($access_plugin_encoded),
                ['allowed_classes' => false]);
        }
    }

    /**
     * @return int
     */
    protected function getWantPage()
    {
        return $this->input_want_page;
    }

    /**
     * @return string
     */
    protected function getSearchWord()
    {
        return $this->input_search_word;
    }

    /**
     * @return string
     */
    protected function getPrimaryKey()
    {
        return $this->input_primary_key;
    }

    /**
     * @return mixed
     */
    protected function getAccessPlugin()
    {
        return $this->input_access_plugin;
    }

    /**
     * @return string
     */
    protected function getAppId()
    {
        return $this->input_app_id;
    }

    /**
     * @return boolean
     */
    protected function useSearchItem()
    {
        return true;
    }

    /**
     * @return bool
     */
    public function useBackButton()
    {
        return false;
    }

    /**
     * @return bool
     */
    protected function useSwitchTab()
    {
        return false;
    }

    /**
     * @return array()
     */
    protected function getSwitchTabCaption()
    {
        return null;
    }

    /**
     * @return boolean
     */
    protected function isSearch()
    {
        if (strlen($this->input_search_word) > 0) {
            return true;
        }

        return false;
    }

    /**
     * @param boolean $include_search
     *
     * @return array
     */
    protected function _setDisplayMembersId($include_search = false)
    {
        $this->searchRoleUsers($this->getPrimaryKey(), $include_search);
    }

    /**
     * @return string
     */
    protected function createDialogTitle()
    {
        $name = $this->uum->getStaticRole($this->getPrimaryKey())
                          ->get('foreign_key');
        $count = count($this->getDisplayMembersId(false));

        return cb_msg('grn.grn', 'grn.member_list_dialog.title',
            ['name' => $name, 'count' => $count]);
    }
}
