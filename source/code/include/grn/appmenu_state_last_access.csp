<?php

function grn_appmenu_set_state_last_access($user, $state = null)
{
    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();
    $session = $session_manager->getSession('stateMenuApplication');
    $attr_name = 'last_state_applicationMenu';
    if (is_null($state)) {
        $state = '0';
    }

    require_once('fw/profile.csp');
    $profile = cb_get_user_profile($user, 'grn.common.toggleMenu');
    if ( ! $profile->updateAttribute($attr_name, $state)) {
        $profile->createAttribute($attr_name, $state);
    } else {
        $profile->getAttribute($attr_name, $tmpState);
    }
    $session->set($attr_name, $state);
}


function grn_appmenu_get_state_last_access($user)
{
    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();
    $session = $session_manager->getSession('stateMenuApplication');
    $attr_name = 'last_state_applicationMenu';

    $state = $session->get($attr_name);
    // don't have value in session
    if (is_null($state)) {
        $state = '0';
        require_once('fw/profile.csp');
        $profile = cb_get_user_profile($user, 'grn.common.toggleMenu');
        if ($profile->getAttribute($attr_name, $tmpState)) {
            $state = $tmpState;
        }
        $session->set($attr_name, $state);
    }

    return $state;
}



