<?php
global $G_container_base;
$uum = $G_container_base->getInstance('uum');
$user = $uum->getLoginUser();

//generate upload ticket
require_once('grn/upload.csp');
$t->assign('upload_ticket', GRN_UploadTicket::create($user->getOID()));

require_once('grn/file.csp');
$filemanagerconfig = GRN_FileManagerConfig::getInstance();
$max = $filemanagerconfig->getMaxFileSize();

//GRN2-3579
$page_path = strtolower(cb_get_pagename());
$page_parts = explode('/', $page_path);
if (count($page_parts) > 1 && strcmp($page_parts[0], 'mail') == 0) {
    // Use the value of personal send mail limit to range max the upload file size for the mail module.
    require_once('mail/system_config.csp');
    $system_config->getSizeUserLimitSetting($size_settings, $user->getOID());
    $send_limit = $size_settings['send_limit_' . $user->getOID()];
    $max = $send_limit * 1024;
}
//GRN2-3579

$t->assign('max_filesize', $max);

$t->assign('url', cb_get_upload_path());

global $G_config_grn;
$grn_system_version = $G_config_grn->get('System', 'version');
$t->assign('grn_system_version', $grn_system_version);


