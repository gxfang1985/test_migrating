<?php

namespace grn\grn\background;

/**
 */
class BackgroundJobEvent
{
    /** @var BackgroundJob[] */
    private $listener;

    private $dao;

    /**
     * @param IBackgroundJobDAO $dao
     */
    public function __construct(IBackgroundJobDAO $dao)
    {
        $this->dao = $dao;
    }

    /**
     * @param               $jobName
     * @param BackgroundJob $job
     */
    public function addJobListener($jobName, BackgroundJob $job)
    {
        $this->listener[$jobName] = $job;
    }

    public function run()
    {
        $jobs = $this->dao->getJobs();
        foreach ($jobs as $job) {
            $jobListener = $this->listener[$job->getJobName()];
            $jobListener->run($job);
            $this->dao->removeJob($job);
        }
    }
}
