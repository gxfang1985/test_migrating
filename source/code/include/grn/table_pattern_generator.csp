<?php

class GRN_TablePatternGenerator
{
    const DB_REPRECATED = "master";
    const DB_SPACE = "space";
    const DB_STAR = "star";
    const DB_REPORT = "report";
    const DB_PRESENCE = "presence";
    const DB_LINK = "link";
    const DB_SCHEDULE = "schedule";
    const DB_MESSAGE = "message";
    const DB_BULLETIN = "bulletin";
    const DB_CABINET = "cabinet";
    const DB_MEMO = "memo";
    const DB_PHONEMESSAGE = "phonemessage";
    const DB_TIMECARD = "timecard";
    const DB_TODO = "todo";
    const DB_ADDRESS = "address";
    const DB_MAIL = "mail";
    const DB_WORKFLOW = "workflow";
    const DB_NOTIFICATION = "notification";
    const DB_PROFILE = "profile";
    const DB_KUNAI = "kunai";
    const DB_FAVOUR = "favour";

    const DB_OTHERS = "others";

    const APPLICATION_PORTAL = "portal";
    const APPLICATION_SPACE = "space";
    const APPLICATION_LINK = "link";
    const APPLICATION_SCHEDULE = "schedule";
    const APPLICATION_MESSAGE = "message";
    const APPLICATION_BULLETIN = "bulletin";
    const APPLICATION_CABINET = "cabinet";
    const APPLICATION_MEMO = "memo";
    const APPLICATION_PHONEMESSAGE = "phonemessage";
    const APPLICATION_TIMECARD = "timecard";
    const APPLICATION_TODO = "todo";
    const APPLICATION_ADDRESS = "address";
    const APPLICATION_MAIL = "mail";
    const APPLICATION_WORKFLOW = "workflow";
    const APPLICATION_REPORT = "report";
    const APPLICATION_CBWEBSRV = "cbwebsrv";
    const APPLICATION_RSS = "rss";
    const APPLICATION_PRESENCE = "presence";
    const APPLICATION_STAR = "star";
    const APPLICATION_NOTIFICATION = "notification";
    const APPLICATION_CELLULAR = "cellular";
    const APPLICATION_DEZIELINK = "dezielink";
    const APPLICATION_KUNAI = "kunai";
    const APPLICATION_FAVOUR = "favour";

    public function getAllDatabaseNames()
    {
        return [
            self::DB_REPRECATED,
            self::DB_SPACE,
            self::DB_STAR,
            self::DB_REPORT,
            self::DB_PRESENCE,
            self::DB_LINK,
            self::DB_SCHEDULE,
            self::DB_MESSAGE,
            self::DB_BULLETIN,
            self::DB_CABINET,
            self::DB_MEMO,
            self::DB_PHONEMESSAGE,
            self::DB_TIMECARD,
            self::DB_TODO,
            self::DB_ADDRESS,
            self::DB_MAIL,
            self::DB_WORKFLOW,
            self::DB_NOTIFICATION,
            self::DB_PROFILE,
            self::DB_KUNAI,
            self::DB_FAVOUR,
        ];
    }

    public function getTablePatternsForDatabase($databaseName)
    {
        // DBと対応するテーブルのマッピング
        $tablesForEachDatabase = [
            self::DB_SPACE        => [
                'tab_grn_space%'
            ],
            self::DB_REPORT       => [
                'tab_grn_report%'
            ],
            self::DB_STAR         => [
                'tab_grn_star%'
            ],
            self::DB_PRESENCE     => [
                'tab_grn_presence%'
            ],
            self::DB_LINK         => [
                'tab_grn_link%'
            ],
            self::DB_SCHEDULE     => [
                'tab_grn_schedule%',
                'tab_grn_facility%'
            ],
            self::DB_MESSAGE      => [
                'tab_grn_message%'
            ],
            self::DB_BULLETIN     => [
                'tab_grn_bulletin%'
            ],
            self::DB_CABINET      => [
                'tab_grn_cabinet%'
            ],
            self::DB_MEMO         => [
                'tab_grn_memo%'
            ],
            self::DB_PHONEMESSAGE => [
                'tab_grn_phonemessage%'
            ],
            self::DB_TIMECARD     => [
                'tab_grn_timecard%'
            ],
            self::DB_TODO         => [
                'tab_grn_todo%'
            ],
            self::DB_ADDRESS      => [
                'tab_grn_address%',
                'tab_grn_access_abstractdata_addr%'
            ],
            self::DB_MAIL         => [
                'tab_grn_mail%'
            ],
            self::DB_WORKFLOW     => [
                'tab_grn_workflow%'
            ],
            self::DB_NOTIFICATION => $this->getNotificationTables(),
            self::DB_PROFILE      => [
                'tab_cb_profiledata___p%'
            ],
            self::DB_REPRECATED   => [
                'tab_cb_user',
                'tab_cb_group',
                'tab_cb_group_local',
                'tab_cb_role',
                'tab_grn_access_abstractdata',
                'tab_grn_sso_sso',
                'tab_cb_usergrouprelation',
                'tab_cb_userrolerelation',
                'tab_grn_mimetype',
                'tab_grn_userinfo',
                'tab_grn_file',
                'tab_cb_language_status',
                'tab_grn_useritem',
                'tab_grn_itemuserrelation',
                'tab_cb_user_name_language',
            ],
            self::DB_KUNAI        => [
                'tab_grn_kunai%'
            ],
            self::DB_FAVOUR       => [
                'tab_grn_favour%'
            ],
        ];

        return $tablesForEachDatabase[$databaseName];
    }

    private function getTablePatternsForAllApplicationDatabase()
    {
        return [
            self::APPLICATION_PORTAL       => [
                self::DB_OTHERS => [
                    "tab_grn_portal_%",
                    "tab_grn_abstractdata_prtl_%"
                ]
            ],
            self::APPLICATION_SPACE        => [
                self::DB_SPACE => [
                    "tab_grn_space_%"
                ]
            ],
            self::APPLICATION_LINK         => [
                self::DB_LINK => [
                    "tab_grn_link_%"
                ]
            ],
            self::APPLICATION_SCHEDULE     => [
                self::DB_SCHEDULE => [
                    'tab_grn_schedule_%',
                    'tab_grn_facility_%'
                ]
            ],
            self::APPLICATION_MESSAGE      => [
                self::DB_MESSAGE => [
                    "tab_grn_message_%"
                ]
            ],
            self::APPLICATION_BULLETIN     => [
                self::DB_BULLETIN => [
                    "tab_grn_bulletin%"
                ]
            ],
            self::APPLICATION_CABINET      => [
                self::DB_CABINET => [
                    "tab_grn_cabinet_%"
                ]
            ],
            self::APPLICATION_MEMO         => [
                self::DB_MEMO => [
                    "tab_grn_memo_%"
                ]
            ],
            self::APPLICATION_PHONEMESSAGE => [
                self::DB_PHONEMESSAGE => [
                    "tab_grn_phonemessage_%"
                ]
            ],
            self::APPLICATION_TIMECARD     => [
                self::DB_TIMECARD => [
                    "tab_grn_timecard_%"
                ]
            ],
            self::APPLICATION_TODO         => [
                self::DB_TODO => [
                    "tab_grn_todo_%"
                ]
            ],
            self::APPLICATION_ADDRESS      => [
                self::DB_ADDRESS => [
                    "tab_grn_address_%",
                    "tab_grn_access_abstractdata_addr%"
                ]
            ],
            self::APPLICATION_MAIL         => [
                self::DB_MAIL => [
                    "tab_grn_mail_%"
                ]
            ],
            self::APPLICATION_WORKFLOW     => [
                self::DB_WORKFLOW => [
                    "tab_grn_workflow_%"
                ]
            ],
            self::APPLICATION_REPORT       => [
                self::DB_REPORT => [
                    "tab_grn_report_%"
                ]
            ],
            self::APPLICATION_CBWEBSRV     => [
                self::DB_OTHERS => [
                    "tab_grn_cbwebsrv_%"
                ]
            ],
            self::APPLICATION_RSS          => [
                self::DB_OTHERS => [
                    "tab_grn_rss_%"
                ]
            ],
            self::APPLICATION_PRESENCE     => [
                self::DB_PRESENCE => [
                    "tab_grn_presence_%"
                ]
            ],
            self::APPLICATION_STAR         => [
                self::DB_STAR => [
                    "tab_grn_star%"
                ]
            ],
            self::APPLICATION_NOTIFICATION => [
                self::DB_NOTIFICATION => $this->getNotificationTables(),
                self::DB_OTHERS       => [
                    "tab_grn_notification_applicationid",
                    "tab_grn_notification_applicationname"
                ]
            ],
            self::APPLICATION_CELLULAR     => [
                self::DB_OTHERS => [
                    "tab_grn_cellular%"
                ]
            ],
            self::APPLICATION_DEZIELINK    => [
                self::DB_OTHERS => [
                    "tab_grn_dezielink_%"
                ]
            ],
            self::APPLICATION_KUNAI        => [
                self::DB_KUNAI => [
                    "tab_grn_kunai_%"
                ]
            ],
            self::APPLICATION_FAVOUR       => [
                self::DB_FAVOUR => [
                    "tab_grn_favour_%"
                ]
            ],
        ];
    }

    public function getNotificationTables()
    {
        global $G_config_common;
        if ($G_config_common->get('Database', 'merged')) {
            return [
                "tab_grn_notification_notify",
                "tab_grn_notification_history"
            ];
        }

        return [
            "tab_grn_notification_notify___%",
            "tab_grn_notification_history___%"
        ];
    }
}
