<?php

namespace grn\grn\customization\schedule;

use grn\grn\customization\JsApiEventInterface;

class CalendarMonthShowJsApiEvent implements JsApiEventInterface
{
    /**
     * @var array
     */
    private $input;

    /**
     * CalendarMonthShowJsApiEvent constructor.
     *
     * @param array $screen_properties
     */
    public function __construct(array $screen_properties)
    {
        $this->input = $screen_properties;
    }

    /**
     * @return string
     */
    public function getEventName(): string
    {
        return 'schedule.calendar.monthIndex.show';
    }

    /**
     * @return array
     */
    public function getInitData(): array
    {
        $init_data = [];
        //When display the portlet screen
        if (isset($this->input['portletId'])) {
            $init_data['portletId'] = $this->input['portletId'];
        }

        return $init_data;
    }

    /**
     * @return array
     */
    public function getEventData(): array
    {
        $weeks = array_slice($this->input['weeks'],
            $this->input['buffer_count'], $this->input['weeks_display']);
        $dates = [];
        foreach ($weeks as $week) {
            foreach ($week['schedule_event'] as $date) {
                $dates[] = $date["date"];
            }
        }
        $event_data = ['viewType' => 'MONTH', 'dates' => $dates];

        return $event_data;
    }
}
