<?php

require_once('fw/i18n.csp');
$charset = @$G_INPUT['charset'];
if ( ! $charset) {
    global $G_config_common;
    $charset = $G_config_common->get('I18N', 'default_external_encoding');
}
$put_title = @$G_INPUT['title'];

// エラーフックの登録
require_once('fw/csv.csp');
$csv = new CB_CSVWriter($charset);
$uum =& $G_container_base->getInstance('uum');

if ($put_title) {
    $line = [];
    $line[] = cb_msg('grn.common', 'role_foreign_key');
    $line[] = cb_msg('grn.common', 'role_description');
    $csv->writeLine($line);
}

$roles = $uum->listStaticRoles();
$role_keys = array_keys($roles);
foreach ($role_keys as $role_key) {
    //Adminは出力しない
    if ($role_key == GRN_UUM_ADMINISTRATION_ROLE) {
        continue;
    }
    $line = [];
    $foreign_key = $roles[$role_key]->get('foreign_key');
    $line[] = $foreign_key;
    $line[] = $roles[$role_key]->get('description');
    $csv->writeLine($line);

    $uum->execInspection('role', 'export',
        ['rid' => $role_key, 'foreign_key' => $foreign_key]);
}

$csv->close();


