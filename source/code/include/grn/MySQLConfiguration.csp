<?php

namespace grn\grn;

class MySQLConfiguration
{
    /** @var \CB_DatabaseConnection $db */
    private $db;
    private $pluginDirectory;

    public static function create()
    {
        return new self;
    }

    private function __construct()
    {
        $this->db = cb_get_master_db();
        $this->setPluginDirectory();
    }

    private function setPluginDirectory()
    {
        $result = $this->db->query("SHOW VARIABLES LIKE 'plugin_dir'");
        $row = $this->db->fetch_assoc($result);
        $this->pluginDirectory = is_null($row) ? "" : $row["Value"];
    }

    /**
     * returns whether event_scheduler is ON or OFF
     *
     * @return bool when event_scheduler is available, return true.
     */
    public function isAvailableEventScheduler()
    {
        $result = $this->db->query("SHOW VARIABLES LIKE 'event_scheduler'");
        $row = $this->db->fetch_assoc($result);

        return is_null($row) ? false : $row["Value"] === "ON";
    }

    /**
     * returns properties of plugin_dir. when plugin_dir is not set,
     * returns empty string.
     *
     * @return string
     */
    public function getPluginDirectory()
    {
        return $this->pluginDirectory;
    }

    /**
     * @return bool
     */
    public function isAvailablePluginDirectory()
    {
        return ! empty($this->pluginDirectory);
    }
}
