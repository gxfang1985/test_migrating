<?php

class GRN_SQLLoader
{
    public function loadNewQueries($applicationName, $databaseName)
    {
        return $this->loadSQL(implode(DIRECTORY_SEPARATOR,
            [
                cb_basedir(),
                "db",
                "schema",
                "{$applicationName}",
                "{$databaseName}.sql"
            ]));
    }

    public function loadInitQueries($applicationName, $databaseName)
    {
        return $this->loadSQL(implode(DIRECTORY_SEPARATOR,
            [
                cb_basedir(),
                "db",
                "init",
                "{$applicationName}",
                "{$databaseName}.sql"
            ]));
    }

    public function loadSQL($path)
    {
        $retval = [];
        if (file_exists($path)) {
            $content = file_get_contents($path);
            if ( ! $content) {
                return $retval;
            }

            foreach (explode(";\n", $content) as $eachQuery) {
                if ( ! preg_match('/^\s*$/', $eachQuery)) {
                    $retval[] = $eachQuery;
                }
            }
        }

        return $retval;
    }
}
