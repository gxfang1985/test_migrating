<?php
/**
 * Report Application Follow Manager Class
 *
 * @author  Shou Aoki 2009/09
 * @version 1.0
 * @package grn.report
 */

/** Report Application **/
require_once('report/resources.csp');
require_once('report/follow_manager_base.csp');

/**
 * Follow Manager Class
 *
 * @package grn.report
 */
class GRN_Report_Follow_Logic_Base
{
    /**
     * Constructor
     *
     * @return none
     */
    function __construct()
    {

    }

    private static $_instance = null;

    /**
     * Get Instance
     *
     * @return GRN_Report_Follow_Logic_Base
     */
    public static function getInstance()
    {
        if ( ! isset(self::$_instance)) {
            $c = __CLASS__;
            self::$_instance = new $c;
        }

        return self::$_instance;
    }

    /**
     * Get Column List
     *
     * @param  none
     *
     * @return array  $column_name_list          //Column Name List
     */
    function getColumnList()
    {
        //Get Column List
        $column_name_list
            =& GRN_Report_Table_Manager::getColumnlist(GRN_REPORT_TABLE_FOLLOW,
            null, true);

        //Return Column Name List
        return $column_name_list;
    }

    /**
     * Get Follow
     *
     * @param  int   $follow_id   //Follow ID
     * @param  int   $report_id   //Report ID
     * @param  array $column_list //Column List
     * @param  bool  $refresh     //Refresh Cache
     * @param  int   $lock_mode   //Lock Mode
     *
     * @return array  $follow                      //Follow Inreportation Array
     */
    function &get(
        $follow_id,
        $report_id = null,
        $column_list = [],
        $refresh = false,
        $lock_mode = CB_DATABASE_DEFAULT_LOCK
    ) {
        //Check Argument
        require_once('fw/string_util.csp');
        require_once('report/error_code.csp');
        cb_trim_check($follow_id, E_GRN_RPRT_FOLLOW_INVALID_ID);    //Follow ID

        //Get Follow 
        $follow_manager_base = GRN_Report_Follow_Manager_Base::getInstance();
        $follow =& $follow_manager_base->get($follow_id,
            $report_id, $column_list, $refresh, $lock_mode);
        if ( ! $follow) {
            //Follow Not Found
            require_once('report/error_code.csp');
            cb_throw_error(E_GRN_RPRT_FOLLOW_NOT_FOUND);
        }

        //Return Follow
        return $follow;
    }

    /**
     * Get Follow Direct
     *
     * @param  int   $follow_id   //Follow ID
     * @param  array $column_list //Column List
     * @param  int   $lock_mode   //Lock Mode
     *
     * @return array  $follow                      //Follow Inreportation Array
     */
    function getDirect(
        $follow_id,
        $column_list = [],
        $lock_mode = CB_DATABASE_DEFAULT_LOCK
    ) {
        //Check Argument
        require_once('fw/string_util.csp');
        require_once('report/error_code.csp');
        cb_trim_check($follow_id, E_GRN_RPRT_FOLLOW_INVALID_ID);    //Follow ID

        //Get Follow 
        $follow_manager_base = GRN_Report_Follow_Manager_Base::getInstance();
        $follow = $follow_manager_base->getDirect($follow_id,
            $column_list, $lock_mode);
        if ( ! $follow) {
            //Follow Not Found
            cb_throw_error(E_GRN_RPRT_FOLLOW_NOT_FOUND);
        }

        //Return Follow
        return $follow;
    }

    /**
     * Get Follow List
     *
     * @param  int   $report_id   //Report ID
     * @param  array $column_list //Column List
     * @param  array $option
     * @param  bool  $refresh     //Refresh Cache
     * @param  int   $lock_mode   //Lock Mode
     *
     * @return array  $follow_list                 //Follow Inreportation List
     */
    function &getList(
        $report_id = null,
        $column_list = [],
        $option = [],
        $refresh = false,
        $lock_mode = CB_DATABASE_DEFAULT_LOCK
    ) {
        //Get Follow List
        $follow_manager_base = GRN_Report_Follow_Manager_Base::getInstance();
        $follow_list =& $follow_manager_base->getList($report_id,
            $column_list, $option, $refresh, $lock_mode);

        //Return Follow List
        return $follow_list;
    }

    /**
     * Get Follow Count
     *
     * @param  int  $report_id //Report ID
     * @param  bool $refresh   //Refresh Cache
     * @param  int  $lock_mode //Lock Mode
     *
     * @return int    $follow_count                //Follow Count
     */
    function getCount(
        $report_id = null,
        $option = [],
        $refresh = false,
        $lock_mode = CB_DATABASE_DEFAULT_LOCK
    ) {
        //Get Follow List
        $follow_manager_base = GRN_Report_Follow_Manager_Base::getInstance();
        $follow_count = $follow_manager_base->getCount($report_id,
            $option, $refresh, $lock_mode);

        //Return Follow Count
        return $follow_count;
    }
}


