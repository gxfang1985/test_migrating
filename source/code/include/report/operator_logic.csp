<?php

/** Report Application **/
require_once('report/resources.csp');
require_once('report/table_manager.csp');

class GRN_Report_Operator_Logic
{
    static public function isReportOperator($user_id, $report_id)
    {
        $database = GRN_Report_Table_Manager::getDatabase();

        //Create Column List
        $column_list
            =& GRN_Report_Table_Manager::getColumnList(GRN_REPORT_TABLE_MEMBER);
        $column_list = implode(',', $column_list);

        $query = cb_queryf($database,
            'SELECT @S FROM tab_grn_report_member WHERE col_user = "@S" AND col_report = "@S" AND col_is_operator = "1" ORDER BY col_list_index ASC',
            $column_list, $user_id, $report_id);

        $result = $database->query($query);
        if ($result === false) {
            //Throw Query Error
            $database->throwError(['query' => 'query failed: ' . $query]);
        }

        if ($database->num_rows($result) > 0) {
            return true;
        }

        $database->free_result($result);
        $query = cb_queryf($database,
            'SELECT @S FROM tab_grn_report_notification WHERE col_user = "@S" AND col_report = "@S" AND col_is_operator = "1" ORDER BY col_list_index ASC',
            $column_list, $user_id, $report_id);

        $result = $database->query($query);
        if ($result === false) {
            //Throw Query Error
            $database->throwError(['query' => 'query failed: ' . $query]);
        }

        if ($database->num_rows($result) > 0) {
            return true;
        }

        return false;
    }
}
