<?php

namespace grn\mail\tnef;


class BinaryUtil
{
    private static $IS_LITTLE_ENDIAN = null;

    /**
     * @return bool
     */
    private static function machineByteOrderIsLittleEndian()
    {
        if (is_null(self::$IS_LITTLE_ENDIAN)) {
            $packed_by_machine_byte_order = pack('S', 0x00FF);
            $packed_by_little_endian = pack('v', 0x00FF);
            self::$IS_LITTLE_ENDIAN = ($packed_by_machine_byte_order
                                       === $packed_by_little_endian);
        }

        return self::$IS_LITTLE_ENDIAN;
    }

    /**
     * @param string $binary
     *
     * @return int
     */
    public static function binaryToUint32($binary)
    {
        return unpack('V', $binary)[1];
    }

    /**
     * @param string $binary
     *
     * @return int
     */
    public static function binaryToInt32($binary)
    {
        if (self::machineByteOrderIsLittleEndian()) {
            return unpack('l', $binary)[1];
        } else {
            return unpack('l', strrev($binary))[1];
        }
    }

    /**
     * @param string $binary
     *
     * @return int
     */
    public static function binaryToUint16($binary)
    {
        return unpack('v', $binary)[1];
    }

    /**
     * @param string $binary
     *
     * @return int
     */
    public static function binaryToInt16($binary)
    {
        if (self::machineByteOrderIsLittleEndian()) {
            return unpack('s', $binary)[1];
        } else {
            return unpack('s', strrev($binary))[1];
        }
    }
}
