<?php

namespace grn\mail\dao;

class GrnMailSourceFileBodyDAO
{
    /**
     * @param string $mailId
     * @param string $suffix
     *
     * @return string
     */
    public function getSourceFileBlobId($mailId, $suffix)
    {
        $db = $this->getDataBaseConnection();
        $query
            = $db->format("SELECT col_blob FROM tab_grn_mail_sourcefilebody___p{$suffix} WHERE col_mail='@S'",
            [$mailId]);
        $result = $db->query($query);
        $row = $db->fetch_assoc($result);
        $db->free_result($result);

        return isset($row['col_blob']) ? $row['col_blob'] : '';
    }

    /**
     * @return \CB_DatabaseConnection
     */
    private function getDataBaseConnection()
    {
        $app_locator = \GRN_ApplicationLocator::instance();

        return $app_locator->getConnection('mail');
    }
}
