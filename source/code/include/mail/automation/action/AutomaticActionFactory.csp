<?php

namespace grn\mail\automation\action;

require_once("fw/mail_message.csp");

class AutomaticActionFactory
{
    /**
     * @param $action
     * @param $message
     *
     * @return AutomaticAction
     */
    public function createAction($action, $message)
    {
        if (ActionNameConstraints::FORWARD_MAIL === $action) {
            $serializedMessage = $this->convertMessageToArray($action,
                $message);

            return new AutomaticForwardMail(
                \CB_MailAddress::static_parse_list($serializedMessage["forwardTo"])
            );
        }
        assert('false');

        return "";
    }

    /**
     * @param $action
     * @param $message
     *
     * @return array
     */
    public function convertMessageToArray($action, $message)
    {
        if (ActionNameConstraints::FORWARD_MAIL === $action) {
            return $this->convertAutoForwardMailMessage($message);
        }
        assert('false');

        return [];
    }

    /**
     * @param $message
     *
     * @return array|mixed
     */
    private function convertAutoForwardMailMessage($message)
    {
        $serialized_message = json_decode($message, true);
        if ( ! $serialized_message
             || ! isset($serialized_message["forwardTo"])
        ) {
            return [];
        }

        return $serialized_message;
    }

}
