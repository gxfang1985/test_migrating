<?php

namespace grn\mail\screen\personal\automation;

require_once("mail/utility.csp");


class AddEvent implements RegisterAction
{
    private $pageTitle;
    private $accountId;
    private $account;
    private $personalConfig;

    public function __construct($accountId)
    {
        $this->pageTitle = cb_msg("grn.mail.personal", "automation_add");
        $logged_in_user = cb_get_login_user();
        $this->personalConfig = \GRN_Mail_Utility::getInstance()
                                                 ->getPersonalConfig($logged_in_user);
        $this->accountId = (int)$accountId;
    }

    public function getSitePosition()
    {
        return [
            [
                'page'      => 'mail/personal/automation',
                'name'      => cb_msg("grn.mail.personal", "automation"),
                'accountId' => $this->accountId
            ],
            ['page' => '', 'name' => $this->pageTitle]
        ];
    }

    public function getTitle()
    {
        return $this->pageTitle;
    }

    public function getEvent()
    {

        return [
            "eventId"        => -1,
            "accountId"      => $this->account["id"],
            "eventName"      => "",
            "logicType"      => "AND",
            "serviceAccount" => $this->account["title"],
            "serviceStatus"  => true,
            "accountStatus"  => (int)$this->account["disabled"] === 0 ? true
                : false,
            "actions"        => [
                [
                    "actionName" => "grn.mail.automatic.forward",
                    "message"    => [
                        "forwardTo" => []
                    ]
                ]
            ],
            "conditions"     => [
                [
                    "evaluationMethod" => "contains",
                    "evaluationObject" => "subject",
                    "matchData"        => ""
                ]
            ]
        ];
    }
}
