<?php

namespace grn\fts;

class FileIcon
{
    const ICON_PREFIX = '/grn/image/cybozu/image-app-search/';
    const ICON_SUFFIX = '.png';
    const OTHER = 'fileOther';
    private static $AVAILABLE_EXTENSIONS_FILENAME
        = [
            'ppt'  => 'filePpt',
            'pptm' => 'filePpt',
            'pptx' => 'filePpt',
            'odp'  => 'filePpt',
            'doc'  => 'fileDoc',
            'docm' => 'fileDoc',
            'docx' => 'fileDoc',
            'odt'  => 'fileDoc',
            'xls'  => 'fileXls',
            'xlsm' => 'fileXls',
            'xlsx' => 'fileXls',
            'ods'  => 'fileXls',
            'pdf'  => 'filePdf',
            'txt'  => 'fileTxt',
        ];

    /**
     * @param \CB_ServerFile $file
     *
     * @return string
     */
    public static function getIconUrl(\CB_ServerFile $file)
    {
        $extension = self::extractExtension($file->get('name'));

        return self::getIconPath($extension);
    }

    /**
     * @param string $filename
     *
     * @return string  Return empty string if $filename has no period characters.
     */
    public static function extractExtension($filename)
    {
        $pos = strrpos($filename, '.');
        if ($pos === false) {
            return '';
        }

        return strtolower(substr($filename, $pos + 1));
    }

    /**
     * @param \CB_MailSinglePart $file
     *
     * @return string
     */
    public static function getIconUrlForMailFile(\CB_MailSinglePart $file)
    {
        $extension = self::extractExtension($file->getFilename());

        return self::getIconPath($extension);
    }

    /**
     * @param string $extension
     *
     * @return string
     */
    private static function getIconPath($extension)
    {
        if (array_key_exists($extension,
            self::$AVAILABLE_EXTENSIONS_FILENAME)
        ) {
            $fileName = self::$AVAILABLE_EXTENSIONS_FILENAME[$extension];

            return cb_get_app_path() . self::ICON_PREFIX . $fileName
                   . self::ICON_SUFFIX;
        }

        return cb_get_app_path() . self::ICON_PREFIX . self::OTHER
               . self::ICON_SUFFIX;
    }
}
