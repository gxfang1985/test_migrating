<?php

namespace grn\fts;


class FullIndexTarget
{
    /** @var int */
    private $lastId;
    /** @var FullIndexTargetRangeDAOInterface */
    private $dao;
    /** @var IndexTargetRange */
    private $targetRange;

    public function __construct(FullIndexTargetRangeDAOInterface $dao)
    {
        $this->dao = $dao;
        $this->lastId = $this->dao->getLastId();
    }

    /**
     * @return int
     */
    public function getStartId()
    {
        return $this->targetRange->getStartId();
    }

    /**
     * @return int
     */
    public function getEndId()
    {
        return $this->targetRange->getEndId();
    }

    /**
     * @param int $startId
     * @param     $limit
     *
     * @return void
     */
    public function initializeTargetRange($startId, $limit)
    {
        $this->targetRange = $this->dao->getTargetRange($startId, $limit);
    }

    /**
     * @param int $limit
     *
     * @return void
     */
    public function updateTargetRange($limit)
    {
        $oldTargetRange = $this->targetRange;
        $this->targetRange
            = $this->dao->getTargetRange($oldTargetRange->getEndId()
                                         + 1, $limit);
    }

    /**
     * @return boolean
     */
    public function isWithinLoop()
    {
        return $this->lastId !== 0
               && $this->lastId >= $this->targetRange->getStartId();
    }
}
