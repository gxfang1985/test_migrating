<?php

namespace grn\fts\message;

use grn\fts\DocumentConverterInterface;
use grn\fts\SearchDocumentInterface;
use grn\fts\SearchConstants;

class DocumentConverter implements DocumentConverterInterface
{
    /**
     * Convert a search result to view data of Garoon.
     *
     * @param \grn\fts\SearchDocumentInterface $document
     *
     * @return \grn\fts\DocumentView
     */
    public function convert(SearchDocumentInterface $document)
    {
        $converter = $this->getConverter($document);

        return $converter->convert($document);
    }

    /**
     * @param \grn\fts\SearchDocumentInterface $document
     *
     * @return \grn\fts\DocumentConverterInterface
     */
    private function getConverter(SearchDocumentInterface $document)
    {
        $tokens = explode(SearchConstants::DOCUMENT_ID_DELIMITER,
            $document->getId());
        if (count($tokens) === 3) {
            return new MessageConverter();
        }
        if (count($tokens) === 4 && substr($tokens[3], 0, 1) === 'C') {

            return new FollowConverter();
        }

        return new FileConverter();
    }
}
