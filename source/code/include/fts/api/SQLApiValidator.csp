<?php

namespace grn\fts\api;

use grn\fts\exception\SearchException;

class SQLApiValidator extends ApiValidator
{
    const MESSAGE = "message";
    const MAIL = "mail";
    const BULLETIN = "bulletin";
    const CABINET = "cabinet";

    private $supported_apps
        = [
            self::MESSAGE,
            self::MAIL,
            self::BULLETIN,
            self::CABINET
        ];

    /**
     * @param SearchApiParameter $parameter
     */
    public function validateParameter(SearchApiParameter $parameter)
    {
        $apps = $parameter->getApps();
        if (empty($apps) || ! in_array($apps[0], $this->supported_apps)) {
            throw new SearchException("Invalid Access From " . $apps[0]);
        }

        $app_name = $apps[0];

        if ($app_name === self::MESSAGE || $apps === self::MAIL) {
            if (strlen($parameter->getKeyword()) !== 0) {
                throw new SearchException('keyword is not required parameter');
            }
        }

        if (($app_name === self::BULLETIN || $apps === self::BULLETIN)
            || ($app_name === self::CABINET || $apps === self::CABINET)
        ) {
            $this->validateIds($parameter);
            $this->validateStart($parameter);
            $this->validateTarget($parameter);
        } else {
            parent::validateParameter($parameter);
        }

    }
}
