<?php
/**
 * @author HATA,Shinya
 *
 *  Smarty関数の {cb_date_format} は内部でPHP関数の cb_date_format() を呼んでいるので、
 *  本テストケースでは、正確に cb_date_format() を呼べているかどうかをチェックし、
 *  引数をいろいろ代えてみての cb_date_format() 自体のテストについては
 *  cb_date_format() のテストケースに任せる
 */
require_once 'developer/azunit.csp';
require_once 'fw/smarty_bridge.csp';
require_once 'fw/i18n.csp';
require_once 'plugins/function.cb_date_format.php';

/**
 *  smarty_function_cb_date_format($params, & $smarty)
 */
class test_smarty_function_cb_date_format extends CB_TestCase
{
    var $_smarty = null;

    function test_smarty_function_cb_date_format($test_method)
    {
        parent::CB_TestCase($test_method);

        $this->_smarty = new CB_Smarty;
    }

    function test_Date()
    {
        $i18n = CB_I18N::getInstance();
        $i18n->setCurrentLocale('ja');
        $params = [
            'format' => 'DateMiddle_YMD',
            'date'   => '2004-03-22 00:00:00'
        ];
        $actual = smarty_function_cb_date_format($params, $this->_smarty);
        $expect = '2004/3/22';
        $this->assertStringEquals($expect, $actual);
    }

    function test_NoDate()
    {
        $i18n = CB_I18N::getInstance();
        $i18n->setCurrentLocale('ja');
        $params = ['format' => 'DateMiddle_YMD'];
        $actual = smarty_function_cb_date_format($params, $this->_smarty);
        $expect = date('Y/n/j');
        $this->assertStringEquals($expect, $actual);
    }

    function test_NoFormat()
    {
        //no format is 'DateTimeCompact'
        $i18n = CB_I18N::getInstance();
        $i18n->setCurrentLocale('ja');
        $i18n->setCurrentTimeNotation('24');
        $params = ['date' => '2004-03-22 00:00:00'];
        $actual = smarty_function_cb_date_format($params, $this->_smarty);
        $expect = "2004/3/22（月）";
        $this->assertStringEquals($expect, $actual);
    }
}

cb_test_run();

?>
