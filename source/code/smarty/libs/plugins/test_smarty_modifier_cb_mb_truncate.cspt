<?php
/**
 * @author HATA,Shinya
 *
 *  Smarty修飾子の cb_mb_truncate は内部でPHP関数の mb_strimwidth() を呼んでいるので、
 *  本テストケースでは、正確に mb_strimwidth() を呼べているかどうかをチェックする
 */
require_once 'developer/azunit.csp';
require_once 'fw/smarty_bridge.csp';
require_once 'fw/i18n.csp';
require_once 'plugins/modifier.cb_mb_truncate.php';

/**
 *  smarty_modifier_cb_mb_truncate($params, & $smarty)
 */
class test_smarty_modifier_cb_mb_truncate extends CB_TestCase
{
    var $_smarty = null;

    function test_smarty_modifier_cb_mb_truncate($test_method)
    {
        parent::CB_TestCase($test_method);

        $this->_smarty = new CB_Smarty;
    }

    function test()
    {
        $string = "あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやいゆえよらりるれろわゐうゑをん";

        $actual = smarty_modifier_cb_mb_truncate($string);
        $expect = "あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやいゆ...";
        $this->assertStringEquals($expect, $actual);

        $actual = smarty_modifier_cb_mb_truncate($string, 10);
        $expect = "あいう...";
        $this->assertStringEquals($expect, $actual);

        $actual = smarty_modifier_cb_mb_truncate($string, 10, '…');
        $expect = "あいうえ…";
        $this->assertStringEquals($expect, $actual);

        $actual = smarty_modifier_cb_mb_truncate($string, 10, '');
        $expect = "あいうえお";
        $this->assertStringEquals($expect, $actual);

        $actual = smarty_modifier_cb_mb_truncate($string, 11);
        $expect = "あいうえ...";
        $this->assertStringEquals($expect, $actual);

        $actual = smarty_modifier_cb_mb_truncate($string, 11, '…');
        $expect = "あいうえ…";
        $this->assertStringEquals($expect, $actual);

        $actual = smarty_modifier_cb_mb_truncate($string, 11, '');
        $expect = "あいうえお";
        $this->assertStringEquals($expect, $actual);
    }

    /*<BTS:486>*/
    function test2()
    {
        $string = "あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやいゆえよらりるれろわゐうゑをん";
        $actual = smarty_modifier_cb_mb_truncate($string, 11, '÷');
        $expect = "あいうえ÷";
        $this->assertStringEquals($expect, $actual);
    }
}

cb_test_run();

?>
