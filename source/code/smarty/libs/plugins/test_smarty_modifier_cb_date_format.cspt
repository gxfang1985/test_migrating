<?php
/**
 * @author HATA,Shinya
 *
 *  Smarty修飾子の cb_date_format は内部でPHP関数の cb_date_format() を呼んでいるので、
 *  本テストケースでは、正確に cb_date_format() を呼べているかどうかをチェックし、
 *  引数をいろいろ代えてみての cb_date_format() 自体のテストについては
 *  cb_date_format() のテストケースに任せる
 *
 *  smarty_modifier_cb_date_format() は関数外の範囲で $smarty を Smarty オブジェクト
 *  として参照しているので、テストケースではテスト関数内で require_once する必要がある
 */
require_once 'developer/azunit.csp';
require_once 'fw/smarty_bridge.csp';
require_once 'fw/i18n.csp';

/**
 *  smarty_modifier_cb_date_format($params, & $smarty)
 */
class test_smarty_modifier_cb_date_format extends CB_TestCase
{
    var $_smarty = null;

    function test_smarty_modifier_cb_date_format($test_method)
    {
        parent::CB_TestCase($test_method);

        $this->_smarty = new CB_Smarty;
    }

    function test_Date()
    {
        $smarty =& $this->_smarty;
        require_once 'plugins/modifier.cb_date_format.php';

        $i18n = CB_I18N::getInstance();
        $i18n->setCurrentLocale('ja');
        $string = '2004-03-22 00:00:00';
        $resource_key = 'DateMiddle_YMD';
        $actual = smarty_modifier_cb_date_format($string, $resource_key);
        $expect = '2004/3/22';
        $this->assertStringEquals($expect, $actual);
    }

    function test_NoDate_Default()
    {
        $smarty =& $this->_smarty;
        require_once 'plugins/modifier.cb_date_format.php';

        $i18n = CB_I18N::getInstance();
        $i18n->setCurrentLocale('ja');

        $string = '';
        $resource_key = 'DateMiddle_YMD';
        $default_date = '2004-03-23 00:00:00';

        $actual = smarty_modifier_cb_date_format($string, $resource_key,
            $default_date);
        $expect = '2004/3/23';
        $this->assertStringEquals($expect, $actual);
    }

    function test_NoDate_NoDefault()
    {
        $smarty =& $this->_smarty;
        require_once 'plugins/modifier.cb_date_format.php';

        $i18n = CB_I18N::getInstance();
        $i18n->setCurrentLocale('ja');

        $string = '';
        $resource_key = 'DateMiddle_YMD';

        $actual = smarty_modifier_cb_date_format($string, $resource_key);
        $expect = '';
        $this->assertStringEquals($expect, $actual);
    }
}

cb_test_run();

?>
