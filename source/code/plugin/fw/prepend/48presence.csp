<?php
global $G_INPUT;
global $G_config_common;

if ( ! cb_is_init_process()) {
    // get login user
    global $G_container_base;
    $uum = $G_container_base->getInstance('uum');
    $login_user = $uum->getLoginUser();
    if ($login_user && is_a($login_user, 'CB_User')) {
        // get presence
        require_once('presence/logic.csp');
        $presence_logic = GRN_Presence_Logic::getInstance();
        $presence_user = $presence_logic->getPresence($login_user->getOID());
        $mtime = $presence_user['mtime'];

        //get current period start today 00:00
        $start_today_time = new CB_TimeStampEx();
        $current_date = $start_today_time->getDateTime();
        $current_date->hour = 0;
        $current_date->minute = 0;
        $current_date->second = 0;
        $start_today_time->setDateTime($current_date);

        $call = false;
        // not presence
        if ( ! $mtime) {
            $call = true;
        } else {
            // presence is yesterday
            if ($start_today_time->compare($mtime) > 0) {
                $call = true;
            }
        }

        // call auto_set_attend
        if ($call) {
            include('presence/auto_set_attend.csp');
        }
    }
}

