<?php

function plugin_fw_uum_login_grn_set_cookie($user)
{
    global $G_config_common, $G_INPUT;

    $use_cookie = @$G_INPUT['use_cookie'];

    $is_standard = strcmp($G_config_common->get('Global', 'php'), 'standard')
                   == 0;
    $path = cb_get_page_prefix();
    $pos = strrpos($path, '/');
    if ($is_standard || $pos === false) {
        $path .= '/';
    } else {
        $path = substr($path, 0, $pos + 1);
    }

    //Security setting for cookie
    require_once('fw/miscFunctions.csp');
    $cookie_httponly = cb_is_cookie_httponly();
    $cookie_secure = cb_is_cookie_secure();

    if ($use_cookie) {
        if ($use_cookie != -1) {
            // set login cookies
            require_once('fw/system_admin.csp');
            $sa = CB_SystemAdmin::getInstance();
            $lifetime = (int)$sa->getCookieLifetime();
            $expire = time() + 3600 * 24 * $lifetime;

            if (array_key_exists('_account', $G_INPUT)) {
                setcookie('GRN_Account', $G_INPUT['_account'], $expire, $path,
                    '', $cookie_secure, $cookie_httponly);
            }
        }
    } else {
        $expire = time() - 3600 * 24 * 365;
        setcookie('GRN_Account', '', $expire, $path, '', $cookie_secure,
            $cookie_httponly);
    }
}

