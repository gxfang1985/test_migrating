<?php

use grn\grn\access\service\AppAccess;
use grn\grn\Validate;

require_once('bulletin/application.csp');
require_once('bulletin/table.csp');


class plugin_grn_common_user_select_bulletin
{

    function evalGroups($groups, $params, $user_pulldown = false)
    {
        return $groups;
    }

    function evalUsers($users, $params)
    {
        if ( ! is_array($users) || count($users) == 0) {
            return $users;
        }

        $users = AppAccess::filterUserIdsInternalAccessByAppId($users,
            'bulletin');
        $users = array_values($users);

        $category_id = cb_at($params, 'category_id', null);
        if ( ! $category_id || ! Validate::isNumber($category_id)) {
            return $users;
        }

        require_once('bulletin/category.csp');
        $category = null;
        $factory = GRN_Bulletin_CategoryFactory::getInstance();
        $category = $factory->get($category_id);
        if ( ! $category) {
            return $users;
        }

        $users = $category->checkMaintainerUsersAccess($users);

        return $users;
    }
}
