<?php

require_once('developer/azunit.csp');
require_once('address/application.csp');
require_once(cb_basedir() . '/code/plugin/grn/address/cyde.csp');

class test_plugin_grn_address_cyde extends CB_TestCase
{
    var $_table_manager = null;
    var $_book_factory = null;

    function test_plugin_grn_address_cyde($test_method)
    {
        parent::CB_TestCase($test_method);

        global $G_container_base;
        $this->_table_manager
            =& $G_container_base->getInstance('table_manager');

        $this->_book_factory = new plugin_grn_address_cyde();
    }

    function test_newBook1()
    {
        $data_types = [GRN_ADDRESS_DATA_SHARED, GRN_ADDRESS_DATA_PRIVATE];
        foreach ($data_types as $data_type) {
            $class_name = 'GRN_Address_' . $data_type . 'Book';
            $table_info =& $this->_table_manager->getTableInfo($class_name);

            $children = [];
            $row =& $table_info->newRow();

            $book =& $this->_book_factory->newBook($data_type, $children, $row);
            assert('is_object( $book ) && is_a( $book, \'GRN_Address_Cyde_Book\' )');

            $row->delete();
        }
    }

}

cb_test_run();

?>
