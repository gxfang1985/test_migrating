<?php
global $G_INPUT;
global $G_container_base;
$uum =& $G_container_base->getInstance('uum');

if ( ! $uum->getLoginUser()) {
    cb_safe_exit();//何もせず終了
} else {
    //ログイン済ブラウザからの直アクセス対策
    require_once('fw/session_manager.csp');
    $session_manager = CB_SessionManager::getInstance();
    $session =& $session_manager->getSession('grn.csrf');
    $csrf_ticket = '';
    $csrf_ticket = $session->get('csrf_ticket');
    require_once('fw/csrf.csp');
    cb_csrf_validate_token($csrf_ticket);

    //LDAPの場合は基本システムの管理権限以上を持っていない場合はエラー
    //つまり，運用管理者でもエラーになります
    require_once('grn/system_logic.csp');
    $system = GRN_System::getInstance();
    $logged_in_user = $uum->getLoginUser();
    if ( ! $system->adminSubSystem('user', $logged_in_user)) {
        require_once('fw/error_code.csp');
        cb_throw_error(E_GRN_NO_SYSTEM_PRIVILEGE);
    }

    cb_switch_page('/system/user/command_user_import2.csp');
}
