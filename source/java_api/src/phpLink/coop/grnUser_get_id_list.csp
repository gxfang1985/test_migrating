<?php
/**
 * Program_Name        :  ユーザーIDとログイン名のリストを取得します。
 * File_Name           :  grnUser_get_id_list.csp
 * Producer            :  cybozu
 * Programming_Date    :  2008/01/22
 * Comment             :  IDの昇順
 *
 * History:
 *    Date         Name             Title
 * 2008/01/22     cybozu          新規作成
 */

global $G_INPUT;

$nextpage = "coopLogin.csp";
if (is_file(cb_basedir() . '/code/doc_root/' . dirname(cb_get_pagename()) . '/'
            . $nextpage)
) {

    //ログイン認証
    require('coopLogin.csp');
    unset($uum);

    global $G_container_base;
    $db =& $G_container_base->getInstance('dbconn');

    $list = [];
    $query
        = 'SELECT _id,col_foreign_key FROM tab_cb_user WHERE col_deleted IS NULL order by _id';
    $result = $db->query($query);
    if ($result !== false) {
        $i = 0;
        while ($row = $db->fetch_assoc($result)) {
            $list[$row['_id']] = $row['col_foreign_key'];
        }
    }

    foreach ($list as $id => $name) {

        $param = "%id%,\"%name%\"\r\n";
        $coulum = str_replace('%id%', $id, $param);
        $coulum = str_replace('%name%', mb_ereg_replace('"', '""', $name),
            $coulum);
        echo $coulum;
    }
} else {
    //コピーライトとHTML閉じタグ出力しない
    global $G_state_set;
    $G_state_set->set('copyright_should_be_written', false);
    $G_state_set->set('html_should_be_closed', false);

    include_once('error_code.csp');
    header("X-Cybozu-Error:" . E_API_COMMON_COOPLOGIN_NOT_FOUND);
    print("<Header Data><CR><LF>");
    print("1," . E_API_COMMON_COOPLOGIN_NOT_FOUND);
    print("<Footer Data><CR><LF>");
    print("ERROR<CR><LF>");
    cb_safe_exit();
}



