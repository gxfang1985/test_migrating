<?php

function api_xml_write_map_data($xml_writer, $xml_map)
{
    // 指定項目の書出し
    foreach ($xml_map as $key => $val) {
        if (array_key_exists('writeType', $val)) {
            $xml_writer->startElement($key);

            if (isset($val['value']) && strlen($val['value']) > 0) {
                call_user_func([$xml_writer, $val['writeType']], $val['value']);
            }

            $xml_writer->endElement();
        }
    }
}

function api_escape_cdata($value)
{
    return str_replace(']]>', ']]]]><![CDATA[>', $value);
}

// 日付の書式 2007-04-01T12:00:00+9:00 の形にする
function api_format_datetime($value)
{
    $val = null;

    if (is_a($value, 'cb_timestamp')) {
        $val = date('Y-m-d\TH:i:sO', $value->unix_ts);
    } else {
        $val = date('Y-m-d\TH:i:sO', $value);
    }

    return $val;
}
