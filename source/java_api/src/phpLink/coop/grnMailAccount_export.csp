<?php
/*
* Created on 2007-03-26
*
* メールアカウントCSV書出し
* 
* ■受信データ仕様 
* 名前       | 必須 |   値    | 個数 | 備考
* ----------------------------|------------------------------------------------------------------------
* charset    |  ×  | 文字列  |  1   | 文字コード(1の場合 SJIS-win、 0 の場合 UTF-8)
* item_name  |  ×  | 文字列  |  1   | 先頭行の項目名
* system     |  ○  | 固定値  |  1   | "2"  ※"2"の場合、ガルーン2のシステム設定を指定する
*            |      |         |      | →coopLogin.cspにて、各アプリケーションオブジェクトの生成時使用
* manage     |  ○  | 固定値  |  1   | "mail"
*            |      |         |      | →coopLogin.cspにて、各アプリケーションオブジェクトの生成時使用
* ■機能
* ・文字コードと先頭行のスキップを指定して、ガルーン２からメールアカウントのCSVファイルを出力することができる
*/

global $G_INPUT;

// coopLogin.cspのファイル存在
if ( ! is_file('coopLogin.csp')) {
    global $G_state_set;
    $G_state_set->set('copyright_should_be_written', false);
    $G_state_set->set('html_should_be_closed', false);

    include_once('error_code.csp');

    header("X-Cybozu-Error:" . E_API_COMMON_COOPLOGIN_NOT_FOUND);
    print("<Header Data><CR><LF>");
    print("1," . E_API_COMMON_COOPLOGIN_NOT_FOUND);
    print("<Footer Data><CR><LF>");
    print("ERROR<CR><LF>");
    cb_safe_exit();
}
// ログイン認証
require('coopLogin.csp');
unset($uum);

//---------------------------------------------
//  アプリケーションの使用/停止状態をチェック
//---------------------------------------------
require_once('grn/application.csp');
$locator = GRN_ApplicationLocator::instance();
if ( ! ($G_application =& $locator->getInstance($G_INPUT['manage']))) {
    require_once('grn/error_code.csp');
    cb_throw_error(E_GRN_APPLICATION_NOT_ACTIVE);
}
unset($locator);


//-------------------------------------------------
//  CSVファイルへの書出し(メールアカウント)
//-------------------------------------------------
require(cb_basedir()
        . '/code/doc_root/mail/system/command_user_account_export.csp');

