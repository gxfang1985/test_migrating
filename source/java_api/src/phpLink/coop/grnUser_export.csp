<?php
/*
* Updated on 2011-03-31　 クラスのオブジェクトの作成し、関数を呼び出す
*/
global $G_INPUT;
/////////////////////////////////////////////////////////////////////////////////////////
//20061120修正
//coopファイルが存在しないとFatal Erorrになるためファイル存在チェック
//$nextpage = basename($G_INPUT['page']);
$nextpage = "coopLogin.csp";
if (is_file(cb_basedir() . '/code/doc_root/' . dirname(cb_get_pagename()) . '/'
            . $nextpage)
) {
    //20061120修正
    //require( $nextpage );
} else {
    //コピーライトとHTML閉じタグ出力しない
    global $G_state_set;
    $G_state_set->set('copyright_should_be_written', false);
    $G_state_set->set('html_should_be_closed', false);

    //   2007/03/27 coopLogin.cspがない場合のエラーメッセージ修正 不具合管理(199)
    include_once('error_code.csp');
    header("X-Cybozu-Error:" . E_API_COMMON_COOPLOGIN_NOT_FOUND);
    print("<Header Data><CR><LF>");
    print("1," . E_API_COMMON_COOPLOGIN_NOT_FOUND);
    print("<Footer Data><CR><LF>");
    print("ERROR<CR><LF>");
    cb_safe_exit();
}

//ログイン認証
require('coopLogin.csp');

/////////////////////////////////////////////////////////////////////////////////////////
unset($uum);

include(ini_get('doc_root') . '/system/user/_prepend.csp');       //G2.5対応
$logic = &_grn_get_privilege_logic();                                  //G2.5対応

//-----------------------------------------
//  CSVファイルへの書き出し(ユーザー情報)
//-----------------------------------------
cb_prepare_download('users.csv', 'application/csv', false);
require('grn/_export_user.csp');
$objGrnExportUser = new GrnExportUserCSV();
$objGrnExportUser->execute($G_INPUT);

