LDAP連携キット for ガルーン2

【目次】
1. ファイル一覧
2. JNDI について
3. CSV変換設定ファイルについて
4. 使用上の注意
5. 使いかた
  5-1. Ldap2Export
  5-2. Ldap2Sync


========================================================================
1. ファイル一覧
========================================================================

●Ldap2Export.java
  LDAPサーバーと通信し、設定内容に従ってユーザー/所属組織の情報をCSV
  ファイルに書き出すコマンドラインユーティリティです。

●Ldap2Sync.java
  LDAPサーバーのユーザー/所属組織の情報を、ガルーンに送るコマンドラ
  インユーティリティです。

●jndi.properties
  LdapExport と LdapSync が使用する、JNDI (Java Naming and Directory
  Interface) の設定ファイルです。適宜書換えて使用します。

●ldap2csv.cfg
  共通で使用する、LDAPの情報をガルーン用に変換するためのサンプル設定
  ファイルです。LDAPサーバーの設定に合わせて書換えて使用します。


========================================================================
2. JNDI について
========================================================================

Ldap2Export と Ldap2Sync (jp.co.cybozu.garoon2.LdapToCSV) クラスでは JNDI
という標準インターフェースを使用して LDAP サーバーと通信しています。

JNDI インターフェースでは LDAP サーバーとの通信にいくつかのパラメータを
設定する必要があります。ここでは、Ldap2Export クラスと同じディレクトリに
 "jndi.properties" ファイルを置く方法を採用しています。

jndi.properties ファイルの設定内容の詳細については、Sun の JNDI
チュートリアルをご覧ください。
http://java.sun.com/products/jndi/tutorial/

初期状態でも多くの場合は不都合ありませんが、ユーザーや組織の検索に何らか
の認証が必要であれば、下部のログイン設定を適切に変更します。
Microsoft の ActiveDirectory や、Novell の eDirectory では、匿名認証では
一部のエントリや属性値が取得できません。

なお、jp.co.cybozu.garoon2.LdapToCSV ではコンストラクタに環境を渡す方法で
も JNDI のパラメータを指定できます。


========================================================================
3. CSV変換設定ファイルについて
========================================================================

LDAPの情報をガルーンに変換するために、どの属性がどの項目に対応するのか等
の設定が必要です。ここにあるサンプルソースではファイルから設定情報を読み
込みます。

このディレクトリにはサンプルの設定ファイルとして、"ldap2csv.cfg" を用意
してありますが、LDAPサーバー上の情報に合わせて編集が必要です。

設定は一行ずつ "(設定名)=(値)" の形式で行います。空行と、'#' から始まる
行は無視されます。設定ファイルでは、日本語(EUC, Shift_JIS, ISO-2022-JP)
の文字列を使用可能です。以下に、各設定項目の意味を示します。


設定名		|解説	
----------------+-------------------------------------------------------
ldapURL		|例) ldap://localhost:389/
		|LdapExport (jp.co.cybozu.garoon.LdapToCSV) クラスで使用
		|する、LDAP サーバーの URL です。
----------------+-------------------------------------------------------
userDN		|例) ou=Users,dc=cybozu,dc=co,dc=jp
		|ユーザーのエントリを検索する、基点となるエントリの DN
		|を指定します。複数指定する場合、"userDN1", "userDN2",
		|"userDN3", ... のように、後に数値を付加して指定します。
		|
		|少くとも一つを指定しなければなりません。
		|【注意】エントリの値の先頭に"#"がある場合,DNは正しく解
　　　　　　　　|　　　　釈されません。
----------------+-------------------------------------------------------
userFilter	|例) (&(objectclass=inetOrgPerson)(uid=*))
		|ユーザーのエントリを検索するための、検索フィルターを指
		|定します。RFC2254 で規定された形式で指定します。
		|
		|必須設定です。
----------------+-------------------------------------------------------
account		|例) name
		|ユーザーのログイン名に変換する属性名を指定します。
		|
		|必須設定です。なおかつ、エントリはこの属性を持っている
		|必要があります。
----------------+-------------------------------------------------------
name		|例) displayname
		|ユーザーの名前に変換する属性名を指定します。
		|
		|必須設定です。
----------------+-------------------------------------------------------
newaccount	|ユーザーの新ログイン名用のフィールドです。
		|設定する場合は"account"と同じフィールドを指定してください。
		|何も設定しなかった場合、csvの該当フィールドには*を設定します。
----------------+-------------------------------------------------------
password	|ユーザーの平文パスワードに変換する属性名を指定します。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
		|
		|【注意】大抵のLDAPサーバーにおいて、パスワードは取り出
                |　　　　せません。
----------------+-------------------------------------------------------
priority	|ユーザーの表示優先度用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
state   	|例) userAccountControl(514)
stateUse        |ユーザーの使用/停止用のフィールドです。
		|(1:使用 /0:停止)
		|LDAPのアカウントが有効の場合は、1:使用が設定され、それ
		|以外の場合は、0:停止が設定されます。
		|この項目を出力する場合は、stateには無効化フラグが設定
                |される属性名を指定し、stateUseにはそのフラグ値を指定し
                |ます。
----------------+-------------------------------------------------------
delete		|ユーザーの削除フラグ用のフィールドです。
		|1：削除
		|0,空白：削除でない
		|何も設定しなかった場合、csvの該当フィールドには*を設定
		|します。
		|上記以外の値の場合、ユーザー情報のガルーン送信時にエラー
		|になり、登録がおこなわれません。
----------------+-------------------------------------------------------
phonetic	|ユーザーのよみ用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
mail		|ユーザーのE-mail用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
description	|ユーザーのメモ用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
executive	|ユーザーの役職用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
contact		|ユーザーの連絡先用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
url		|ユーザーのURL用のフィールドです。
		|何も設定しなかった場合、csvの該当フィールドには*を設定
                |します。
----------------+-------------------------------------------------------
userInfo1	|ユーザーの拡張フィールド用です。
userInfo2	|下記項目のコメントアウトを外すことで、CSVフィールドを
userInfo3       |追加できます。
                |(最大3つ)
----------------+-------------------------------------------------------
belongCode	|例) department
		|ユーザー所属組織の組織コードに変換する属性名を指定します。
                |その属性に格納された文字列のうち、「,」を区切り文字と
                |して判断します。
----------------+-------------------------------------------------------

※「属性名を指定」という項目で、属性名に "dn" を指定すると、エントリの
　DN を使用することができます。

※「属性名を指定」という項目を省略すると、書き出されるユーザー CSV の
　該当項目は "*" になります。組織図 CSV の該当項目は空欄になります。


========================================================================
4. 使用上の注意
========================================================================

a. もしユーザーの平文パスワードが入手可能であれば、ガルーンのシングルサ
   インオン設定で、「LDAP認証」を設定する必要はありません。

b. Ldap2Export と Ldap2Sync (jp.co.cybozu.garoon2.LdapToCSV) では、ユーザー
   数が多い場合に LDAP サーバーの検索数の制限のため、全員を書き出せない
   ことがあります。そのような場合は、LDAP サーバーの設定を変更します。

c. LDAPの識別名(ou)の先頭カラムに#が付いた識別名にすると「LDAP連携キット」
   では、コメントとして扱われるために連携処理は正常に行いません。
　 識別名には、#付きの識別名は使用しないでください。


========================================================================
5. 使いかた
========================================================================

●5-1. Ldap2Export

【書式】 java Ldap2Export CONFIG [OPTIONS]

CONFIG には、3 節で解説した変換設定ファイルを指定します。

【オプション】
-charset  SJIS          エンコードがUTF8の場合は、'-charset UTF8'を設定し、
　　　　　　　　　　　　SJISの場合は、'-charset SJIS'として設定します。

jp.co.cybozu.garoon2.LdapToCSV クラスの単純なラッパーです。LDAPサーバーと
通信し、ユーザー/所属組織図の CSV ファイルを、それぞれカレントディレクト
リの "users.csv", "user_ounits.csv" という名前で書き出します。


●5-2. Ldap2Sync

【書式】 java Ldap2Sync CONFIG [OPTIONS]

CONFIG には、3 節で解説した変換設定ファイルを指定します。

【オプション】
-h			コマンドの簡単な説明を表示して終了します。

-o 	  URL		ガルーンシステムの URL を指定します。
			省略すると、標準入力での入力を求められます。

-u 	　USER		ガルーンシステムにログインする利用者名を指定しま
			す。
			省略すると、標準入力での入力を求められます。

-p 	　PASSWORD	ガルーンシステムにログインするためのパスワードを
			指定します。省略すると、標準入力での入力を求めら
			れます。

-charset  SJIS          エンコードがUTF8の場合は、'-charset UTF8'を設定し、
　　　　　　　　　　　　SJISの場合は、'-charset SJIS'として設定します。

jp.co.cybozu.garoon2.LdapToCSV クラスを利用して、ユーザー/所属組織の情報
を取得し、下記のクラスを利用してガルーンに送信します。
　　jp.co.cybozu.garoon2.userGrnLink2
　　jp.co.cybozu.garoon2.belongGrnLink2 
