[[概要|section:abstract]]
[[LDAP|http://www.keyman.or.jp/search/30000422_1.html]] (Lightweight Directory Access Protocol) は数多くのアクセス(主に read)
を効率良く提供することに特化された分散ディレクトリ技術です。
DNS や NIS を知っていれば、それを汎用化した技術であると考えれば理解しやすいと思います。

Azaleaを使用した製品では、LDAPを使用した連携が必須になるはずですので、その為のクライアントAPIをフレームワークとして提供しています。

[[設計|section:design]]
LDAPに関してはたくさんの場所で繰り返し使われるようなものではないので、使い易さはそれ程重要でないと判断しました。
( 当初は、セッションハンドル等を隠蔽する形でクラスライブラリとして使いやすく設計しようとしましたが、工数をかける意味があまりない。)

結局、PHPの[[LDAP関数|http://php.s3.to/man/ref.ldap.html]] をそのまま拡張ライブラリをしてバンドルしたので、ユーザーはそれを使用することになります。
ただし、[[SASL認証|http://asg.web.cmu.edu/sasl/]]に関しては、PHP4でサポートされていないため別途ユーテリティ関数を用意しました。

尚、現在 [[EDS|http://www.ace.comp.nec.co.jp/eds/]] ( Enterprise Directory Server ) 等のOEM契約等を進めているので、それによっては、LDAPSDKの部分をOpenLDAPから挿げ替える可能性があるので、その点も視野にいれて設計する。）

また、[[マニュアル|http://php.s3.to/man/ref.ldap.html]] を読むと、windowsで使用する場合は、「システムディレクトリに ''libsasl.dll'' をコピーする必要がある」と書いてありますが、その点はシステムには一切影響がないようにする。

[[サンプル|section:sample]]
[[一般的な使用方法|head:]]
[[マニュアル|http://php.s3.to/man/ref.ldap.html]]における、 LDAP検索の例を参考にしてください。

[[SASL認証( DIGEST-MD5 )|head:]]
[[src]]
<?php
require_once( 'fw/ldap.csp' );
{{// LDAPサーバーに接続}}
$ds = ldap_connect( 'localhost', 389 );
{{// 接続失敗 }}
if( FALSE === $ds )
{
    echo "ERROR: ldap_connect\n";
    die();
}
{{// プロトコルバージョンをv3に設定 }}
$ret = ldap_set_option( $ds, LDAP_OPT_PROTOCOL_VERSION, 3 );
if( FALSE === $ret )
{
    echo "ERROR: ldap_set_option\n";
    die();
}
{{// DIGEST-MD5認証}}
$ret = cb_ldap_digest_md5_sasl_bind( $ds, 'cn=bozuman,ou=framework,o=cybozu,c=jp', 'bozuman', 'localhost' );
{{// 認証に失敗した場合}}
if( FALSE === $ret )
{
    echo "ERROR: cb_ldap_digest_md5_sasl_bind\n";
    die();
}
{{// セッションクローズ}}
ldap_close( $ds );
?>
[[/src]]

[[SASL認証( CRAM-MD5 )|head:]]
[[src]]
{{//上記と同様}}
...
{{// CRAM-MD5認証}}
$ret = cb_ldap_cram_md5_sasl_bind( $ds, 'cn=bozuman,ou=framework,o=cybozu,c=jp', 'bozuman' );
{{// 認証に失敗した場合}}
if( FALSE === $ret )
{
    echo "ERROR: cb_ldap_cram_md5_sasl_bind\n";
    die();
}
...
[[/src]]

[[リファレンス|section:source]]
[[フレームワークソース|head:]]
[[fw/ldap.csp|fw/ldap.csp]] ( LDAPライブラリ )