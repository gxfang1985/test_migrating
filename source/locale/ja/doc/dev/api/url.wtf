[[概要|section:abstract]]
Azaleaでは、用途に応じていくつかのURL生成関数を用意しています。
 開発を行う際は必ずこれらのURL生成関数を使わなくてはなりません。理由としては大きく以下の項目が挙げられます。
#標準PHPと [[Cybozu版PHP|doc:ext/azalea_php4]] の両方に対応するため。
 [[Cybozu版PHP|doc:ext/azalea_php4]] のおかげで、''簡単インストール''(webサーバーへの設定が一切不要)、''製品ごとに異なるPHPエンジンが使用可能'' となっています。
ただしメリットばかりではなく、デメリットとしてパフォーマンス的な問題が残りました。(PHPをCGIプロセスとして毎回起動するため)
その対応策として、将来的にはWebサーバーへの組み込みモジュールとして動かせる選択枝を残しています。その際に、これらのURL生成関数を使用していれば、アプリケーション側への変更を一切せずに動作させることができます。
URLの生成方式の切り替えは [[common.ini|doc:ext/config#common.ini]] で簡単に切り替えることが可能ですので参照してください。
#アプリケーションでの一意なURLを生成するため。
 （Azaleaでは異なる製品はもちろん、同一製品でも複数インストールを行えるように設計されています。そのためCGIのディレクトリはもちろん、ドキュメントディレクトリもインストール時に指定するアプリケーションの識別子によって階層化されています。そのためURLはインストール後しか分からないため、動的に生成する必要があります。）
#セッションの仕組みを常に使用可能にするため。
 (クッキーの使用できないブラウザからアクセスされた場合は、セッションの仕組みを利用可能にする為にセッションIDをURLに付与する必要があります。URL生成関数では、HTTP_USER_AGENT環境変数から使用ブラウザの情報を取得し、クッキーの使えないブラウザの場合、自動的にそれらの処理を行ってくれるので開発者はそれを意識する必要がなくなります。)
#URLエンコード、HTMLエスケープなどの処理漏れを防ぐため。

[[関数リファレンス|section:api_refernce]]
[[html]]
<table class="cb_doc_table">
<tr>
<th>
関数名
</th>
<th>
目的
</th>
<th>
使い方の例
</th>
</tr>
<tr>
<td>
[[az:fw.core:include/fw/prepend.csp:cb_format_url]]
</td>
<td>
相対URLを生成する。<br>(URLエンコードのみ行う)
</td>
<td>
cb_format_url( 'foo/bar', array('hoge'=>'fu+ga'))<br>
→ "/scripts/cbfw/php.exe/foo/bar?hoge=fu%2Bga"<br><br>
cb_format_url( 'foo', null, 'hoge' )<br>
→ "/scripts/cbfw/php.exe/foo?#hoge"<br><br>
cb_format_url( 'foo', null, null, 'memo.txt' )<br>
→ "/scripts/cbfw/php.exe/foo/-/memo.txt?"
</td>
</tr>

<tr>
<td>
[[az:fw.core:include/fw/prepend.csp:cb_pageurl]]
</td>
<td>
相対URLを生成する。<br>(上記に加えてHTMLエスケープを行う)
</td>
<td>
HTML中に埋め込む時に使用する。上記参照。
</td>
</tr>

<tr>
<td>
[[az:fw.core:include/fw/prepend.csp:cb_get_full_url]]
</td>
<td>
絶対URLを生成する。<br>(cb_format_url + cb_fully_qualify_url)
</td>
<td>
使用方法は [[az:fw.core:include/fw/prepend.csp:cb_format_url]] と同様。<br><br>
cb_get_full_url( 'foo/bar', array('hoge'=>'fu+ga'))<br>
→ "http://xxx.jp/scripts/cbfw/php.exe/foo/bar?hoge=fu%2Bga"<br><br>
cb_get_full_url( 'foo', null, 'hoge' )<br>
→ "http://xxx.jp/scripts/cbfw/php.exe/foo?#hoge"<br><br>
cb_get_full_url( 'foo', null, null, 'memo.txt' )<br>
→ "http://xxx.jp/scripts/cbfw/php.exe/foo/-/memo.txt?"
</td>
</tr>

<tr>
<td nowrap>
[[az:fw.core:include/fw/prepend.csp:cb_fully_qualify_url]]
</td>
<td>
相対URLから絶対URLを生成する。
</td>
<td>
内部的に使用することを想定しており、通常は使用しない。
</td>
</tr>
</table>
[[/html]]

[[フレームワーク・ソースコード|section:source]]
[[前処理スクリプト (include/fw/prepend.csp) |include/fw/prepend.csp]]
