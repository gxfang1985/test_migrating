[[初期化とは|section:abstract]]

アゼリアでは複数インストールに対応する都合上、
MySQL に予めデータベースやテーブルを作成しておくことは困難である。
必然的にインストール後、データベースの初期化作業が必要となる。 

ここではアゼリア上に作られた製品（アプリケーション）が、
内部のデータ構造などを初期化する手順を解説する。 

[[初期化の構成|section:structure]]

アゼリアでは内部コンポーネントのモジュラリティを確保するため、
以下のような枠組みで初期化を構成している。 

*各モジュールごとに自己の初期化処理を定義する 
*各モジュールごとに自己を再初期化可能とする 
*アプリケーション全体の初期化では、依存関係を考慮しつつ全モジュールの初期化処理を行う

[[モジュール別の初期化|section:module]]

モジュールごとに自分の管理するデータベーステーブルやディレクトリの管理を行うスクリプトを用意する。
例えばフレームワークとしては [[include/fw/initialize.csp]]、
サンプル掲示板では [[include/demo_bulletin/initialize.csp]] 
というスクリプトでそれぞれ行っている。 

初期化スクリプトの形式は強制しないが、
下記に推奨する仕様を示すので可能な限りは従うこと。 

*初期化スクリプト名は "initialize.csp" とし、各モジュールのインクルードディレクトリに配置する
*初期化スクリプトを 2 回以上呼び出された場合、再初期化動作を行うようにする。
例えばテーブルを drop し、再作成するなど。サンプル掲示板の初期化スクリプト 
（[[include/demo_bulletin/initialize.csp]]）が参考になる。 

[[アプリケーション全体の初期化（サンプルアプリケーションの初期化）|section:app]]
アゼリアでは、以下の枠組みからなるモジュールを組み合わせたアプリケーションとしての初期化方法も提供している。

#初期化フラグを [[common.ini|doc:ext/config#common.ini]] の [Database] initialized 設定で管理 
#初期化フラグが立っていない状態で [[index.csp]] にアクセスすると、
[[initialize.csp]] に強制リダイレクトする
#[[initialize.csp]] から [[command_initialize.csp]] が呼び出される
#[[command_initialize.csp]] 内では[[汎用プラグイン機構|doc:pg/basic/plugin]]を利用して 
"code/plugin/init" 以下の初期化スクリプトを順々に読み込み、各モジュールを初期化する

アゼリアに付随するサンプルアプリケーションで、データベーステーブル作成などの初期化が必要なものについては、全て、このようなプラグインスクリプトを用意する必要がある。アゼリア全体の初期化が行われた際には、この機構により、全てのサンプルアプリケーションが再初期化される。サンプルアプリケーションの開発者は注意すること。

なお、プラグインスクリプトの中身は、
通常対応するモジュールの初期化スクリプトを include するだけのものになる。
初期化スクリプト自体は3項で示されたガイドラインに則る。
詳細は [[code/plugin/init/index.html]] 
および [[code/plugin/init/99demo_bulletin.csp]] などを参照せよ。

[[フレームワークソース|section:source]]

*アプリケーション初期化ページ （[[initialize.csp]]） 
*アプリケーション初期化スクリプト （[[command_initialize.csp]]） 
*フレームワークの初期化（本体） （[[include/fw/initialize.csp]]） 
*フレームワークの初期化（プラグイン） （[[plugin/init/00fw.csp]]） 
*サンプル掲示板の初期化（本体） （[[include/demo_bulletin/initialize.csp]]） 
*サンプル掲示板の初期化（プラグイン） （[[plugin/init/99demo_bulletin.csp]]） 
